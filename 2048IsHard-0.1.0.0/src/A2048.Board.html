<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-|
Module      : A2048.Board
Description : Game board for the 2048 game.
Copyright   : (c) Xie Ruifeng, 2020
License     : AGPL-3
Maintainer  : krantz.xrf@outlook.com
Stability   : experimental
Portability : portable
-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-11"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">A2048.Board</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-12"></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Applicative</span></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Reader</span></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State</span></span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Graphics.SvgTree</span></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Reanimate</span></span><span>
</span><span id="line-20"></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Common.Object.Types</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">roundedRect</span></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="A2048.Config.html"><span class="hs-identifier">A2048.Config</span></a></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="A2048.Tile.html"><span class="hs-identifier">A2048.Tile</span></a></span><span>
</span><span id="line-25"></span><span>
</span><span id="line-26"></span><span class="hs-comment">-- |Game board: board = [row], row = [tile].</span><span>
</span><span id="line-27"></span><span class="hs-keyword">type</span><span> </span><span id="Board"><span class="annot"><a href="A2048.Board.html#Board"><span class="hs-identifier hs-var">Board</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span class="hs-comment">-- |The 2048 game monad, a concrete instance for 'Monad2048' constraint.</span><span>
</span><span id="line-30"></span><span class="hs-keyword">type</span><span> </span><span id="Game"><span class="annot"><a href="A2048.Board.html#Game"><span class="hs-identifier hs-var">Game</span></a></span></span><span> </span><span id="local-6989586621679182628"><span class="annot"><a href="#local-6989586621679182628"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="annot"><a href="A2048.Config.html#Game2048Config"><span class="hs-identifier hs-type">Game2048Config</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">State</span></span><span> </span><span class="annot"><a href="A2048.Board.html#Board"><span class="hs-identifier hs-type">Board</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679182628"><span class="hs-identifier hs-type">x</span></a></span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span class="hs-comment">-- |All game actions run in a 'Monad2048' monad.</span><span>
</span><span id="line-33"></span><span class="hs-keyword">type</span><span> </span><span id="Monad2048"><span class="annot"><a href="A2048.Board.html#Monad2048"><span class="hs-identifier hs-var">Monad2048</span></a></span></span><span> </span><span id="local-6989586621679182627"><span class="annot"><a href="#local-6989586621679182627"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="annot"><a href="A2048.Board.html#Board"><span class="hs-identifier hs-type">Board</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679182627"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="A2048.Config.html#Game2048Config"><span class="hs-identifier hs-type">Game2048Config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679182627"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span class="hs-comment">-- |Position of the selected grid, pure function.</span><span>
</span><span id="line-36"></span><span class="annot"><a href="A2048.Board.html#gridPos"><span class="hs-identifier hs-type">gridPos</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="A2048.Config.html#Game2048Config"><span class="hs-identifier hs-type">Game2048Config</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span id="gridPos"><span class="annot"><span class="annottext">gridPos :: Game2048Config -&gt; (Double, Double) -&gt; (Double, Double)
</span><a href="A2048.Board.html#gridPos"><span class="hs-identifier hs-var hs-var">gridPos</span></a></span></span><span> </span><span class="annot"><a href="A2048.Config.html#Game2048Config"><span class="hs-identifier hs-type">Game2048Config</span></a></span><span class="hs-special">{</span><span id="local-6989586621679182610"><span id="local-6989586621679182611"><span id="local-6989586621679182612"><span id="local-6989586621679182613"><span id="local-6989586621679182614"><span id="local-6989586621679182615"><span id="local-6989586621679182616"><span id="local-6989586621679182617"><span id="local-6989586621679182618"><span id="local-6989586621679182619"><span id="local-6989586621679182620"><span id="local-6989586621679182621"><span id="local-6989586621679182622"><span id="local-6989586621679182623"><span id="local-6989586621679182624"><span class="annot"><span class="annottext">Bool
Double
Int
[Texture]
Texture
TileLabelMode
_motionDuration :: Game2048Config -&gt; Double
_motionFillPadding :: Game2048Config -&gt; Bool
_boardFillColour :: Game2048Config -&gt; Texture
_boardGridColour :: Game2048Config -&gt; Texture
_boardBorderSize :: Game2048Config -&gt; Double
_boardGapSize :: Game2048Config -&gt; Double
_boardHeight :: Game2048Config -&gt; Int
_boardWidth :: Game2048Config -&gt; Int
_tileLabelMode :: Game2048Config -&gt; TileLabelMode
_tileShowLabel :: Game2048Config -&gt; Bool
_tileTextColour :: Game2048Config -&gt; [Texture]
_tileFillColour :: Game2048Config -&gt; [Texture]
_tileTextScaleRatio :: Game2048Config -&gt; Double
_tileRadius :: Game2048Config -&gt; Double
_tileSize :: Game2048Config -&gt; Double
_motionDuration :: Double
_motionFillPadding :: Bool
_boardFillColour :: Texture
_boardGridColour :: Texture
_boardBorderSize :: Double
_boardGapSize :: Double
_boardHeight :: Int
_boardWidth :: Int
_tileLabelMode :: TileLabelMode
_tileShowLabel :: Bool
_tileTextColour :: [Texture]
_tileFillColour :: [Texture]
_tileTextScaleRatio :: Double
_tileRadius :: Double
_tileSize :: Double
</span><a href="A2048.Config.html#_motionDuration"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679182594"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679182594"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679182593"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679182593"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679182592"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679182591"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-38"></span><span>  </span><span id="local-6989586621679182590"><span class="annot"><span class="annottext">sx :: Double
</span><a href="#local-6989586621679182590"><span class="hs-identifier hs-var hs-var">sx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679182617"><span class="hs-identifier hs-var">_boardWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">2</span></span><span>
</span><span id="line-39"></span><span>  </span><span id="local-6989586621679182588"><span class="annot"><span class="annottext">sy :: Double
</span><a href="#local-6989586621679182588"><span class="hs-identifier hs-var hs-var">sy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679182616"><span class="hs-identifier hs-var">_boardHeight</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">2</span></span><span>
</span><span id="line-40"></span><span>  </span><span id="local-6989586621679182592"><span class="annot"><span class="annottext">x :: Double
</span><a href="#local-6989586621679182592"><span class="hs-identifier hs-var hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679182594"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679182590"><span class="hs-identifier hs-var">sx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679182624"><span class="hs-identifier hs-var">_tileSize</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679182615"><span class="hs-identifier hs-var">_boardGapSize</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span>  </span><span id="local-6989586621679182591"><span class="annot"><span class="annottext">y :: Double
</span><a href="#local-6989586621679182591"><span class="hs-identifier hs-var hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679182588"><span class="hs-identifier hs-var">sy</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679182593"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679182624"><span class="hs-identifier hs-var">_tileSize</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679182615"><span class="hs-identifier hs-var">_boardGapSize</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span class="hs-comment">-- |Translate to the selected grid, pure function.</span><span>
</span><span id="line-44"></span><span class="annot"><a href="A2048.Board.html#translateGrid"><span class="hs-identifier hs-type">translateGrid</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="A2048.Config.html#Game2048Config"><span class="hs-identifier hs-type">Game2048Config</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SVG</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SVG</span></span><span>
</span><span id="line-45"></span><span id="translateGrid"><span class="annot"><span class="annottext">translateGrid :: Game2048Config -&gt; Double -&gt; Double -&gt; SVG -&gt; SVG
</span><a href="A2048.Board.html#translateGrid"><span class="hs-identifier hs-var hs-var">translateGrid</span></a></span></span><span> </span><span id="local-6989586621679182584"><span class="annot"><span class="annottext">Game2048Config
</span><a href="#local-6989586621679182584"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span id="local-6989586621679182583"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679182583"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621679182582"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679182582"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; SVG -&gt; SVG
</span><span class="hs-identifier hs-var">translate</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679182580"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679182579"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679182580"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679182580"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679182579"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679182579"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Game2048Config -&gt; (Double, Double) -&gt; (Double, Double)
</span><a href="A2048.Board.html#gridPos"><span class="hs-identifier hs-var">gridPos</span></a></span><span> </span><span class="annot"><span class="annottext">Game2048Config
</span><a href="#local-6989586621679182584"><span class="hs-identifier hs-var">cfg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679182583"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679182582"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span class="hs-comment">-- |Translate to the selected grid.</span><span>
</span><span id="line-48"></span><span id="local-6989586621679182695"><span class="annot"><a href="A2048.Board.html#translateGridM"><span class="hs-identifier hs-type">translateGridM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="A2048.Config.html#Game2048Config"><span class="hs-identifier hs-type">Game2048Config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679182695"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679182695"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SVG</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679182695"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SVG</span></span></span><span>
</span><span id="line-49"></span><span id="translateGridM"><span class="annot"><span class="annottext">translateGridM :: Double -&gt; Double -&gt; m SVG -&gt; m SVG
</span><a href="A2048.Board.html#translateGridM"><span class="hs-identifier hs-var hs-var">translateGridM</span></a></span></span><span> </span><span id="local-6989586621679182577"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679182577"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621679182576"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679182576"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679182575"><span class="annot"><span class="annottext">m SVG
</span><a href="#local-6989586621679182575"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m Game2048Config
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span> </span><span class="annot"><span class="annottext">m Game2048Config -&gt; (Game2048Config -&gt; m SVG) -&gt; m SVG
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679182573"><span class="annot"><span class="annottext">Game2048Config
</span><a href="#local-6989586621679182573"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Game2048Config -&gt; Double -&gt; Double -&gt; SVG -&gt; SVG
</span><a href="A2048.Board.html#translateGrid"><span class="hs-identifier hs-var">translateGrid</span></a></span><span> </span><span class="annot"><span class="annottext">Game2048Config
</span><a href="#local-6989586621679182573"><span class="hs-identifier hs-var">cfg</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679182577"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679182576"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">(SVG -&gt; SVG) -&gt; m SVG -&gt; m SVG
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">m SVG
</span><a href="#local-6989586621679182575"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-50"></span><span>
</span><span id="line-51"></span><span class="hs-comment">-- |Traverse all grids.</span><span>
</span><span id="line-52"></span><span id="local-6989586621679182691"><span class="annot"><a href="A2048.Board.html#foreachGrid"><span class="hs-identifier hs-type">foreachGrid</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="A2048.Board.html#Monad2048"><span class="hs-identifier hs-type">Monad2048</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679182691"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679182691"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SVG</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679182691"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">SVG</span></span><span class="hs-special">]</span></span><span>
</span><span id="line-53"></span><span id="foreachGrid"><span class="annot"><span class="annottext">foreachGrid :: (Int -&gt; m SVG) -&gt; m [SVG]
</span><a href="A2048.Board.html#foreachGrid"><span class="hs-identifier hs-var hs-var">foreachGrid</span></a></span></span><span> </span><span id="local-6989586621679182570"><span class="annot"><span class="annottext">Int -&gt; m SVG
</span><a href="#local-6989586621679182570"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m [[Int]]
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span> </span><span class="annot"><span class="annottext">m [[Int]] -&gt; ([[Int]] -&gt; m [SVG]) -&gt; m [SVG]
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679182568"><span class="annot"><span class="annottext">[[Int]]
</span><a href="#local-6989586621679182568"><span class="hs-identifier hs-var">board</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[m SVG] -&gt; m [SVG]
forall (t :: * -&gt; *) (f :: * -&gt; *) a.
(Traversable t, Applicative f) =&gt;
t (f a) -&gt; f (t a)
</span><span class="hs-identifier hs-var">sequenceA</span></span><span>
</span><span id="line-54"></span><span>  </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; m SVG -&gt; m SVG
forall (m :: * -&gt; *).
MonadReader Game2048Config m =&gt;
Double -&gt; Double -&gt; m SVG -&gt; m SVG
</span><a href="A2048.Board.html#translateGridM"><span class="hs-identifier hs-var">translateGridM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679182566"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679182565"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; m SVG
</span><a href="#local-6989586621679182570"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679182564"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679182565"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679182565"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679182563"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679182563"><span class="hs-identifier hs-var">row</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; [[Int]] -&gt; [(Int, [Int])]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[[Int]]
</span><a href="#local-6989586621679182568"><span class="hs-identifier hs-var">board</span></a></span><span>
</span><span id="line-56"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679182566"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679182566"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679182564"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679182564"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; [Int] -&gt; [(Int, Int)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679182563"><span class="hs-identifier hs-var">row</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-57"></span><span>
</span><span id="line-58"></span><span class="hs-comment">-- |Traverse all non-empty grids.</span><span>
</span><span id="line-59"></span><span id="local-6989586621679182562"><span class="annot"><a href="A2048.Board.html#foreachNonEmptyGrid"><span class="hs-identifier hs-type">foreachNonEmptyGrid</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="A2048.Board.html#Monad2048"><span class="hs-identifier hs-type">Monad2048</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679182562"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679182562"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SVG</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679182562"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">SVG</span></span><span class="hs-special">]</span></span><span>
</span><span id="line-60"></span><span id="foreachNonEmptyGrid"><span class="annot"><span class="annottext">foreachNonEmptyGrid :: (Int -&gt; m SVG) -&gt; m [SVG]
</span><a href="A2048.Board.html#foreachNonEmptyGrid"><span class="hs-identifier hs-var hs-var">foreachNonEmptyGrid</span></a></span></span><span> </span><span id="local-6989586621679182560"><span class="annot"><span class="annottext">Int -&gt; m SVG
</span><a href="#local-6989586621679182560"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; m SVG) -&gt; m [SVG]
forall (m :: * -&gt; *). Monad2048 m =&gt; (Int -&gt; m SVG) -&gt; m [SVG]
</span><a href="A2048.Board.html#foreachGrid"><span class="hs-identifier hs-var">foreachGrid</span></a></span><span> </span><span class="annot"><span class="annottext">((Int -&gt; m SVG) -&gt; m [SVG]) -&gt; (Int -&gt; m SVG) -&gt; m [SVG]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679182559"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679182559"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679182559"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int -&gt; m SVG
</span><a href="#local-6989586621679182560"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679182559"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">SVG -&gt; m SVG
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">SVG
</span><span class="hs-identifier hs-var">None</span></span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span class="hs-comment">-- |Generate an SVG image for the empty board.</span><span>
</span><span id="line-63"></span><span id="local-6989586621679182658"><span class="annot"><a href="A2048.Board.html#boardSVG"><span class="hs-identifier hs-type">boardSVG</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="A2048.Board.html#Monad2048"><span class="hs-identifier hs-type">Monad2048</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679182658"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679182658"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SVG</span></span></span><span>
</span><span id="line-64"></span><span id="boardSVG"><span class="annot"><span class="annottext">boardSVG :: m SVG
</span><a href="A2048.Board.html#boardSVG"><span class="hs-identifier hs-var hs-var">boardSVG</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-65"></span><span>  </span><span class="annot"><a href="A2048.Config.html#Game2048Config"><span class="hs-identifier hs-type">Game2048Config</span></a></span><span class="hs-special">{</span><span id="local-6989586621679182541"><span id="local-6989586621679182542"><span id="local-6989586621679182543"><span id="local-6989586621679182544"><span id="local-6989586621679182545"><span id="local-6989586621679182546"><span id="local-6989586621679182547"><span id="local-6989586621679182548"><span id="local-6989586621679182549"><span id="local-6989586621679182550"><span id="local-6989586621679182551"><span id="local-6989586621679182552"><span id="local-6989586621679182553"><span id="local-6989586621679182554"><span id="local-6989586621679182555"><span class="annot"><span class="annottext">Bool
Double
Int
[Texture]
Texture
TileLabelMode
_motionDuration :: Double
_motionFillPadding :: Bool
_boardFillColour :: Texture
_boardGridColour :: Texture
_boardBorderSize :: Double
_boardGapSize :: Double
_boardHeight :: Int
_boardWidth :: Int
_tileLabelMode :: TileLabelMode
_tileShowLabel :: Bool
_tileTextColour :: [Texture]
_tileFillColour :: [Texture]
_tileTextScaleRatio :: Double
_tileRadius :: Double
_tileSize :: Double
_motionDuration :: Game2048Config -&gt; Double
_motionFillPadding :: Game2048Config -&gt; Bool
_boardFillColour :: Game2048Config -&gt; Texture
_boardGridColour :: Game2048Config -&gt; Texture
_boardBorderSize :: Game2048Config -&gt; Double
_boardGapSize :: Game2048Config -&gt; Double
_boardHeight :: Game2048Config -&gt; Int
_boardWidth :: Game2048Config -&gt; Int
_tileLabelMode :: Game2048Config -&gt; TileLabelMode
_tileShowLabel :: Game2048Config -&gt; Bool
_tileTextColour :: Game2048Config -&gt; [Texture]
_tileFillColour :: Game2048Config -&gt; [Texture]
_tileTextScaleRatio :: Game2048Config -&gt; Double
_tileRadius :: Game2048Config -&gt; Double
_tileSize :: Game2048Config -&gt; Double
</span><a href="#local-6989586621679182541"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m Game2048Config
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-66"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679182540"><span class="annot"><span class="annottext">w :: Double
</span><a href="#local-6989586621679182540"><span class="hs-identifier hs-var hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679182548"><span class="hs-identifier hs-var">_boardWidth</span></a></span><span>
</span><span id="line-67"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679182539"><span class="annot"><span class="annottext">h :: Double
</span><a href="#local-6989586621679182539"><span class="hs-identifier hs-var hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679182547"><span class="hs-identifier hs-var">_boardHeight</span></a></span><span>
</span><span id="line-68"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679182538"><span class="annot"><span class="annottext">bw :: Double
</span><a href="#local-6989586621679182538"><span class="hs-identifier hs-var hs-var">bw</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679182540"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679182555"><span class="hs-identifier hs-var">_tileSize</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679182540"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679182546"><span class="hs-identifier hs-var">_boardGapSize</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679182545"><span class="hs-identifier hs-var">_boardBorderSize</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">2</span></span><span>
</span><span id="line-69"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679182537"><span class="annot"><span class="annottext">bh :: Double
</span><a href="#local-6989586621679182537"><span class="hs-identifier hs-var hs-var">bh</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679182539"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679182555"><span class="hs-identifier hs-var">_tileSize</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679182539"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679182546"><span class="hs-identifier hs-var">_boardGapSize</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679182545"><span class="hs-identifier hs-var">_boardBorderSize</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">2</span></span><span>
</span><span id="line-70"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679182536"><span class="annot"><span class="annottext">bg :: Maybe Texture
</span><a href="#local-6989586621679182536"><span class="hs-identifier hs-var hs-var">bg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Texture -&gt; Maybe Texture
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Texture
</span><a href="#local-6989586621679182543"><span class="hs-identifier hs-var">_boardFillColour</span></a></span><span>
</span><span id="line-71"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679182535"><span class="annot"><span class="annottext">boardRect :: SVG
</span><a href="#local-6989586621679182535"><span class="hs-identifier hs-var hs-var">boardRect</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double -&gt; SVG
</span><span class="hs-identifier hs-var">roundedRect</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679182538"><span class="hs-identifier hs-var">bw</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679182537"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679182554"><span class="hs-identifier hs-var">_tileRadius</span></a></span><span> </span><span class="annot"><span class="annottext">SVG -&gt; (SVG -&gt; SVG) -&gt; SVG
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Texture -&gt; Identity (Maybe Texture)) -&gt; SVG -&gt; Identity SVG
forall c. HasDrawAttributes c =&gt; Lens' c (Maybe Texture)
</span><span class="hs-identifier hs-var">fillColor</span></span><span> </span><span class="annot"><span class="annottext">((Maybe Texture -&gt; Identity (Maybe Texture))
 -&gt; SVG -&gt; Identity SVG)
-&gt; Maybe Texture -&gt; SVG -&gt; SVG
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">Maybe Texture
</span><a href="#local-6989586621679182536"><span class="hs-identifier hs-var">bg</span></a></span><span>
</span><span id="line-72"></span><span>  </span><span class="annot"><span class="annottext">[SVG] -&gt; SVG
</span><span class="hs-identifier hs-var">mkGroup</span></span><span> </span><span class="annot"><span class="annottext">([SVG] -&gt; SVG) -&gt; ([SVG] -&gt; [SVG]) -&gt; [SVG] -&gt; SVG
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SVG
</span><a href="#local-6989586621679182535"><span class="hs-identifier hs-var">boardRect</span></a></span><span> </span><span class="annot"><span class="annottext">SVG -&gt; [SVG] -&gt; [SVG]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([SVG] -&gt; SVG) -&gt; m [SVG] -&gt; m SVG
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; m SVG) -&gt; m [SVG]
forall (m :: * -&gt; *). Monad2048 m =&gt; (Int -&gt; m SVG) -&gt; m [SVG]
</span><a href="A2048.Board.html#foreachGrid"><span class="hs-identifier hs-var">foreachGrid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">m SVG -&gt; Int -&gt; m SVG
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">m SVG
forall c (m :: * -&gt; *).
(HasGame2048Config c, MonadReader c m) =&gt;
m SVG
</span><a href="A2048.Tile.html#emptyTile"><span class="hs-identifier hs-var">emptyTile</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span class="hs-comment">-- |Take a snapshot of the current game status.</span><span>
</span><span id="line-75"></span><span id="local-6989586621679182527"><span class="annot"><a href="A2048.Board.html#snapshot"><span class="hs-identifier hs-type">snapshot</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="A2048.Board.html#Monad2048"><span class="hs-identifier hs-type">Monad2048</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679182527"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679182527"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SVG</span></span></span><span>
</span><span id="line-76"></span><span id="snapshot"><span class="annot"><span class="annottext">snapshot :: m SVG
</span><a href="A2048.Board.html#snapshot"><span class="hs-identifier hs-var hs-var">snapshot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SVG] -&gt; SVG
</span><span class="hs-identifier hs-var">mkGroup</span></span><span> </span><span class="annot"><span class="annottext">([SVG] -&gt; SVG) -&gt; m [SVG] -&gt; m SVG
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(SVG -&gt; [SVG] -&gt; [SVG]) -&gt; m SVG -&gt; m [SVG] -&gt; m [SVG]
forall (f :: * -&gt; *) a b c.
Applicative f =&gt;
(a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c
</span><span class="hs-identifier hs-var">liftA2</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m SVG
forall (m :: * -&gt; *). Monad2048 m =&gt; m SVG
</span><a href="A2048.Board.html#boardSVG"><span class="hs-identifier hs-var">boardSVG</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int -&gt; m SVG) -&gt; m [SVG]
forall (m :: * -&gt; *). Monad2048 m =&gt; (Int -&gt; m SVG) -&gt; m [SVG]
</span><a href="A2048.Board.html#foreachGrid"><span class="hs-identifier hs-var">foreachGrid</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; m SVG
forall c (m :: * -&gt; *).
(HasGame2048Config c, MonadReader c m) =&gt;
Int -&gt; m SVG
</span><a href="A2048.Tile.html#tile"><span class="hs-identifier hs-var">tile</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span class="hs-comment">-- |Emit a static animation for the current game status.</span><span>
</span><span id="line-79"></span><span id="local-6989586621679182650"><span class="annot"><a href="A2048.Board.html#hold"><span class="hs-identifier hs-type">hold</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="A2048.Board.html#Monad2048"><span class="hs-identifier hs-type">Monad2048</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679182650"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679182650"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Animation</span></span></span><span>
</span><span id="line-80"></span><span id="hold"><span class="annot"><span class="annottext">hold :: Double -&gt; m Animation
</span><a href="A2048.Board.html#hold"><span class="hs-identifier hs-var hs-var">hold</span></a></span></span><span> </span><span id="local-6989586621679182522"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679182522"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; SVG -&gt; Animation
</span><span class="hs-identifier hs-var">staticFrame</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679182522"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">(SVG -&gt; Animation) -&gt; m SVG -&gt; m Animation
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">m SVG
forall (m :: * -&gt; *). Monad2048 m =&gt; m SVG
</span><a href="A2048.Board.html#snapshot"><span class="hs-identifier hs-var">snapshot</span></a></span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span class="hs-comment">-- |Emit a static animation for the current game status.</span><span>
</span><span id="line-83"></span><span id="local-6989586621679182520"><span class="annot"><a href="A2048.Board.html#holdWith"><span class="hs-identifier hs-type">holdWith</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="A2048.Board.html#Monad2048"><span class="hs-identifier hs-type">Monad2048</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679182520"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="A2048.Config.html#TileLabelMode"><span class="hs-identifier hs-type">TileLabelMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679182520"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Animation</span></span></span><span>
</span><span id="line-84"></span><span id="holdWith"><span class="annot"><span class="annottext">holdWith :: TileLabelMode -&gt; Double -&gt; m Animation
</span><a href="A2048.Board.html#holdWith"><span class="hs-identifier hs-var hs-var">holdWith</span></a></span></span><span> </span><span id="local-6989586621679182518"><span class="annot"><span class="annottext">TileLabelMode
</span><a href="#local-6989586621679182518"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Game2048Config -&gt; Game2048Config) -&gt; m Animation -&gt; m Animation
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; r) -&gt; m a -&gt; m a
</span><span class="hs-identifier hs-var">local</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TileLabelMode -&gt; Identity TileLabelMode)
-&gt; Game2048Config -&gt; Identity Game2048Config
forall c. HasGame2048Config c =&gt; Lens' c TileLabelMode
</span><a href="A2048.Config.html#tileLabelMode"><span class="hs-identifier hs-var">tileLabelMode</span></a></span><span> </span><span class="annot"><span class="annottext">((TileLabelMode -&gt; Identity TileLabelMode)
 -&gt; Game2048Config -&gt; Identity Game2048Config)
-&gt; TileLabelMode -&gt; Game2048Config -&gt; Game2048Config
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">TileLabelMode
</span><a href="#local-6989586621679182518"><span class="hs-identifier hs-var">mode</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m Animation -&gt; m Animation)
-&gt; (Double -&gt; m Animation) -&gt; Double -&gt; m Animation
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; m Animation
forall (m :: * -&gt; *). Monad2048 m =&gt; Double -&gt; m Animation
</span><a href="A2048.Board.html#hold"><span class="hs-identifier hs-var">hold</span></a></span><span>
</span><span id="line-85"></span><span>
</span><span id="line-86"></span><span class="hs-comment">-- |Convert a 'Monad2048' action to an animation.</span><span>
</span><span id="line-87"></span><span id="local-6989586621679182633"><span class="annot"><a href="A2048.Board.html#gameAnimation"><span class="hs-identifier hs-type">gameAnimation</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="A2048.Config.html#Game2048Config"><span class="hs-identifier hs-type">Game2048Config</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="A2048.Board.html#Game"><span class="hs-identifier hs-type">Game</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679182633"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679182633"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-88"></span><span id="gameAnimation"><span class="annot"><span class="annottext">gameAnimation :: Game2048Config -&gt; Game a -&gt; a
</span><a href="A2048.Board.html#gameAnimation"><span class="hs-identifier hs-var hs-var">gameAnimation</span></a></span></span><span> </span><span id="local-6989586621679182514"><span class="annot"><span class="annottext">Game2048Config
</span><a href="#local-6989586621679182514"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span id="local-6989586621679182513"><span class="annot"><span class="annottext">Game a
</span><a href="#local-6989586621679182513"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-89"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679182512"><span class="annot"><span class="annottext">b :: [[Int]]
</span><a href="#local-6989586621679182512"><span class="hs-identifier hs-var hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Int] -&gt; [[Int]]
forall a. Int -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">replicate</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Getting Int Game2048Config Int -&gt; Game2048Config -&gt; Int
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">Getting Int Game2048Config Int
forall c. HasGame2048Config c =&gt; Lens' c Int
</span><a href="A2048.Config.html#boardHeight"><span class="hs-identifier hs-var">boardHeight</span></a></span><span> </span><span class="annot"><span class="annottext">Game2048Config
</span><a href="#local-6989586621679182514"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span>        </span><span class="annot"><span class="annottext">([Int] -&gt; [[Int]]) -&gt; [Int] -&gt; [[Int]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; [Int]
forall a. Int -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">replicate</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Getting Int Game2048Config Int -&gt; Game2048Config -&gt; Int
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">Getting Int Game2048Config Int
forall c. HasGame2048Config c =&gt; Lens' c Int
</span><a href="A2048.Config.html#boardWidth"><span class="hs-identifier hs-var">boardWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Game2048Config
</span><a href="#local-6989586621679182514"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-91"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">State [[Int]] a -&gt; [[Int]] -&gt; a
forall s a. State s a -&gt; s -&gt; a
</span><span class="hs-identifier hs-var">evalState</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Game a -&gt; Game2048Config -&gt; State [[Int]] a
forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><span class="hs-identifier hs-var hs-var">runReaderT</span></span><span> </span><span class="annot"><span class="annottext">Game a
</span><a href="#local-6989586621679182513"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">Game2048Config
</span><a href="#local-6989586621679182514"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[[Int]]
</span><a href="#local-6989586621679182512"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span class="hs-comment">-- |Make a pure 'Animation' from a 'Game' monad.</span><span>
</span><span id="line-94"></span><span id="local-6989586621679182504"><span id="local-6989586621679182505"><span class="annot"><a href="A2048.Board.html#mkPure"><span class="hs-identifier hs-type">mkPure</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="A2048.Board.html#Monad2048"><span class="hs-identifier hs-type">Monad2048</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679182505"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Time</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="A2048.Board.html#Game"><span class="hs-identifier hs-type">Game</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679182504"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679182505"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Time</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679182504"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-95"></span><span id="mkPure"><span class="annot"><span class="annottext">mkPure :: (Double -&gt; Game a) -&gt; m (Double -&gt; a)
</span><a href="A2048.Board.html#mkPure"><span class="hs-identifier hs-var hs-var">mkPure</span></a></span></span><span> </span><span id="local-6989586621679182501"><span class="annot"><span class="annottext">Double -&gt; Game a
</span><a href="#local-6989586621679182501"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-96"></span><span>  </span><span id="local-6989586621679182500"><span class="annot"><span class="annottext">Game2048Config
</span><a href="#local-6989586621679182500"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m Game2048Config
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span class="hs-special">;</span><span> </span><span id="local-6989586621679182499"><span class="annot"><span class="annottext">[[Int]]
</span><a href="#local-6989586621679182499"><span class="hs-identifier hs-var">bd</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m [[Int]]
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-97"></span><span>  </span><span class="annot"><span class="annottext">(Double -&gt; a) -&gt; m (Double -&gt; a)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679182498"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679182498"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Game2048Config -&gt; Game a -&gt; a
forall a. Game2048Config -&gt; Game a -&gt; a
</span><a href="A2048.Board.html#gameAnimation"><span class="hs-identifier hs-var">gameAnimation</span></a></span><span> </span><span class="annot"><span class="annottext">Game2048Config
</span><a href="#local-6989586621679182500"><span class="hs-identifier hs-var">cfg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[[Int]] -&gt; ReaderT Game2048Config (State [[Int]]) ()
forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">put</span></span><span> </span><span class="annot"><span class="annottext">[[Int]]
</span><a href="#local-6989586621679182499"><span class="hs-identifier hs-var">bd</span></a></span><span> </span><span class="annot"><span class="annottext">ReaderT Game2048Config (State [[Int]]) () -&gt; Game a -&gt; Game a
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Game a
</span><a href="#local-6989586621679182501"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679182498"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-98"></span></pre></body></html>