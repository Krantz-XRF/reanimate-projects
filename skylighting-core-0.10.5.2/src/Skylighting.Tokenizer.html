<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# OPTIONS_GHC -fno-warn-missing-methods #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE CPP                   #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DeriveFunctor         #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances     #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings     #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE StandaloneDeriving    #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE TypeSynonymInstances  #-}</span><span>
</span><span id="line-9"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Skylighting.Tokenizer</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-10"></span><span>    </span><span class="annot"><a href="Skylighting.Tokenizer.html#tokenize"><span class="hs-identifier">tokenize</span></a></span><span>
</span><span id="line-11"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerConfig"><span class="hs-identifier">TokenizerConfig</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Applicative</span></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Except</span></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Reader</span></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State.Strict</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Attoparsec.ByteString.Char8</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">A</span></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Char8</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ByteString</span></span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Char8</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BS</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.UTF8</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">UTF8</span></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.CaseInsensitive</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">mk</span></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Char</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">isAlphaNum</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">isAscii</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">isDigit</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">isLetter</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">isSpace</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ord</span></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.IntMap</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">IntMap</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">catMaybes</span></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Text</span></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Text</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.Encoding</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">decodeUtf8'</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">encodeUtf8</span></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Debug.Trace</span></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Skylighting.Regex.html"><span class="hs-identifier">Skylighting.Regex</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Skylighting.Types.html"><span class="hs-identifier">Skylighting.Types</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List.NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NonEmpty</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(:|)</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(&lt;|)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">toList</span></span><span class="hs-special">)</span><span class="hs-cpp">
#if !MIN_VERSION_base(4,11,0)
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Semigroup</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-39"></span><span class="hs-keyword">newtype</span><span> </span><span id="ContextStack"><span class="annot"><a href="Skylighting.Tokenizer.html#ContextStack"><span class="hs-identifier hs-var">ContextStack</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ContextStack"><span class="annot"><a href="Skylighting.Tokenizer.html#ContextStack"><span class="hs-identifier hs-var">ContextStack</span></a></span></span><span class="hs-special">{</span><span> </span><span id="unContextStack"><span class="annot"><span class="annottext">ContextStack -&gt; NonEmpty Context
</span><a href="Skylighting.Tokenizer.html#unContextStack"><span class="hs-identifier hs-var hs-var">unContextStack</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="annot"><a href="Skylighting.Types.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-40"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679139432"><span id="local-6989586621679139434"><span id="local-6989586621679139436"><span class="annot"><span class="annottext">Int -&gt; ContextStack -&gt; ShowS
[ContextStack] -&gt; ShowS
ContextStack -&gt; String
(Int -&gt; ContextStack -&gt; ShowS)
-&gt; (ContextStack -&gt; String)
-&gt; ([ContextStack] -&gt; ShowS)
-&gt; Show ContextStack
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ContextStack] -&gt; ShowS
$cshowList :: [ContextStack] -&gt; ShowS
show :: ContextStack -&gt; String
$cshow :: ContextStack -&gt; String
showsPrec :: Int -&gt; ContextStack -&gt; ShowS
$cshowsPrec :: Int -&gt; ContextStack -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span class="hs-keyword">data</span><span> </span><span id="TokenizerState"><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerState"><span class="hs-identifier hs-var">TokenizerState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="TokenizerState"><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerState"><span class="hs-identifier hs-var">TokenizerState</span></a></span></span><span class="hs-special">{</span><span>
</span><span id="line-43"></span><span>    </span><span id="input"><span class="annot"><span class="annottext">TokenizerState -&gt; ByteString
</span><a href="Skylighting.Tokenizer.html#input"><span class="hs-identifier hs-var hs-var">input</span></a></span></span><span>               </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span>
</span><span id="line-44"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="endline"><span class="annot"><span class="annottext">TokenizerState -&gt; Bool
</span><a href="Skylighting.Tokenizer.html#endline"><span class="hs-identifier hs-var hs-var">endline</span></a></span></span><span>             </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-45"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="prevChar"><span class="annot"><span class="annottext">TokenizerState -&gt; Char
</span><a href="Skylighting.Tokenizer.html#prevChar"><span class="hs-identifier hs-var hs-var">prevChar</span></a></span></span><span>            </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span>
</span><span id="line-46"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="contextStack"><span class="annot"><span class="annottext">TokenizerState -&gt; ContextStack
</span><a href="Skylighting.Tokenizer.html#contextStack"><span class="hs-identifier hs-var hs-var">contextStack</span></a></span></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#ContextStack"><span class="hs-identifier hs-type">ContextStack</span></a></span><span>
</span><span id="line-47"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="captures"><span class="annot"><span class="annottext">TokenizerState -&gt; IntMap ByteString
</span><a href="Skylighting.Tokenizer.html#captures"><span class="hs-identifier hs-var hs-var">captures</span></a></span></span><span>            </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IntMap.IntMap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span>
</span><span id="line-48"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="column"><span class="annot"><span class="annottext">TokenizerState -&gt; Int
</span><a href="Skylighting.Tokenizer.html#column"><span class="hs-identifier hs-var hs-var">column</span></a></span></span><span>              </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-49"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="lineContinuation"><span class="annot"><span class="annottext">TokenizerState -&gt; Bool
</span><a href="Skylighting.Tokenizer.html#lineContinuation"><span class="hs-identifier hs-var hs-var">lineContinuation</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-50"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="firstNonspaceColumn"><span class="annot"><span class="annottext">TokenizerState -&gt; Maybe Int
</span><a href="Skylighting.Tokenizer.html#firstNonspaceColumn"><span class="hs-identifier hs-var hs-var">firstNonspaceColumn</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-51"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="compiledRegexes"><span class="annot"><span class="annottext">TokenizerState -&gt; Map RE Regex
</span><a href="Skylighting.Tokenizer.html#compiledRegexes"><span class="hs-identifier hs-var hs-var">compiledRegexes</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.Map</span></span><span> </span><span class="annot"><a href="Skylighting.Regex.html#RE"><span class="hs-identifier hs-type">RE</span></a></span><span> </span><span class="annot"><a href="Regex.KDE.Regex.html#Regex"><span class="hs-identifier hs-type">Regex</span></a></span><span>
</span><span id="line-52"></span><span class="hs-special">}</span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span class="hs-comment">-- | Configuration options for 'tokenize'.</span><span>
</span><span id="line-55"></span><span class="hs-keyword">data</span><span> </span><span id="TokenizerConfig"><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerConfig"><span class="hs-identifier hs-var">TokenizerConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="TokenizerConfig"><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerConfig"><span class="hs-identifier hs-var">TokenizerConfig</span></a></span></span><span class="hs-special">{</span><span>
</span><span id="line-56"></span><span>    </span><span id="syntaxMap"><span class="annot"><span class="annottext">TokenizerConfig -&gt; SyntaxMap
</span><a href="Skylighting.Tokenizer.html#syntaxMap"><span class="hs-identifier hs-var hs-var">syntaxMap</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Skylighting.Types.html#SyntaxMap"><span class="hs-identifier hs-type">SyntaxMap</span></a></span><span>  </span><span class="hs-comment">-- ^ Syntax map to use</span><span>
</span><span id="line-57"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="traceOutput"><span class="annot"><span class="annottext">TokenizerConfig -&gt; Bool
</span><a href="Skylighting.Tokenizer.html#traceOutput"><span class="hs-identifier hs-var hs-var">traceOutput</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>       </span><span class="hs-comment">-- ^ Generate trace output for debugging</span><span>
</span><span id="line-58"></span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679139412"><span id="local-6989586621679139414"><span id="local-6989586621679139416"><span class="annot"><span class="annottext">Int -&gt; TokenizerConfig -&gt; ShowS
[TokenizerConfig] -&gt; ShowS
TokenizerConfig -&gt; String
(Int -&gt; TokenizerConfig -&gt; ShowS)
-&gt; (TokenizerConfig -&gt; String)
-&gt; ([TokenizerConfig] -&gt; ShowS)
-&gt; Show TokenizerConfig
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [TokenizerConfig] -&gt; ShowS
$cshowList :: [TokenizerConfig] -&gt; ShowS
show :: TokenizerConfig -&gt; String
$cshow :: TokenizerConfig -&gt; String
showsPrec :: Int -&gt; TokenizerConfig -&gt; ShowS
$cshowsPrec :: Int -&gt; TokenizerConfig -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span class="hs-keyword">data</span><span> </span><span id="Result"><span class="annot"><a href="Skylighting.Tokenizer.html#Result"><span class="hs-identifier hs-var">Result</span></a></span></span><span> </span><span id="local-6989586621679139591"><span class="annot"><a href="#local-6989586621679139591"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621679139592"><span class="annot"><a href="#local-6989586621679139592"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Success"><span class="annot"><a href="Skylighting.Tokenizer.html#Success"><span class="hs-identifier hs-var">Success</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621679139592"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-61"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span id="Failure"><span class="annot"><a href="Skylighting.Tokenizer.html#Failure"><span class="hs-identifier hs-var">Failure</span></a></span></span><span>
</span><span id="line-62"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span id="Error"><span class="annot"><a href="Skylighting.Tokenizer.html#Error"><span class="hs-identifier hs-var">Error</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621679139591"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-63"></span><span>     </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679139405"><span id="local-6989586621679139407"><span class="annot"><span class="annottext">a -&gt; Result e b -&gt; Result e a
(a -&gt; b) -&gt; Result e a -&gt; Result e b
(forall a b. (a -&gt; b) -&gt; Result e a -&gt; Result e b)
-&gt; (forall a b. a -&gt; Result e b -&gt; Result e a)
-&gt; Functor (Result e)
forall a b. a -&gt; Result e b -&gt; Result e a
forall a b. (a -&gt; b) -&gt; Result e a -&gt; Result e b
forall e a b. a -&gt; Result e b -&gt; Result e a
forall e a b. (a -&gt; b) -&gt; Result e a -&gt; Result e b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
&lt;$ :: a -&gt; Result e b -&gt; Result e a
$c&lt;$ :: forall e a b. a -&gt; Result e b -&gt; Result e a
fmap :: (a -&gt; b) -&gt; Result e a -&gt; Result e b
$cfmap :: forall e a b. (a -&gt; b) -&gt; Result e a -&gt; Result e b
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span id="local-6989586621679139396"><span id="local-6989586621679139398"><span id="local-6989586621679139400"><span id="local-6989586621679139402"><span id="local-6989586621679139403"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679139403"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679139402"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Skylighting.Tokenizer.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679139402"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679139403"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span class="hs-keyword">data</span><span> </span><span id="TokenizerM"><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerM"><span class="hs-identifier hs-var">TokenizerM</span></a></span></span><span> </span><span id="local-6989586621679139615"><span class="annot"><a href="#local-6989586621679139615"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="TM"><span class="annot"><a href="Skylighting.Tokenizer.html#TM"><span class="hs-identifier hs-var">TM</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="runTokenizerM"><span class="annot"><span class="annottext">TokenizerM a
-&gt; TokenizerConfig
-&gt; TokenizerState
-&gt; (TokenizerState, Result String a)
</span><a href="Skylighting.Tokenizer.html#runTokenizerM"><span class="hs-identifier hs-var hs-var">runTokenizerM</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerConfig"><span class="hs-identifier hs-type">TokenizerConfig</span></a></span><span>
</span><span id="line-68"></span><span>                                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerState"><span class="hs-identifier hs-type">TokenizerState</span></a></span><span>
</span><span id="line-69"></span><span>                                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerState"><span class="hs-identifier hs-type">TokenizerState</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><a href="#local-6989586621679139615"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-70"></span><span>
</span><span id="line-71"></span><span id="local-6989586621679139612"><span id="local-6989586621679139613"><span id="local-6989586621679139614"><span class="annot"><a href="Skylighting.Tokenizer.html#mapsnd"><span class="hs-identifier hs-type">mapsnd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679139614"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679139613"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679139612"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679139614"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679139612"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679139613"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-72"></span><span id="mapsnd"><span class="annot"><span class="annottext">mapsnd :: (a -&gt; b) -&gt; (c, a) -&gt; (c, b)
</span><a href="Skylighting.Tokenizer.html#mapsnd"><span class="hs-identifier hs-var hs-var">mapsnd</span></a></span></span><span> </span><span id="local-6989586621679139392"><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679139392"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679139391"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679139391"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679139390"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679139390"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679139391"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679139392"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679139390"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679139387"><span class="annot"><span class="hs-identifier hs-type">Functor</span></span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerM"><span class="hs-identifier hs-type">TokenizerM</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-75"></span><span>  </span><span id="local-6989586621679139386"><span class="annot"><span class="annottext">fmap :: (a -&gt; b) -&gt; TokenizerM a -&gt; TokenizerM b
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">fmap</span></span></span><span> </span><span id="local-6989586621679139385"><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679139385"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Skylighting.Tokenizer.html#TM"><span class="hs-identifier hs-type">TM</span></a></span><span> </span><span id="local-6989586621679139384"><span class="annot"><span class="annottext">TokenizerConfig
-&gt; TokenizerState -&gt; (TokenizerState, Result String a)
</span><a href="#local-6989586621679139384"><span class="hs-identifier hs-var">g</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TokenizerConfig
 -&gt; TokenizerState -&gt; (TokenizerState, Result String b))
-&gt; TokenizerM b
forall a.
(TokenizerConfig
 -&gt; TokenizerState -&gt; (TokenizerState, Result String a))
-&gt; TokenizerM a
</span><a href="Skylighting.Tokenizer.html#TM"><span class="hs-identifier hs-var">TM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679139383"><span class="annot"><span class="annottext">TokenizerConfig
</span><a href="#local-6989586621679139383"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679139382"><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139382"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Result String a -&gt; Result String b)
-&gt; (TokenizerState, Result String a)
-&gt; (TokenizerState, Result String b)
forall a b c. (a -&gt; b) -&gt; (c, a) -&gt; (c, b)
</span><a href="Skylighting.Tokenizer.html#mapsnd"><span class="hs-identifier hs-var">mapsnd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a -&gt; b) -&gt; Result String a -&gt; Result String b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679139385"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenizerConfig
-&gt; TokenizerState -&gt; (TokenizerState, Result String a)
</span><a href="#local-6989586621679139384"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">TokenizerConfig
</span><a href="#local-6989586621679139383"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139382"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679139373"><span id="local-6989586621679139375"><span id="local-6989586621679139377"><span class="annot"><span class="hs-identifier hs-type">Applicative</span></span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerM"><span class="hs-identifier hs-type">TokenizerM</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-78"></span><span>  </span><span id="local-6989586621679139371"><span class="annot"><span class="annottext">pure :: a -&gt; TokenizerM a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">pure</span></span></span><span> </span><span id="local-6989586621679139370"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679139370"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TokenizerConfig
 -&gt; TokenizerState -&gt; (TokenizerState, Result String a))
-&gt; TokenizerM a
forall a.
(TokenizerConfig
 -&gt; TokenizerState -&gt; (TokenizerState, Result String a))
-&gt; TokenizerM a
</span><a href="Skylighting.Tokenizer.html#TM"><span class="hs-identifier hs-var">TM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">TokenizerConfig
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679139369"><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139369"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139369"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a -&gt; Result String a
forall e a. a -&gt; Result e a
</span><a href="Skylighting.Tokenizer.html#Success"><span class="hs-identifier hs-var">Success</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679139370"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Skylighting.Tokenizer.html#TM"><span class="hs-identifier hs-type">TM</span></a></span><span> </span><span id="local-6989586621679139368"><span class="annot"><span class="annottext">TokenizerConfig
-&gt; TokenizerState -&gt; (TokenizerState, Result String (a -&gt; b))
</span><a href="#local-6989586621679139368"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679139367"><span class="annot"><span class="annottext">&lt;*&gt; :: TokenizerM (a -&gt; b) -&gt; TokenizerM a -&gt; TokenizerM b
</span><span class="hs-operator hs-var hs-var hs-var hs-var">&lt;*&gt;</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Skylighting.Tokenizer.html#TM"><span class="hs-identifier hs-type">TM</span></a></span><span> </span><span id="local-6989586621679139366"><span class="annot"><span class="annottext">TokenizerConfig
-&gt; TokenizerState -&gt; (TokenizerState, Result String a)
</span><a href="#local-6989586621679139366"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TokenizerConfig
 -&gt; TokenizerState -&gt; (TokenizerState, Result String b))
-&gt; TokenizerM b
forall a.
(TokenizerConfig
 -&gt; TokenizerState -&gt; (TokenizerState, Result String a))
-&gt; TokenizerM a
</span><a href="Skylighting.Tokenizer.html#TM"><span class="hs-identifier hs-var">TM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679139365"><span class="annot"><span class="annottext">TokenizerConfig
</span><a href="#local-6989586621679139365"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679139364"><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139364"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-80"></span><span>                           </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenizerConfig
-&gt; TokenizerState -&gt; (TokenizerState, Result String (a -&gt; b))
</span><a href="#local-6989586621679139368"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">TokenizerConfig
</span><a href="#local-6989586621679139365"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139364"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-81"></span><span>                              </span><span class="hs-special">(</span><span id="local-6989586621679139363"><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139363"><span class="hs-identifier hs-var">s'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Result String (a -&gt; b)
</span><a href="Skylighting.Tokenizer.html#Failure"><span class="hs-identifier hs-var">Failure</span></a></span><span>   </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139363"><span class="hs-identifier hs-var">s'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Result String b
forall e a. Result e a
</span><a href="Skylighting.Tokenizer.html#Failure"><span class="hs-identifier hs-var">Failure</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span>                              </span><span class="hs-special">(</span><span id="local-6989586621679139362"><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139362"><span class="hs-identifier hs-var">s'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#Error"><span class="hs-identifier hs-type">Error</span></a></span><span> </span><span id="local-6989586621679139361"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679139361"><span class="hs-identifier hs-var">e</span></a></span></span><span>   </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139362"><span class="hs-identifier hs-var">s'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Result String b
forall e a. e -&gt; Result e a
</span><a href="Skylighting.Tokenizer.html#Error"><span class="hs-identifier hs-var">Error</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679139361"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span>                              </span><span class="hs-special">(</span><span id="local-6989586621679139360"><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139360"><span class="hs-identifier hs-var">s'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#Success"><span class="hs-identifier hs-type">Success</span></a></span><span> </span><span id="local-6989586621679139359"><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679139359"><span class="hs-identifier hs-var">f'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-84"></span><span>                                  </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenizerConfig
-&gt; TokenizerState -&gt; (TokenizerState, Result String a)
</span><a href="#local-6989586621679139366"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">TokenizerConfig
</span><a href="#local-6989586621679139365"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139360"><span class="hs-identifier hs-var">s'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-85"></span><span>                                    </span><span class="hs-special">(</span><span id="local-6989586621679139358"><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139358"><span class="hs-identifier hs-var">s''</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Result String a
</span><a href="Skylighting.Tokenizer.html#Failure"><span class="hs-identifier hs-var">Failure</span></a></span><span>   </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139358"><span class="hs-identifier hs-var">s''</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Result String b
forall e a. Result e a
</span><a href="Skylighting.Tokenizer.html#Failure"><span class="hs-identifier hs-var">Failure</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span>                                    </span><span class="hs-special">(</span><span id="local-6989586621679139357"><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139357"><span class="hs-identifier hs-var">s''</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#Error"><span class="hs-identifier hs-type">Error</span></a></span><span> </span><span id="local-6989586621679139356"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679139356"><span class="hs-identifier hs-var">e'</span></a></span></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139357"><span class="hs-identifier hs-var">s''</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Result String b
forall e a. e -&gt; Result e a
</span><a href="Skylighting.Tokenizer.html#Error"><span class="hs-identifier hs-var">Error</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679139356"><span class="hs-identifier hs-var">e'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span>                                    </span><span class="hs-special">(</span><span id="local-6989586621679139355"><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139355"><span class="hs-identifier hs-var">s''</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#Success"><span class="hs-identifier hs-type">Success</span></a></span><span> </span><span id="local-6989586621679139354"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679139354"><span class="hs-identifier hs-var">y'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139355"><span class="hs-identifier hs-var">s''</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b -&gt; Result String b
forall e a. a -&gt; Result e a
</span><a href="Skylighting.Tokenizer.html#Success"><span class="hs-identifier hs-var">Success</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679139359"><span class="hs-identifier hs-var">f'</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679139354"><span class="hs-identifier hs-var">y'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679139350"><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerM"><span class="hs-identifier hs-type">TokenizerM</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-91"></span><span>  </span><span id="local-6989586621679139347"><span class="annot"><span class="annottext">return :: a -&gt; TokenizerM a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">return</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; TokenizerM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-92"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Skylighting.Tokenizer.html#TM"><span class="hs-identifier hs-type">TM</span></a></span><span> </span><span id="local-6989586621679139346"><span class="annot"><span class="annottext">TokenizerConfig
-&gt; TokenizerState -&gt; (TokenizerState, Result String a)
</span><a href="#local-6989586621679139346"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679139345"><span class="annot"><span class="annottext">&gt;&gt;= :: TokenizerM a -&gt; (a -&gt; TokenizerM b) -&gt; TokenizerM b
</span><span class="hs-operator hs-var hs-var hs-var hs-var">&gt;&gt;=</span></span></span><span> </span><span id="local-6989586621679139344"><span class="annot"><span class="annottext">a -&gt; TokenizerM b
</span><a href="#local-6989586621679139344"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TokenizerConfig
 -&gt; TokenizerState -&gt; (TokenizerState, Result String b))
-&gt; TokenizerM b
forall a.
(TokenizerConfig
 -&gt; TokenizerState -&gt; (TokenizerState, Result String a))
-&gt; TokenizerM a
</span><a href="Skylighting.Tokenizer.html#TM"><span class="hs-identifier hs-var">TM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679139343"><span class="annot"><span class="annottext">TokenizerConfig
</span><a href="#local-6989586621679139343"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679139342"><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139342"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-93"></span><span>                       </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TokenizerConfig
-&gt; TokenizerState -&gt; (TokenizerState, Result String a)
</span><a href="#local-6989586621679139346"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">TokenizerConfig
</span><a href="#local-6989586621679139343"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139342"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-94"></span><span>                            </span><span class="hs-special">(</span><span id="local-6989586621679139341"><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139341"><span class="hs-identifier hs-var">s'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Result String a
</span><a href="Skylighting.Tokenizer.html#Failure"><span class="hs-identifier hs-var">Failure</span></a></span><span>   </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139341"><span class="hs-identifier hs-var">s'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Result String b
forall e a. Result e a
</span><a href="Skylighting.Tokenizer.html#Failure"><span class="hs-identifier hs-var">Failure</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span>                            </span><span class="hs-special">(</span><span id="local-6989586621679139340"><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139340"><span class="hs-identifier hs-var">s'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#Error"><span class="hs-identifier hs-type">Error</span></a></span><span> </span><span id="local-6989586621679139339"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679139339"><span class="hs-identifier hs-var">e</span></a></span></span><span>   </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139340"><span class="hs-identifier hs-var">s'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Result String b
forall e a. e -&gt; Result e a
</span><a href="Skylighting.Tokenizer.html#Error"><span class="hs-identifier hs-var">Error</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679139339"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span>                            </span><span class="hs-special">(</span><span id="local-6989586621679139338"><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139338"><span class="hs-identifier hs-var">s'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#Success"><span class="hs-identifier hs-type">Success</span></a></span><span> </span><span id="local-6989586621679139337"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679139337"><span class="hs-identifier hs-var">x'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TokenizerConfig
-&gt; TokenizerState -&gt; (TokenizerState, Result String b)
</span><a href="#local-6989586621679139336"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">TokenizerConfig
</span><a href="#local-6989586621679139343"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139338"><span class="hs-identifier hs-var">s'</span></a></span><span>
</span><span id="line-97"></span><span>                              </span><span class="hs-keyword">where</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TM"><span class="hs-identifier hs-type">TM</span></a></span><span> </span><span id="local-6989586621679139336"><span class="annot"><span class="annottext">TokenizerConfig
-&gt; TokenizerState -&gt; (TokenizerState, Result String b)
</span><a href="#local-6989586621679139336"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; TokenizerM b
</span><a href="#local-6989586621679139344"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679139337"><span class="hs-identifier hs-var">x'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Alternative</span></span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerM"><span class="hs-identifier hs-type">TokenizerM</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-100"></span><span>  </span><span id="local-6989586621679139329"><span class="annot"><span class="annottext">empty :: TokenizerM a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">empty</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TokenizerConfig
 -&gt; TokenizerState -&gt; (TokenizerState, Result String a))
-&gt; TokenizerM a
forall a.
(TokenizerConfig
 -&gt; TokenizerState -&gt; (TokenizerState, Result String a))
-&gt; TokenizerM a
</span><a href="Skylighting.Tokenizer.html#TM"><span class="hs-identifier hs-var">TM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">TokenizerConfig
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679139327"><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139327"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139327"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Result String a
forall e a. Result e a
</span><a href="Skylighting.Tokenizer.html#Failure"><span class="hs-identifier hs-var">Failure</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span>  </span><span id="local-6989586621679139326"><span class="annot"><span class="annottext">&lt;|&gt; :: TokenizerM a -&gt; TokenizerM a -&gt; TokenizerM a
</span><span class="hs-operator hs-var hs-var hs-var hs-var">(&lt;|&gt;)</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Skylighting.Tokenizer.html#TM"><span class="hs-identifier hs-type">TM</span></a></span><span> </span><span id="local-6989586621679139324"><span class="annot"><span class="annottext">TokenizerConfig
-&gt; TokenizerState -&gt; (TokenizerState, Result String a)
</span><a href="#local-6989586621679139324"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Skylighting.Tokenizer.html#TM"><span class="hs-identifier hs-type">TM</span></a></span><span> </span><span id="local-6989586621679139323"><span class="annot"><span class="annottext">TokenizerConfig
-&gt; TokenizerState -&gt; (TokenizerState, Result String a)
</span><a href="#local-6989586621679139323"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TokenizerConfig
 -&gt; TokenizerState -&gt; (TokenizerState, Result String a))
-&gt; TokenizerM a
forall a.
(TokenizerConfig
 -&gt; TokenizerState -&gt; (TokenizerState, Result String a))
-&gt; TokenizerM a
</span><a href="Skylighting.Tokenizer.html#TM"><span class="hs-identifier hs-var">TM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679139322"><span class="annot"><span class="annottext">TokenizerConfig
</span><a href="#local-6989586621679139322"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679139321"><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139321"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-102"></span><span>                           </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TokenizerConfig
-&gt; TokenizerState -&gt; (TokenizerState, Result String a)
</span><a href="#local-6989586621679139324"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">TokenizerConfig
</span><a href="#local-6989586621679139322"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139321"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-103"></span><span>                                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenizerState
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Result String a
</span><a href="Skylighting.Tokenizer.html#Failure"><span class="hs-identifier hs-var">Failure</span></a></span><span>   </span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TokenizerConfig
-&gt; TokenizerState -&gt; (TokenizerState, Result String a)
</span><a href="#local-6989586621679139323"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">TokenizerConfig
</span><a href="#local-6989586621679139322"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139321"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-104"></span><span>                                </span><span class="hs-special">(</span><span id="local-6989586621679139320"><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139320"><span class="hs-identifier hs-var">s'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#Error"><span class="hs-identifier hs-type">Error</span></a></span><span> </span><span id="local-6989586621679139319"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679139319"><span class="hs-identifier hs-var">e</span></a></span></span><span>   </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139320"><span class="hs-identifier hs-var">s'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Result String a
forall e a. e -&gt; Result e a
</span><a href="Skylighting.Tokenizer.html#Error"><span class="hs-identifier hs-var">Error</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679139319"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span>                                </span><span class="hs-special">(</span><span id="local-6989586621679139318"><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139318"><span class="hs-identifier hs-var">s'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#Success"><span class="hs-identifier hs-type">Success</span></a></span><span> </span><span id="local-6989586621679139317"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679139317"><span class="hs-identifier hs-var">x'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139318"><span class="hs-identifier hs-var">s'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a -&gt; Result String a
forall e a. a -&gt; Result e a
</span><a href="Skylighting.Tokenizer.html#Success"><span class="hs-identifier hs-var">Success</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679139317"><span class="hs-identifier hs-var">x'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-106"></span><span>  </span><span id="local-6989586621679139316"><span class="annot"><span class="annottext">many :: TokenizerM a -&gt; TokenizerM [a]
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">many</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Skylighting.Tokenizer.html#TM"><span class="hs-identifier hs-type">TM</span></a></span><span> </span><span id="local-6989586621679139314"><span class="annot"><span class="annottext">TokenizerConfig
-&gt; TokenizerState -&gt; (TokenizerState, Result String a)
</span><a href="#local-6989586621679139314"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TokenizerConfig
 -&gt; TokenizerState -&gt; (TokenizerState, Result String [a]))
-&gt; TokenizerM [a]
forall a.
(TokenizerConfig
 -&gt; TokenizerState -&gt; (TokenizerState, Result String a))
-&gt; TokenizerM a
</span><a href="Skylighting.Tokenizer.html#TM"><span class="hs-identifier hs-var">TM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679139313"><span class="annot"><span class="annottext">TokenizerConfig
</span><a href="#local-6989586621679139313"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679139312"><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139312"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-107"></span><span>                    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TokenizerConfig
-&gt; TokenizerState -&gt; (TokenizerState, Result String a)
</span><a href="#local-6989586621679139314"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">TokenizerConfig
</span><a href="#local-6989586621679139313"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139312"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-108"></span><span>                       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenizerState
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Result String a
</span><a href="Skylighting.Tokenizer.html#Failure"><span class="hs-identifier hs-var">Failure</span></a></span><span>   </span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139312"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; Result String [a]
forall e a. a -&gt; Result e a
</span><a href="Skylighting.Tokenizer.html#Success"><span class="hs-identifier hs-var">Success</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span>                       </span><span class="hs-special">(</span><span id="local-6989586621679139311"><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139311"><span class="hs-identifier hs-var">s'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#Error"><span class="hs-identifier hs-type">Error</span></a></span><span> </span><span id="local-6989586621679139310"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679139310"><span class="hs-identifier hs-var">e</span></a></span></span><span>   </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139311"><span class="hs-identifier hs-var">s'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Result String [a]
forall e a. e -&gt; Result e a
</span><a href="Skylighting.Tokenizer.html#Error"><span class="hs-identifier hs-var">Error</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679139310"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-110"></span><span>                       </span><span class="hs-special">(</span><span id="local-6989586621679139309"><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139309"><span class="hs-identifier hs-var">s'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#Success"><span class="hs-identifier hs-type">Success</span></a></span><span> </span><span id="local-6989586621679139308"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679139308"><span class="hs-identifier hs-var">x'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Result String [a] -&gt; Result String [a])
-&gt; (TokenizerState, Result String [a])
-&gt; (TokenizerState, Result String [a])
forall a b c. (a -&gt; b) -&gt; (c, a) -&gt; (c, b)
</span><a href="Skylighting.Tokenizer.html#mapsnd"><span class="hs-identifier hs-var">mapsnd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([a] -&gt; [a]) -&gt; Result String [a] -&gt; Result String [a]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679139308"><span class="hs-identifier hs-var">x'</span></a></span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; [a]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenizerConfig
-&gt; TokenizerState -&gt; (TokenizerState, Result String [a])
</span><a href="#local-6989586621679139307"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">TokenizerConfig
</span><a href="#local-6989586621679139313"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139309"><span class="hs-identifier hs-var">s'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-111"></span><span>                         </span><span class="hs-keyword">where</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TM"><span class="hs-identifier hs-type">TM</span></a></span><span> </span><span id="local-6989586621679139307"><span class="annot"><span class="annottext">TokenizerConfig
-&gt; TokenizerState -&gt; (TokenizerState, Result String [a])
</span><a href="#local-6989586621679139307"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TokenizerM a -&gt; TokenizerM [a]
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f [a]
</span><span class="hs-identifier hs-var">many</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TokenizerConfig
 -&gt; TokenizerState -&gt; (TokenizerState, Result String a))
-&gt; TokenizerM a
forall a.
(TokenizerConfig
 -&gt; TokenizerState -&gt; (TokenizerState, Result String a))
-&gt; TokenizerM a
</span><a href="Skylighting.Tokenizer.html#TM"><span class="hs-identifier hs-var">TM</span></a></span><span> </span><span class="annot"><span class="annottext">TokenizerConfig
-&gt; TokenizerState -&gt; (TokenizerState, Result String a)
</span><a href="#local-6989586621679139314"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span>  </span><span id="local-6989586621679139306"><span class="annot"><span class="annottext">some :: TokenizerM a -&gt; TokenizerM [a]
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">some</span></span></span><span> </span><span id="local-6989586621679139304"><span class="annot"><span class="annottext">TokenizerM a
</span><a href="#local-6989586621679139304"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(a -&gt; [a] -&gt; [a]) -&gt; TokenizerM a -&gt; TokenizerM ([a] -&gt; [a])
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TokenizerM a
</span><a href="#local-6989586621679139304"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">TokenizerM ([a] -&gt; [a]) -&gt; TokenizerM [a] -&gt; TokenizerM [a]
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">TokenizerM a -&gt; TokenizerM [a]
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f [a]
</span><span class="hs-identifier hs-var">many</span></span><span> </span><span class="annot"><span class="annottext">TokenizerM a
</span><a href="#local-6989586621679139304"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadPlus</span></span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerM"><span class="hs-identifier hs-type">TokenizerM</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-115"></span><span>  </span><span id="local-6989586621679139297"><span class="annot"><span class="annottext">mzero :: TokenizerM a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">mzero</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TokenizerM a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a
</span><span class="hs-identifier hs-var">empty</span></span><span>
</span><span id="line-116"></span><span>  </span><span id="local-6989586621679139295"><span class="annot"><span class="annottext">mplus :: TokenizerM a -&gt; TokenizerM a -&gt; TokenizerM a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">mplus</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TokenizerM a -&gt; TokenizerM a -&gt; TokenizerM a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">(&lt;|&gt;)</span></span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679139289"><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerConfig"><span class="hs-identifier hs-type">TokenizerConfig</span></a></span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerM"><span class="hs-identifier hs-type">TokenizerM</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-119"></span><span>  </span><span id="local-6989586621679139287"><span class="annot"><span class="annottext">ask :: TokenizerM TokenizerConfig
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">ask</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TokenizerConfig
 -&gt; TokenizerState
 -&gt; (TokenizerState, Result String TokenizerConfig))
-&gt; TokenizerM TokenizerConfig
forall a.
(TokenizerConfig
 -&gt; TokenizerState -&gt; (TokenizerState, Result String a))
-&gt; TokenizerM a
</span><a href="Skylighting.Tokenizer.html#TM"><span class="hs-identifier hs-var">TM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679139285"><span class="annot"><span class="annottext">TokenizerConfig
</span><a href="#local-6989586621679139285"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679139284"><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139284"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139284"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TokenizerConfig -&gt; Result String TokenizerConfig
forall e a. a -&gt; Result e a
</span><a href="Skylighting.Tokenizer.html#Success"><span class="hs-identifier hs-var">Success</span></a></span><span> </span><span class="annot"><span class="annottext">TokenizerConfig
</span><a href="#local-6989586621679139285"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-120"></span><span>  </span><span id="local-6989586621679139283"><span class="annot"><span class="annottext">local :: (TokenizerConfig -&gt; TokenizerConfig)
-&gt; TokenizerM a -&gt; TokenizerM a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">local</span></span></span><span> </span><span id="local-6989586621679139281"><span class="annot"><span class="annottext">TokenizerConfig -&gt; TokenizerConfig
</span><a href="#local-6989586621679139281"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Skylighting.Tokenizer.html#TM"><span class="hs-identifier hs-type">TM</span></a></span><span> </span><span id="local-6989586621679139280"><span class="annot"><span class="annottext">TokenizerConfig
-&gt; TokenizerState -&gt; (TokenizerState, Result String a)
</span><a href="#local-6989586621679139280"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TokenizerConfig
 -&gt; TokenizerState -&gt; (TokenizerState, Result String a))
-&gt; TokenizerM a
forall a.
(TokenizerConfig
 -&gt; TokenizerState -&gt; (TokenizerState, Result String a))
-&gt; TokenizerM a
</span><a href="Skylighting.Tokenizer.html#TM"><span class="hs-identifier hs-var">TM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679139279"><span class="annot"><span class="annottext">TokenizerConfig
</span><a href="#local-6989586621679139279"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679139278"><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139278"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TokenizerConfig
-&gt; TokenizerState -&gt; (TokenizerState, Result String a)
</span><a href="#local-6989586621679139280"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenizerConfig -&gt; TokenizerConfig
</span><a href="#local-6989586621679139281"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">TokenizerConfig
</span><a href="#local-6989586621679139279"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139278"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-121"></span><span>
</span><span id="line-122"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679139273"><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerState"><span class="hs-identifier hs-type">TokenizerState</span></a></span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerM"><span class="hs-identifier hs-type">TokenizerM</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-123"></span><span>  </span><span id="local-6989586621679139271"><span class="annot"><span class="annottext">get :: TokenizerM TokenizerState
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">get</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TokenizerConfig
 -&gt; TokenizerState
 -&gt; (TokenizerState, Result String TokenizerState))
-&gt; TokenizerM TokenizerState
forall a.
(TokenizerConfig
 -&gt; TokenizerState -&gt; (TokenizerState, Result String a))
-&gt; TokenizerM a
</span><a href="Skylighting.Tokenizer.html#TM"><span class="hs-identifier hs-var">TM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">TokenizerConfig
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679139269"><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139269"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139269"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TokenizerState -&gt; Result String TokenizerState
forall e a. a -&gt; Result e a
</span><a href="Skylighting.Tokenizer.html#Success"><span class="hs-identifier hs-var">Success</span></a></span><span> </span><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139269"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span>  </span><span id="local-6989586621679139268"><span class="annot"><span class="annottext">put :: TokenizerState -&gt; TokenizerM ()
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">put</span></span></span><span> </span><span id="local-6989586621679139266"><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139266"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TokenizerConfig
 -&gt; TokenizerState -&gt; (TokenizerState, Result String ()))
-&gt; TokenizerM ()
forall a.
(TokenizerConfig
 -&gt; TokenizerState -&gt; (TokenizerState, Result String a))
-&gt; TokenizerM a
</span><a href="Skylighting.Tokenizer.html#TM"><span class="hs-identifier hs-var">TM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">TokenizerConfig
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TokenizerState
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139266"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">() -&gt; Result String ()
forall e a. a -&gt; Result e a
</span><a href="Skylighting.Tokenizer.html#Success"><span class="hs-identifier hs-var">Success</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerM"><span class="hs-identifier hs-type">TokenizerM</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-127"></span><span>  </span><span id="local-6989586621679139261"><span class="annot"><span class="annottext">throwError :: String -&gt; TokenizerM a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">throwError</span></span></span><span> </span><span id="local-6989586621679139259"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679139259"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TokenizerConfig
 -&gt; TokenizerState -&gt; (TokenizerState, Result String a))
-&gt; TokenizerM a
forall a.
(TokenizerConfig
 -&gt; TokenizerState -&gt; (TokenizerState, Result String a))
-&gt; TokenizerM a
</span><a href="Skylighting.Tokenizer.html#TM"><span class="hs-identifier hs-var">TM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">TokenizerConfig
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679139258"><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139258"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139258"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Result String a
forall e a. e -&gt; Result e a
</span><a href="Skylighting.Tokenizer.html#Error"><span class="hs-identifier hs-var">Error</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679139259"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-128"></span><span>  </span><span id="local-6989586621679139257"><span class="annot"><span class="annottext">catchError :: TokenizerM a -&gt; (String -&gt; TokenizerM a) -&gt; TokenizerM a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">catchError</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Skylighting.Tokenizer.html#TM"><span class="hs-identifier hs-type">TM</span></a></span><span> </span><span id="local-6989586621679139255"><span class="annot"><span class="annottext">TokenizerConfig
-&gt; TokenizerState -&gt; (TokenizerState, Result String a)
</span><a href="#local-6989586621679139255"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679139254"><span class="annot"><span class="annottext">String -&gt; TokenizerM a
</span><a href="#local-6989586621679139254"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TokenizerConfig
 -&gt; TokenizerState -&gt; (TokenizerState, Result String a))
-&gt; TokenizerM a
forall a.
(TokenizerConfig
 -&gt; TokenizerState -&gt; (TokenizerState, Result String a))
-&gt; TokenizerM a
</span><a href="Skylighting.Tokenizer.html#TM"><span class="hs-identifier hs-var">TM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679139253"><span class="annot"><span class="annottext">TokenizerConfig
</span><a href="#local-6989586621679139253"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679139252"><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139252"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TokenizerConfig
-&gt; TokenizerState -&gt; (TokenizerState, Result String a)
</span><a href="#local-6989586621679139255"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">TokenizerConfig
</span><a href="#local-6989586621679139253"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139252"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-129"></span><span>                                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenizerState
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#Error"><span class="hs-identifier hs-type">Error</span></a></span><span> </span><span id="local-6989586621679139251"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679139251"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TM"><span class="hs-identifier hs-type">TM</span></a></span><span> </span><span id="local-6989586621679139250"><span class="annot"><span class="annottext">TokenizerConfig
-&gt; TokenizerState -&gt; (TokenizerState, Result String a)
</span><a href="#local-6989586621679139250"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; TokenizerM a
</span><a href="#local-6989586621679139254"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679139251"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">TokenizerConfig
-&gt; TokenizerState -&gt; (TokenizerState, Result String a)
</span><a href="#local-6989586621679139250"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">TokenizerConfig
</span><a href="#local-6989586621679139253"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139252"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-130"></span><span>                                      </span><span id="local-6989586621679139249"><span class="annot"><span class="annottext">(TokenizerState, Result String a)
</span><a href="#local-6989586621679139249"><span class="hs-identifier hs-var">z</span></a></span></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(TokenizerState, Result String a)
</span><a href="#local-6989586621679139249"><span class="hs-identifier hs-var">z</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span class="hs-comment">-- | Tokenize some text using 'Syntax'.</span><span>
</span><span id="line-133"></span><span class="annot"><a href="Skylighting.Tokenizer.html#tokenize"><span class="hs-identifier hs-type">tokenize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerConfig"><span class="hs-identifier hs-type">TokenizerConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Skylighting.Types.html#Syntax"><span class="hs-identifier hs-type">Syntax</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Skylighting.Types.html#SourceLine"><span class="hs-identifier hs-type">SourceLine</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-134"></span><span id="tokenize"><span class="annot"><span class="annottext">tokenize :: TokenizerConfig -&gt; Syntax -&gt; Text -&gt; Either String [SourceLine]
</span><a href="Skylighting.Tokenizer.html#tokenize"><span class="hs-identifier hs-var hs-var">tokenize</span></a></span></span><span> </span><span id="local-6989586621679139248"><span class="annot"><span class="annottext">TokenizerConfig
</span><a href="#local-6989586621679139248"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span id="local-6989586621679139247"><span class="annot"><span class="annottext">Syntax
</span><a href="#local-6989586621679139247"><span class="hs-identifier hs-var">syntax</span></a></span></span><span> </span><span id="local-6989586621679139246"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139246"><span class="hs-identifier hs-var">inp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-135"></span><span>  </span><span class="annot"><span class="annottext">Either String ContextStack
</span><a href="#local-6989586621679139245"><span class="hs-identifier hs-var">eitherStack</span></a></span><span> </span><span class="annot"><span class="annottext">Either String ContextStack
-&gt; (ContextStack -&gt; Either String [SourceLine])
-&gt; Either String [SourceLine]
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679139244"><span class="annot"><span class="annottext">ContextStack
</span><a href="#local-6989586621679139244"><span class="hs-identifier hs-var">stack</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-136"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TokenizerM [SourceLine]
-&gt; TokenizerConfig
-&gt; TokenizerState
-&gt; (TokenizerState, Result String [SourceLine])
forall a.
TokenizerM a
-&gt; TokenizerConfig
-&gt; TokenizerState
-&gt; (TokenizerState, Result String a)
</span><a href="Skylighting.Tokenizer.html#runTokenizerM"><span class="hs-identifier hs-var hs-var">runTokenizerM</span></a></span><span> </span><span class="annot"><span class="annottext">TokenizerM [SourceLine]
</span><a href="#local-6989586621679139243"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="annot"><span class="annottext">TokenizerConfig
</span><a href="#local-6989586621679139248"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ContextStack -&gt; TokenizerState
</span><a href="#local-6989586621679139242"><span class="hs-identifier hs-var">startingState</span></a></span><span> </span><span class="annot"><span class="annottext">ContextStack
</span><a href="#local-6989586621679139244"><span class="hs-identifier hs-var">stack</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-137"></span><span>       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenizerState
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#Success"><span class="hs-identifier hs-type">Success</span></a></span><span> </span><span id="local-6989586621679139241"><span class="annot"><span class="annottext">[SourceLine]
</span><a href="#local-6989586621679139241"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[SourceLine] -&gt; Either String [SourceLine]
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">[SourceLine]
</span><a href="#local-6989586621679139241"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-138"></span><span>       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenizerState
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#Error"><span class="hs-identifier hs-type">Error</span></a></span><span> </span><span id="local-6989586621679139240"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679139240"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Either String [SourceLine]
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679139240"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-139"></span><span>       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenizerState
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Result String [SourceLine]
</span><a href="Skylighting.Tokenizer.html#Failure"><span class="hs-identifier hs-var">Failure</span></a></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Either String [SourceLine]
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Could not tokenize code&quot;</span></span><span>
</span><span id="line-140"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-141"></span><span>    </span><span id="local-6989586621679139243"><span class="annot"><span class="annottext">action :: TokenizerM [SourceLine]
</span><a href="#local-6989586621679139243"><span class="hs-identifier hs-var hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((ByteString, Int) -&gt; TokenizerM SourceLine)
-&gt; [(ByteString, Int)] -&gt; TokenizerM [SourceLine]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">(ByteString, Int) -&gt; TokenizerM SourceLine
</span><a href="Skylighting.Tokenizer.html#tokenizeLine"><span class="hs-identifier hs-var">tokenizeLine</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ByteString] -&gt; [Int] -&gt; [(ByteString, Int)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString]
</span><span class="hs-identifier hs-var">BS.lines</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; ByteString
</span><span class="hs-identifier hs-var">encodeUtf8</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139246"><span class="hs-identifier hs-var">inp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-142"></span><span>    </span><span id="local-6989586621679139245"><span class="annot"><span class="annottext">eitherStack :: Either String ContextStack
</span><a href="#local-6989586621679139245"><span class="hs-identifier hs-var hs-var">eitherStack</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Syntax -&gt; Maybe Context
</span><a href="Skylighting.Tokenizer.html#lookupContext"><span class="hs-identifier hs-var">lookupContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Syntax -&gt; Text
</span><a href="Skylighting.Types.html#sStartingContext"><span class="hs-identifier hs-var hs-var">sStartingContext</span></a></span><span> </span><span class="annot"><span class="annottext">Syntax
</span><a href="#local-6989586621679139247"><span class="hs-identifier hs-var">syntax</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Syntax
</span><a href="#local-6989586621679139247"><span class="hs-identifier hs-var">syntax</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-143"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679139234"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679139234"><span class="hs-identifier hs-var">c</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ContextStack -&gt; Either String ContextStack
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(ContextStack -&gt; Either String ContextStack)
-&gt; ContextStack -&gt; Either String ContextStack
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty Context -&gt; ContextStack
</span><a href="Skylighting.Tokenizer.html#ContextStack"><span class="hs-identifier hs-var">ContextStack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679139234"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Context -&gt; [Context] -&gt; NonEmpty Context
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">:|</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-144"></span><span>                    </span><span class="annot"><span class="annottext">Maybe Context
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Either String ContextStack
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;No starting context specified&quot;</span></span><span>
</span><span id="line-145"></span><span>    </span><span id="local-6989586621679139242"><span class="annot"><span class="annottext">startingState :: ContextStack -&gt; TokenizerState
</span><a href="#local-6989586621679139242"><span class="hs-identifier hs-var hs-var">startingState</span></a></span></span><span> </span><span id="local-6989586621679139233"><span class="annot"><span class="annottext">ContextStack
</span><a href="#local-6989586621679139233"><span class="hs-identifier hs-var">stack</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-146"></span><span>      </span><span class="annot"><span class="annottext">TokenizerState :: ByteString
-&gt; Bool
-&gt; Char
-&gt; ContextStack
-&gt; IntMap ByteString
-&gt; Int
-&gt; Bool
-&gt; Maybe Int
-&gt; Map RE Regex
-&gt; TokenizerState
</span><a href="Skylighting.Tokenizer.html#TokenizerState"><span class="hs-identifier hs-type">TokenizerState</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">input :: ByteString
</span><a href="Skylighting.Tokenizer.html#input"><span class="hs-identifier hs-var">input</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-identifier hs-var">BS.empty</span></span><span>
</span><span id="line-147"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">endline :: Bool
</span><a href="Skylighting.Tokenizer.html#endline"><span class="hs-identifier hs-var">endline</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Bool
</span><span class="hs-identifier hs-var">Text.null</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139246"><span class="hs-identifier hs-var">inp</span></a></span><span>
</span><span id="line-148"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">prevChar :: Char
</span><a href="Skylighting.Tokenizer.html#prevChar"><span class="hs-identifier hs-var">prevChar</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\n'</span></span><span>
</span><span id="line-149"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">contextStack :: ContextStack
</span><a href="Skylighting.Tokenizer.html#contextStack"><span class="hs-identifier hs-var">contextStack</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ContextStack
</span><a href="#local-6989586621679139233"><span class="hs-identifier hs-var">stack</span></a></span><span>
</span><span id="line-150"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">captures :: IntMap ByteString
</span><a href="Skylighting.Tokenizer.html#captures"><span class="hs-identifier hs-var">captures</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IntMap ByteString
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-151"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">column :: Int
</span><a href="Skylighting.Tokenizer.html#column"><span class="hs-identifier hs-var">column</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-152"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">lineContinuation :: Bool
</span><a href="Skylighting.Tokenizer.html#lineContinuation"><span class="hs-identifier hs-var">lineContinuation</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-153"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">firstNonspaceColumn :: Maybe Int
</span><a href="Skylighting.Tokenizer.html#firstNonspaceColumn"><span class="hs-identifier hs-var">firstNonspaceColumn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Int
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-154"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">compiledRegexes :: Map RE Regex
</span><a href="Skylighting.Tokenizer.html#compiledRegexes"><span class="hs-identifier hs-var">compiledRegexes</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map RE Regex
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span>
</span><span id="line-155"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span class="annot"><a href="Skylighting.Tokenizer.html#info"><span class="hs-identifier hs-type">info</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerM"><span class="hs-identifier hs-type">TokenizerM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span id="info"><span class="annot"><span class="annottext">info :: String -&gt; TokenizerM ()
</span><a href="Skylighting.Tokenizer.html#info"><span class="hs-identifier hs-var hs-var">info</span></a></span></span><span> </span><span id="local-6989586621679139228"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679139228"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-159"></span><span>  </span><span id="local-6989586621679139227"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679139227"><span class="hs-identifier hs-var">tr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TokenizerConfig -&gt; Bool) -&gt; TokenizerM Bool
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">TokenizerConfig -&gt; Bool
</span><a href="Skylighting.Tokenizer.html#traceOutput"><span class="hs-identifier hs-var hs-var">traceOutput</span></a></span><span>
</span><span id="line-160"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; TokenizerM () -&gt; TokenizerM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679139227"><span class="hs-identifier hs-var">tr</span></a></span><span> </span><span class="annot"><span class="annottext">(TokenizerM () -&gt; TokenizerM ()) -&gt; TokenizerM () -&gt; TokenizerM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; TokenizerM () -&gt; TokenizerM ()
forall a. String -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">trace</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679139228"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; TokenizerM ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-161"></span><span>
</span><span id="line-162"></span><span class="annot"><a href="Skylighting.Tokenizer.html#infoContextStack"><span class="hs-identifier hs-type">infoContextStack</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerM"><span class="hs-identifier hs-type">TokenizerM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-163"></span><span id="infoContextStack"><span class="annot"><span class="annottext">infoContextStack :: TokenizerM ()
</span><a href="Skylighting.Tokenizer.html#infoContextStack"><span class="hs-identifier hs-var hs-var">infoContextStack</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-164"></span><span>  </span><span id="local-6989586621679139223"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679139223"><span class="hs-identifier hs-var">tr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TokenizerConfig -&gt; Bool) -&gt; TokenizerM Bool
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">TokenizerConfig -&gt; Bool
</span><a href="Skylighting.Tokenizer.html#traceOutput"><span class="hs-identifier hs-var hs-var">traceOutput</span></a></span><span>
</span><span id="line-165"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; TokenizerM () -&gt; TokenizerM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679139223"><span class="hs-identifier hs-var">tr</span></a></span><span> </span><span class="annot"><span class="annottext">(TokenizerM () -&gt; TokenizerM ()) -&gt; TokenizerM () -&gt; TokenizerM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-166"></span><span>    </span><span class="annot"><a href="Skylighting.Tokenizer.html#ContextStack"><span class="hs-identifier hs-type">ContextStack</span></a></span><span> </span><span id="local-6989586621679139222"><span class="annot"><span class="annottext">NonEmpty Context
</span><a href="#local-6989586621679139222"><span class="hs-identifier hs-var">stack</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TokenizerState -&gt; ContextStack) -&gt; TokenizerM ContextStack
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">TokenizerState -&gt; ContextStack
</span><a href="Skylighting.Tokenizer.html#contextStack"><span class="hs-identifier hs-var hs-var">contextStack</span></a></span><span>
</span><span id="line-167"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; TokenizerM ()
</span><a href="Skylighting.Tokenizer.html#info"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; TokenizerM ()) -&gt; String -&gt; TokenizerM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;CONTEXT STACK &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Context -&gt; Text) -&gt; [Context] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Context -&gt; Text
</span><a href="Skylighting.Types.html#cName"><span class="hs-identifier hs-var hs-var">cName</span></a></span><span> </span><span class="annot"><span class="annottext">([Context] -&gt; [Text]) -&gt; [Context] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty Context -&gt; [Context]
forall a. NonEmpty a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty Context
</span><a href="#local-6989586621679139222"><span class="hs-identifier hs-var">stack</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span class="annot"><a href="Skylighting.Tokenizer.html#popContextStack"><span class="hs-identifier hs-type">popContextStack</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerM"><span class="hs-identifier hs-type">TokenizerM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span id="popContextStack"><span class="annot"><span class="annottext">popContextStack :: TokenizerM ()
</span><a href="Skylighting.Tokenizer.html#popContextStack"><span class="hs-identifier hs-var hs-var">popContextStack</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-171"></span><span>  </span><span class="annot"><a href="Skylighting.Tokenizer.html#ContextStack"><span class="hs-identifier hs-type">ContextStack</span></a></span><span> </span><span id="local-6989586621679139217"><span class="annot"><span class="annottext">NonEmpty Context
</span><a href="#local-6989586621679139217"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TokenizerState -&gt; ContextStack) -&gt; TokenizerM ContextStack
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">TokenizerState -&gt; ContextStack
</span><a href="Skylighting.Tokenizer.html#contextStack"><span class="hs-identifier hs-var hs-var">contextStack</span></a></span><span>
</span><span id="line-172"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NonEmpty Context
</span><a href="#local-6989586621679139217"><span class="hs-identifier hs-var">cs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-173"></span><span>       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; TokenizerM ()
</span><a href="Skylighting.Tokenizer.html#info"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;WARNING: Tried to pop only element on context stack!&quot;</span></span><span>
</span><span id="line-174"></span><span>       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679139216"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679139216"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679139215"><span class="annot"><span class="annottext">[Context]
</span><a href="#local-6989586621679139215"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-175"></span><span>         </span><span class="annot"><span class="annottext">(TokenizerState -&gt; TokenizerState) -&gt; TokenizerM ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679139213"><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139213"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139213"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">contextStack :: ContextStack
</span><a href="Skylighting.Tokenizer.html#contextStack"><span class="hs-identifier hs-var">contextStack</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty Context -&gt; ContextStack
</span><a href="Skylighting.Tokenizer.html#ContextStack"><span class="hs-identifier hs-var">ContextStack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679139216"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Context -&gt; [Context] -&gt; NonEmpty Context
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">:|</span></span><span> </span><span class="annot"><span class="annottext">[Context]
</span><a href="#local-6989586621679139215"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-176"></span><span>         </span><span class="annot"><span class="annottext">TokenizerM ()
</span><a href="Skylighting.Tokenizer.html#infoContextStack"><span class="hs-identifier hs-var">infoContextStack</span></a></span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span class="annot"><a href="Skylighting.Tokenizer.html#pushContextStack"><span class="hs-identifier hs-type">pushContextStack</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Skylighting.Types.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerM"><span class="hs-identifier hs-type">TokenizerM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-179"></span><span id="pushContextStack"><span class="annot"><span class="annottext">pushContextStack :: Context -&gt; TokenizerM ()
</span><a href="Skylighting.Tokenizer.html#pushContextStack"><span class="hs-identifier hs-var hs-var">pushContextStack</span></a></span></span><span> </span><span id="local-6989586621679139211"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679139211"><span class="hs-identifier hs-var">cont</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-180"></span><span>  </span><span class="annot"><span class="annottext">(TokenizerState -&gt; TokenizerState) -&gt; TokenizerM ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679139210"><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139210"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139210"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">contextStack :: ContextStack
</span><a href="Skylighting.Tokenizer.html#contextStack"><span class="hs-identifier hs-var">contextStack</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-181"></span><span>                      </span><span class="annot"><span class="annottext">NonEmpty Context -&gt; ContextStack
</span><a href="Skylighting.Tokenizer.html#ContextStack"><span class="hs-identifier hs-var">ContextStack</span></a></span><span>
</span><span id="line-182"></span><span>                       </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679139211"><span class="hs-identifier hs-var">cont</span></a></span><span> </span><span class="annot"><span class="annottext">Context -&gt; NonEmpty Context -&gt; NonEmpty Context
forall a. a -&gt; NonEmpty a -&gt; NonEmpty a
</span><span class="hs-operator hs-var">&lt;|</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(NonEmpty Context -&gt; NonEmpty Context)
-&gt; (ContextStack -&gt; NonEmpty Context)
-&gt; ContextStack
-&gt; NonEmpty Context
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ContextStack -&gt; NonEmpty Context
</span><a href="Skylighting.Tokenizer.html#unContextStack"><span class="hs-identifier hs-var hs-var">unContextStack</span></a></span><span> </span><span class="annot"><span class="annottext">(ContextStack -&gt; NonEmpty Context)
-&gt; ContextStack -&gt; NonEmpty Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TokenizerState -&gt; ContextStack
</span><a href="Skylighting.Tokenizer.html#contextStack"><span class="hs-identifier hs-var hs-var">contextStack</span></a></span><span> </span><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139210"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-183"></span><span>  </span><span class="annot"><span class="annottext">TokenizerM ()
</span><a href="Skylighting.Tokenizer.html#infoContextStack"><span class="hs-identifier hs-var">infoContextStack</span></a></span><span>
</span><span id="line-184"></span><span>
</span><span id="line-185"></span><span class="annot"><a href="Skylighting.Tokenizer.html#currentContext"><span class="hs-identifier hs-type">currentContext</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerM"><span class="hs-identifier hs-type">TokenizerM</span></a></span><span> </span><span class="annot"><a href="Skylighting.Types.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span>
</span><span id="line-186"></span><span id="currentContext"><span class="annot"><span class="annottext">currentContext :: TokenizerM Context
</span><a href="Skylighting.Tokenizer.html#currentContext"><span class="hs-identifier hs-var hs-var">currentContext</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-187"></span><span>  </span><span class="annot"><a href="Skylighting.Tokenizer.html#ContextStack"><span class="hs-identifier hs-type">ContextStack</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679139207"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679139207"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span> </span><span class="annot"><span class="annottext">[Context]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TokenizerState -&gt; ContextStack) -&gt; TokenizerM ContextStack
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">TokenizerState -&gt; ContextStack
</span><a href="Skylighting.Tokenizer.html#contextStack"><span class="hs-identifier hs-var hs-var">contextStack</span></a></span><span>
</span><span id="line-188"></span><span>  </span><span class="annot"><span class="annottext">Context -&gt; TokenizerM Context
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679139207"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-189"></span><span>
</span><span id="line-190"></span><span class="annot"><a href="Skylighting.Tokenizer.html#doContextSwitch"><span class="hs-identifier hs-type">doContextSwitch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Skylighting.Types.html#ContextSwitch"><span class="hs-identifier hs-type">ContextSwitch</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerM"><span class="hs-identifier hs-type">TokenizerM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-191"></span><span id="doContextSwitch"><span class="annot"><span class="annottext">doContextSwitch :: ContextSwitch -&gt; TokenizerM ()
</span><a href="Skylighting.Tokenizer.html#doContextSwitch"><span class="hs-identifier hs-var hs-var">doContextSwitch</span></a></span></span><span> </span><span class="annot"><span class="annottext">ContextSwitch
</span><a href="Skylighting.Types.html#Pop"><span class="hs-identifier hs-var">Pop</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TokenizerM ()
</span><a href="Skylighting.Tokenizer.html#popContextStack"><span class="hs-identifier hs-var">popContextStack</span></a></span><span>
</span><span id="line-192"></span><span class="annot"><a href="Skylighting.Tokenizer.html#doContextSwitch"><span class="hs-identifier hs-var">doContextSwitch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Skylighting.Types.html#Push"><span class="hs-identifier hs-type">Push</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679139203"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139203"><span class="hs-identifier hs-var">syn</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679139202"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139202"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-193"></span><span>  </span><span id="local-6989586621679139201"><span class="annot"><span class="annottext">SyntaxMap
</span><a href="#local-6989586621679139201"><span class="hs-identifier hs-var">syntaxes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TokenizerConfig -&gt; SyntaxMap) -&gt; TokenizerM SyntaxMap
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">TokenizerConfig -&gt; SyntaxMap
</span><a href="Skylighting.Tokenizer.html#syntaxMap"><span class="hs-identifier hs-var hs-var">syntaxMap</span></a></span><span>
</span><span id="line-194"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Text -&gt; SyntaxMap -&gt; Maybe Syntax
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139203"><span class="hs-identifier hs-var">syn</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxMap
</span><a href="#local-6989586621679139201"><span class="hs-identifier hs-var">syntaxes</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Syntax -&gt; (Syntax -&gt; Maybe Context) -&gt; Maybe Context
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Syntax -&gt; Maybe Context
</span><a href="Skylighting.Tokenizer.html#lookupContext"><span class="hs-identifier hs-var">lookupContext</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139202"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-195"></span><span>       </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679139199"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679139199"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Context -&gt; TokenizerM ()
</span><a href="Skylighting.Tokenizer.html#pushContextStack"><span class="hs-identifier hs-var">pushContextStack</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679139199"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-196"></span><span>       </span><span class="annot"><span class="annottext">Maybe Context
</span><span class="hs-identifier hs-var">Nothing</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; TokenizerM ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; TokenizerM ()) -&gt; String -&gt; TokenizerM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Unknown syntax or context: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">(Text, Text) -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139203"><span class="hs-identifier hs-var">syn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139202"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span class="annot"><a href="Skylighting.Tokenizer.html#doContextSwitches"><span class="hs-identifier hs-type">doContextSwitches</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Skylighting.Types.html#ContextSwitch"><span class="hs-identifier hs-type">ContextSwitch</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerM"><span class="hs-identifier hs-type">TokenizerM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-199"></span><span id="doContextSwitches"><span class="annot"><span class="annottext">doContextSwitches :: [ContextSwitch] -&gt; TokenizerM ()
</span><a href="Skylighting.Tokenizer.html#doContextSwitches"><span class="hs-identifier hs-var hs-var">doContextSwitches</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ContextSwitch -&gt; TokenizerM ())
-&gt; [ContextSwitch] -&gt; TokenizerM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">ContextSwitch -&gt; TokenizerM ()
</span><a href="Skylighting.Tokenizer.html#doContextSwitch"><span class="hs-identifier hs-var">doContextSwitch</span></a></span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span class="annot"><a href="Skylighting.Tokenizer.html#lookupContext"><span class="hs-identifier hs-type">lookupContext</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Skylighting.Types.html#Syntax"><span class="hs-identifier hs-type">Syntax</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Skylighting.Types.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span>
</span><span id="line-202"></span><span id="lookupContext"><span class="annot"><span class="annottext">lookupContext :: Text -&gt; Syntax -&gt; Maybe Context
</span><a href="Skylighting.Tokenizer.html#lookupContext"><span class="hs-identifier hs-var hs-var">lookupContext</span></a></span></span><span> </span><span id="local-6989586621679139196"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139196"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679139195"><span class="annot"><span class="annottext">Syntax
</span><a href="#local-6989586621679139195"><span class="hs-identifier hs-var">syntax</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Bool
</span><span class="hs-identifier hs-var">Text.null</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139196"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-203"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Bool
</span><span class="hs-identifier hs-var">Text.null</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Syntax -&gt; Text
</span><a href="Skylighting.Types.html#sStartingContext"><span class="hs-identifier hs-var hs-var">sStartingContext</span></a></span><span> </span><span class="annot"><span class="annottext">Syntax
</span><a href="#local-6989586621679139195"><span class="hs-identifier hs-var">syntax</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-204"></span><span>     </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe Context
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-205"></span><span>     </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Syntax -&gt; Maybe Context
</span><a href="Skylighting.Tokenizer.html#lookupContext"><span class="hs-identifier hs-var">lookupContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Syntax -&gt; Text
</span><a href="Skylighting.Types.html#sStartingContext"><span class="hs-identifier hs-var hs-var">sStartingContext</span></a></span><span> </span><span class="annot"><span class="annottext">Syntax
</span><a href="#local-6989586621679139195"><span class="hs-identifier hs-var">syntax</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Syntax
</span><a href="#local-6989586621679139195"><span class="hs-identifier hs-var">syntax</span></a></span><span>
</span><span id="line-206"></span><span class="annot"><a href="Skylighting.Tokenizer.html#lookupContext"><span class="hs-identifier hs-var">lookupContext</span></a></span><span> </span><span id="local-6989586621679139194"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139194"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679139193"><span class="annot"><span class="annottext">Syntax
</span><a href="#local-6989586621679139193"><span class="hs-identifier hs-var">syntax</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Map Text Context -&gt; Maybe Context
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139194"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">(Map Text Context -&gt; Maybe Context)
-&gt; Map Text Context -&gt; Maybe Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Syntax -&gt; Map Text Context
</span><a href="Skylighting.Types.html#sContexts"><span class="hs-identifier hs-var hs-var">sContexts</span></a></span><span> </span><span class="annot"><span class="annottext">Syntax
</span><a href="#local-6989586621679139193"><span class="hs-identifier hs-var">syntax</span></a></span><span>
</span><span id="line-207"></span><span>
</span><span id="line-208"></span><span class="annot"><a href="Skylighting.Tokenizer.html#tokenizeLine"><span class="hs-identifier hs-type">tokenizeLine</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerM"><span class="hs-identifier hs-type">TokenizerM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Skylighting.Types.html#Token"><span class="hs-identifier hs-type">Token</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-209"></span><span id="tokenizeLine"><span class="annot"><span class="annottext">tokenizeLine :: (ByteString, Int) -&gt; TokenizerM SourceLine
</span><a href="Skylighting.Tokenizer.html#tokenizeLine"><span class="hs-identifier hs-var hs-var">tokenizeLine</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679139191"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679139191"><span class="hs-identifier hs-var">ln</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679139190"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679139190"><span class="hs-identifier hs-var">linenum</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-210"></span><span>  </span><span class="annot"><span class="annottext">(TokenizerState -&gt; TokenizerState) -&gt; TokenizerM ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((TokenizerState -&gt; TokenizerState) -&gt; TokenizerM ())
-&gt; (TokenizerState -&gt; TokenizerState) -&gt; TokenizerM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679139189"><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139189"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139189"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">input :: ByteString
</span><a href="Skylighting.Tokenizer.html#input"><span class="hs-identifier hs-var">input</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679139191"><span class="hs-identifier hs-var">ln</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">endline :: Bool
</span><a href="Skylighting.Tokenizer.html#endline"><span class="hs-identifier hs-var">endline</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Bool
</span><span class="hs-identifier hs-var">BS.null</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679139191"><span class="hs-identifier hs-var">ln</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">prevChar :: Char
</span><a href="Skylighting.Tokenizer.html#prevChar"><span class="hs-identifier hs-var">prevChar</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\n'</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-211"></span><span>  </span><span id="local-6989586621679139187"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679139187"><span class="hs-identifier hs-var">cur</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TokenizerM Context
</span><a href="Skylighting.Tokenizer.html#currentContext"><span class="hs-identifier hs-var">currentContext</span></a></span><span>
</span><span id="line-212"></span><span>  </span><span id="local-6989586621679139186"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679139186"><span class="hs-identifier hs-var">lineCont</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TokenizerState -&gt; Bool) -&gt; TokenizerM Bool
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">TokenizerState -&gt; Bool
</span><a href="Skylighting.Tokenizer.html#lineContinuation"><span class="hs-identifier hs-var hs-var">lineContinuation</span></a></span><span>
</span><span id="line-213"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679139186"><span class="hs-identifier hs-var">lineCont</span></a></span><span>
</span><span id="line-214"></span><span>     </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(TokenizerState -&gt; TokenizerState) -&gt; TokenizerM ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((TokenizerState -&gt; TokenizerState) -&gt; TokenizerM ())
-&gt; (TokenizerState -&gt; TokenizerState) -&gt; TokenizerM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679139185"><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139185"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139185"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">lineContinuation :: Bool
</span><a href="Skylighting.Tokenizer.html#lineContinuation"><span class="hs-identifier hs-var">lineContinuation</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-215"></span><span>     </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-216"></span><span>       </span><span class="annot"><span class="annottext">(TokenizerState -&gt; TokenizerState) -&gt; TokenizerM ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((TokenizerState -&gt; TokenizerState) -&gt; TokenizerM ())
-&gt; (TokenizerState -&gt; TokenizerState) -&gt; TokenizerM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679139184"><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139184"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139184"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">column :: Int
</span><a href="Skylighting.Tokenizer.html#column"><span class="hs-identifier hs-var">column</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-217"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">firstNonspaceColumn :: Maybe Int
</span><a href="Skylighting.Tokenizer.html#firstNonspaceColumn"><span class="hs-identifier hs-var">firstNonspaceColumn</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-218"></span><span>                              </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; ByteString -&gt; Maybe Int
</span><span class="hs-identifier hs-var">BS.findIndex</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (Char -&gt; Bool) -&gt; Char -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><span class="hs-identifier hs-var">isSpace</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679139191"><span class="hs-identifier hs-var">ln</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-219"></span><span>       </span><span class="annot"><span class="annottext">[ContextSwitch] -&gt; TokenizerM ()
</span><a href="Skylighting.Tokenizer.html#doContextSwitches"><span class="hs-identifier hs-var">doContextSwitches</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; [ContextSwitch]
</span><a href="Skylighting.Types.html#cLineBeginContext"><span class="hs-identifier hs-var hs-var">cLineBeginContext</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679139187"><span class="hs-identifier hs-var">cur</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-220"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Bool
</span><span class="hs-identifier hs-var">BS.null</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679139191"><span class="hs-identifier hs-var">ln</span></a></span><span>
</span><span id="line-221"></span><span>     </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[ContextSwitch] -&gt; TokenizerM ()
</span><a href="Skylighting.Tokenizer.html#doContextSwitches"><span class="hs-identifier hs-var">doContextSwitches</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; [ContextSwitch]
</span><a href="Skylighting.Types.html#cLineEmptyContext"><span class="hs-identifier hs-var hs-var">cLineEmptyContext</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679139187"><span class="hs-identifier hs-var">cur</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-222"></span><span>     </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[ContextSwitch] -&gt; TokenizerM ()
</span><a href="Skylighting.Tokenizer.html#doContextSwitches"><span class="hs-identifier hs-var">doContextSwitches</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; [ContextSwitch]
</span><a href="Skylighting.Types.html#cLineBeginContext"><span class="hs-identifier hs-var hs-var">cLineBeginContext</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679139187"><span class="hs-identifier hs-var">cur</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-223"></span><span>  </span><span id="local-6989586621679139179"><span class="annot"><span class="annottext">SourceLine
</span><a href="#local-6989586621679139179"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SourceLine -&gt; SourceLine
</span><a href="Skylighting.Tokenizer.html#normalizeHighlighting"><span class="hs-identifier hs-var">normalizeHighlighting</span></a></span><span> </span><span class="annot"><span class="annottext">(SourceLine -&gt; SourceLine)
-&gt; ([Maybe Token] -&gt; SourceLine) -&gt; [Maybe Token] -&gt; SourceLine
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Maybe Token] -&gt; SourceLine
forall a. [Maybe a] -&gt; [a]
</span><span class="hs-identifier hs-var">catMaybes</span></span><span> </span><span class="annot"><span class="annottext">([Maybe Token] -&gt; SourceLine)
-&gt; TokenizerM [Maybe Token] -&gt; TokenizerM SourceLine
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TokenizerM (Maybe Token) -&gt; TokenizerM [Maybe Token]
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f [a]
</span><span class="hs-identifier hs-var">many</span></span><span> </span><span class="annot"><span class="annottext">TokenizerM (Maybe Token)
</span><a href="Skylighting.Tokenizer.html#getToken"><span class="hs-identifier hs-var">getToken</span></a></span><span>
</span><span id="line-224"></span><span>  </span><span id="local-6989586621679139176"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679139176"><span class="hs-identifier hs-var">eol</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TokenizerState -&gt; Bool) -&gt; TokenizerM Bool
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">TokenizerState -&gt; Bool
</span><a href="Skylighting.Tokenizer.html#endline"><span class="hs-identifier hs-var hs-var">endline</span></a></span><span>
</span><span id="line-225"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679139176"><span class="hs-identifier hs-var">eol</span></a></span><span>
</span><span id="line-226"></span><span>     </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-227"></span><span>       </span><span class="annot"><span class="annottext">TokenizerM Context
</span><a href="Skylighting.Tokenizer.html#currentContext"><span class="hs-identifier hs-var">currentContext</span></a></span><span> </span><span class="annot"><span class="annottext">TokenizerM Context -&gt; (Context -&gt; TokenizerM ()) -&gt; TokenizerM ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Context -&gt; TokenizerM ()
</span><a href="Skylighting.Tokenizer.html#checkLineEnd"><span class="hs-identifier hs-var">checkLineEnd</span></a></span><span>
</span><span id="line-228"></span><span>       </span><span class="annot"><span class="annottext">SourceLine -&gt; TokenizerM SourceLine
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">SourceLine
</span><a href="#local-6989586621679139179"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-229"></span><span>     </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-comment">-- fail if we haven't consumed whole line</span><span>
</span><span id="line-230"></span><span>       </span><span id="local-6989586621679139174"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679139174"><span class="hs-identifier hs-var">col</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TokenizerState -&gt; Int) -&gt; TokenizerM Int
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">TokenizerState -&gt; Int
</span><a href="Skylighting.Tokenizer.html#column"><span class="hs-identifier hs-var hs-var">column</span></a></span><span>
</span><span id="line-231"></span><span>       </span><span class="annot"><span class="annottext">String -&gt; TokenizerM SourceLine
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; TokenizerM SourceLine)
-&gt; String -&gt; TokenizerM SourceLine
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Could not match anything at line &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-232"></span><span>         </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679139190"><span class="hs-identifier hs-var">linenum</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; column &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679139174"><span class="hs-identifier hs-var">col</span></a></span><span>
</span><span id="line-233"></span><span>
</span><span id="line-234"></span><span class="annot"><a href="Skylighting.Tokenizer.html#getToken"><span class="hs-identifier hs-type">getToken</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerM"><span class="hs-identifier hs-type">TokenizerM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Skylighting.Types.html#Token"><span class="hs-identifier hs-type">Token</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-235"></span><span id="getToken"><span class="annot"><span class="annottext">getToken :: TokenizerM (Maybe Token)
</span><a href="Skylighting.Tokenizer.html#getToken"><span class="hs-identifier hs-var hs-var">getToken</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-236"></span><span>  </span><span id="local-6989586621679139173"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679139173"><span class="hs-identifier hs-var">inp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TokenizerState -&gt; ByteString) -&gt; TokenizerM ByteString
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">TokenizerState -&gt; ByteString
</span><a href="Skylighting.Tokenizer.html#input"><span class="hs-identifier hs-var hs-var">input</span></a></span><span>
</span><span id="line-237"></span><span>  </span><span class="annot"><span class="annottext">(TokenizerState -&gt; Bool) -&gt; TokenizerM Bool
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">TokenizerState -&gt; Bool
</span><a href="Skylighting.Tokenizer.html#endline"><span class="hs-identifier hs-var hs-var">endline</span></a></span><span> </span><span class="annot"><span class="annottext">TokenizerM Bool -&gt; (Bool -&gt; TokenizerM ()) -&gt; TokenizerM ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TokenizerM ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; TokenizerM ()) -&gt; (Bool -&gt; Bool) -&gt; Bool -&gt; TokenizerM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span>
</span><span id="line-238"></span><span>  </span><span id="local-6989586621679139172"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679139172"><span class="hs-identifier hs-var">context</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TokenizerM Context
</span><a href="Skylighting.Tokenizer.html#currentContext"><span class="hs-identifier hs-var">currentContext</span></a></span><span>
</span><span id="line-239"></span><span>  </span><span class="annot"><span class="annottext">[TokenizerM (Maybe Token)] -&gt; TokenizerM (Maybe Token)
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Foldable t, MonadPlus m) =&gt;
t (m a) -&gt; m a
</span><span class="hs-identifier hs-var">msum</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Rule -&gt; TokenizerM (Maybe Token))
-&gt; [Rule] -&gt; [TokenizerM (Maybe Token)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679139170"><span class="annot"><span class="annottext">Rule
</span><a href="#local-6989586621679139170"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Rule -&gt; ByteString -&gt; TokenizerM (Maybe Token)
</span><a href="Skylighting.Tokenizer.html#tryRule"><span class="hs-identifier hs-var">tryRule</span></a></span><span> </span><span class="annot"><span class="annottext">Rule
</span><a href="#local-6989586621679139170"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679139173"><span class="hs-identifier hs-var">inp</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; [Rule]
</span><a href="Skylighting.Types.html#cRules"><span class="hs-identifier hs-var hs-var">cRules</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679139172"><span class="hs-identifier hs-var">context</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TokenizerM (Maybe Token)
-&gt; TokenizerM (Maybe Token) -&gt; TokenizerM (Maybe Token)
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">&lt;|&gt;</span></span><span>
</span><span id="line-240"></span><span>     </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Context -&gt; [ContextSwitch]
</span><a href="Skylighting.Types.html#cFallthroughContext"><span class="hs-identifier hs-var hs-var">cFallthroughContext</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679139172"><span class="hs-identifier hs-var">context</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-241"></span><span>           </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Context -&gt; Bool
</span><a href="Skylighting.Types.html#cFallthrough"><span class="hs-identifier hs-var hs-var">cFallthrough</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679139172"><span class="hs-identifier hs-var">context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Token
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Maybe Token -&gt; TokenizerM () -&gt; TokenizerM (Maybe Token)
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">[ContextSwitch] -&gt; TokenizerM ()
</span><a href="Skylighting.Tokenizer.html#doContextSwitches"><span class="hs-identifier hs-var">doContextSwitches</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ContextSwitch
</span><a href="Skylighting.Types.html#Pop"><span class="hs-identifier hs-var">Pop</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-242"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-243"></span><span>                  </span><span id="local-6989586621679139164"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139164"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#normalChunk"><span class="hs-identifier hs-var">normalChunk</span></a></span><span>
</span><span id="line-244"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679139162"><span class="annot"><span class="annottext">mbtok :: Maybe Token
</span><a href="#local-6989586621679139162"><span class="hs-identifier hs-var hs-var">mbtok</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Token -&gt; Maybe Token
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; TokenType
</span><a href="Skylighting.Types.html#cAttribute"><span class="hs-identifier hs-var hs-var">cAttribute</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679139172"><span class="hs-identifier hs-var">context</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139164"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-245"></span><span>                  </span><span class="annot"><span class="annottext">String -&gt; TokenizerM ()
</span><a href="Skylighting.Tokenizer.html#info"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; TokenizerM ()) -&gt; String -&gt; TokenizerM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;FALLTHROUGH &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Maybe Token -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Maybe Token
</span><a href="#local-6989586621679139162"><span class="hs-identifier hs-var">mbtok</span></a></span><span>
</span><span id="line-246"></span><span>                  </span><span class="annot"><span class="annottext">Maybe Token -&gt; TokenizerM (Maybe Token)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe Token
</span><a href="#local-6989586621679139162"><span class="hs-identifier hs-var">mbtok</span></a></span><span>
</span><span id="line-247"></span><span>           </span><span id="local-6989586621679139160"><span class="annot"><span class="annottext">[ContextSwitch]
</span><a href="#local-6989586621679139160"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Token
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Maybe Token -&gt; TokenizerM () -&gt; TokenizerM (Maybe Token)
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">[ContextSwitch] -&gt; TokenizerM ()
</span><a href="Skylighting.Tokenizer.html#doContextSwitches"><span class="hs-identifier hs-var">doContextSwitches</span></a></span><span> </span><span class="annot"><span class="annottext">[ContextSwitch]
</span><a href="#local-6989586621679139160"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-248"></span><span>
</span><span id="line-249"></span><span class="annot"><a href="Skylighting.Tokenizer.html#takeChars"><span class="hs-identifier hs-type">takeChars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerM"><span class="hs-identifier hs-type">TokenizerM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-250"></span><span id="takeChars"><span class="annot"><span class="annottext">takeChars :: Int -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#takeChars"><span class="hs-identifier hs-var hs-var">takeChars</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TokenizerM Text
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><span class="hs-identifier hs-var">mzero</span></span><span>
</span><span id="line-251"></span><span class="annot"><a href="Skylighting.Tokenizer.html#takeChars"><span class="hs-identifier hs-var">takeChars</span></a></span><span> </span><span id="local-6989586621679139158"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679139158"><span class="hs-identifier hs-var">numchars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-252"></span><span>  </span><span id="local-6989586621679139157"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679139157"><span class="hs-identifier hs-var">inp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TokenizerState -&gt; ByteString) -&gt; TokenizerM ByteString
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">TokenizerState -&gt; ByteString
</span><a href="Skylighting.Tokenizer.html#input"><span class="hs-identifier hs-var hs-var">input</span></a></span><span>
</span><span id="line-253"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679139156"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679139156"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679139155"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679139155"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ByteString -&gt; (ByteString, ByteString)
</span><span class="hs-identifier hs-var">UTF8.splitAt</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679139158"><span class="hs-identifier hs-var">numchars</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679139157"><span class="hs-identifier hs-var">inp</span></a></span><span>
</span><span id="line-254"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; TokenizerM ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; TokenizerM ()) -&gt; Bool -&gt; TokenizerM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Bool
</span><span class="hs-identifier hs-var">BS.null</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679139156"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-255"></span><span>  </span><span id="local-6989586621679139153"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139153"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#decodeBS"><span class="hs-identifier hs-var">decodeBS</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679139156"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-256"></span><span>  </span><span class="annot"><span class="annottext">(TokenizerState -&gt; TokenizerState) -&gt; TokenizerM ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((TokenizerState -&gt; TokenizerState) -&gt; TokenizerM ())
-&gt; (TokenizerState -&gt; TokenizerState) -&gt; TokenizerM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679139151"><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139151"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139151"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">input :: ByteString
</span><a href="Skylighting.Tokenizer.html#input"><span class="hs-identifier hs-var">input</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679139155"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-257"></span><span>                      </span><span class="annot"><span class="annottext">endline :: Bool
</span><a href="Skylighting.Tokenizer.html#endline"><span class="hs-identifier hs-var">endline</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Bool
</span><span class="hs-identifier hs-var">BS.null</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679139155"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-258"></span><span>                      </span><span class="annot"><span class="annottext">prevChar :: Char
</span><a href="Skylighting.Tokenizer.html#prevChar"><span class="hs-identifier hs-var">prevChar</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Char
</span><span class="hs-identifier hs-var">Text.last</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139153"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-259"></span><span>                      </span><span class="annot"><span class="annottext">column :: Int
</span><a href="Skylighting.Tokenizer.html#column"><span class="hs-identifier hs-var">column</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TokenizerState -&gt; Int
</span><a href="Skylighting.Tokenizer.html#column"><span class="hs-identifier hs-var hs-var">column</span></a></span><span> </span><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139151"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679139158"><span class="hs-identifier hs-var">numchars</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-260"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; TokenizerM Text
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139153"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-261"></span><span>
</span><span id="line-262"></span><span class="annot"><a href="Skylighting.Tokenizer.html#tryRule"><span class="hs-identifier hs-type">tryRule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Skylighting.Types.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerM"><span class="hs-identifier hs-type">TokenizerM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Skylighting.Types.html#Token"><span class="hs-identifier hs-type">Token</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-263"></span><span id="tryRule"><span class="annot"><span class="annottext">tryRule :: Rule -&gt; ByteString -&gt; TokenizerM (Maybe Token)
</span><a href="Skylighting.Tokenizer.html#tryRule"><span class="hs-identifier hs-var hs-var">tryRule</span></a></span></span><span> </span><span class="annot"><span class="annottext">Rule
</span><span class="hs-identifier">_</span></span><span>    </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;&quot;</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TokenizerM (Maybe Token)
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><span class="hs-identifier hs-var">mzero</span></span><span>
</span><span id="line-264"></span><span class="annot"><a href="Skylighting.Tokenizer.html#tryRule"><span class="hs-identifier hs-var">tryRule</span></a></span><span> </span><span id="local-6989586621679139148"><span class="annot"><span class="annottext">Rule
</span><a href="#local-6989586621679139148"><span class="hs-identifier hs-var">rule</span></a></span></span><span> </span><span id="local-6989586621679139147"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679139147"><span class="hs-identifier hs-var">inp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-265"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; TokenizerM ()
</span><a href="Skylighting.Tokenizer.html#info"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; TokenizerM ()) -&gt; String -&gt; TokenizerM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Trying rule &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Rule -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Rule
</span><a href="#local-6989586621679139148"><span class="hs-identifier hs-var">rule</span></a></span><span>
</span><span id="line-266"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Rule -&gt; Maybe Int
</span><a href="Skylighting.Types.html#rColumn"><span class="hs-identifier hs-var hs-var">rColumn</span></a></span><span> </span><span class="annot"><span class="annottext">Rule
</span><a href="#local-6989586621679139148"><span class="hs-identifier hs-var">rule</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-267"></span><span>       </span><span class="annot"><span class="annottext">Maybe Int
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TokenizerM ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-268"></span><span>       </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679139145"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679139145"><span class="hs-identifier hs-var">n</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(TokenizerState -&gt; Int) -&gt; TokenizerM Int
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">TokenizerState -&gt; Int
</span><a href="Skylighting.Tokenizer.html#column"><span class="hs-identifier hs-var hs-var">column</span></a></span><span> </span><span class="annot"><span class="annottext">TokenizerM Int -&gt; (Int -&gt; TokenizerM ()) -&gt; TokenizerM ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TokenizerM ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; TokenizerM ()) -&gt; (Int -&gt; Bool) -&gt; Int -&gt; TokenizerM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679139145"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-269"></span><span>
</span><span id="line-270"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; TokenizerM () -&gt; TokenizerM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rule -&gt; Bool
</span><a href="Skylighting.Types.html#rFirstNonspace"><span class="hs-identifier hs-var hs-var">rFirstNonspace</span></a></span><span> </span><span class="annot"><span class="annottext">Rule
</span><a href="#local-6989586621679139148"><span class="hs-identifier hs-var">rule</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TokenizerM () -&gt; TokenizerM ()) -&gt; TokenizerM () -&gt; TokenizerM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-271"></span><span>    </span><span id="local-6989586621679139143"><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621679139143"><span class="hs-identifier hs-var">firstNonspace</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TokenizerState -&gt; Maybe Int) -&gt; TokenizerM (Maybe Int)
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">TokenizerState -&gt; Maybe Int
</span><a href="Skylighting.Tokenizer.html#firstNonspaceColumn"><span class="hs-identifier hs-var hs-var">firstNonspaceColumn</span></a></span><span>
</span><span id="line-272"></span><span>    </span><span id="local-6989586621679139142"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679139142"><span class="hs-identifier hs-var">col</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TokenizerState -&gt; Int) -&gt; TokenizerM Int
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">TokenizerState -&gt; Int
</span><a href="Skylighting.Tokenizer.html#column"><span class="hs-identifier hs-var hs-var">column</span></a></span><span>
</span><span id="line-273"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; TokenizerM ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621679139143"><span class="hs-identifier hs-var">firstNonspace</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Int -&gt; Maybe Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679139142"><span class="hs-identifier hs-var">col</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-274"></span><span>
</span><span id="line-275"></span><span>  </span><span id="local-6989586621679139141"><span class="annot"><span class="annottext">Maybe TokenizerState
</span><a href="#local-6989586621679139141"><span class="hs-identifier hs-var">oldstate</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Rule -&gt; Bool
</span><a href="Skylighting.Types.html#rLookahead"><span class="hs-identifier hs-var hs-var">rLookahead</span></a></span><span> </span><span class="annot"><span class="annottext">Rule
</span><a href="#local-6989586621679139148"><span class="hs-identifier hs-var">rule</span></a></span><span>
</span><span id="line-276"></span><span>                 </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">TokenizerState -&gt; Maybe TokenizerState
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(TokenizerState -&gt; Maybe TokenizerState)
-&gt; TokenizerM TokenizerState -&gt; TokenizerM (Maybe TokenizerState)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TokenizerM TokenizerState
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span> </span><span class="hs-comment">-- needed for lookahead rules</span><span>
</span><span id="line-277"></span><span>                 </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe TokenizerState -&gt; TokenizerM (Maybe TokenizerState)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe TokenizerState
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-278"></span><span>
</span><span id="line-279"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679139139"><span class="annot"><span class="annottext">attr :: TokenType
</span><a href="#local-6989586621679139139"><span class="hs-identifier hs-var hs-var">attr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Rule -&gt; TokenType
</span><a href="Skylighting.Types.html#rAttribute"><span class="hs-identifier hs-var hs-var">rAttribute</span></a></span><span> </span><span class="annot"><span class="annottext">Rule
</span><a href="#local-6989586621679139148"><span class="hs-identifier hs-var">rule</span></a></span><span>
</span><span id="line-280"></span><span>  </span><span id="local-6989586621679139137"><span class="annot"><span class="annottext">Maybe Token
</span><a href="#local-6989586621679139137"><span class="hs-identifier hs-var">mbtok</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Rule -&gt; Matcher
</span><a href="Skylighting.Types.html#rMatcher"><span class="hs-identifier hs-var hs-var">rMatcher</span></a></span><span> </span><span class="annot"><span class="annottext">Rule
</span><a href="#local-6989586621679139148"><span class="hs-identifier hs-var">rule</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-281"></span><span>                </span><span class="annot"><a href="Skylighting.Types.html#DetectChar"><span class="hs-identifier hs-type">DetectChar</span></a></span><span> </span><span id="local-6989586621679139134"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679139134"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TokenType -&gt; TokenizerM Text -&gt; TokenizerM (Maybe Token)
</span><a href="Skylighting.Tokenizer.html#withAttr"><span class="hs-identifier hs-var">withAttr</span></a></span><span> </span><span class="annot"><span class="annottext">TokenType
</span><a href="#local-6989586621679139139"><span class="hs-identifier hs-var">attr</span></a></span><span> </span><span class="annot"><span class="annottext">(TokenizerM Text -&gt; TokenizerM (Maybe Token))
-&gt; TokenizerM Text -&gt; TokenizerM (Maybe Token)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Char -&gt; ByteString -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#detectChar"><span class="hs-identifier hs-var">detectChar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rule -&gt; Bool
</span><a href="Skylighting.Types.html#rDynamic"><span class="hs-identifier hs-var hs-var">rDynamic</span></a></span><span> </span><span class="annot"><span class="annottext">Rule
</span><a href="#local-6989586621679139148"><span class="hs-identifier hs-var">rule</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679139134"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679139147"><span class="hs-identifier hs-var">inp</span></a></span><span>
</span><span id="line-282"></span><span>                </span><span class="annot"><a href="Skylighting.Types.html#Detect2Chars"><span class="hs-identifier hs-type">Detect2Chars</span></a></span><span> </span><span id="local-6989586621679139129"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679139129"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679139128"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679139128"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TokenType -&gt; TokenizerM Text -&gt; TokenizerM (Maybe Token)
</span><a href="Skylighting.Tokenizer.html#withAttr"><span class="hs-identifier hs-var">withAttr</span></a></span><span> </span><span class="annot"><span class="annottext">TokenType
</span><a href="#local-6989586621679139139"><span class="hs-identifier hs-var">attr</span></a></span><span> </span><span class="annot"><span class="annottext">(TokenizerM Text -&gt; TokenizerM (Maybe Token))
-&gt; TokenizerM Text -&gt; TokenizerM (Maybe Token)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-283"></span><span>                                      </span><span class="annot"><span class="annottext">Bool -&gt; Char -&gt; Char -&gt; ByteString -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#detect2Chars"><span class="hs-identifier hs-var">detect2Chars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rule -&gt; Bool
</span><a href="Skylighting.Types.html#rDynamic"><span class="hs-identifier hs-var hs-var">rDynamic</span></a></span><span> </span><span class="annot"><span class="annottext">Rule
</span><a href="#local-6989586621679139148"><span class="hs-identifier hs-var">rule</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679139129"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679139128"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679139147"><span class="hs-identifier hs-var">inp</span></a></span><span>
</span><span id="line-284"></span><span>                </span><span class="annot"><a href="Skylighting.Types.html#AnyChar"><span class="hs-identifier hs-type">AnyChar</span></a></span><span> </span><span id="local-6989586621679139125"><span class="annot"><span class="annottext">Set Char
</span><a href="#local-6989586621679139125"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TokenType -&gt; TokenizerM Text -&gt; TokenizerM (Maybe Token)
</span><a href="Skylighting.Tokenizer.html#withAttr"><span class="hs-identifier hs-var">withAttr</span></a></span><span> </span><span class="annot"><span class="annottext">TokenType
</span><a href="#local-6989586621679139139"><span class="hs-identifier hs-var">attr</span></a></span><span> </span><span class="annot"><span class="annottext">(TokenizerM Text -&gt; TokenizerM (Maybe Token))
-&gt; TokenizerM Text -&gt; TokenizerM (Maybe Token)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set Char -&gt; ByteString -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#anyChar"><span class="hs-identifier hs-var">anyChar</span></a></span><span> </span><span class="annot"><span class="annottext">Set Char
</span><a href="#local-6989586621679139125"><span class="hs-identifier hs-var">cs</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679139147"><span class="hs-identifier hs-var">inp</span></a></span><span>
</span><span id="line-285"></span><span>                </span><span class="annot"><a href="Skylighting.Types.html#RangeDetect"><span class="hs-identifier hs-type">RangeDetect</span></a></span><span> </span><span id="local-6989586621679139122"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679139122"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679139121"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679139121"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TokenType -&gt; TokenizerM Text -&gt; TokenizerM (Maybe Token)
</span><a href="Skylighting.Tokenizer.html#withAttr"><span class="hs-identifier hs-var">withAttr</span></a></span><span> </span><span class="annot"><span class="annottext">TokenType
</span><a href="#local-6989586621679139139"><span class="hs-identifier hs-var">attr</span></a></span><span> </span><span class="annot"><span class="annottext">(TokenizerM Text -&gt; TokenizerM (Maybe Token))
-&gt; TokenizerM Text -&gt; TokenizerM (Maybe Token)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; ByteString -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#rangeDetect"><span class="hs-identifier hs-var">rangeDetect</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679139122"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679139121"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679139147"><span class="hs-identifier hs-var">inp</span></a></span><span>
</span><span id="line-286"></span><span>                </span><span class="annot"><a href="Skylighting.Types.html#RegExpr"><span class="hs-identifier hs-type">RegExpr</span></a></span><span> </span><span id="local-6989586621679139118"><span class="annot"><span class="annottext">RE
</span><a href="#local-6989586621679139118"><span class="hs-identifier hs-var">re</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TokenType -&gt; TokenizerM Text -&gt; TokenizerM (Maybe Token)
</span><a href="Skylighting.Tokenizer.html#withAttr"><span class="hs-identifier hs-var">withAttr</span></a></span><span> </span><span class="annot"><span class="annottext">TokenType
</span><a href="#local-6989586621679139139"><span class="hs-identifier hs-var">attr</span></a></span><span> </span><span class="annot"><span class="annottext">(TokenizerM Text -&gt; TokenizerM (Maybe Token))
-&gt; TokenizerM Text -&gt; TokenizerM (Maybe Token)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; RE -&gt; ByteString -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#regExpr"><span class="hs-identifier hs-var">regExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rule -&gt; Bool
</span><a href="Skylighting.Types.html#rDynamic"><span class="hs-identifier hs-var hs-var">rDynamic</span></a></span><span> </span><span class="annot"><span class="annottext">Rule
</span><a href="#local-6989586621679139148"><span class="hs-identifier hs-var">rule</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RE
</span><a href="#local-6989586621679139118"><span class="hs-identifier hs-var">re</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679139147"><span class="hs-identifier hs-var">inp</span></a></span><span>
</span><span id="line-287"></span><span>                </span><span class="annot"><span class="annottext">Matcher
</span><a href="Skylighting.Types.html#Int"><span class="hs-identifier hs-var">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TokenType -&gt; TokenizerM Text -&gt; TokenizerM (Maybe Token)
</span><a href="Skylighting.Tokenizer.html#withAttr"><span class="hs-identifier hs-var">withAttr</span></a></span><span> </span><span class="annot"><span class="annottext">TokenType
</span><a href="#local-6989586621679139139"><span class="hs-identifier hs-var">attr</span></a></span><span> </span><span class="annot"><span class="annottext">(TokenizerM Text -&gt; TokenizerM (Maybe Token))
-&gt; TokenizerM Text -&gt; TokenizerM (Maybe Token)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#parseInt"><span class="hs-identifier hs-var">parseInt</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679139147"><span class="hs-identifier hs-var">inp</span></a></span><span>
</span><span id="line-288"></span><span>                </span><span class="annot"><span class="annottext">Matcher
</span><a href="Skylighting.Types.html#HlCOct"><span class="hs-identifier hs-var">HlCOct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TokenType -&gt; TokenizerM Text -&gt; TokenizerM (Maybe Token)
</span><a href="Skylighting.Tokenizer.html#withAttr"><span class="hs-identifier hs-var">withAttr</span></a></span><span> </span><span class="annot"><span class="annottext">TokenType
</span><a href="#local-6989586621679139139"><span class="hs-identifier hs-var">attr</span></a></span><span> </span><span class="annot"><span class="annottext">(TokenizerM Text -&gt; TokenizerM (Maybe Token))
-&gt; TokenizerM Text -&gt; TokenizerM (Maybe Token)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#parseOct"><span class="hs-identifier hs-var">parseOct</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679139147"><span class="hs-identifier hs-var">inp</span></a></span><span>
</span><span id="line-289"></span><span>                </span><span class="annot"><span class="annottext">Matcher
</span><a href="Skylighting.Types.html#HlCHex"><span class="hs-identifier hs-var">HlCHex</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TokenType -&gt; TokenizerM Text -&gt; TokenizerM (Maybe Token)
</span><a href="Skylighting.Tokenizer.html#withAttr"><span class="hs-identifier hs-var">withAttr</span></a></span><span> </span><span class="annot"><span class="annottext">TokenType
</span><a href="#local-6989586621679139139"><span class="hs-identifier hs-var">attr</span></a></span><span> </span><span class="annot"><span class="annottext">(TokenizerM Text -&gt; TokenizerM (Maybe Token))
-&gt; TokenizerM Text -&gt; TokenizerM (Maybe Token)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#parseHex"><span class="hs-identifier hs-var">parseHex</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679139147"><span class="hs-identifier hs-var">inp</span></a></span><span>
</span><span id="line-290"></span><span>                </span><span class="annot"><span class="annottext">Matcher
</span><a href="Skylighting.Types.html#HlCStringChar"><span class="hs-identifier hs-var">HlCStringChar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TokenType -&gt; TokenizerM Text -&gt; TokenizerM (Maybe Token)
</span><a href="Skylighting.Tokenizer.html#withAttr"><span class="hs-identifier hs-var">withAttr</span></a></span><span> </span><span class="annot"><span class="annottext">TokenType
</span><a href="#local-6989586621679139139"><span class="hs-identifier hs-var">attr</span></a></span><span> </span><span class="annot"><span class="annottext">(TokenizerM Text -&gt; TokenizerM (Maybe Token))
-&gt; TokenizerM Text -&gt; TokenizerM (Maybe Token)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#parseCStringChar"><span class="hs-identifier hs-var">parseCStringChar</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679139147"><span class="hs-identifier hs-var">inp</span></a></span><span>
</span><span id="line-291"></span><span>                </span><span class="annot"><span class="annottext">Matcher
</span><a href="Skylighting.Types.html#HlCChar"><span class="hs-identifier hs-var">HlCChar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TokenType -&gt; TokenizerM Text -&gt; TokenizerM (Maybe Token)
</span><a href="Skylighting.Tokenizer.html#withAttr"><span class="hs-identifier hs-var">withAttr</span></a></span><span> </span><span class="annot"><span class="annottext">TokenType
</span><a href="#local-6989586621679139139"><span class="hs-identifier hs-var">attr</span></a></span><span> </span><span class="annot"><span class="annottext">(TokenizerM Text -&gt; TokenizerM (Maybe Token))
-&gt; TokenizerM Text -&gt; TokenizerM (Maybe Token)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#parseCChar"><span class="hs-identifier hs-var">parseCChar</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679139147"><span class="hs-identifier hs-var">inp</span></a></span><span>
</span><span id="line-292"></span><span>                </span><span class="annot"><span class="annottext">Matcher
</span><a href="Skylighting.Types.html#Float"><span class="hs-identifier hs-var">Float</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TokenType -&gt; TokenizerM Text -&gt; TokenizerM (Maybe Token)
</span><a href="Skylighting.Tokenizer.html#withAttr"><span class="hs-identifier hs-var">withAttr</span></a></span><span> </span><span class="annot"><span class="annottext">TokenType
</span><a href="#local-6989586621679139139"><span class="hs-identifier hs-var">attr</span></a></span><span> </span><span class="annot"><span class="annottext">(TokenizerM Text -&gt; TokenizerM (Maybe Token))
-&gt; TokenizerM Text -&gt; TokenizerM (Maybe Token)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#parseFloat"><span class="hs-identifier hs-var">parseFloat</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679139147"><span class="hs-identifier hs-var">inp</span></a></span><span>
</span><span id="line-293"></span><span>                </span><span class="annot"><a href="Skylighting.Types.html#Keyword"><span class="hs-identifier hs-type">Keyword</span></a></span><span> </span><span id="local-6989586621679139103"><span class="annot"><span class="annottext">KeywordAttr
</span><a href="#local-6989586621679139103"><span class="hs-identifier hs-var">kwattr</span></a></span></span><span> </span><span id="local-6989586621679139102"><span class="annot"><span class="annottext">WordSet Text
</span><a href="#local-6989586621679139102"><span class="hs-identifier hs-var">kws</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TokenType -&gt; TokenizerM Text -&gt; TokenizerM (Maybe Token)
</span><a href="Skylighting.Tokenizer.html#withAttr"><span class="hs-identifier hs-var">withAttr</span></a></span><span> </span><span class="annot"><span class="annottext">TokenType
</span><a href="#local-6989586621679139139"><span class="hs-identifier hs-var">attr</span></a></span><span> </span><span class="annot"><span class="annottext">(TokenizerM Text -&gt; TokenizerM (Maybe Token))
-&gt; TokenizerM Text -&gt; TokenizerM (Maybe Token)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">KeywordAttr -&gt; WordSet Text -&gt; ByteString -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#keyword"><span class="hs-identifier hs-var">keyword</span></a></span><span> </span><span class="annot"><span class="annottext">KeywordAttr
</span><a href="#local-6989586621679139103"><span class="hs-identifier hs-var">kwattr</span></a></span><span> </span><span class="annot"><span class="annottext">WordSet Text
</span><a href="#local-6989586621679139102"><span class="hs-identifier hs-var">kws</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679139147"><span class="hs-identifier hs-var">inp</span></a></span><span>
</span><span id="line-294"></span><span>                </span><span class="annot"><a href="Skylighting.Types.html#StringDetect"><span class="hs-identifier hs-type">StringDetect</span></a></span><span> </span><span id="local-6989586621679139099"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139099"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TokenType -&gt; TokenizerM Text -&gt; TokenizerM (Maybe Token)
</span><a href="Skylighting.Tokenizer.html#withAttr"><span class="hs-identifier hs-var">withAttr</span></a></span><span> </span><span class="annot"><span class="annottext">TokenType
</span><a href="#local-6989586621679139139"><span class="hs-identifier hs-var">attr</span></a></span><span> </span><span class="annot"><span class="annottext">(TokenizerM Text -&gt; TokenizerM (Maybe Token))
-&gt; TokenizerM Text -&gt; TokenizerM (Maybe Token)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-295"></span><span>                                    </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Text -&gt; ByteString -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#stringDetect"><span class="hs-identifier hs-var">stringDetect</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rule -&gt; Bool
</span><a href="Skylighting.Types.html#rDynamic"><span class="hs-identifier hs-var hs-var">rDynamic</span></a></span><span> </span><span class="annot"><span class="annottext">Rule
</span><a href="#local-6989586621679139148"><span class="hs-identifier hs-var">rule</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rule -&gt; Bool
</span><a href="Skylighting.Types.html#rCaseSensitive"><span class="hs-identifier hs-var hs-var">rCaseSensitive</span></a></span><span> </span><span class="annot"><span class="annottext">Rule
</span><a href="#local-6989586621679139148"><span class="hs-identifier hs-var">rule</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-296"></span><span>                                                 </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139099"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679139147"><span class="hs-identifier hs-var">inp</span></a></span><span>
</span><span id="line-297"></span><span>                </span><span class="annot"><a href="Skylighting.Types.html#WordDetect"><span class="hs-identifier hs-type">WordDetect</span></a></span><span> </span><span id="local-6989586621679139095"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139095"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TokenType -&gt; TokenizerM Text -&gt; TokenizerM (Maybe Token)
</span><a href="Skylighting.Tokenizer.html#withAttr"><span class="hs-identifier hs-var">withAttr</span></a></span><span> </span><span class="annot"><span class="annottext">TokenType
</span><a href="#local-6989586621679139139"><span class="hs-identifier hs-var">attr</span></a></span><span> </span><span class="annot"><span class="annottext">(TokenizerM Text -&gt; TokenizerM (Maybe Token))
-&gt; TokenizerM Text -&gt; TokenizerM (Maybe Token)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-298"></span><span>                                    </span><span class="annot"><span class="annottext">Bool -&gt; Text -&gt; ByteString -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#wordDetect"><span class="hs-identifier hs-var">wordDetect</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rule -&gt; Bool
</span><a href="Skylighting.Types.html#rCaseSensitive"><span class="hs-identifier hs-var hs-var">rCaseSensitive</span></a></span><span> </span><span class="annot"><span class="annottext">Rule
</span><a href="#local-6989586621679139148"><span class="hs-identifier hs-var">rule</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139095"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679139147"><span class="hs-identifier hs-var">inp</span></a></span><span>
</span><span id="line-299"></span><span>                </span><span class="annot"><span class="annottext">Matcher
</span><a href="Skylighting.Types.html#LineContinue"><span class="hs-identifier hs-var">LineContinue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TokenType -&gt; TokenizerM Text -&gt; TokenizerM (Maybe Token)
</span><a href="Skylighting.Tokenizer.html#withAttr"><span class="hs-identifier hs-var">withAttr</span></a></span><span> </span><span class="annot"><span class="annottext">TokenType
</span><a href="#local-6989586621679139139"><span class="hs-identifier hs-var">attr</span></a></span><span> </span><span class="annot"><span class="annottext">(TokenizerM Text -&gt; TokenizerM (Maybe Token))
-&gt; TokenizerM Text -&gt; TokenizerM (Maybe Token)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#lineContinue"><span class="hs-identifier hs-var">lineContinue</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679139147"><span class="hs-identifier hs-var">inp</span></a></span><span>
</span><span id="line-300"></span><span>                </span><span class="annot"><span class="annottext">Matcher
</span><a href="Skylighting.Types.html#DetectSpaces"><span class="hs-identifier hs-var">DetectSpaces</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TokenType -&gt; TokenizerM Text -&gt; TokenizerM (Maybe Token)
</span><a href="Skylighting.Tokenizer.html#withAttr"><span class="hs-identifier hs-var">withAttr</span></a></span><span> </span><span class="annot"><span class="annottext">TokenType
</span><a href="#local-6989586621679139139"><span class="hs-identifier hs-var">attr</span></a></span><span> </span><span class="annot"><span class="annottext">(TokenizerM Text -&gt; TokenizerM (Maybe Token))
-&gt; TokenizerM Text -&gt; TokenizerM (Maybe Token)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#detectSpaces"><span class="hs-identifier hs-var">detectSpaces</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679139147"><span class="hs-identifier hs-var">inp</span></a></span><span>
</span><span id="line-301"></span><span>                </span><span class="annot"><span class="annottext">Matcher
</span><a href="Skylighting.Types.html#DetectIdentifier"><span class="hs-identifier hs-var">DetectIdentifier</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TokenType -&gt; TokenizerM Text -&gt; TokenizerM (Maybe Token)
</span><a href="Skylighting.Tokenizer.html#withAttr"><span class="hs-identifier hs-var">withAttr</span></a></span><span> </span><span class="annot"><span class="annottext">TokenType
</span><a href="#local-6989586621679139139"><span class="hs-identifier hs-var">attr</span></a></span><span> </span><span class="annot"><span class="annottext">(TokenizerM Text -&gt; TokenizerM (Maybe Token))
-&gt; TokenizerM Text -&gt; TokenizerM (Maybe Token)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#detectIdentifier"><span class="hs-identifier hs-var">detectIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679139147"><span class="hs-identifier hs-var">inp</span></a></span><span>
</span><span id="line-302"></span><span>                </span><span class="annot"><a href="Skylighting.Types.html#IncludeRules"><span class="hs-identifier hs-type">IncludeRules</span></a></span><span> </span><span id="local-6989586621679139086"><span class="annot"><span class="annottext">(Text, Text)
</span><a href="#local-6989586621679139086"><span class="hs-identifier hs-var">cname</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe TokenType
-&gt; (Text, Text) -&gt; ByteString -&gt; TokenizerM (Maybe Token)
</span><a href="Skylighting.Tokenizer.html#includeRules"><span class="hs-identifier hs-var">includeRules</span></a></span><span>
</span><span id="line-303"></span><span>                   </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Rule -&gt; Bool
</span><a href="Skylighting.Types.html#rIncludeAttribute"><span class="hs-identifier hs-var hs-var">rIncludeAttribute</span></a></span><span> </span><span class="annot"><span class="annottext">Rule
</span><a href="#local-6989586621679139148"><span class="hs-identifier hs-var">rule</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">TokenType -&gt; Maybe TokenType
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">TokenType
</span><a href="#local-6989586621679139139"><span class="hs-identifier hs-var">attr</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe TokenType
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-304"></span><span>                   </span><span class="annot"><span class="annottext">(Text, Text)
</span><a href="#local-6989586621679139086"><span class="hs-identifier hs-var">cname</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679139147"><span class="hs-identifier hs-var">inp</span></a></span><span>
</span><span id="line-305"></span><span>  </span><span id="local-6989586621679139083"><span class="annot"><span class="annottext">Maybe Token
</span><a href="#local-6989586621679139083"><span class="hs-identifier hs-var">mbchildren</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-306"></span><span>    </span><span id="local-6989586621679139082"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679139082"><span class="hs-identifier hs-var">inp'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TokenizerState -&gt; ByteString) -&gt; TokenizerM ByteString
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">TokenizerState -&gt; ByteString
</span><a href="Skylighting.Tokenizer.html#input"><span class="hs-identifier hs-var hs-var">input</span></a></span><span>
</span><span id="line-307"></span><span>    </span><span class="annot"><span class="annottext">[TokenizerM (Maybe Token)] -&gt; TokenizerM (Maybe Token)
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Foldable t, MonadPlus m) =&gt;
t (m a) -&gt; m a
</span><span class="hs-identifier hs-var">msum</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Rule -&gt; TokenizerM (Maybe Token))
-&gt; [Rule] -&gt; [TokenizerM (Maybe Token)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679139081"><span class="annot"><span class="annottext">Rule
</span><a href="#local-6989586621679139081"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Rule -&gt; ByteString -&gt; TokenizerM (Maybe Token)
</span><a href="Skylighting.Tokenizer.html#tryRule"><span class="hs-identifier hs-var">tryRule</span></a></span><span> </span><span class="annot"><span class="annottext">Rule
</span><a href="#local-6989586621679139081"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679139082"><span class="hs-identifier hs-var">inp'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rule -&gt; [Rule]
</span><a href="Skylighting.Types.html#rChildren"><span class="hs-identifier hs-var hs-var">rChildren</span></a></span><span> </span><span class="annot"><span class="annottext">Rule
</span><a href="#local-6989586621679139148"><span class="hs-identifier hs-var">rule</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TokenizerM (Maybe Token)
-&gt; TokenizerM (Maybe Token) -&gt; TokenizerM (Maybe Token)
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Token -&gt; TokenizerM (Maybe Token)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe Token
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-308"></span><span>
</span><span id="line-309"></span><span>  </span><span id="local-6989586621679139079"><span class="annot"><span class="annottext">Maybe Token
</span><a href="#local-6989586621679139079"><span class="hs-identifier hs-var">mbtok'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Token
</span><a href="#local-6989586621679139137"><span class="hs-identifier hs-var">mbtok</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-310"></span><span>                 </span><span class="annot"><span class="annottext">Maybe Token
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Token -&gt; TokenizerM (Maybe Token)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe Token
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-311"></span><span>                 </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679139078"><span class="annot"><span class="annottext">TokenType
</span><a href="#local-6989586621679139078"><span class="hs-identifier hs-var">tt</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679139077"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139077"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-312"></span><span>                   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Rule -&gt; Bool
</span><a href="Skylighting.Types.html#rLookahead"><span class="hs-identifier hs-var hs-var">rLookahead</span></a></span><span> </span><span class="annot"><span class="annottext">Rule
</span><a href="#local-6989586621679139148"><span class="hs-identifier hs-var">rule</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-313"></span><span>                     </span><span class="hs-special">(</span><span id="local-6989586621679139076"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679139076"><span class="hs-identifier hs-var">oldinput</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679139075"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679139075"><span class="hs-identifier hs-var">oldendline</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679139074"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679139074"><span class="hs-identifier hs-var">oldprevChar</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679139073"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679139073"><span class="hs-identifier hs-var">oldColumn</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-314"></span><span>                         </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe TokenizerState
</span><a href="#local-6989586621679139141"><span class="hs-identifier hs-var">oldstate</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-315"></span><span>                              </span><span class="annot"><span class="annottext">Maybe TokenizerState
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; TokenizerM (ByteString, Bool, Char, Int)
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span>
</span><span id="line-316"></span><span>                                    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;oldstate not saved with lookahead rule&quot;</span></span><span>
</span><span id="line-317"></span><span>                              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679139072"><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139072"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(ByteString, Bool, Char, Int)
-&gt; TokenizerM (ByteString, Bool, Char, Int)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-318"></span><span>                                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenizerState -&gt; ByteString
</span><a href="Skylighting.Tokenizer.html#input"><span class="hs-identifier hs-var hs-var">input</span></a></span><span> </span><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139072"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TokenizerState -&gt; Bool
</span><a href="Skylighting.Tokenizer.html#endline"><span class="hs-identifier hs-var hs-var">endline</span></a></span><span> </span><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139072"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-319"></span><span>                                     </span><span class="annot"><span class="annottext">TokenizerState -&gt; Char
</span><a href="Skylighting.Tokenizer.html#prevChar"><span class="hs-identifier hs-var hs-var">prevChar</span></a></span><span> </span><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139072"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TokenizerState -&gt; Int
</span><a href="Skylighting.Tokenizer.html#column"><span class="hs-identifier hs-var hs-var">column</span></a></span><span> </span><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139072"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-320"></span><span>                     </span><span class="annot"><span class="annottext">(TokenizerState -&gt; TokenizerState) -&gt; TokenizerM ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((TokenizerState -&gt; TokenizerState) -&gt; TokenizerM ())
-&gt; (TokenizerState -&gt; TokenizerState) -&gt; TokenizerM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679139071"><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139071"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679139071"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">input :: ByteString
</span><a href="Skylighting.Tokenizer.html#input"><span class="hs-identifier hs-var">input</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679139076"><span class="hs-identifier hs-var">oldinput</span></a></span><span>
</span><span id="line-321"></span><span>                                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">endline :: Bool
</span><a href="Skylighting.Tokenizer.html#endline"><span class="hs-identifier hs-var">endline</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679139075"><span class="hs-identifier hs-var">oldendline</span></a></span><span>
</span><span id="line-322"></span><span>                                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">prevChar :: Char
</span><a href="Skylighting.Tokenizer.html#prevChar"><span class="hs-identifier hs-var">prevChar</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679139074"><span class="hs-identifier hs-var">oldprevChar</span></a></span><span>
</span><span id="line-323"></span><span>                                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">column :: Int
</span><a href="Skylighting.Tokenizer.html#column"><span class="hs-identifier hs-var">column</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679139073"><span class="hs-identifier hs-var">oldColumn</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-324"></span><span>                     </span><span class="annot"><span class="annottext">Maybe Token -&gt; TokenizerM (Maybe Token)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe Token
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-325"></span><span>                   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-326"></span><span>                     </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Token
</span><a href="#local-6989586621679139083"><span class="hs-identifier hs-var">mbchildren</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-327"></span><span>                          </span><span class="annot"><span class="annottext">Maybe Token
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Token -&gt; TokenizerM (Maybe Token)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Token -&gt; TokenizerM (Maybe Token))
-&gt; Maybe Token -&gt; TokenizerM (Maybe Token)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Token -&gt; Maybe Token
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenType
</span><a href="#local-6989586621679139078"><span class="hs-identifier hs-var">tt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139077"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-328"></span><span>                          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenType
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679139070"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139070"><span class="hs-identifier hs-var">cresult</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Token -&gt; TokenizerM (Maybe Token)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Token -&gt; TokenizerM (Maybe Token))
-&gt; Maybe Token -&gt; TokenizerM (Maybe Token)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Token -&gt; Maybe Token
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenType
</span><a href="#local-6989586621679139078"><span class="hs-identifier hs-var">tt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139077"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139070"><span class="hs-identifier hs-var">cresult</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-329"></span><span>
</span><span id="line-330"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; TokenizerM ()
</span><a href="Skylighting.Tokenizer.html#info"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; TokenizerM ()) -&gt; String -&gt; TokenizerM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; ShowS
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">takeWhile</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">' '</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Matcher -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rule -&gt; Matcher
</span><a href="Skylighting.Types.html#rMatcher"><span class="hs-identifier hs-var hs-var">rMatcher</span></a></span><span> </span><span class="annot"><span class="annottext">Rule
</span><a href="#local-6989586621679139148"><span class="hs-identifier hs-var">rule</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; MATCHED &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Maybe Token -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Maybe Token
</span><a href="#local-6989586621679139079"><span class="hs-identifier hs-var">mbtok'</span></a></span><span>
</span><span id="line-331"></span><span>  </span><span class="annot"><span class="annottext">[ContextSwitch] -&gt; TokenizerM ()
</span><a href="Skylighting.Tokenizer.html#doContextSwitches"><span class="hs-identifier hs-var">doContextSwitches</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rule -&gt; [ContextSwitch]
</span><a href="Skylighting.Types.html#rContextSwitch"><span class="hs-identifier hs-var hs-var">rContextSwitch</span></a></span><span> </span><span class="annot"><span class="annottext">Rule
</span><a href="#local-6989586621679139148"><span class="hs-identifier hs-var">rule</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-332"></span><span>  </span><span class="annot"><span class="annottext">Maybe Token -&gt; TokenizerM (Maybe Token)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe Token
</span><a href="#local-6989586621679139079"><span class="hs-identifier hs-var">mbtok'</span></a></span><span>
</span><span id="line-333"></span><span>
</span><span id="line-334"></span><span class="annot"><a href="Skylighting.Tokenizer.html#withAttr"><span class="hs-identifier hs-type">withAttr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Skylighting.Types.html#TokenType"><span class="hs-identifier hs-type">TokenType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerM"><span class="hs-identifier hs-type">TokenizerM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerM"><span class="hs-identifier hs-type">TokenizerM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Skylighting.Types.html#Token"><span class="hs-identifier hs-type">Token</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-335"></span><span id="withAttr"><span class="annot"><span class="annottext">withAttr :: TokenType -&gt; TokenizerM Text -&gt; TokenizerM (Maybe Token)
</span><a href="Skylighting.Tokenizer.html#withAttr"><span class="hs-identifier hs-var hs-var">withAttr</span></a></span></span><span> </span><span id="local-6989586621679139066"><span class="annot"><span class="annottext">TokenType
</span><a href="#local-6989586621679139066"><span class="hs-identifier hs-var">tt</span></a></span></span><span> </span><span id="local-6989586621679139065"><span class="annot"><span class="annottext">TokenizerM Text
</span><a href="#local-6989586621679139065"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-336"></span><span>  </span><span id="local-6989586621679139064"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139064"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TokenizerM Text
</span><a href="#local-6989586621679139065"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-337"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Bool
</span><span class="hs-identifier hs-var">Text.null</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139064"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-338"></span><span>     </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe Token -&gt; TokenizerM (Maybe Token)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe Token
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-339"></span><span>     </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe Token -&gt; TokenizerM (Maybe Token)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Token -&gt; TokenizerM (Maybe Token))
-&gt; Maybe Token -&gt; TokenizerM (Maybe Token)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Token -&gt; Maybe Token
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenType
</span><a href="#local-6989586621679139066"><span class="hs-identifier hs-var">tt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139064"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-340"></span><span>
</span><span id="line-341"></span><span class="annot"><a href="Skylighting.Tokenizer.html#wordDetect"><span class="hs-identifier hs-type">wordDetect</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerM"><span class="hs-identifier hs-type">TokenizerM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-342"></span><span id="wordDetect"><span class="annot"><span class="annottext">wordDetect :: Bool -&gt; Text -&gt; ByteString -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#wordDetect"><span class="hs-identifier hs-var hs-var">wordDetect</span></a></span></span><span> </span><span id="local-6989586621679139063"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679139063"><span class="hs-identifier hs-var">caseSensitive</span></a></span></span><span> </span><span id="local-6989586621679139062"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139062"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679139061"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679139061"><span class="hs-identifier hs-var">inp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-343"></span><span>  </span><span class="annot"><span class="annottext">ByteString -&gt; TokenizerM ()
</span><a href="Skylighting.Tokenizer.html#wordBoundary"><span class="hs-identifier hs-var">wordBoundary</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679139061"><span class="hs-identifier hs-var">inp</span></a></span><span>
</span><span id="line-344"></span><span>  </span><span id="local-6989586621679139059"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139059"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#decodeBS"><span class="hs-identifier hs-var">decodeBS</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; TokenizerM Text) -&gt; ByteString -&gt; TokenizerM Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">UTF8.take</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Int
</span><span class="hs-identifier hs-var">Text.length</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139062"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679139061"><span class="hs-identifier hs-var">inp</span></a></span><span>
</span><span id="line-345"></span><span>  </span><span class="hs-comment">-- we assume here that the case fold will not change length,</span><span>
</span><span id="line-346"></span><span>  </span><span class="hs-comment">-- which is safe for ASCII keywords and the like...</span><span>
</span><span id="line-347"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; TokenizerM ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; TokenizerM ()) -&gt; Bool -&gt; TokenizerM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679139063"><span class="hs-identifier hs-var">caseSensitive</span></a></span><span>
</span><span id="line-348"></span><span>             </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139062"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139059"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-349"></span><span>             </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Text -&gt; CI Text
forall s. FoldCase s =&gt; s -&gt; CI s
</span><span class="hs-identifier hs-var">mk</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139062"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">CI Text -&gt; CI Text -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; CI Text
forall s. FoldCase s =&gt; s -&gt; CI s
</span><span class="hs-identifier hs-var">mk</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139059"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-350"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; TokenizerM ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; TokenizerM ()) -&gt; Bool -&gt; TokenizerM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Bool
</span><span class="hs-identifier hs-var">Text.null</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139059"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-351"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679139056"><span class="annot"><span class="annottext">c :: Char
</span><a href="#local-6989586621679139056"><span class="hs-identifier hs-var hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Char
</span><span class="hs-identifier hs-var">Text.last</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139059"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-352"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679139055"><span class="annot"><span class="annottext">rest :: ByteString
</span><a href="#local-6989586621679139055"><span class="hs-identifier hs-var hs-var">rest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">UTF8.drop</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Int
</span><span class="hs-identifier hs-var">Text.length</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139062"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679139061"><span class="hs-identifier hs-var">inp</span></a></span><span>
</span><span id="line-353"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679139053"><span class="annot"><span class="annottext">d :: Char
</span><a href="#local-6989586621679139053"><span class="hs-identifier hs-var hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe (Char, ByteString)
</span><span class="hs-identifier hs-var">UTF8.uncons</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679139055"><span class="hs-identifier hs-var">rest</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-354"></span><span>               </span><span class="annot"><span class="annottext">Maybe (Char, ByteString)
</span><span class="hs-identifier hs-var">Nothing</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\n'</span></span><span>
</span><span id="line-355"></span><span>               </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679139051"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679139051"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679139051"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-356"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; TokenizerM ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; TokenizerM ()) -&gt; Bool -&gt; TokenizerM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
</span><a href="Skylighting.Tokenizer.html#isWordBoundary"><span class="hs-identifier hs-var">isWordBoundary</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679139056"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679139053"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-357"></span><span>  </span><span class="annot"><span class="annottext">Int -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#takeChars"><span class="hs-identifier hs-var">takeChars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Int
</span><span class="hs-identifier hs-var">Text.length</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139059"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-358"></span><span>
</span><span id="line-359"></span><span class="annot"><a href="Skylighting.Tokenizer.html#stringDetect"><span class="hs-identifier hs-type">stringDetect</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerM"><span class="hs-identifier hs-type">TokenizerM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-360"></span><span id="stringDetect"><span class="annot"><span class="annottext">stringDetect :: Bool -&gt; Bool -&gt; Text -&gt; ByteString -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#stringDetect"><span class="hs-identifier hs-var hs-var">stringDetect</span></a></span></span><span> </span><span id="local-6989586621679139049"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679139049"><span class="hs-keyword hs-var">dynamic</span></a></span></span><span> </span><span id="local-6989586621679139048"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679139048"><span class="hs-identifier hs-var">caseSensitive</span></a></span></span><span> </span><span id="local-6989586621679139047"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139047"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679139046"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679139046"><span class="hs-identifier hs-var">inp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-361"></span><span>  </span><span id="local-6989586621679139045"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139045"><span class="hs-identifier hs-var">s'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679139049"><span class="hs-keyword hs-var">dynamic</span></a></span><span>
</span><span id="line-362"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-363"></span><span>          </span><span id="local-6989586621679139044"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139044"><span class="hs-identifier hs-var">dynStr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Text -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#subDynamicText"><span class="hs-identifier hs-var">subDynamicText</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139047"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-364"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; TokenizerM ()
</span><a href="Skylighting.Tokenizer.html#info"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; TokenizerM ()) -&gt; String -&gt; TokenizerM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Dynamic string: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139044"><span class="hs-identifier hs-var">dynStr</span></a></span><span>
</span><span id="line-365"></span><span>          </span><span class="annot"><span class="annottext">Text -&gt; TokenizerM Text
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139044"><span class="hs-identifier hs-var">dynStr</span></a></span><span>
</span><span id="line-366"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Text -&gt; TokenizerM Text
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139047"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-367"></span><span>  </span><span id="local-6989586621679139042"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139042"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#decodeBS"><span class="hs-identifier hs-var">decodeBS</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; TokenizerM Text) -&gt; ByteString -&gt; TokenizerM Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">UTF8.take</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Int
</span><span class="hs-identifier hs-var">Text.length</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139045"><span class="hs-identifier hs-var">s'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679139046"><span class="hs-identifier hs-var">inp</span></a></span><span>
</span><span id="line-368"></span><span>  </span><span class="hs-comment">-- we assume here that the case fold will not change length,</span><span>
</span><span id="line-369"></span><span>  </span><span class="hs-comment">-- which is safe for ASCII keywords and the like...</span><span>
</span><span id="line-370"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; TokenizerM ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; TokenizerM ()) -&gt; Bool -&gt; TokenizerM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679139048"><span class="hs-identifier hs-var">caseSensitive</span></a></span><span>
</span><span id="line-371"></span><span>             </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139045"><span class="hs-identifier hs-var">s'</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139042"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-372"></span><span>             </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Text -&gt; CI Text
forall s. FoldCase s =&gt; s -&gt; CI s
</span><span class="hs-identifier hs-var">mk</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139045"><span class="hs-identifier hs-var">s'</span></a></span><span> </span><span class="annot"><span class="annottext">CI Text -&gt; CI Text -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; CI Text
forall s. FoldCase s =&gt; s -&gt; CI s
</span><span class="hs-identifier hs-var">mk</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139042"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-373"></span><span>  </span><span class="annot"><span class="annottext">Int -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#takeChars"><span class="hs-identifier hs-var">takeChars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Int
</span><span class="hs-identifier hs-var">Text.length</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139045"><span class="hs-identifier hs-var">s'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-374"></span><span>
</span><span id="line-375"></span><span class="annot"><a href="Skylighting.Tokenizer.html#subDynamicText"><span class="hs-identifier hs-type">subDynamicText</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerM"><span class="hs-identifier hs-type">TokenizerM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-376"></span><span id="subDynamicText"><span class="annot"><span class="annottext">subDynamicText :: Text -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#subDynamicText"><span class="hs-identifier hs-var hs-var">subDynamicText</span></a></span></span><span> </span><span id="local-6989586621679139041"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139041"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-377"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679139040"><span class="annot"><span class="annottext">substitute :: Text -&gt; TokenizerM Text
</span><a href="#local-6989586621679139040"><span class="hs-identifier hs-var hs-var">substitute</span></a></span></span><span> </span><span id="local-6989586621679139039"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139039"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe (Char, Text)
</span><span class="hs-identifier hs-var">Text.uncons</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139039"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-378"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679139037"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679139037"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679139036"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139036"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><span class="hs-identifier hs-var">isDigit</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679139037"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679139035"><span class="annot"><span class="annottext">capNum :: Int
</span><a href="#local-6989586621679139035"><span class="hs-identifier hs-var hs-var">capNum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Int
</span><span class="hs-identifier hs-var">ord</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679139037"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Int
</span><span class="hs-identifier hs-var">ord</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'0'</span></span><span>
</span><span id="line-379"></span><span>                                      </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139036"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; TokenizerM Text -&gt; TokenizerM Text
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#getCapture"><span class="hs-identifier hs-var">getCapture</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679139035"><span class="hs-identifier hs-var">capNum</span></a></span><span>
</span><span id="line-380"></span><span>        </span><span class="annot"><span class="annottext">Maybe (Char, Text)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; TokenizerM Text
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; TokenizerM Text) -&gt; Text -&gt; TokenizerM Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.cons</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'%'</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139039"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-381"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; Text -&gt; [Text]
</span><span class="hs-identifier hs-var">Text.split</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'%'</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139041"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-382"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; TokenizerM Text
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier hs-var">Text.empty</span></span><span>
</span><span id="line-383"></span><span>    </span><span id="local-6989586621679139030"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139030"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679139029"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679139029"><span class="hs-identifier hs-var">rest</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139030"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; ([Text] -&gt; Text) -&gt; [Text] -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><span class="hs-identifier hs-var">Text.concat</span></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; Text) -&gt; TokenizerM [Text] -&gt; TokenizerM Text
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; TokenizerM Text) -&gt; [Text] -&gt; TokenizerM [Text]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; TokenizerM Text
</span><a href="#local-6989586621679139040"><span class="hs-identifier hs-var">substitute</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679139029"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-384"></span><span>
</span><span id="line-385"></span><span class="hs-comment">-- This assumes that nothing significant will happen</span><span>
</span><span id="line-386"></span><span class="hs-comment">-- in the middle of a string of spaces or a string</span><span>
</span><span id="line-387"></span><span class="hs-comment">-- of alphanumerics.  This seems true  for all normal</span><span>
</span><span id="line-388"></span><span class="hs-comment">-- programming languages, and the optimization speeds</span><span>
</span><span id="line-389"></span><span class="hs-comment">-- things up a lot, relative to just parsing one char.</span><span>
</span><span id="line-390"></span><span class="annot"><a href="Skylighting.Tokenizer.html#normalChunk"><span class="hs-identifier hs-type">normalChunk</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerM"><span class="hs-identifier hs-type">TokenizerM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-391"></span><span id="normalChunk"><span class="annot"><span class="annottext">normalChunk :: TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#normalChunk"><span class="hs-identifier hs-var hs-var">normalChunk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-392"></span><span>  </span><span id="local-6989586621679139027"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679139027"><span class="hs-identifier hs-var">inp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TokenizerState -&gt; ByteString) -&gt; TokenizerM ByteString
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">TokenizerState -&gt; ByteString
</span><a href="Skylighting.Tokenizer.html#input"><span class="hs-identifier hs-var hs-var">input</span></a></span><span>
</span><span id="line-393"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe (Char, ByteString)
</span><span class="hs-identifier hs-var">UTF8.uncons</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679139027"><span class="hs-identifier hs-var">inp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-394"></span><span>    </span><span class="annot"><span class="annottext">Maybe (Char, ByteString)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TokenizerM Text
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><span class="hs-identifier hs-var">mzero</span></span><span>
</span><span id="line-395"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679139026"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679139026"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-396"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679139026"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">' '</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-397"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679139025"><span class="annot"><span class="annottext">bs :: ByteString
</span><a href="#local-6989586621679139025"><span class="hs-identifier hs-var hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">BS.takeWhile</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">' '</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679139027"><span class="hs-identifier hs-var">inp</span></a></span><span>
</span><span id="line-398"></span><span>        </span><span class="hs-keyword">in</span><span>  </span><span class="annot"><span class="annottext">Int -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#takeChars"><span class="hs-identifier hs-var">takeChars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Int
</span><span class="hs-identifier hs-var">BS.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679139025"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-399"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><span class="hs-identifier hs-var">isAscii</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679139026"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><span class="hs-identifier hs-var">isAlphaNum</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679139026"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-400"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679139021"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679139021"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; ByteString -&gt; (ByteString, ByteString)
</span><span class="hs-identifier hs-var">UTF8.span</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><span class="hs-identifier hs-var">isAlphaNum</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679139027"><span class="hs-identifier hs-var">inp</span></a></span><span>
</span><span id="line-401"></span><span>        </span><span class="hs-keyword">in</span><span>  </span><span class="annot"><span class="annottext">Int -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#takeChars"><span class="hs-identifier hs-var">takeChars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Int
</span><span class="hs-identifier hs-var">UTF8.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679139021"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-402"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#takeChars"><span class="hs-identifier hs-var">takeChars</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-403"></span><span>
</span><span id="line-404"></span><span class="annot"><a href="Skylighting.Tokenizer.html#includeRules"><span class="hs-identifier hs-type">includeRules</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Skylighting.Types.html#TokenType"><span class="hs-identifier hs-type">TokenType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Skylighting.Types.html#ContextName"><span class="hs-identifier hs-type">ContextName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span>
</span><span id="line-405"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerM"><span class="hs-identifier hs-type">TokenizerM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Skylighting.Types.html#Token"><span class="hs-identifier hs-type">Token</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-406"></span><span id="includeRules"><span class="annot"><span class="annottext">includeRules :: Maybe TokenType
-&gt; (Text, Text) -&gt; ByteString -&gt; TokenizerM (Maybe Token)
</span><a href="Skylighting.Tokenizer.html#includeRules"><span class="hs-identifier hs-var hs-var">includeRules</span></a></span></span><span> </span><span id="local-6989586621679139017"><span class="annot"><span class="annottext">Maybe TokenType
</span><a href="#local-6989586621679139017"><span class="hs-identifier hs-var">mbattr</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679139016"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139016"><span class="hs-identifier hs-var">syn</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679139015"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139015"><span class="hs-identifier hs-var">con</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679139014"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679139014"><span class="hs-identifier hs-var">inp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-407"></span><span>  </span><span id="local-6989586621679139013"><span class="annot"><span class="annottext">SyntaxMap
</span><a href="#local-6989586621679139013"><span class="hs-identifier hs-var">syntaxes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TokenizerConfig -&gt; SyntaxMap) -&gt; TokenizerM SyntaxMap
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">TokenizerConfig -&gt; SyntaxMap
</span><a href="Skylighting.Tokenizer.html#syntaxMap"><span class="hs-identifier hs-var hs-var">syntaxMap</span></a></span><span>
</span><span id="line-408"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Text -&gt; SyntaxMap -&gt; Maybe Syntax
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139016"><span class="hs-identifier hs-var">syn</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxMap
</span><a href="#local-6989586621679139013"><span class="hs-identifier hs-var">syntaxes</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Syntax -&gt; (Syntax -&gt; Maybe Context) -&gt; Maybe Context
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Syntax -&gt; Maybe Context
</span><a href="Skylighting.Tokenizer.html#lookupContext"><span class="hs-identifier hs-var">lookupContext</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139015"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-409"></span><span>       </span><span class="annot"><span class="annottext">Maybe Context
</span><span class="hs-identifier hs-var">Nothing</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-410"></span><span>          </span><span id="local-6989586621679139012"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679139012"><span class="hs-identifier hs-var">cur</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TokenizerM Context
</span><a href="Skylighting.Tokenizer.html#currentContext"><span class="hs-identifier hs-var">currentContext</span></a></span><span>
</span><span id="line-411"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; TokenizerM (Maybe Token)
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; TokenizerM (Maybe Token))
-&gt; String -&gt; TokenizerM (Maybe Token)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;IncludeRules in &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">Text.unpack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; Text
</span><a href="Skylighting.Types.html#cSyntax"><span class="hs-identifier hs-var hs-var">cSyntax</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679139012"><span class="hs-identifier hs-var">cur</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-412"></span><span>           </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; requires undefined context &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-413"></span><span>           </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">Text.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139015"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;##&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">Text.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139016"><span class="hs-identifier hs-var">syn</span></a></span><span>
</span><span id="line-414"></span><span>       </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679139009"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679139009"><span class="hs-identifier hs-var">c</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-415"></span><span>         </span><span id="local-6989586621679139008"><span class="annot"><span class="annottext">Maybe Token
</span><a href="#local-6989586621679139008"><span class="hs-identifier hs-var">mbtok</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TokenizerM (Maybe Token)] -&gt; TokenizerM (Maybe Token)
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Foldable t, MonadPlus m) =&gt;
t (m a) -&gt; m a
</span><span class="hs-identifier hs-var">msum</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Rule -&gt; TokenizerM (Maybe Token))
-&gt; [Rule] -&gt; [TokenizerM (Maybe Token)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679139007"><span class="annot"><span class="annottext">Rule
</span><a href="#local-6989586621679139007"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Rule -&gt; ByteString -&gt; TokenizerM (Maybe Token)
</span><a href="Skylighting.Tokenizer.html#tryRule"><span class="hs-identifier hs-var">tryRule</span></a></span><span> </span><span class="annot"><span class="annottext">Rule
</span><a href="#local-6989586621679139007"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679139014"><span class="hs-identifier hs-var">inp</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; [Rule]
</span><a href="Skylighting.Types.html#cRules"><span class="hs-identifier hs-var hs-var">cRules</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679139009"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-416"></span><span>         </span><span class="annot"><span class="annottext">Maybe Token -&gt; TokenizerM (Maybe Token)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Token -&gt; TokenizerM (Maybe Token))
-&gt; Maybe Token -&gt; TokenizerM (Maybe Token)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Token
</span><a href="#local-6989586621679139008"><span class="hs-identifier hs-var">mbtok</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe TokenType
</span><a href="#local-6989586621679139017"><span class="hs-identifier hs-var">mbattr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-417"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenType
</span><a href="Skylighting.Types.html#NormalTok"><span class="hs-identifier hs-var">NormalTok</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679139005"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139005"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679139004"><span class="annot"><span class="annottext">TokenType
</span><a href="#local-6989586621679139004"><span class="hs-identifier hs-var">attr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Token -&gt; Maybe Token
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenType
</span><a href="#local-6989586621679139004"><span class="hs-identifier hs-var">attr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679139005"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-418"></span><span>                    </span><span class="annot"><span class="annottext">(Maybe Token, Maybe TokenType)
</span><span class="hs-identifier">_</span></span><span>                                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Token
</span><a href="#local-6989586621679139008"><span class="hs-identifier hs-var">mbtok</span></a></span><span>
</span><span id="line-419"></span><span>
</span><span id="line-420"></span><span class="annot"><a href="Skylighting.Tokenizer.html#checkLineEnd"><span class="hs-identifier hs-type">checkLineEnd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Skylighting.Types.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerM"><span class="hs-identifier hs-type">TokenizerM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-421"></span><span id="checkLineEnd"><span class="annot"><span class="annottext">checkLineEnd :: Context -&gt; TokenizerM ()
</span><a href="Skylighting.Tokenizer.html#checkLineEnd"><span class="hs-identifier hs-var hs-var">checkLineEnd</span></a></span></span><span> </span><span id="local-6989586621679139003"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679139003"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-422"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; TokenizerM () -&gt; TokenizerM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ContextSwitch] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; [ContextSwitch]
</span><a href="Skylighting.Types.html#cLineEndContext"><span class="hs-identifier hs-var hs-var">cLineEndContext</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679139003"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TokenizerM () -&gt; TokenizerM ()) -&gt; TokenizerM () -&gt; TokenizerM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-423"></span><span>    </span><span id="local-6989586621679138999"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679138999"><span class="hs-identifier hs-var">eol</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TokenizerState -&gt; Bool) -&gt; TokenizerM Bool
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">TokenizerState -&gt; Bool
</span><a href="Skylighting.Tokenizer.html#endline"><span class="hs-identifier hs-var hs-var">endline</span></a></span><span>
</span><span id="line-424"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; TokenizerM ()
</span><a href="Skylighting.Tokenizer.html#info"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; TokenizerM ()) -&gt; String -&gt; TokenizerM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;checkLineEnd for &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; Text
</span><a href="Skylighting.Types.html#cName"><span class="hs-identifier hs-var hs-var">cName</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679139003"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; eol = &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679138999"><span class="hs-identifier hs-var">eol</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; cLineEndContext = &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[ContextSwitch] -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; [ContextSwitch]
</span><a href="Skylighting.Types.html#cLineEndContext"><span class="hs-identifier hs-var hs-var">cLineEndContext</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679139003"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-425"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; TokenizerM () -&gt; TokenizerM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679138999"><span class="hs-identifier hs-var">eol</span></a></span><span> </span><span class="annot"><span class="annottext">(TokenizerM () -&gt; TokenizerM ()) -&gt; TokenizerM () -&gt; TokenizerM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-426"></span><span>      </span><span id="local-6989586621679138998"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679138998"><span class="hs-identifier hs-var">lineCont'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TokenizerState -&gt; Bool) -&gt; TokenizerM Bool
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">TokenizerState -&gt; Bool
</span><a href="Skylighting.Tokenizer.html#lineContinuation"><span class="hs-identifier hs-var hs-var">lineContinuation</span></a></span><span>
</span><span id="line-427"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; TokenizerM () -&gt; TokenizerM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679138998"><span class="hs-identifier hs-var">lineCont'</span></a></span><span> </span><span class="annot"><span class="annottext">(TokenizerM () -&gt; TokenizerM ()) -&gt; TokenizerM () -&gt; TokenizerM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-428"></span><span>        </span><span class="annot"><span class="annottext">[ContextSwitch] -&gt; TokenizerM ()
</span><a href="Skylighting.Tokenizer.html#doContextSwitches"><span class="hs-identifier hs-var">doContextSwitches</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; [ContextSwitch]
</span><a href="Skylighting.Types.html#cLineEndContext"><span class="hs-identifier hs-var hs-var">cLineEndContext</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679139003"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-429"></span><span>        </span><span id="local-6989586621679138997"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679138997"><span class="hs-identifier hs-var">c'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TokenizerM Context
</span><a href="Skylighting.Tokenizer.html#currentContext"><span class="hs-identifier hs-var">currentContext</span></a></span><span>
</span><span id="line-430"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; TokenizerM () -&gt; TokenizerM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679139003"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Context -&gt; Context -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679138997"><span class="hs-identifier hs-var">c'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TokenizerM () -&gt; TokenizerM ()) -&gt; TokenizerM () -&gt; TokenizerM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Context -&gt; TokenizerM ()
</span><a href="Skylighting.Tokenizer.html#checkLineEnd"><span class="hs-identifier hs-var">checkLineEnd</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679138997"><span class="hs-identifier hs-var">c'</span></a></span><span>
</span><span id="line-431"></span><span>
</span><span id="line-432"></span><span class="annot"><a href="Skylighting.Tokenizer.html#detectChar"><span class="hs-identifier hs-type">detectChar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerM"><span class="hs-identifier hs-type">TokenizerM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-433"></span><span id="detectChar"><span class="annot"><span class="annottext">detectChar :: Bool -&gt; Char -&gt; ByteString -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#detectChar"><span class="hs-identifier hs-var hs-var">detectChar</span></a></span></span><span> </span><span id="local-6989586621679138996"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679138996"><span class="hs-keyword hs-var">dynamic</span></a></span></span><span> </span><span id="local-6989586621679138995"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138995"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679138994"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138994"><span class="hs-identifier hs-var">inp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-434"></span><span>  </span><span id="local-6989586621679138993"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138993"><span class="hs-identifier hs-var">c'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679138996"><span class="hs-keyword hs-var">dynamic</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138995"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'0'</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138995"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'9'</span></span><span>
</span><span id="line-435"></span><span>           </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Char -&gt; TokenizerM Char
</span><a href="Skylighting.Tokenizer.html#getDynamicChar"><span class="hs-identifier hs-var">getDynamicChar</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138995"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-436"></span><span>           </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Char -&gt; TokenizerM Char
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138995"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-437"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe (Char, ByteString)
</span><span class="hs-identifier hs-var">UTF8.uncons</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138994"><span class="hs-identifier hs-var">inp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-438"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679138990"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138990"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138990"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138993"><span class="hs-identifier hs-var">c'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#takeChars"><span class="hs-identifier hs-var">takeChars</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-439"></span><span>    </span><span class="annot"><span class="annottext">Maybe (Char, ByteString)
</span><span class="hs-identifier">_</span></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TokenizerM Text
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><span class="hs-identifier hs-var">mzero</span></span><span>
</span><span id="line-440"></span><span>
</span><span id="line-441"></span><span class="annot"><a href="Skylighting.Tokenizer.html#getDynamicChar"><span class="hs-identifier hs-type">getDynamicChar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerM"><span class="hs-identifier hs-type">TokenizerM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span>
</span><span id="line-442"></span><span id="getDynamicChar"><span class="annot"><span class="annottext">getDynamicChar :: Char -&gt; TokenizerM Char
</span><a href="Skylighting.Tokenizer.html#getDynamicChar"><span class="hs-identifier hs-var hs-var">getDynamicChar</span></a></span></span><span> </span><span id="local-6989586621679138989"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138989"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-443"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679138988"><span class="annot"><span class="annottext">capNum :: Int
</span><a href="#local-6989586621679138988"><span class="hs-identifier hs-var hs-var">capNum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Int
</span><span class="hs-identifier hs-var">ord</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138989"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Int
</span><span class="hs-identifier hs-var">ord</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'0'</span></span><span>
</span><span id="line-444"></span><span>  </span><span id="local-6989586621679138987"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679138987"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#getCapture"><span class="hs-identifier hs-var">getCapture</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679138988"><span class="hs-identifier hs-var">capNum</span></a></span><span>
</span><span id="line-445"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe (Char, Text)
</span><span class="hs-identifier hs-var">Text.uncons</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679138987"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-446"></span><span>       </span><span class="annot"><span class="annottext">Maybe (Char, Text)
</span><span class="hs-identifier hs-var">Nothing</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TokenizerM Char
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><span class="hs-identifier hs-var">mzero</span></span><span>
</span><span id="line-447"></span><span>       </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679138986"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138986"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Char -&gt; TokenizerM Char
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138986"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-448"></span><span>
</span><span id="line-449"></span><span class="annot"><a href="Skylighting.Tokenizer.html#detect2Chars"><span class="hs-identifier hs-type">detect2Chars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerM"><span class="hs-identifier hs-type">TokenizerM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-450"></span><span id="detect2Chars"><span class="annot"><span class="annottext">detect2Chars :: Bool -&gt; Char -&gt; Char -&gt; ByteString -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#detect2Chars"><span class="hs-identifier hs-var hs-var">detect2Chars</span></a></span></span><span> </span><span id="local-6989586621679138985"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679138985"><span class="hs-keyword hs-var">dynamic</span></a></span></span><span> </span><span id="local-6989586621679138984"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138984"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679138983"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138983"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621679138982"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138982"><span class="hs-identifier hs-var">inp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-451"></span><span>  </span><span id="local-6989586621679138981"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138981"><span class="hs-identifier hs-var">c'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679138985"><span class="hs-keyword hs-var">dynamic</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138984"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'0'</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138984"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'9'</span></span><span>
</span><span id="line-452"></span><span>           </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Char -&gt; TokenizerM Char
</span><a href="Skylighting.Tokenizer.html#getDynamicChar"><span class="hs-identifier hs-var">getDynamicChar</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138984"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-453"></span><span>           </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Char -&gt; TokenizerM Char
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138984"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-454"></span><span>  </span><span id="local-6989586621679138980"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138980"><span class="hs-identifier hs-var">d'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679138985"><span class="hs-keyword hs-var">dynamic</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138983"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'0'</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138983"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'9'</span></span><span>
</span><span id="line-455"></span><span>           </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Char -&gt; TokenizerM Char
</span><a href="Skylighting.Tokenizer.html#getDynamicChar"><span class="hs-identifier hs-var">getDynamicChar</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138983"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-456"></span><span>           </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Char -&gt; TokenizerM Char
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138983"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-457"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; ByteString
</span><span class="hs-identifier hs-var">encodeUtf8</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">Text.pack</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138981"><span class="hs-identifier hs-var">c'</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138980"><span class="hs-identifier hs-var">d'</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; Bool
</span><span class="hs-operator hs-var">`BS.isPrefixOf`</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138982"><span class="hs-identifier hs-var">inp</span></a></span><span>
</span><span id="line-458"></span><span>     </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#takeChars"><span class="hs-identifier hs-var">takeChars</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span>
</span><span id="line-459"></span><span>     </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">TokenizerM Text
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><span class="hs-identifier hs-var">mzero</span></span><span>
</span><span id="line-460"></span><span>
</span><span id="line-461"></span><span class="annot"><a href="Skylighting.Tokenizer.html#rangeDetect"><span class="hs-identifier hs-type">rangeDetect</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerM"><span class="hs-identifier hs-type">TokenizerM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-462"></span><span id="rangeDetect"><span class="annot"><span class="annottext">rangeDetect :: Char -&gt; Char -&gt; ByteString -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#rangeDetect"><span class="hs-identifier hs-var hs-var">rangeDetect</span></a></span></span><span> </span><span id="local-6989586621679138977"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138977"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679138976"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138976"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621679138975"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138975"><span class="hs-identifier hs-var">inp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-463"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe (Char, ByteString)
</span><span class="hs-identifier hs-var">UTF8.uncons</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138975"><span class="hs-identifier hs-var">inp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-464"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679138974"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138974"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679138973"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138973"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-465"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138974"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138977"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; ByteString -&gt; (ByteString, ByteString)
</span><span class="hs-identifier hs-var">UTF8.span</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138976"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138973"><span class="hs-identifier hs-var">rest</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-466"></span><span>                       </span><span class="hs-special">(</span><span id="local-6989586621679138972"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138972"><span class="hs-identifier hs-var">in_t</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679138971"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138971"><span class="hs-identifier hs-var">out_t</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-467"></span><span>                         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Bool
</span><span class="hs-identifier hs-var">BS.null</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138971"><span class="hs-identifier hs-var">out_t</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TokenizerM Text
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><span class="hs-identifier hs-var">mzero</span></span><span>
</span><span id="line-468"></span><span>                         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-469"></span><span>                              </span><span id="local-6989586621679138970"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679138970"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#decodeBS"><span class="hs-identifier hs-var">decodeBS</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138972"><span class="hs-identifier hs-var">in_t</span></a></span><span>
</span><span id="line-470"></span><span>                              </span><span class="annot"><span class="annottext">Int -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#takeChars"><span class="hs-identifier hs-var">takeChars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Int
</span><span class="hs-identifier hs-var">Text.length</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679138970"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-471"></span><span>    </span><span class="annot"><span class="annottext">Maybe (Char, ByteString)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TokenizerM Text
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><span class="hs-identifier hs-var">mzero</span></span><span>
</span><span id="line-472"></span><span>
</span><span id="line-473"></span><span class="hs-comment">-- NOTE: currently limited to ASCII</span><span>
</span><span id="line-474"></span><span class="annot"><a href="Skylighting.Tokenizer.html#detectSpaces"><span class="hs-identifier hs-type">detectSpaces</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerM"><span class="hs-identifier hs-type">TokenizerM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-475"></span><span id="detectSpaces"><span class="annot"><span class="annottext">detectSpaces :: ByteString -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#detectSpaces"><span class="hs-identifier hs-var hs-var">detectSpaces</span></a></span></span><span> </span><span id="local-6989586621679138969"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138969"><span class="hs-identifier hs-var">inp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-476"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; ByteString -&gt; (ByteString, ByteString)
</span><span class="hs-identifier hs-var">BS.span</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679138967"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138967"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><span class="hs-identifier hs-var">isSpace</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138967"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138969"><span class="hs-identifier hs-var">inp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-477"></span><span>       </span><span class="hs-special">(</span><span id="local-6989586621679138966"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138966"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-478"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Bool
</span><span class="hs-identifier hs-var">BS.null</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138966"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TokenizerM Text
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><span class="hs-identifier hs-var">mzero</span></span><span>
</span><span id="line-479"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#takeChars"><span class="hs-identifier hs-var">takeChars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Int
</span><span class="hs-identifier hs-var">BS.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138966"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-480"></span><span>
</span><span id="line-481"></span><span class="hs-comment">-- NOTE: limited to ASCII as per kate documentation</span><span>
</span><span id="line-482"></span><span class="annot"><a href="Skylighting.Tokenizer.html#detectIdentifier"><span class="hs-identifier hs-type">detectIdentifier</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerM"><span class="hs-identifier hs-type">TokenizerM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-483"></span><span id="detectIdentifier"><span class="annot"><span class="annottext">detectIdentifier :: ByteString -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#detectIdentifier"><span class="hs-identifier hs-var hs-var">detectIdentifier</span></a></span></span><span> </span><span id="local-6989586621679138965"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138965"><span class="hs-identifier hs-var">inp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-484"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe (Char, ByteString)
</span><span class="hs-identifier hs-var">BS.uncons</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138965"><span class="hs-identifier hs-var">inp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-485"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679138963"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138963"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679138962"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138962"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><span class="hs-identifier hs-var">isAscii</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138963"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><span class="hs-identifier hs-var">isLetter</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138963"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138963"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'_'</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-486"></span><span>      </span><span class="annot"><span class="annottext">Int -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#takeChars"><span class="hs-identifier hs-var">takeChars</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; TokenizerM Text) -&gt; Int -&gt; TokenizerM Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; (Int -&gt; Int) -&gt; Maybe Int -&gt; Int
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Int
</span><span class="hs-identifier hs-var">BS.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138962"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-487"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; ByteString -&gt; Maybe Int
</span><span class="hs-identifier hs-var">BS.findIndex</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679138958"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138958"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><span class="hs-identifier hs-var">isAscii</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138958"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span>
</span><span id="line-488"></span><span>                                     </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><span class="hs-identifier hs-var">isAlphaNum</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138958"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138958"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'_'</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138962"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-489"></span><span>    </span><span class="annot"><span class="annottext">Maybe (Char, ByteString)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TokenizerM Text
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><span class="hs-identifier hs-var">mzero</span></span><span>
</span><span id="line-490"></span><span>
</span><span id="line-491"></span><span class="annot"><a href="Skylighting.Tokenizer.html#lineContinue"><span class="hs-identifier hs-type">lineContinue</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerM"><span class="hs-identifier hs-type">TokenizerM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-492"></span><span id="lineContinue"><span class="annot"><span class="annottext">lineContinue :: ByteString -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#lineContinue"><span class="hs-identifier hs-var hs-var">lineContinue</span></a></span></span><span> </span><span id="local-6989586621679138957"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138957"><span class="hs-identifier hs-var">inp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-493"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138957"><span class="hs-identifier hs-var">inp</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;\\&quot;</span></span><span>
</span><span id="line-494"></span><span>     </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-495"></span><span>       </span><span class="annot"><span class="annottext">(TokenizerState -&gt; TokenizerState) -&gt; TokenizerM ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((TokenizerState -&gt; TokenizerState) -&gt; TokenizerM ())
-&gt; (TokenizerState -&gt; TokenizerState) -&gt; TokenizerM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679138956"><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679138956"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679138956"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">lineContinuation :: Bool
</span><a href="Skylighting.Tokenizer.html#lineContinuation"><span class="hs-identifier hs-var">lineContinuation</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-496"></span><span>       </span><span class="annot"><span class="annottext">Int -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#takeChars"><span class="hs-identifier hs-var">takeChars</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-497"></span><span>     </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">TokenizerM Text
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><span class="hs-identifier hs-var">mzero</span></span><span>
</span><span id="line-498"></span><span>
</span><span id="line-499"></span><span class="annot"><a href="Skylighting.Tokenizer.html#anyChar"><span class="hs-identifier hs-type">anyChar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set.Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerM"><span class="hs-identifier hs-type">TokenizerM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-500"></span><span id="anyChar"><span class="annot"><span class="annottext">anyChar :: Set Char -&gt; ByteString -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#anyChar"><span class="hs-identifier hs-var hs-var">anyChar</span></a></span></span><span> </span><span id="local-6989586621679138955"><span class="annot"><span class="annottext">Set Char
</span><a href="#local-6989586621679138955"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span id="local-6989586621679138954"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138954"><span class="hs-identifier hs-var">inp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-501"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe (Char, ByteString)
</span><span class="hs-identifier hs-var">UTF8.uncons</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138954"><span class="hs-identifier hs-var">inp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-502"></span><span>     </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679138953"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138953"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138953"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Set Char -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`Set.member`</span></span><span> </span><span class="annot"><span class="annottext">Set Char
</span><a href="#local-6989586621679138955"><span class="hs-identifier hs-var">cs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#takeChars"><span class="hs-identifier hs-var">takeChars</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-503"></span><span>     </span><span class="annot"><span class="annottext">Maybe (Char, ByteString)
</span><span class="hs-identifier">_</span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TokenizerM Text
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><span class="hs-identifier hs-var">mzero</span></span><span>
</span><span id="line-504"></span><span>
</span><span id="line-505"></span><span class="annot"><a href="Skylighting.Tokenizer.html#regExpr"><span class="hs-identifier hs-type">regExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Skylighting.Regex.html#RE"><span class="hs-identifier hs-type">RE</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerM"><span class="hs-identifier hs-type">TokenizerM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-506"></span><span id="regExpr"><span class="annot"><span class="annottext">regExpr :: Bool -&gt; RE -&gt; ByteString -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#regExpr"><span class="hs-identifier hs-var hs-var">regExpr</span></a></span></span><span> </span><span id="local-6989586621679138951"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679138951"><span class="hs-keyword hs-var">dynamic</span></a></span></span><span> </span><span id="local-6989586621679138950"><span class="annot"><span class="annottext">RE
</span><a href="#local-6989586621679138950"><span class="hs-identifier hs-var">re</span></a></span></span><span> </span><span id="local-6989586621679138949"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138949"><span class="hs-identifier hs-var">inp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-507"></span><span>  </span><span class="hs-comment">-- return $! traceShowId $! (reStr, inp)</span><span>
</span><span id="line-508"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679138948"><span class="annot"><span class="annottext">reStr :: ByteString
</span><a href="#local-6989586621679138948"><span class="hs-identifier hs-var hs-var">reStr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RE -&gt; ByteString
</span><a href="Skylighting.Regex.html#reString"><span class="hs-identifier hs-var hs-var">reString</span></a></span><span> </span><span class="annot"><span class="annottext">RE
</span><a href="#local-6989586621679138950"><span class="hs-identifier hs-var">re</span></a></span><span>
</span><span id="line-509"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; TokenizerM () -&gt; TokenizerM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">BS.take</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138948"><span class="hs-identifier hs-var">reStr</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;\\b&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TokenizerM () -&gt; TokenizerM ()) -&gt; TokenizerM () -&gt; TokenizerM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; TokenizerM ()
</span><a href="Skylighting.Tokenizer.html#wordBoundary"><span class="hs-identifier hs-var">wordBoundary</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138949"><span class="hs-identifier hs-var">inp</span></a></span><span>
</span><span id="line-510"></span><span>  </span><span id="local-6989586621679138945"><span class="annot"><span class="annottext">Map RE Regex
</span><a href="#local-6989586621679138945"><span class="hs-identifier hs-var">compiledREs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TokenizerState -&gt; Map RE Regex) -&gt; TokenizerM (Map RE Regex)
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">TokenizerState -&gt; Map RE Regex
</span><a href="Skylighting.Tokenizer.html#compiledRegexes"><span class="hs-identifier hs-var hs-var">compiledRegexes</span></a></span><span>
</span><span id="line-511"></span><span>  </span><span id="local-6989586621679138944"><span class="annot"><span class="annottext">Regex
</span><a href="#local-6989586621679138944"><span class="hs-identifier hs-var">regex</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">RE -&gt; Map RE Regex -&gt; Maybe Regex
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">RE
</span><a href="#local-6989586621679138950"><span class="hs-identifier hs-var">re</span></a></span><span> </span><span class="annot"><span class="annottext">Map RE Regex
</span><a href="#local-6989586621679138945"><span class="hs-identifier hs-var">compiledREs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-512"></span><span>              </span><span class="annot"><span class="annottext">Maybe Regex
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-513"></span><span>                </span><span id="local-6989586621679138943"><span class="annot"><span class="annottext">Regex
</span><a href="#local-6989586621679138943"><span class="hs-identifier hs-var">cre</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ByteString -&gt; Either String Regex
</span><a href="Regex.KDE.Compile.html#compileRegex"><span class="hs-identifier hs-var">compileRegex</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RE -&gt; Bool
</span><a href="Skylighting.Regex.html#reCaseSensitive"><span class="hs-identifier hs-var hs-var">reCaseSensitive</span></a></span><span> </span><span class="annot"><span class="annottext">RE
</span><a href="#local-6989586621679138950"><span class="hs-identifier hs-var">re</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138948"><span class="hs-identifier hs-var">reStr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-514"></span><span>                         </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679138940"><span class="annot"><span class="annottext">Regex
</span><a href="#local-6989586621679138940"><span class="hs-identifier hs-var">r</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Regex -&gt; TokenizerM Regex
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Regex
</span><a href="#local-6989586621679138940"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-515"></span><span>                         </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679138939"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679138939"><span class="hs-identifier hs-var">e</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; TokenizerM Regex
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; TokenizerM Regex) -&gt; String -&gt; TokenizerM Regex
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-516"></span><span>                           </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Error compiling regex &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-517"></span><span>                            </span><span class="annot"><span class="annottext">ByteString -&gt; String
</span><span class="hs-identifier hs-var">UTF8.toString</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138948"><span class="hs-identifier hs-var">reStr</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679138939"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-518"></span><span>                </span><span class="annot"><span class="annottext">(TokenizerState -&gt; TokenizerState) -&gt; TokenizerM ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((TokenizerState -&gt; TokenizerState) -&gt; TokenizerM ())
-&gt; (TokenizerState -&gt; TokenizerState) -&gt; TokenizerM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679138937"><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679138937"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679138937"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">compiledRegexes :: Map RE Regex
</span><a href="Skylighting.Tokenizer.html#compiledRegexes"><span class="hs-identifier hs-var">compiledRegexes</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-519"></span><span>                      </span><span class="annot"><span class="annottext">RE -&gt; Regex -&gt; Map RE Regex -&gt; Map RE Regex
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insert</span></span><span> </span><span class="annot"><span class="annottext">RE
</span><a href="#local-6989586621679138950"><span class="hs-identifier hs-var">re</span></a></span><span> </span><span class="annot"><span class="annottext">Regex
</span><a href="#local-6989586621679138943"><span class="hs-identifier hs-var">cre</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenizerState -&gt; Map RE Regex
</span><a href="Skylighting.Tokenizer.html#compiledRegexes"><span class="hs-identifier hs-var hs-var">compiledRegexes</span></a></span><span> </span><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679138937"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-520"></span><span>                </span><span class="annot"><span class="annottext">Regex -&gt; TokenizerM Regex
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Regex
</span><a href="#local-6989586621679138943"><span class="hs-identifier hs-var">cre</span></a></span><span>
</span><span id="line-521"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679138935"><span class="annot"><span class="annottext">Regex
</span><a href="#local-6989586621679138935"><span class="hs-identifier hs-var">cre</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Regex -&gt; TokenizerM Regex
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Regex
</span><a href="#local-6989586621679138935"><span class="hs-identifier hs-var">cre</span></a></span><span>
</span><span id="line-522"></span><span>  </span><span id="local-6989586621679138934"><span class="annot"><span class="annottext">Regex
</span><a href="#local-6989586621679138934"><span class="hs-identifier hs-var">regex'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679138951"><span class="hs-keyword hs-var">dynamic</span></a></span><span>
</span><span id="line-523"></span><span>               </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Regex -&gt; TokenizerM Regex
</span><a href="Skylighting.Tokenizer.html#subDynamic"><span class="hs-identifier hs-var">subDynamic</span></a></span><span> </span><span class="annot"><span class="annottext">Regex
</span><a href="#local-6989586621679138944"><span class="hs-identifier hs-var">regex</span></a></span><span>
</span><span id="line-524"></span><span>               </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Regex -&gt; TokenizerM Regex
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Regex
</span><a href="#local-6989586621679138944"><span class="hs-identifier hs-var">regex</span></a></span><span>
</span><span id="line-525"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Regex -&gt; ByteString -&gt; Maybe (ByteString, IntMap (Int, Int))
</span><a href="Regex.KDE.Match.html#matchRegex"><span class="hs-identifier hs-var">matchRegex</span></a></span><span> </span><span class="annot"><span class="annottext">Regex
</span><a href="#local-6989586621679138934"><span class="hs-identifier hs-var">regex'</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138949"><span class="hs-identifier hs-var">inp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-526"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679138931"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138931"><span class="hs-identifier hs-var">matchedBytes</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679138930"><span class="annot"><span class="annottext">IntMap (Int, Int)
</span><a href="#local-6989586621679138930"><span class="hs-identifier hs-var">capts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-527"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; TokenizerM () -&gt; TokenizerM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IntMap (Int, Int) -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">IntMap (Int, Int)
</span><a href="#local-6989586621679138930"><span class="hs-identifier hs-var">capts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TokenizerM () -&gt; TokenizerM ()) -&gt; TokenizerM () -&gt; TokenizerM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-528"></span><span>             </span><span class="annot"><span class="annottext">(TokenizerState -&gt; TokenizerState) -&gt; TokenizerM ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((TokenizerState -&gt; TokenizerState) -&gt; TokenizerM ())
-&gt; (TokenizerState -&gt; TokenizerState) -&gt; TokenizerM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679138929"><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679138929"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TokenizerState
</span><a href="#local-6989586621679138929"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">captures :: IntMap ByteString
</span><a href="Skylighting.Tokenizer.html#captures"><span class="hs-identifier hs-var">captures</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-529"></span><span>                                  </span><span class="annot"><span class="annottext">((Int, Int) -&gt; ByteString)
-&gt; IntMap (Int, Int) -&gt; IntMap ByteString
forall a b. (a -&gt; b) -&gt; IntMap a -&gt; IntMap b
</span><span class="hs-identifier hs-var">IntMap.map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; (Int, Int) -&gt; ByteString
</span><a href="Skylighting.Tokenizer.html#toSlice"><span class="hs-identifier hs-var">toSlice</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138949"><span class="hs-identifier hs-var">inp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IntMap (Int, Int)
</span><a href="#local-6989586621679138930"><span class="hs-identifier hs-var">capts</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-530"></span><span>          </span><span class="annot"><span class="annottext">Int -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#takeChars"><span class="hs-identifier hs-var">takeChars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Int
</span><span class="hs-identifier hs-var">UTF8.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138931"><span class="hs-identifier hs-var">matchedBytes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-531"></span><span>        </span><span class="annot"><span class="annottext">Maybe (ByteString, IntMap (Int, Int))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TokenizerM Text
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><span class="hs-identifier hs-var">mzero</span></span><span>
</span><span id="line-532"></span><span>
</span><span id="line-533"></span><span class="annot"><a href="Skylighting.Tokenizer.html#toSlice"><span class="hs-identifier hs-type">toSlice</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span>
</span><span id="line-534"></span><span id="toSlice"><span class="annot"><span class="annottext">toSlice :: ByteString -&gt; (Int, Int) -&gt; ByteString
</span><a href="Skylighting.Tokenizer.html#toSlice"><span class="hs-identifier hs-var hs-var">toSlice</span></a></span></span><span> </span><span id="local-6989586621679138926"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138926"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679138925"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679138925"><span class="hs-identifier hs-var">off</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679138924"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679138924"><span class="hs-identifier hs-var">len</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">BS.take</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679138924"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString) -&gt; ByteString -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">BS.drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679138925"><span class="hs-identifier hs-var">off</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138926"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-535"></span><span>
</span><span id="line-536"></span><span class="annot"><a href="Skylighting.Tokenizer.html#wordBoundary"><span class="hs-identifier hs-type">wordBoundary</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerM"><span class="hs-identifier hs-type">TokenizerM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-537"></span><span id="wordBoundary"><span class="annot"><span class="annottext">wordBoundary :: ByteString -&gt; TokenizerM ()
</span><a href="Skylighting.Tokenizer.html#wordBoundary"><span class="hs-identifier hs-var hs-var">wordBoundary</span></a></span></span><span> </span><span id="local-6989586621679138922"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138922"><span class="hs-identifier hs-var">inp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-538"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe (Char, ByteString)
</span><span class="hs-identifier hs-var">UTF8.uncons</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138922"><span class="hs-identifier hs-var">inp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-539"></span><span>       </span><span class="annot"><span class="annottext">Maybe (Char, ByteString)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TokenizerM ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-540"></span><span>       </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679138921"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138921"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-541"></span><span>         </span><span id="local-6989586621679138920"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138920"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TokenizerState -&gt; Char) -&gt; TokenizerM Char
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">TokenizerState -&gt; Char
</span><a href="Skylighting.Tokenizer.html#prevChar"><span class="hs-identifier hs-var hs-var">prevChar</span></a></span><span>
</span><span id="line-542"></span><span>         </span><span class="annot"><span class="annottext">Bool -&gt; TokenizerM ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; TokenizerM ()) -&gt; Bool -&gt; TokenizerM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
</span><a href="Skylighting.Tokenizer.html#isWordBoundary"><span class="hs-identifier hs-var">isWordBoundary</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138920"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138921"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-543"></span><span>
</span><span id="line-544"></span><span class="annot"><a href="Skylighting.Tokenizer.html#isWordBoundary"><span class="hs-identifier hs-type">isWordBoundary</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-545"></span><span id="isWordBoundary"><span class="annot"><span class="annottext">isWordBoundary :: Char -&gt; Char -&gt; Bool
</span><a href="Skylighting.Tokenizer.html#isWordBoundary"><span class="hs-identifier hs-var hs-var">isWordBoundary</span></a></span></span><span> </span><span id="local-6989586621679138919"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138919"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679138918"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138918"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><a href="Regex.KDE.Regex.html#isWordChar"><span class="hs-identifier hs-var">isWordChar</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138919"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><a href="Regex.KDE.Regex.html#isWordChar"><span class="hs-identifier hs-var">isWordChar</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138918"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-546"></span><span>
</span><span id="line-547"></span><span class="annot"><a href="Skylighting.Tokenizer.html#decodeBS"><span class="hs-identifier hs-type">decodeBS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerM"><span class="hs-identifier hs-type">TokenizerM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-548"></span><span id="decodeBS"><span class="annot"><span class="annottext">decodeBS :: ByteString -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#decodeBS"><span class="hs-identifier hs-var hs-var">decodeBS</span></a></span></span><span> </span><span id="local-6989586621679138916"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138916"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Either UnicodeException Text
</span><span class="hs-identifier hs-var">decodeUtf8'</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138916"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-549"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><span class="annottext">UnicodeException
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; TokenizerM Text
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ByteString &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-550"></span><span>                                </span><span class="annot"><span class="annottext">ByteString -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138916"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;is not UTF8&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-551"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679138915"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679138915"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; TokenizerM Text
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679138915"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-552"></span><span>
</span><span id="line-553"></span><span class="hs-comment">-- Substitute out %1, %2, etc. in regex string, escaping</span><span>
</span><span id="line-554"></span><span class="hs-comment">-- appropriately..</span><span>
</span><span id="line-555"></span><span class="annot"><a href="Skylighting.Tokenizer.html#subDynamic"><span class="hs-identifier hs-type">subDynamic</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Regex.KDE.Regex.html#Regex"><span class="hs-identifier hs-type">Regex</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerM"><span class="hs-identifier hs-type">TokenizerM</span></a></span><span> </span><span class="annot"><a href="Regex.KDE.Regex.html#Regex"><span class="hs-identifier hs-type">Regex</span></a></span><span>
</span><span id="line-556"></span><span id="subDynamic"><span class="annot"><span class="annottext">subDynamic :: Regex -&gt; TokenizerM Regex
</span><a href="Skylighting.Tokenizer.html#subDynamic"><span class="hs-identifier hs-var hs-var">subDynamic</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Regex.KDE.Regex.html#MatchDynamic"><span class="hs-identifier hs-type">MatchDynamic</span></a></span><span> </span><span id="local-6989586621679138913"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679138913"><span class="hs-identifier hs-var">capNum</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-557"></span><span>  </span><span id="local-6989586621679138912"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679138912"><span class="hs-identifier hs-var">replacement</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#getCapture"><span class="hs-identifier hs-var">getCapture</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679138913"><span class="hs-identifier hs-var">capNum</span></a></span><span>
</span><span id="line-558"></span><span>  </span><span class="annot"><span class="annottext">Regex -&gt; TokenizerM Regex
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Regex -&gt; TokenizerM Regex) -&gt; Regex -&gt; TokenizerM Regex
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Regex] -&gt; Regex
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="annot"><span class="annottext">([Regex] -&gt; Regex) -&gt; [Regex] -&gt; Regex
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Regex) -&gt; String -&gt; [Regex]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; Regex
</span><a href="Regex.KDE.Regex.html#MatchChar"><span class="hs-identifier hs-var">MatchChar</span></a></span><span> </span><span class="annot"><span class="annottext">((Char -&gt; Bool) -&gt; Regex)
-&gt; (Char -&gt; Char -&gt; Bool) -&gt; Char -&gt; Regex
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">(==)</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(String -&gt; [Regex]) -&gt; String -&gt; [Regex]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">Text.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679138912"><span class="hs-identifier hs-var">replacement</span></a></span><span>
</span><span id="line-559"></span><span class="annot"><a href="Skylighting.Tokenizer.html#subDynamic"><span class="hs-identifier hs-var">subDynamic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Regex.KDE.Regex.html#MatchAlt"><span class="hs-identifier hs-type">MatchAlt</span></a></span><span> </span><span id="local-6989586621679138909"><span class="annot"><span class="annottext">Regex
</span><a href="#local-6989586621679138909"><span class="hs-identifier hs-var">r1</span></a></span></span><span> </span><span id="local-6989586621679138908"><span class="annot"><span class="annottext">Regex
</span><a href="#local-6989586621679138908"><span class="hs-identifier hs-var">r2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-560"></span><span>  </span><span class="annot"><span class="annottext">Regex -&gt; Regex -&gt; Regex
</span><a href="Regex.KDE.Regex.html#MatchAlt"><span class="hs-identifier hs-var">MatchAlt</span></a></span><span> </span><span class="annot"><span class="annottext">(Regex -&gt; Regex -&gt; Regex)
-&gt; TokenizerM Regex -&gt; TokenizerM (Regex -&gt; Regex)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Regex -&gt; TokenizerM Regex
</span><a href="Skylighting.Tokenizer.html#subDynamic"><span class="hs-identifier hs-var">subDynamic</span></a></span><span> </span><span class="annot"><span class="annottext">Regex
</span><a href="#local-6989586621679138909"><span class="hs-identifier hs-var">r1</span></a></span><span> </span><span class="annot"><span class="annottext">TokenizerM (Regex -&gt; Regex) -&gt; TokenizerM Regex -&gt; TokenizerM Regex
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Regex -&gt; TokenizerM Regex
</span><a href="Skylighting.Tokenizer.html#subDynamic"><span class="hs-identifier hs-var">subDynamic</span></a></span><span> </span><span class="annot"><span class="annottext">Regex
</span><a href="#local-6989586621679138908"><span class="hs-identifier hs-var">r2</span></a></span><span>
</span><span id="line-561"></span><span class="annot"><a href="Skylighting.Tokenizer.html#subDynamic"><span class="hs-identifier hs-var">subDynamic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Regex.KDE.Regex.html#MatchConcat"><span class="hs-identifier hs-type">MatchConcat</span></a></span><span> </span><span id="local-6989586621679138906"><span class="annot"><span class="annottext">Regex
</span><a href="#local-6989586621679138906"><span class="hs-identifier hs-var">r1</span></a></span></span><span> </span><span id="local-6989586621679138905"><span class="annot"><span class="annottext">Regex
</span><a href="#local-6989586621679138905"><span class="hs-identifier hs-var">r2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-562"></span><span>  </span><span class="annot"><span class="annottext">Regex -&gt; Regex -&gt; Regex
</span><a href="Regex.KDE.Regex.html#MatchConcat"><span class="hs-identifier hs-var">MatchConcat</span></a></span><span> </span><span class="annot"><span class="annottext">(Regex -&gt; Regex -&gt; Regex)
-&gt; TokenizerM Regex -&gt; TokenizerM (Regex -&gt; Regex)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Regex -&gt; TokenizerM Regex
</span><a href="Skylighting.Tokenizer.html#subDynamic"><span class="hs-identifier hs-var">subDynamic</span></a></span><span> </span><span class="annot"><span class="annottext">Regex
</span><a href="#local-6989586621679138906"><span class="hs-identifier hs-var">r1</span></a></span><span> </span><span class="annot"><span class="annottext">TokenizerM (Regex -&gt; Regex) -&gt; TokenizerM Regex -&gt; TokenizerM Regex
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Regex -&gt; TokenizerM Regex
</span><a href="Skylighting.Tokenizer.html#subDynamic"><span class="hs-identifier hs-var">subDynamic</span></a></span><span> </span><span class="annot"><span class="annottext">Regex
</span><a href="#local-6989586621679138905"><span class="hs-identifier hs-var">r2</span></a></span><span>
</span><span id="line-563"></span><span class="annot"><a href="Skylighting.Tokenizer.html#subDynamic"><span class="hs-identifier hs-var">subDynamic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Regex.KDE.Regex.html#MatchSome"><span class="hs-identifier hs-type">MatchSome</span></a></span><span> </span><span id="local-6989586621679138903"><span class="annot"><span class="annottext">Regex
</span><a href="#local-6989586621679138903"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-564"></span><span>  </span><span class="annot"><span class="annottext">Regex -&gt; Regex
</span><a href="Regex.KDE.Regex.html#MatchSome"><span class="hs-identifier hs-var">MatchSome</span></a></span><span> </span><span class="annot"><span class="annottext">(Regex -&gt; Regex) -&gt; TokenizerM Regex -&gt; TokenizerM Regex
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Regex -&gt; TokenizerM Regex
</span><a href="Skylighting.Tokenizer.html#subDynamic"><span class="hs-identifier hs-var">subDynamic</span></a></span><span> </span><span class="annot"><span class="annottext">Regex
</span><a href="#local-6989586621679138903"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-565"></span><span class="annot"><a href="Skylighting.Tokenizer.html#subDynamic"><span class="hs-identifier hs-var">subDynamic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Regex.KDE.Regex.html#MatchCapture"><span class="hs-identifier hs-type">MatchCapture</span></a></span><span> </span><span id="local-6989586621679138901"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679138901"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621679138900"><span class="annot"><span class="annottext">Regex
</span><a href="#local-6989586621679138900"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-566"></span><span>  </span><span class="annot"><span class="annottext">Int -&gt; Regex -&gt; Regex
</span><a href="Regex.KDE.Regex.html#MatchCapture"><span class="hs-identifier hs-var">MatchCapture</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679138901"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">(Regex -&gt; Regex) -&gt; TokenizerM Regex -&gt; TokenizerM Regex
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Regex -&gt; TokenizerM Regex
</span><a href="Skylighting.Tokenizer.html#subDynamic"><span class="hs-identifier hs-var">subDynamic</span></a></span><span> </span><span class="annot"><span class="annottext">Regex
</span><a href="#local-6989586621679138900"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-567"></span><span class="annot"><a href="Skylighting.Tokenizer.html#subDynamic"><span class="hs-identifier hs-var">subDynamic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Regex.KDE.Regex.html#AssertPositive"><span class="hs-identifier hs-type">AssertPositive</span></a></span><span> </span><span id="local-6989586621679138898"><span class="annot"><span class="annottext">Direction
</span><a href="#local-6989586621679138898"><span class="hs-identifier hs-var">dir</span></a></span></span><span> </span><span id="local-6989586621679138897"><span class="annot"><span class="annottext">Regex
</span><a href="#local-6989586621679138897"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-568"></span><span>  </span><span class="annot"><span class="annottext">Direction -&gt; Regex -&gt; Regex
</span><a href="Regex.KDE.Regex.html#AssertPositive"><span class="hs-identifier hs-var">AssertPositive</span></a></span><span> </span><span class="annot"><span class="annottext">Direction
</span><a href="#local-6989586621679138898"><span class="hs-identifier hs-var">dir</span></a></span><span> </span><span class="annot"><span class="annottext">(Regex -&gt; Regex) -&gt; TokenizerM Regex -&gt; TokenizerM Regex
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Regex -&gt; TokenizerM Regex
</span><a href="Skylighting.Tokenizer.html#subDynamic"><span class="hs-identifier hs-var">subDynamic</span></a></span><span> </span><span class="annot"><span class="annottext">Regex
</span><a href="#local-6989586621679138897"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-569"></span><span class="annot"><a href="Skylighting.Tokenizer.html#subDynamic"><span class="hs-identifier hs-var">subDynamic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Regex.KDE.Regex.html#AssertNegative"><span class="hs-identifier hs-type">AssertNegative</span></a></span><span> </span><span id="local-6989586621679138895"><span class="annot"><span class="annottext">Direction
</span><a href="#local-6989586621679138895"><span class="hs-identifier hs-var">dir</span></a></span></span><span> </span><span id="local-6989586621679138894"><span class="annot"><span class="annottext">Regex
</span><a href="#local-6989586621679138894"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-570"></span><span>  </span><span class="annot"><span class="annottext">Direction -&gt; Regex -&gt; Regex
</span><a href="Regex.KDE.Regex.html#AssertNegative"><span class="hs-identifier hs-var">AssertNegative</span></a></span><span> </span><span class="annot"><span class="annottext">Direction
</span><a href="#local-6989586621679138895"><span class="hs-identifier hs-var">dir</span></a></span><span> </span><span class="annot"><span class="annottext">(Regex -&gt; Regex) -&gt; TokenizerM Regex -&gt; TokenizerM Regex
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Regex -&gt; TokenizerM Regex
</span><a href="Skylighting.Tokenizer.html#subDynamic"><span class="hs-identifier hs-var">subDynamic</span></a></span><span> </span><span class="annot"><span class="annottext">Regex
</span><a href="#local-6989586621679138894"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-571"></span><span class="annot"><a href="Skylighting.Tokenizer.html#subDynamic"><span class="hs-identifier hs-var">subDynamic</span></a></span><span> </span><span id="local-6989586621679138893"><span class="annot"><span class="annottext">Regex
</span><a href="#local-6989586621679138893"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Regex -&gt; TokenizerM Regex
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Regex
</span><a href="#local-6989586621679138893"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-572"></span><span>
</span><span id="line-573"></span><span class="annot"><a href="Skylighting.Tokenizer.html#getCapture"><span class="hs-identifier hs-type">getCapture</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerM"><span class="hs-identifier hs-type">TokenizerM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-574"></span><span id="getCapture"><span class="annot"><span class="annottext">getCapture :: Int -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#getCapture"><span class="hs-identifier hs-var hs-var">getCapture</span></a></span></span><span> </span><span id="local-6989586621679138892"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679138892"><span class="hs-identifier hs-var">capnum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-575"></span><span>  </span><span id="local-6989586621679138891"><span class="annot"><span class="annottext">IntMap ByteString
</span><a href="#local-6989586621679138891"><span class="hs-identifier hs-var">capts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TokenizerState -&gt; IntMap ByteString)
-&gt; TokenizerM (IntMap ByteString)
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">TokenizerState -&gt; IntMap ByteString
</span><a href="Skylighting.Tokenizer.html#captures"><span class="hs-identifier hs-var hs-var">captures</span></a></span><span>
</span><span id="line-576"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Int -&gt; IntMap ByteString -&gt; Maybe ByteString
forall a. Int -&gt; IntMap a -&gt; Maybe a
</span><span class="hs-identifier hs-var">IntMap.lookup</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679138892"><span class="hs-identifier hs-var">capnum</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap ByteString
</span><a href="#local-6989586621679138891"><span class="hs-identifier hs-var">capts</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-577"></span><span>     </span><span class="annot"><span class="annottext">Maybe ByteString
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; TokenizerM Text
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; TokenizerM Text) -&gt; String -&gt; TokenizerM Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Capture &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679138892"><span class="hs-identifier hs-var">capnum</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; not defined!&quot;</span></span><span>
</span><span id="line-578"></span><span>     </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679138889"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138889"><span class="hs-identifier hs-var">x</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#decodeBS"><span class="hs-identifier hs-var">decodeBS</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138889"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-579"></span><span>
</span><span id="line-580"></span><span class="annot"><a href="Skylighting.Tokenizer.html#keyword"><span class="hs-identifier hs-type">keyword</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Skylighting.Types.html#KeywordAttr"><span class="hs-identifier hs-type">KeywordAttr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Skylighting.Types.html#WordSet"><span class="hs-identifier hs-type">WordSet</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerM"><span class="hs-identifier hs-type">TokenizerM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-581"></span><span id="keyword"><span class="annot"><span class="annottext">keyword :: KeywordAttr -&gt; WordSet Text -&gt; ByteString -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#keyword"><span class="hs-identifier hs-var hs-var">keyword</span></a></span></span><span> </span><span id="local-6989586621679138888"><span class="annot"><span class="annottext">KeywordAttr
</span><a href="#local-6989586621679138888"><span class="hs-identifier hs-var">kwattr</span></a></span></span><span> </span><span id="local-6989586621679138887"><span class="annot"><span class="annottext">WordSet Text
</span><a href="#local-6989586621679138887"><span class="hs-identifier hs-var">kws</span></a></span></span><span> </span><span id="local-6989586621679138886"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138886"><span class="hs-identifier hs-var">inp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-582"></span><span>  </span><span id="local-6989586621679138885"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138885"><span class="hs-identifier hs-var">prev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TokenizerState -&gt; Char) -&gt; TokenizerM Char
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">TokenizerState -&gt; Char
</span><a href="Skylighting.Tokenizer.html#prevChar"><span class="hs-identifier hs-var hs-var">prevChar</span></a></span><span>
</span><span id="line-583"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; TokenizerM ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; TokenizerM ()) -&gt; Bool -&gt; TokenizerM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138885"><span class="hs-identifier hs-var">prev</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Set Char -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`Set.member`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KeywordAttr -&gt; Set Char
</span><a href="Skylighting.Types.html#keywordDelims"><span class="hs-identifier hs-var hs-var">keywordDelims</span></a></span><span> </span><span class="annot"><span class="annottext">KeywordAttr
</span><a href="#local-6989586621679138888"><span class="hs-identifier hs-var">kwattr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-584"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679138883"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138883"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; ByteString -&gt; (ByteString, ByteString)
</span><span class="hs-identifier hs-var">UTF8.break</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Set Char -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`Set.member`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KeywordAttr -&gt; Set Char
</span><a href="Skylighting.Types.html#keywordDelims"><span class="hs-identifier hs-var hs-var">keywordDelims</span></a></span><span> </span><span class="annot"><span class="annottext">KeywordAttr
</span><a href="#local-6989586621679138888"><span class="hs-identifier hs-var">kwattr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138886"><span class="hs-identifier hs-var">inp</span></a></span><span>
</span><span id="line-585"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; TokenizerM ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; TokenizerM ()) -&gt; Bool -&gt; TokenizerM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Bool
</span><span class="hs-identifier hs-var">BS.null</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138883"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-586"></span><span>  </span><span id="local-6989586621679138881"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679138881"><span class="hs-identifier hs-var">w'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#decodeBS"><span class="hs-identifier hs-var">decodeBS</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138883"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-587"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679138880"><span class="annot"><span class="annottext">numchars :: Int
</span><a href="#local-6989586621679138880"><span class="hs-identifier hs-var hs-var">numchars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Int
</span><span class="hs-identifier hs-var">Text.length</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679138881"><span class="hs-identifier hs-var">w'</span></a></span><span>
</span><span id="line-588"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679138881"><span class="hs-identifier hs-var">w'</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; WordSet Text -&gt; Bool
forall a. (FoldCase a, Ord a) =&gt; a -&gt; WordSet a -&gt; Bool
</span><a href="Skylighting.Types.html#inWordSet"><span class="hs-operator hs-var">`inWordSet`</span></a></span><span> </span><span class="annot"><span class="annottext">WordSet Text
</span><a href="#local-6989586621679138887"><span class="hs-identifier hs-var">kws</span></a></span><span>
</span><span id="line-589"></span><span>     </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#takeChars"><span class="hs-identifier hs-var">takeChars</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679138880"><span class="hs-identifier hs-var">numchars</span></a></span><span>
</span><span id="line-590"></span><span>     </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">TokenizerM Text
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><span class="hs-identifier hs-var">mzero</span></span><span>
</span><span id="line-591"></span><span>
</span><span id="line-592"></span><span class="annot"><a href="Skylighting.Tokenizer.html#normalizeHighlighting"><span class="hs-identifier hs-type">normalizeHighlighting</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Skylighting.Types.html#Token"><span class="hs-identifier hs-type">Token</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Skylighting.Types.html#Token"><span class="hs-identifier hs-type">Token</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-593"></span><span id="normalizeHighlighting"><span class="annot"><span class="annottext">normalizeHighlighting :: SourceLine -&gt; SourceLine
</span><a href="Skylighting.Tokenizer.html#normalizeHighlighting"><span class="hs-identifier hs-var hs-var">normalizeHighlighting</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-594"></span><span class="annot"><a href="Skylighting.Tokenizer.html#normalizeHighlighting"><span class="hs-identifier hs-var">normalizeHighlighting</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679138878"><span class="annot"><span class="annottext">TokenType
</span><a href="#local-6989586621679138878"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679138877"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679138877"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679138876"><span class="annot"><span class="annottext">SourceLine
</span><a href="#local-6989586621679138876"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-595"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Bool
</span><span class="hs-identifier hs-var">Text.null</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679138877"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceLine -&gt; SourceLine
</span><a href="Skylighting.Tokenizer.html#normalizeHighlighting"><span class="hs-identifier hs-var">normalizeHighlighting</span></a></span><span> </span><span class="annot"><span class="annottext">SourceLine
</span><a href="#local-6989586621679138876"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-596"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-597"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenType
</span><a href="#local-6989586621679138878"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><span class="hs-identifier hs-var">Text.concat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679138877"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; [Text]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">(Token -&gt; Text) -&gt; SourceLine -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Token -&gt; Text
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">SourceLine
</span><a href="#local-6989586621679138875"><span class="hs-identifier hs-var">matches</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Token -&gt; SourceLine -&gt; SourceLine
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">SourceLine -&gt; SourceLine
</span><a href="Skylighting.Tokenizer.html#normalizeHighlighting"><span class="hs-identifier hs-var">normalizeHighlighting</span></a></span><span> </span><span class="annot"><span class="annottext">SourceLine
</span><a href="#local-6989586621679138874"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-598"></span><span>    </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679138875"><span class="annot"><span class="annottext">SourceLine
</span><a href="#local-6989586621679138875"><span class="hs-identifier hs-var">matches</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679138874"><span class="annot"><span class="annottext">SourceLine
</span><a href="#local-6989586621679138874"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Token -&gt; Bool) -&gt; SourceLine -&gt; (SourceLine, SourceLine)
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">span</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679138872"><span class="annot"><span class="annottext">TokenType
</span><a href="#local-6989586621679138872"><span class="hs-identifier hs-var">z</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TokenType
</span><a href="#local-6989586621679138872"><span class="hs-identifier hs-var">z</span></a></span><span> </span><span class="annot"><span class="annottext">TokenType -&gt; TokenType -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TokenType
</span><a href="#local-6989586621679138878"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SourceLine
</span><a href="#local-6989586621679138876"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-599"></span><span>
</span><span id="line-600"></span><span class="annot"><a href="Skylighting.Tokenizer.html#parseCStringChar"><span class="hs-identifier hs-type">parseCStringChar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerM"><span class="hs-identifier hs-type">TokenizerM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-601"></span><span id="parseCStringChar"><span class="annot"><span class="annottext">parseCStringChar :: ByteString -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#parseCStringChar"><span class="hs-identifier hs-var hs-var">parseCStringChar</span></a></span></span><span> </span><span id="local-6989586621679138871"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138871"><span class="hs-identifier hs-var">inp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-602"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Parser (ByteString, ())
-&gt; ByteString -&gt; Either String (ByteString, ())
forall a. Parser a -&gt; ByteString -&gt; Either String a
</span><span class="hs-identifier hs-var">A.parseOnly</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Parser () -&gt; Parser (ByteString, ())
forall a. Parser a -&gt; Parser (ByteString, a)
</span><span class="hs-identifier hs-var">A.match</span></span><span> </span><span class="annot"><span class="annottext">Parser ()
</span><a href="Skylighting.Tokenizer.html#pCStringChar"><span class="hs-identifier hs-var">pCStringChar</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138871"><span class="hs-identifier hs-var">inp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-603"></span><span>       </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TokenizerM Text
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><span class="hs-identifier hs-var">mzero</span></span><span>
</span><span id="line-604"></span><span>       </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679138867"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138867"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#takeChars"><span class="hs-identifier hs-var">takeChars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Int
</span><span class="hs-identifier hs-var">BS.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138867"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- assumes ascii</span><span>
</span><span id="line-605"></span><span>
</span><span id="line-606"></span><span class="annot"><a href="Skylighting.Tokenizer.html#pCStringChar"><span class="hs-identifier hs-type">pCStringChar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">A.Parser</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-607"></span><span id="pCStringChar"><span class="annot"><span class="annottext">pCStringChar :: Parser ()
</span><a href="Skylighting.Tokenizer.html#pCStringChar"><span class="hs-identifier hs-var hs-var">pCStringChar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-608"></span><span>  </span><span class="annot"><span class="annottext">Char
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Parser Char
</span><span class="hs-identifier hs-var">A.char</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\\'</span></span><span>
</span><span id="line-609"></span><span>  </span><span id="local-6989586621679138865"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138865"><span class="hs-identifier hs-var">next</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Parser Char
</span><span class="hs-identifier hs-var">A.anyChar</span></span><span>
</span><span id="line-610"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138865"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-611"></span><span>       </span><span id="local-6989586621679138863"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138863"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138863"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'x'</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138863"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'X'</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">() -&gt; Parser ByteString ByteString -&gt; Parser ()
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; Parser ByteString ByteString
</span><span class="hs-identifier hs-var">A.takeWhile1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Char -&gt; Bool
</span><span class="hs-identifier hs-var">A.inClass</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;0-9a-fA-F&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-612"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138863"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'0'</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">() -&gt; Parser ByteString ByteString -&gt; Parser ()
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; Parser ByteString ByteString
</span><span class="hs-identifier hs-var">A.takeWhile</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Char -&gt; Bool
</span><span class="hs-identifier hs-var">A.inClass</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;0-7&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-613"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">String -&gt; Char -&gt; Bool
</span><span class="hs-identifier hs-var">A.inClass</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;abefnrtv\&quot;'?\\&quot;</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138863"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; Parser ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-614"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Parser ()
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><span class="hs-identifier hs-var">mzero</span></span><span>
</span><span id="line-615"></span><span>
</span><span id="line-616"></span><span class="annot"><a href="Skylighting.Tokenizer.html#parseCChar"><span class="hs-identifier hs-type">parseCChar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerM"><span class="hs-identifier hs-type">TokenizerM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-617"></span><span id="parseCChar"><span class="annot"><span class="annottext">parseCChar :: ByteString -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#parseCChar"><span class="hs-identifier hs-var hs-var">parseCChar</span></a></span></span><span> </span><span id="local-6989586621679138859"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138859"><span class="hs-identifier hs-var">inp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-618"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Parser (ByteString, ())
-&gt; ByteString -&gt; Either String (ByteString, ())
forall a. Parser a -&gt; ByteString -&gt; Either String a
</span><span class="hs-identifier hs-var">A.parseOnly</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Parser () -&gt; Parser (ByteString, ())
forall a. Parser a -&gt; Parser (ByteString, a)
</span><span class="hs-identifier hs-var">A.match</span></span><span> </span><span class="annot"><span class="annottext">Parser ()
</span><a href="Skylighting.Tokenizer.html#pCChar"><span class="hs-identifier hs-var">pCChar</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138859"><span class="hs-identifier hs-var">inp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-619"></span><span>       </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TokenizerM Text
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><span class="hs-identifier hs-var">mzero</span></span><span>
</span><span id="line-620"></span><span>       </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679138857"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138857"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#takeChars"><span class="hs-identifier hs-var">takeChars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Int
</span><span class="hs-identifier hs-var">BS.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138857"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- assumes ascii</span><span>
</span><span id="line-621"></span><span>
</span><span id="line-622"></span><span class="annot"><a href="Skylighting.Tokenizer.html#pCChar"><span class="hs-identifier hs-type">pCChar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">A.Parser</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-623"></span><span id="pCChar"><span class="annot"><span class="annottext">pCChar :: Parser ()
</span><a href="Skylighting.Tokenizer.html#pCChar"><span class="hs-identifier hs-var hs-var">pCChar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-624"></span><span>  </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">() -&gt; Parser Char -&gt; Parser ()
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Parser Char
</span><span class="hs-identifier hs-var">A.char</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\''</span></span><span>
</span><span id="line-625"></span><span>  </span><span class="annot"><span class="annottext">Parser ()
</span><a href="Skylighting.Tokenizer.html#pCStringChar"><span class="hs-identifier hs-var">pCStringChar</span></a></span><span> </span><span class="annot"><span class="annottext">Parser () -&gt; Parser () -&gt; Parser ()
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">&lt;|&gt;</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">() -&gt; Parser Char -&gt; Parser ()
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; Parser Char
</span><span class="hs-identifier hs-var">A.satisfy</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679138855"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138855"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138855"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\''</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138855"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\\'</span></span><span class="hs-special">)</span><span>
</span><span id="line-626"></span><span>  </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">() -&gt; Parser Char -&gt; Parser ()
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Parser Char
</span><span class="hs-identifier hs-var">A.char</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\''</span></span><span>
</span><span id="line-627"></span><span>
</span><span id="line-628"></span><span class="annot"><a href="Skylighting.Tokenizer.html#parseInt"><span class="hs-identifier hs-type">parseInt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerM"><span class="hs-identifier hs-type">TokenizerM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-629"></span><span id="parseInt"><span class="annot"><span class="annottext">parseInt :: ByteString -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#parseInt"><span class="hs-identifier hs-var hs-var">parseInt</span></a></span></span><span> </span><span id="local-6989586621679138854"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138854"><span class="hs-identifier hs-var">inp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-630"></span><span>  </span><span class="annot"><span class="annottext">ByteString -&gt; TokenizerM ()
</span><a href="Skylighting.Tokenizer.html#wordBoundary"><span class="hs-identifier hs-var">wordBoundary</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138854"><span class="hs-identifier hs-var">inp</span></a></span><span>
</span><span id="line-631"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Parser (ByteString, ())
-&gt; ByteString -&gt; Either String (ByteString, ())
forall a. Parser a -&gt; ByteString -&gt; Either String a
</span><span class="hs-identifier hs-var">A.parseOnly</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Parser () -&gt; Parser (ByteString, ())
forall a. Parser a -&gt; Parser (ByteString, a)
</span><span class="hs-identifier hs-var">A.match</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Parser ()
</span><a href="Skylighting.Tokenizer.html#pHex"><span class="hs-identifier hs-var">pHex</span></a></span><span> </span><span class="annot"><span class="annottext">Parser () -&gt; Parser () -&gt; Parser ()
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">Parser ()
</span><a href="Skylighting.Tokenizer.html#pOct"><span class="hs-identifier hs-var">pOct</span></a></span><span> </span><span class="annot"><span class="annottext">Parser () -&gt; Parser () -&gt; Parser ()
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">Parser ()
</span><a href="Skylighting.Tokenizer.html#pDec"><span class="hs-identifier hs-var">pDec</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138854"><span class="hs-identifier hs-var">inp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-632"></span><span>       </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TokenizerM Text
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><span class="hs-identifier hs-var">mzero</span></span><span>
</span><span id="line-633"></span><span>       </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679138850"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138850"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#takeChars"><span class="hs-identifier hs-var">takeChars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Int
</span><span class="hs-identifier hs-var">BS.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138850"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- assumes ascii</span><span>
</span><span id="line-634"></span><span>
</span><span id="line-635"></span><span class="annot"><a href="Skylighting.Tokenizer.html#pDec"><span class="hs-identifier hs-type">pDec</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">A.Parser</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-636"></span><span id="pDec"><span class="annot"><span class="annottext">pDec :: Parser ()
</span><a href="Skylighting.Tokenizer.html#pDec"><span class="hs-identifier hs-var hs-var">pDec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-637"></span><span>  </span><span class="annot"><span class="annottext">Parser ()
</span><a href="Skylighting.Tokenizer.html#mbMinus"><span class="hs-identifier hs-var">mbMinus</span></a></span><span>
</span><span id="line-638"></span><span>  </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; Parser ByteString ByteString
</span><span class="hs-identifier hs-var">A.takeWhile1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Char -&gt; Bool
</span><span class="hs-identifier hs-var">A.inClass</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;0-9&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-639"></span><span>  </span><span class="annot"><span class="annottext">Parser ()
</span><a href="Skylighting.Tokenizer.html#guardWordBoundary"><span class="hs-identifier hs-var">guardWordBoundary</span></a></span><span>
</span><span id="line-640"></span><span>
</span><span id="line-641"></span><span class="annot"><a href="Skylighting.Tokenizer.html#parseOct"><span class="hs-identifier hs-type">parseOct</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerM"><span class="hs-identifier hs-type">TokenizerM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-642"></span><span id="parseOct"><span class="annot"><span class="annottext">parseOct :: ByteString -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#parseOct"><span class="hs-identifier hs-var hs-var">parseOct</span></a></span></span><span> </span><span id="local-6989586621679138847"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138847"><span class="hs-identifier hs-var">inp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-643"></span><span>  </span><span class="annot"><span class="annottext">ByteString -&gt; TokenizerM ()
</span><a href="Skylighting.Tokenizer.html#wordBoundary"><span class="hs-identifier hs-var">wordBoundary</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138847"><span class="hs-identifier hs-var">inp</span></a></span><span>
</span><span id="line-644"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Parser (ByteString, ())
-&gt; ByteString -&gt; Either String (ByteString, ())
forall a. Parser a -&gt; ByteString -&gt; Either String a
</span><span class="hs-identifier hs-var">A.parseOnly</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Parser () -&gt; Parser (ByteString, ())
forall a. Parser a -&gt; Parser (ByteString, a)
</span><span class="hs-identifier hs-var">A.match</span></span><span> </span><span class="annot"><span class="annottext">Parser ()
</span><a href="Skylighting.Tokenizer.html#pHex"><span class="hs-identifier hs-var">pHex</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138847"><span class="hs-identifier hs-var">inp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-645"></span><span>       </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TokenizerM Text
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><span class="hs-identifier hs-var">mzero</span></span><span>
</span><span id="line-646"></span><span>       </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679138846"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138846"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#takeChars"><span class="hs-identifier hs-var">takeChars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Int
</span><span class="hs-identifier hs-var">BS.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138846"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- assumes ascii</span><span>
</span><span id="line-647"></span><span>
</span><span id="line-648"></span><span class="annot"><a href="Skylighting.Tokenizer.html#pOct"><span class="hs-identifier hs-type">pOct</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">A.Parser</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-649"></span><span id="pOct"><span class="annot"><span class="annottext">pOct :: Parser ()
</span><a href="Skylighting.Tokenizer.html#pOct"><span class="hs-identifier hs-var hs-var">pOct</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-650"></span><span>  </span><span class="annot"><span class="annottext">Parser ()
</span><a href="Skylighting.Tokenizer.html#mbMinus"><span class="hs-identifier hs-var">mbMinus</span></a></span><span>
</span><span id="line-651"></span><span>  </span><span class="annot"><span class="annottext">Char
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Parser Char
</span><span class="hs-identifier hs-var">A.char</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'0'</span></span><span>
</span><span id="line-652"></span><span>  </span><span class="annot"><span class="annottext">Char
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; Parser Char
</span><span class="hs-identifier hs-var">A.satisfy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Char -&gt; Bool
</span><span class="hs-identifier hs-var">A.inClass</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Oo&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-653"></span><span>  </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; Parser ByteString ByteString
</span><span class="hs-identifier hs-var">A.takeWhile1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Char -&gt; Bool
</span><span class="hs-identifier hs-var">A.inClass</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;0-7&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-654"></span><span>  </span><span class="annot"><span class="annottext">Parser ()
</span><a href="Skylighting.Tokenizer.html#guardWordBoundary"><span class="hs-identifier hs-var">guardWordBoundary</span></a></span><span>
</span><span id="line-655"></span><span>
</span><span id="line-656"></span><span class="annot"><a href="Skylighting.Tokenizer.html#parseHex"><span class="hs-identifier hs-type">parseHex</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerM"><span class="hs-identifier hs-type">TokenizerM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-657"></span><span id="parseHex"><span class="annot"><span class="annottext">parseHex :: ByteString -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#parseHex"><span class="hs-identifier hs-var hs-var">parseHex</span></a></span></span><span> </span><span id="local-6989586621679138845"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138845"><span class="hs-identifier hs-var">inp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-658"></span><span>  </span><span class="annot"><span class="annottext">ByteString -&gt; TokenizerM ()
</span><a href="Skylighting.Tokenizer.html#wordBoundary"><span class="hs-identifier hs-var">wordBoundary</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138845"><span class="hs-identifier hs-var">inp</span></a></span><span>
</span><span id="line-659"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Parser (ByteString, ())
-&gt; ByteString -&gt; Either String (ByteString, ())
forall a. Parser a -&gt; ByteString -&gt; Either String a
</span><span class="hs-identifier hs-var">A.parseOnly</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Parser () -&gt; Parser (ByteString, ())
forall a. Parser a -&gt; Parser (ByteString, a)
</span><span class="hs-identifier hs-var">A.match</span></span><span> </span><span class="annot"><span class="annottext">Parser ()
</span><a href="Skylighting.Tokenizer.html#pHex"><span class="hs-identifier hs-var">pHex</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138845"><span class="hs-identifier hs-var">inp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-660"></span><span>       </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TokenizerM Text
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><span class="hs-identifier hs-var">mzero</span></span><span>
</span><span id="line-661"></span><span>       </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679138844"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138844"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#takeChars"><span class="hs-identifier hs-var">takeChars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Int
</span><span class="hs-identifier hs-var">BS.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138844"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- assumes ascii</span><span>
</span><span id="line-662"></span><span>
</span><span id="line-663"></span><span class="annot"><a href="Skylighting.Tokenizer.html#pHex"><span class="hs-identifier hs-type">pHex</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">A.Parser</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-664"></span><span id="pHex"><span class="annot"><span class="annottext">pHex :: Parser ()
</span><a href="Skylighting.Tokenizer.html#pHex"><span class="hs-identifier hs-var hs-var">pHex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-665"></span><span>  </span><span class="annot"><span class="annottext">Parser ()
</span><a href="Skylighting.Tokenizer.html#mbMinus"><span class="hs-identifier hs-var">mbMinus</span></a></span><span>
</span><span id="line-666"></span><span>  </span><span class="annot"><span class="annottext">Char
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Parser Char
</span><span class="hs-identifier hs-var">A.char</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'0'</span></span><span>
</span><span id="line-667"></span><span>  </span><span class="annot"><span class="annottext">Char
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; Parser Char
</span><span class="hs-identifier hs-var">A.satisfy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Char -&gt; Bool
</span><span class="hs-identifier hs-var">A.inClass</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Xx&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-668"></span><span>  </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; Parser ByteString ByteString
</span><span class="hs-identifier hs-var">A.takeWhile1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Char -&gt; Bool
</span><span class="hs-identifier hs-var">A.inClass</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;0-9a-fA-F&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-669"></span><span>  </span><span class="annot"><span class="annottext">Parser ()
</span><a href="Skylighting.Tokenizer.html#guardWordBoundary"><span class="hs-identifier hs-var">guardWordBoundary</span></a></span><span>
</span><span id="line-670"></span><span>
</span><span id="line-671"></span><span class="annot"><a href="Skylighting.Tokenizer.html#guardWordBoundary"><span class="hs-identifier hs-type">guardWordBoundary</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">A.Parser</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-672"></span><span id="guardWordBoundary"><span class="annot"><span class="annottext">guardWordBoundary :: Parser ()
</span><a href="Skylighting.Tokenizer.html#guardWordBoundary"><span class="hs-identifier hs-var hs-var">guardWordBoundary</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-673"></span><span>  </span><span id="local-6989586621679138843"><span class="annot"><span class="annottext">Maybe Char
</span><a href="#local-6989586621679138843"><span class="hs-identifier hs-var">mbw</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Parser (Maybe Char)
</span><span class="hs-identifier hs-var">A.peekChar</span></span><span>
</span><span id="line-674"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Char
</span><a href="#local-6989586621679138843"><span class="hs-identifier hs-var">mbw</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-675"></span><span>       </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679138841"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138841"><span class="hs-identifier hs-var">c</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; Parser ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Parser ()) -&gt; Bool -&gt; Parser ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
</span><a href="Skylighting.Tokenizer.html#isWordBoundary"><span class="hs-identifier hs-var">isWordBoundary</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'0'</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138841"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-676"></span><span>       </span><span class="annot"><span class="annottext">Maybe Char
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; Parser ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-677"></span><span>
</span><span id="line-678"></span><span class="annot"><a href="Skylighting.Tokenizer.html#mbMinus"><span class="hs-identifier hs-type">mbMinus</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">A.Parser</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-679"></span><span id="mbMinus"><span class="annot"><span class="annottext">mbMinus :: Parser ()
</span><a href="Skylighting.Tokenizer.html#mbMinus"><span class="hs-identifier hs-var hs-var">mbMinus</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">() -&gt; Parser Char -&gt; Parser ()
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Parser Char
</span><span class="hs-identifier hs-var">A.char</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'-'</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Parser () -&gt; Parser () -&gt; Parser ()
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">() -&gt; Parser ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-680"></span><span>
</span><span id="line-681"></span><span class="annot"><a href="Skylighting.Tokenizer.html#mbPlusMinus"><span class="hs-identifier hs-type">mbPlusMinus</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">A.Parser</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-682"></span><span id="mbPlusMinus"><span class="annot"><span class="annottext">mbPlusMinus :: Parser ()
</span><a href="Skylighting.Tokenizer.html#mbPlusMinus"><span class="hs-identifier hs-var hs-var">mbPlusMinus</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">() -&gt; Parser Char -&gt; Parser ()
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; Parser Char
</span><span class="hs-identifier hs-var">A.satisfy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Char -&gt; Bool
</span><span class="hs-identifier hs-var">A.inClass</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;+-&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Parser () -&gt; Parser () -&gt; Parser ()
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">() -&gt; Parser ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-683"></span><span>
</span><span id="line-684"></span><span class="annot"><a href="Skylighting.Tokenizer.html#parseFloat"><span class="hs-identifier hs-type">parseFloat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Skylighting.Tokenizer.html#TokenizerM"><span class="hs-identifier hs-type">TokenizerM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-685"></span><span id="parseFloat"><span class="annot"><span class="annottext">parseFloat :: ByteString -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#parseFloat"><span class="hs-identifier hs-var hs-var">parseFloat</span></a></span></span><span> </span><span id="local-6989586621679138839"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138839"><span class="hs-identifier hs-var">inp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-686"></span><span>  </span><span class="annot"><span class="annottext">ByteString -&gt; TokenizerM ()
</span><a href="Skylighting.Tokenizer.html#wordBoundary"><span class="hs-identifier hs-var">wordBoundary</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138839"><span class="hs-identifier hs-var">inp</span></a></span><span>
</span><span id="line-687"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Parser (ByteString, ())
-&gt; ByteString -&gt; Either String (ByteString, ())
forall a. Parser a -&gt; ByteString -&gt; Either String a
</span><span class="hs-identifier hs-var">A.parseOnly</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Parser () -&gt; Parser (ByteString, ())
forall a. Parser a -&gt; Parser (ByteString, a)
</span><span class="hs-identifier hs-var">A.match</span></span><span> </span><span class="annot"><span class="annottext">Parser ()
</span><a href="#local-6989586621679138838"><span class="hs-identifier hs-var">pFloat</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138839"><span class="hs-identifier hs-var">inp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-688"></span><span>       </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TokenizerM Text
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><span class="hs-identifier hs-var">mzero</span></span><span>
</span><span id="line-689"></span><span>       </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679138837"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138837"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TokenizerM Text
</span><a href="Skylighting.Tokenizer.html#takeChars"><span class="hs-identifier hs-var">takeChars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Int
</span><span class="hs-identifier hs-var">BS.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679138837"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- assumes all ascii</span><span>
</span><span id="line-690"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span class="annot"><a href="#local-6989586621679138838"><span class="hs-identifier hs-type">pFloat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">A.Parser</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-691"></span><span>        </span><span id="local-6989586621679138838"><span class="annot"><span class="annottext">pFloat :: Parser ()
</span><a href="#local-6989586621679138838"><span class="hs-identifier hs-var hs-var">pFloat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-692"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679138836"><span class="annot"><span class="annottext">digits :: Parser ByteString ByteString
</span><a href="#local-6989586621679138836"><span class="hs-identifier hs-var hs-var">digits</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; Parser ByteString ByteString
</span><span class="hs-identifier hs-var">A.takeWhile1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Char -&gt; Bool
</span><span class="hs-identifier hs-var">A.inClass</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;0-9&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-693"></span><span>          </span><span class="annot"><span class="annottext">Parser ()
</span><a href="Skylighting.Tokenizer.html#mbPlusMinus"><span class="hs-identifier hs-var">mbPlusMinus</span></a></span><span>
</span><span id="line-694"></span><span>          </span><span id="local-6989586621679138835"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679138835"><span class="hs-identifier hs-var">before</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Parser ByteString Bool -&gt; Parser ByteString Bool
forall (f :: * -&gt; *) a. Alternative f =&gt; a -&gt; f a -&gt; f a
</span><span class="hs-identifier hs-var">A.option</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">(Parser ByteString Bool -&gt; Parser ByteString Bool)
-&gt; Parser ByteString Bool -&gt; Parser ByteString Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Parser ByteString ByteString -&gt; Parser ByteString Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">Parser ByteString ByteString
</span><a href="#local-6989586621679138836"><span class="hs-identifier hs-var">digits</span></a></span><span>
</span><span id="line-695"></span><span>          </span><span id="local-6989586621679138833"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679138833"><span class="hs-identifier hs-var">dot</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Parser ByteString Bool -&gt; Parser ByteString Bool
forall (f :: * -&gt; *) a. Alternative f =&gt; a -&gt; f a -&gt; f a
</span><span class="hs-identifier hs-var">A.option</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">(Parser ByteString Bool -&gt; Parser ByteString Bool)
-&gt; Parser ByteString Bool -&gt; Parser ByteString Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Parser Char -&gt; Parser ByteString Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; Parser Char
</span><span class="hs-identifier hs-var">A.satisfy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Char -&gt; Bool
</span><span class="hs-identifier hs-var">A.inClass</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-696"></span><span>          </span><span id="local-6989586621679138832"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679138832"><span class="hs-identifier hs-var">after</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Parser ByteString Bool -&gt; Parser ByteString Bool
forall (f :: * -&gt; *) a. Alternative f =&gt; a -&gt; f a -&gt; f a
</span><span class="hs-identifier hs-var">A.option</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">(Parser ByteString Bool -&gt; Parser ByteString Bool)
-&gt; Parser ByteString Bool -&gt; Parser ByteString Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Parser ByteString ByteString -&gt; Parser ByteString Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">Parser ByteString ByteString
</span><a href="#local-6989586621679138836"><span class="hs-identifier hs-var">digits</span></a></span><span>
</span><span id="line-697"></span><span>          </span><span id="local-6989586621679138831"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679138831"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Parser ByteString Bool -&gt; Parser ByteString Bool
forall (f :: * -&gt; *) a. Alternative f =&gt; a -&gt; f a -&gt; f a
</span><span class="hs-identifier hs-var">A.option</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">(Parser ByteString Bool -&gt; Parser ByteString Bool)
-&gt; Parser ByteString Bool -&gt; Parser ByteString Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Parser ByteString ByteString -&gt; Parser ByteString Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; Parser Char
</span><span class="hs-identifier hs-var">A.satisfy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Char -&gt; Bool
</span><span class="hs-identifier hs-var">A.inClass</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Ee&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Parser Char -&gt; Parser () -&gt; Parser ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span>
</span><span id="line-698"></span><span>                                         </span><span class="annot"><span class="annottext">Parser ()
</span><a href="Skylighting.Tokenizer.html#mbPlusMinus"><span class="hs-identifier hs-var">mbPlusMinus</span></a></span><span> </span><span class="annot"><span class="annottext">Parser ()
-&gt; Parser ByteString ByteString -&gt; Parser ByteString ByteString
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Parser ByteString ByteString
</span><a href="#local-6989586621679138836"><span class="hs-identifier hs-var">digits</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-699"></span><span>          </span><span id="local-6989586621679138830"><span class="annot"><span class="annottext">Maybe Char
</span><a href="#local-6989586621679138830"><span class="hs-identifier hs-var">mbnext</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Parser (Maybe Char)
</span><span class="hs-identifier hs-var">A.peekChar</span></span><span>
</span><span id="line-700"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Char
</span><a href="#local-6989586621679138830"><span class="hs-identifier hs-var">mbnext</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-701"></span><span>               </span><span class="annot"><span class="annottext">Maybe Char
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; Parser ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-702"></span><span>               </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679138829"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138829"><span class="hs-identifier hs-var">c</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Parser ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Char -&gt; Bool
</span><span class="hs-identifier hs-var">A.inClass</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.&quot;</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679138829"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-703"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; Parser ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Parser ()) -&gt; Bool -&gt; Parser ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679138835"><span class="hs-identifier hs-var">before</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679138833"><span class="hs-identifier hs-var">dot</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679138831"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>     </span><span class="hs-comment">-- 5e2</span><span>
</span><span id="line-704"></span><span>               </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679138835"><span class="hs-identifier hs-var">before</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679138833"><span class="hs-identifier hs-var">dot</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679138832"><span class="hs-identifier hs-var">after</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679138831"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- 5.2e2 or 5.2 or 5.</span><span>
</span><span id="line-705"></span><span>               </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679138835"><span class="hs-identifier hs-var">before</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679138833"><span class="hs-identifier hs-var">dot</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679138832"><span class="hs-identifier hs-var">after</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- .23 or .23e2</span><span>
</span><span id="line-706"></span><span>
</span><span id="line-707"></span></pre></body></html>