<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-2"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-3"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-4"></span><span class="hs-comment">-- Module      :  Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- Copyright   :  (C) Frank Staals</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- License     :  see the LICENSE file</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- Maintainer  :  Frank Staals</span><span>
</span><span id="line-8"></span><span class="hs-comment">--</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- The \(O((n+k)\log n)\) time line segment intersection algorithm by Bentley</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- and Ottmann.</span><span>
</span><span id="line-11"></span><span class="hs-comment">--</span><span>
</span><span id="line-12"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-13"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann</span><span>
</span><span id="line-14"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#intersections"><span class="hs-identifier">intersections</span></a></span><span>
</span><span id="line-15"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#interiorIntersections"><span class="hs-identifier">interiorIntersections</span></a></span><span>
</span><span id="line-16"></span><span>    </span><span class="hs-comment">-- FIXME: Move ordAt and xCoordAt to Data.Geometry.LineSegment?</span><span>
</span><span id="line-17"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#ordAt"><span class="hs-identifier">ordAt</span></a></span><span>
</span><span id="line-18"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#xCoordAt"><span class="hs-identifier">xCoordAt</span></a></span><span>
</span><span id="line-19"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-20"></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.Types.html"><span class="hs-identifier">Algorithms.Geometry.LineSegmentIntersection.Types</span></a></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">contains</span></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Ext</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">F</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Data.Geometry.Interval.html"><span class="hs-identifier">Data.Geometry.Interval</span></a></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Data.Geometry.LineSegment.html"><span class="hs-identifier">Data.Geometry.LineSegment</span></a></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Data.Geometry.Point.html"><span class="hs-identifier">Data.Geometry.Point</span></a></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Data.Geometry.Properties.html"><span class="hs-identifier">Data.Geometry.Properties</span></a></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.List.NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NonEmpty</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.List.NonEmpty</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NonEmpty</span></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Ord</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Down</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">comparing</span></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SS</span></span><span> </span><span class="hs-comment">-- status struct</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set.Util</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SS</span></span><span> </span><span class="hs-comment">-- status struct</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">EQ</span></span><span> </span><span class="hs-comment">-- event queue</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Vinyl</span></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Vinyl.CoRec</span></span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span class="hs-comment">-- | Compute all intersections</span><span>
</span><span id="line-44"></span><span class="hs-comment">--</span><span>
</span><span id="line-45"></span><span class="hs-comment">-- \(O((n+k)\log n)\), where \(k\) is the number of intersections.</span><span>
</span><span id="line-46"></span><span id="local-6989586621679932602"><span id="local-6989586621679932603"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#intersections"><span class="hs-identifier hs-type">intersections</span></a></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679932603"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679932603"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span>                 </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679932602"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932603"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.Types.html#Intersections"><span class="hs-identifier hs-type">Intersections</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932602"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932603"><span class="hs-identifier hs-type">r</span></a></span></span></span><span>
</span><span id="line-48"></span><span id="intersections"><span class="annot"><span class="annottext">intersections :: [LineSegment 2 p r] -&gt; Intersections p r
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#intersections"><span class="hs-identifier hs-var hs-var">intersections</span></a></span></span><span> </span><span id="local-6989586621679932410"><span class="annot"><span class="annottext">[LineSegment 2 p r]
</span><a href="#local-6989586621679932410"><span class="hs-identifier hs-var">ss</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[IntersectionPoint p r] -&gt; Intersections p r
forall r p. Ord r =&gt; [IntersectionPoint p r] -&gt; Intersections p r
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#merge"><span class="hs-identifier hs-var">merge</span></a></span><span> </span><span class="annot"><span class="annottext">([IntersectionPoint p r] -&gt; Intersections p r)
-&gt; [IntersectionPoint p r] -&gt; Intersections p r
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EventQueue p r -&gt; StatusStructure p r -&gt; [IntersectionPoint p r]
forall r p.
(Ord r, Fractional r) =&gt;
EventQueue p r -&gt; StatusStructure p r -&gt; [IntersectionPoint p r]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#sweep"><span class="hs-identifier hs-var">sweep</span></a></span><span> </span><span class="annot"><span class="annottext">EventQueue p r
</span><a href="#local-6989586621679932407"><span class="hs-identifier hs-var">pts</span></a></span><span> </span><span class="annot"><span class="annottext">StatusStructure p r
forall a. Set a
</span><span class="hs-identifier hs-var">SS.empty</span></span><span>
</span><span id="line-49"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-50"></span><span>    </span><span id="local-6989586621679932407"><span class="annot"><span class="annottext">pts :: EventQueue p r
</span><a href="#local-6989586621679932407"><span class="hs-identifier hs-var hs-var">pts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Event p r] -&gt; EventQueue p r
forall a. Eq a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">EQ.fromAscList</span></span><span> </span><span class="annot"><span class="annottext">([Event p r] -&gt; EventQueue p r)
-&gt; ([LineSegment 2 p r] -&gt; [Event p r])
-&gt; [LineSegment 2 p r]
-&gt; EventQueue p r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Event p r] -&gt; [Event p r]
forall r p. Eq r =&gt; [Event p r] -&gt; [Event p r]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#groupStarts"><span class="hs-identifier hs-var">groupStarts</span></a></span><span> </span><span class="annot"><span class="annottext">([Event p r] -&gt; [Event p r])
-&gt; ([LineSegment 2 p r] -&gt; [Event p r])
-&gt; [LineSegment 2 p r]
-&gt; [Event p r]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Event p r] -&gt; [Event p r]
forall a. Ord a =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">L.sort</span></span><span> </span><span class="annot"><span class="annottext">([Event p r] -&gt; [Event p r])
-&gt; ([LineSegment 2 p r] -&gt; [Event p r])
-&gt; [LineSegment 2 p r]
-&gt; [Event p r]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(LineSegment 2 p r -&gt; [Event p r])
-&gt; [LineSegment 2 p r] -&gt; [Event p r]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r -&gt; [Event p r]
forall r p. Ord r =&gt; LineSegment 2 p r -&gt; [Event p r]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#asEventPts"><span class="hs-identifier hs-var">asEventPts</span></a></span><span> </span><span class="annot"><span class="annottext">([LineSegment 2 p r] -&gt; EventQueue p r)
-&gt; [LineSegment 2 p r] -&gt; EventQueue p r
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r]
</span><a href="#local-6989586621679932410"><span class="hs-identifier hs-var">ss</span></a></span><span>
</span><span id="line-51"></span><span>
</span><span id="line-52"></span><span class="hs-comment">-- | Computes all intersection points p s.t. p lies in the interior of at least</span><span>
</span><span id="line-53"></span><span class="hs-comment">-- one of the segments.</span><span>
</span><span id="line-54"></span><span class="hs-comment">--</span><span>
</span><span id="line-55"></span><span class="hs-comment">--  \(O((n+k)\log n)\), where \(k\) is the number of intersections.</span><span>
</span><span id="line-56"></span><span id="local-6989586621679932398"><span id="local-6989586621679932399"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#interiorIntersections"><span class="hs-identifier hs-type">interiorIntersections</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679932399"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679932399"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span>                       </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679932398"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932399"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.Types.html#Intersections"><span class="hs-identifier hs-type">Intersections</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932398"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932399"><span class="hs-identifier hs-type">r</span></a></span></span></span><span>
</span><span id="line-58"></span><span id="interiorIntersections"><span class="annot"><span class="annottext">interiorIntersections :: [LineSegment 2 p r] -&gt; Intersections p r
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#interiorIntersections"><span class="hs-identifier hs-var hs-var">interiorIntersections</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Associated p r -&gt; Bool) -&gt; Intersections p r -&gt; Intersections p r
forall a k. (a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; (Associated p r -&gt; Bool) -&gt; Associated p r -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Associated p r -&gt; Bool
forall p r. Associated p r -&gt; Bool
</span><a href="Algorithms.Geometry.LineSegmentIntersection.Types.html#isEndPointIntersection"><span class="hs-identifier hs-var">isEndPointIntersection</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Intersections p r -&gt; Intersections p r)
-&gt; ([LineSegment 2 p r] -&gt; Intersections p r)
-&gt; [LineSegment 2 p r]
-&gt; Intersections p r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r] -&gt; Intersections p r
forall r p.
(Ord r, Fractional r) =&gt;
[LineSegment 2 p r] -&gt; Intersections p r
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#intersections"><span class="hs-identifier hs-var">intersections</span></a></span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span class="hs-comment">-- | Computes the event points for a given line segment</span><span>
</span><span id="line-61"></span><span id="local-6989586621679932612"><span id="local-6989586621679932613"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#asEventPts"><span class="hs-identifier hs-type">asEventPts</span></a></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679932613"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679932612"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932613"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932612"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932613"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-62"></span><span id="asEventPts"><span class="annot"><span class="annottext">asEventPts :: LineSegment 2 p r -&gt; [Event p r]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#asEventPts"><span class="hs-identifier hs-var hs-var">asEventPts</span></a></span></span><span> </span><span id="local-6989586621679932394"><span class="annot"><span class="annottext">LineSegment 2 p r
</span><a href="#local-6989586621679932394"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">[</span><span id="local-6989586621679932393"><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679932393"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679932392"><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679932392"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Point 2 r -&gt; Point 2 r -&gt; Ordering) -&gt; [Point 2 r] -&gt; [Point 2 r]
forall a. (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">L.sortBy</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Point 2 r -&gt; Ordering
forall r. Ord r =&gt; Point 2 r -&gt; Point 2 r -&gt; Ordering
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#ordPoints"><span class="hs-identifier hs-var">ordPoints</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">LineSegment 2 p r
</span><a href="#local-6989586621679932394"><span class="hs-identifier hs-var">s</span></a></span><span class="annot"><span class="annottext">LineSegment 2 p r
-&gt; Getting (Point 2 r) (LineSegment 2 p r) (Point 2 r) -&gt; Point 2 r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">((Point 2 r :+ p) -&gt; Const (Point 2 r) (Point 2 r :+ p))
-&gt; LineSegment 2 p r -&gt; Const (Point 2 r) (LineSegment 2 p r)
forall t. HasStart t =&gt; Lens' t (StartCore t :+ StartExtra t)
</span><a href="Data.Geometry.Interval.html#start"><span class="hs-identifier hs-var">start</span></a></span><span class="annot"><span class="annottext">(((Point 2 r :+ p) -&gt; Const (Point 2 r) (Point 2 r :+ p))
 -&gt; LineSegment 2 p r -&gt; Const (Point 2 r) (LineSegment 2 p r))
-&gt; ((Point 2 r -&gt; Const (Point 2 r) (Point 2 r))
    -&gt; (Point 2 r :+ p) -&gt; Const (Point 2 r) (Point 2 r :+ p))
-&gt; Getting (Point 2 r) (LineSegment 2 p r) (Point 2 r)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(Point 2 r -&gt; Const (Point 2 r) (Point 2 r))
-&gt; (Point 2 r :+ p) -&gt; Const (Point 2 r) (Point 2 r :+ p)
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">LineSegment 2 p r
</span><a href="#local-6989586621679932394"><span class="hs-identifier hs-var">s</span></a></span><span class="annot"><span class="annottext">LineSegment 2 p r
-&gt; Getting (Point 2 r) (LineSegment 2 p r) (Point 2 r) -&gt; Point 2 r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">((Point 2 r :+ p) -&gt; Const (Point 2 r) (Point 2 r :+ p))
-&gt; LineSegment 2 p r -&gt; Const (Point 2 r) (LineSegment 2 p r)
forall t. HasEnd t =&gt; Lens' t (EndCore t :+ EndExtra t)
</span><a href="Data.Geometry.Interval.html#end"><span class="hs-identifier hs-var">end</span></a></span><span class="annot"><span class="annottext">(((Point 2 r :+ p) -&gt; Const (Point 2 r) (Point 2 r :+ p))
 -&gt; LineSegment 2 p r -&gt; Const (Point 2 r) (LineSegment 2 p r))
-&gt; ((Point 2 r -&gt; Const (Point 2 r) (Point 2 r))
    -&gt; (Point 2 r :+ p) -&gt; Const (Point 2 r) (Point 2 r :+ p))
-&gt; Getting (Point 2 r) (LineSegment 2 p r) (Point 2 r)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(Point 2 r -&gt; Const (Point 2 r) (Point 2 r))
-&gt; (Point 2 r :+ p) -&gt; Const (Point 2 r) (Point 2 r :+ p)
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="hs-special">]</span><span>
</span><span id="line-63"></span><span>               </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Point 2 r -&gt; EventType (LineSegment 2 p r) -&gt; Event p r
forall p r. Point 2 r -&gt; EventType (LineSegment 2 p r) -&gt; Event p r
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-var">Event</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679932393"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty (LineSegment 2 p r) -&gt; EventType (LineSegment 2 p r)
forall s. NonEmpty s -&gt; EventType s
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Start"><span class="hs-identifier hs-var">Start</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty (LineSegment 2 p r) -&gt; EventType (LineSegment 2 p r))
-&gt; NonEmpty (LineSegment 2 p r) -&gt; EventType (LineSegment 2 p r)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r
</span><a href="#local-6989586621679932394"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r
-&gt; [LineSegment 2 p r] -&gt; NonEmpty (LineSegment 2 p r)
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">:|</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; EventType (LineSegment 2 p r) -&gt; Event p r
forall p r. Point 2 r -&gt; EventType (LineSegment 2 p r) -&gt; Event p r
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-var">Event</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679932392"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LineSegment 2 p r -&gt; EventType (LineSegment 2 p r)
forall s. s -&gt; EventType s
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#End"><span class="hs-identifier hs-var">End</span></a></span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r
</span><a href="#local-6989586621679932394"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span class="hs-comment">-- | Group the segments with the intersection points</span><span>
</span><span id="line-66"></span><span id="local-6989586621679932634"><span id="local-6989586621679932635"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#merge"><span class="hs-identifier hs-type">merge</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679932635"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.Types.html#IntersectionPoint"><span class="hs-identifier hs-type">IntersectionPoint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932634"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932635"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.Types.html#Intersections"><span class="hs-identifier hs-type">Intersections</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932634"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932635"><span class="hs-identifier hs-type">r</span></a></span></span></span><span>
</span><span id="line-67"></span><span id="merge"><span class="annot"><span class="annottext">merge :: [IntersectionPoint p r] -&gt; Intersections p r
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#merge"><span class="hs-identifier hs-var hs-var">merge</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(IntersectionPoint p r -&gt; Intersections p r -&gt; Intersections p r)
-&gt; Intersections p r
-&gt; [IntersectionPoint p r]
-&gt; Intersections p r
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.Types.html#IntersectionPoint"><span class="hs-identifier hs-type">IntersectionPoint</span></a></span><span> </span><span id="local-6989586621679932379"><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679932379"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679932378"><span class="annot"><span class="annottext">Associated p r
</span><a href="#local-6989586621679932378"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Associated p r -&gt; Associated p r -&gt; Associated p r)
-&gt; Point 2 r
-&gt; Associated p r
-&gt; Intersections p r
-&gt; Intersections p r
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.insertWith</span></span><span> </span><span class="annot"><span class="annottext">Associated p r -&gt; Associated p r -&gt; Associated p r
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(&lt;&gt;)</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679932379"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Associated p r
</span><a href="#local-6989586621679932378"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Intersections p r
forall k a. Map k a
</span><span class="hs-identifier hs-var">M.empty</span></span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span class="hs-comment">-- | Group the startpoints such that segments with the same start point</span><span>
</span><span id="line-70"></span><span class="hs-comment">-- correspond to one event.</span><span>
</span><span id="line-71"></span><span id="local-6989586621679932618"><span id="local-6989586621679932619"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#groupStarts"><span class="hs-identifier hs-type">groupStarts</span></a></span><span>                          </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679932619"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932618"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932619"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932618"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932619"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-72"></span><span id="groupStarts"><span class="annot"><span class="annottext">groupStarts :: [Event p r] -&gt; [Event p r]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#groupStarts"><span class="hs-identifier hs-var hs-var">groupStarts</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>                       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-73"></span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#groupStarts"><span class="hs-identifier hs-var">groupStarts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span id="local-6989586621679932375"><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679932375"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Start"><span class="hs-identifier hs-type">Start</span></a></span><span> </span><span id="local-6989586621679932374"><span class="annot"><span class="annottext">NonEmpty (LineSegment 2 p r)
</span><a href="#local-6989586621679932374"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679932373"><span class="annot"><span class="annottext">[Event p r]
</span><a href="#local-6989586621679932373"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; EventType (LineSegment 2 p r) -&gt; Event p r
forall p r. Point 2 r -&gt; EventType (LineSegment 2 p r) -&gt; Event p r
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-var">Event</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679932375"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty (LineSegment 2 p r) -&gt; EventType (LineSegment 2 p r)
forall s. NonEmpty s -&gt; EventType s
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Start"><span class="hs-identifier hs-var">Start</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (LineSegment 2 p r)
</span><a href="#local-6989586621679932372"><span class="hs-identifier hs-var">ss</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Event p r -&gt; [Event p r] -&gt; [Event p r]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Event p r] -&gt; [Event p r]
forall r p. Eq r =&gt; [Event p r] -&gt; [Event p r]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#groupStarts"><span class="hs-identifier hs-var">groupStarts</span></a></span><span> </span><span class="annot"><span class="annottext">[Event p r]
</span><a href="#local-6989586621679932371"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-74"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-75"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679932370"><span class="annot"><span class="annottext">[Event p r]
</span><a href="#local-6989586621679932370"><span class="hs-identifier hs-var">ss'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679932371"><span class="annot"><span class="annottext">[Event p r]
</span><a href="#local-6989586621679932371"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Event p r -&gt; Bool) -&gt; [Event p r] -&gt; ([Event p r], [Event p r])
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">L.span</span></span><span> </span><span class="annot"><span class="annottext">Event p r -&gt; Bool
</span><a href="#local-6989586621679932368"><span class="hs-identifier hs-var">sameStart</span></a></span><span> </span><span class="annot"><span class="annottext">[Event p r]
</span><a href="#local-6989586621679932373"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-76"></span><span>    </span><span class="hs-comment">-- sort the segs on lower endpoint</span><span>
</span><span id="line-77"></span><span>    </span><span id="local-6989586621679932372"><span class="annot"><span class="annottext">ss :: NonEmpty (LineSegment 2 p r)
</span><a href="#local-6989586621679932372"><span class="hs-identifier hs-var hs-var">ss</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679932367"><span class="annot"><span class="annottext">LineSegment 2 p r
</span><a href="#local-6989586621679932367"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span id="local-6989586621679932366"><span class="annot"><span class="annottext">[LineSegment 2 p r]
</span><a href="#local-6989586621679932366"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty (LineSegment 2 p r)
</span><a href="#local-6989586621679932374"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r
</span><a href="#local-6989586621679932367"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r
-&gt; [LineSegment 2 p r] -&gt; NonEmpty (LineSegment 2 p r)
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">:|</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[LineSegment 2 p r]
</span><a href="#local-6989586621679932366"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r] -&gt; [LineSegment 2 p r] -&gt; [LineSegment 2 p r]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">(Event p r -&gt; [LineSegment 2 p r])
-&gt; [Event p r] -&gt; [LineSegment 2 p r]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">Event p r -&gt; [LineSegment 2 p r]
forall p r. Event p r -&gt; [LineSegment 2 p r]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#startSegs"><span class="hs-identifier hs-var">startSegs</span></a></span><span> </span><span class="annot"><span class="annottext">[Event p r]
</span><a href="#local-6989586621679932370"><span class="hs-identifier hs-var">ss'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span>    </span><span id="local-6989586621679932368"><span class="annot"><span class="annottext">sameStart :: Event p r -&gt; Bool
</span><a href="#local-6989586621679932368"><span class="hs-identifier hs-var hs-var">sameStart</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span id="local-6989586621679932364"><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679932364"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Start"><span class="hs-identifier hs-type">Start</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (LineSegment 2 p r)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679932375"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Point 2 r -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679932364"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-80"></span><span>    </span><span class="annot"><a href="#local-6989586621679932368"><span class="hs-identifier hs-var">sameStart</span></a></span><span> </span><span class="annot"><span class="annottext">Event p r
</span><span class="hs-identifier">_</span></span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-81"></span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#groupStarts"><span class="hs-identifier hs-var">groupStarts</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679932363"><span class="annot"><span class="annottext">Event p r
</span><a href="#local-6989586621679932363"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679932362"><span class="annot"><span class="annottext">[Event p r]
</span><a href="#local-6989586621679932362"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-special">)</span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Event p r
</span><a href="#local-6989586621679932363"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Event p r -&gt; [Event p r] -&gt; [Event p r]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Event p r] -&gt; [Event p r]
forall r p. Eq r =&gt; [Event p r] -&gt; [Event p r]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#groupStarts"><span class="hs-identifier hs-var">groupStarts</span></a></span><span> </span><span class="annot"><span class="annottext">[Event p r]
</span><a href="#local-6989586621679932362"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-82"></span><span>
</span><span id="line-83"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-84"></span><span class="hs-comment">-- * Data type for Events</span><span>
</span><span id="line-85"></span><span>
</span><span id="line-86"></span><span class="hs-comment">-- | Type of segment</span><span>
</span><span id="line-87"></span><span class="hs-keyword">data</span><span> </span><span id="EventType"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#EventType"><span class="hs-identifier hs-var">EventType</span></a></span></span><span> </span><span id="local-6989586621679932574"><span class="annot"><a href="#local-6989586621679932574"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Start"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Start"><span class="hs-identifier hs-var">Start</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="annot"><a href="#local-6989586621679932574"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-glyph">|</span><span> </span><span id="Intersection"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Intersection"><span class="hs-identifier hs-var">Intersection</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="End"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#End"><span class="hs-identifier hs-var">End</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="#local-6989586621679932574"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679932355"><span id="local-6989586621679932357"><span id="local-6989586621679932359"><span class="annot"><span class="annottext">Int -&gt; EventType s -&gt; ShowS
[EventType s] -&gt; ShowS
EventType s -&gt; String
(Int -&gt; EventType s -&gt; ShowS)
-&gt; (EventType s -&gt; String)
-&gt; ([EventType s] -&gt; ShowS)
-&gt; Show (EventType s)
forall s. Show s =&gt; Int -&gt; EventType s -&gt; ShowS
forall s. Show s =&gt; [EventType s] -&gt; ShowS
forall s. Show s =&gt; EventType s -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [EventType s] -&gt; ShowS
$cshowList :: forall s. Show s =&gt; [EventType s] -&gt; ShowS
show :: EventType s -&gt; String
$cshow :: forall s. Show s =&gt; EventType s -&gt; String
showsPrec :: Int -&gt; EventType s -&gt; ShowS
$cshowsPrec :: forall s. Show s =&gt; Int -&gt; EventType s -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span id="local-6989586621679932353"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679932350"><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#EventType"><span class="hs-identifier hs-type">EventType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932353"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-90"></span><span>  </span><span id="local-6989586621679932348"><span class="annot"><span class="annottext">EventType s
</span><a href="#local-6989586621679932348"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679932347"><span class="annot"><span class="annottext">== :: EventType s -&gt; EventType s -&gt; Bool
</span><span class="hs-operator hs-var hs-var hs-var hs-var">==</span></span></span><span> </span><span id="local-6989586621679932346"><span class="annot"><span class="annottext">EventType s
</span><a href="#local-6989586621679932346"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EventType s
</span><a href="#local-6989586621679932348"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">EventType s -&gt; EventType s -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-operator hs-var">`compare`</span></span><span> </span><span class="annot"><span class="annottext">EventType s
</span><a href="#local-6989586621679932346"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Ordering -&gt; Ordering -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span></span><span>
</span><span id="line-91"></span><span>
</span><span id="line-92"></span><span id="local-6989586621679932344"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679932330"><span id="local-6989586621679932332"><span id="local-6989586621679932334"><span id="local-6989586621679932336"><span id="local-6989586621679932338"><span id="local-6989586621679932340"><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#EventType"><span class="hs-identifier hs-type">EventType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932344"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-93"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Start"><span class="hs-identifier hs-type">Start</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty s
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>    </span><span id="local-6989586621679932328"><span class="annot"><span class="annottext">compare :: EventType s -&gt; EventType s -&gt; Ordering
</span><a href="#local-6989586621679932328"><span class="hs-operator hs-var hs-var hs-var hs-var">`compare`</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Start"><span class="hs-identifier hs-type">Start</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty s
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span>
</span><span id="line-94"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Start"><span class="hs-identifier hs-type">Start</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty s
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>    </span><span class="annot"><span class="hs-operator hs-var">`compare`</span></span><span> </span><span class="annot"><span class="annottext">EventType s
</span><span class="hs-identifier">_</span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">LT</span></span><span>
</span><span id="line-95"></span><span>  </span><span class="annot"><span class="annottext">EventType s
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Intersection"><span class="hs-identifier hs-var">Intersection</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-var">`compare`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Start"><span class="hs-identifier hs-type">Start</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty s
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">GT</span></span><span>
</span><span id="line-96"></span><span>  </span><span class="annot"><span class="annottext">EventType s
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Intersection"><span class="hs-identifier hs-var">Intersection</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-var">`compare`</span></span><span> </span><span class="annot"><span class="annottext">EventType s
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Intersection"><span class="hs-identifier hs-var">Intersection</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span>
</span><span id="line-97"></span><span>  </span><span class="annot"><span class="annottext">EventType s
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Intersection"><span class="hs-identifier hs-var">Intersection</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-var">`compare`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#End"><span class="hs-identifier hs-type">End</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">LT</span></span><span>
</span><span id="line-98"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#End"><span class="hs-identifier hs-type">End</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>      </span><span class="annot"><span class="hs-operator hs-var">`compare`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#End"><span class="hs-identifier hs-type">End</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span>
</span><span id="line-99"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#End"><span class="hs-identifier hs-type">End</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>      </span><span class="annot"><span class="hs-operator hs-var">`compare`</span></span><span> </span><span class="annot"><span class="annottext">EventType s
</span><span class="hs-identifier">_</span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">GT</span></span></span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span class="hs-comment">-- | The actual event consists of a point and its type</span><span>
</span><span id="line-102"></span><span class="hs-keyword">data</span><span> </span><span id="Event"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-var">Event</span></a></span></span><span> </span><span id="local-6989586621679932576"><span class="annot"><a href="#local-6989586621679932576"><span class="hs-identifier hs-type">p</span></a></span></span><span> </span><span id="local-6989586621679932577"><span class="annot"><a href="#local-6989586621679932577"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Event"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-var">Event</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="eventPoint"><span class="annot"><span class="annottext">Event p r -&gt; Point 2 r
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#eventPoint"><span class="hs-identifier hs-var hs-var">eventPoint</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679932577"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span>                       </span><span class="hs-special">,</span><span> </span><span id="eventType"><span class="annot"><span class="annottext">Event p r -&gt; EventType (LineSegment 2 p r)
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#eventType"><span class="hs-identifier hs-var hs-var">eventType</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#EventType"><span class="hs-identifier hs-type">EventType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679932576"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932577"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span>                       </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679932320"><span id="local-6989586621679932322"><span id="local-6989586621679932324"><span class="annot"><span class="annottext">Int -&gt; Event p r -&gt; ShowS
[Event p r] -&gt; ShowS
Event p r -&gt; String
(Int -&gt; Event p r -&gt; ShowS)
-&gt; (Event p r -&gt; String)
-&gt; ([Event p r] -&gt; ShowS)
-&gt; Show (Event p r)
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
forall p r. (Show r, Show p) =&gt; Int -&gt; Event p r -&gt; ShowS
forall p r. (Show r, Show p) =&gt; [Event p r] -&gt; ShowS
forall p r. (Show r, Show p) =&gt; Event p r -&gt; String
showList :: [Event p r] -&gt; ShowS
$cshowList :: forall p r. (Show r, Show p) =&gt; [Event p r] -&gt; ShowS
show :: Event p r -&gt; String
$cshow :: forall p r. (Show r, Show p) =&gt; Event p r -&gt; String
showsPrec :: Int -&gt; Event p r -&gt; ShowS
$cshowsPrec :: forall p r. (Show r, Show p) =&gt; Int -&gt; Event p r -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span id="local-6989586621679932316"><span id="local-6989586621679932318"><span class="annot"><span class="annottext">Event p r -&gt; Event p r -&gt; Bool
(Event p r -&gt; Event p r -&gt; Bool)
-&gt; (Event p r -&gt; Event p r -&gt; Bool) -&gt; Eq (Event p r)
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
forall p r. Eq r =&gt; Event p r -&gt; Event p r -&gt; Bool
/= :: Event p r -&gt; Event p r -&gt; Bool
$c/= :: forall p r. Eq r =&gt; Event p r -&gt; Event p r -&gt; Bool
== :: Event p r -&gt; Event p r -&gt; Bool
$c== :: forall p r. Eq r =&gt; Event p r -&gt; Event p r -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span id="local-6989586621679932314"><span id="local-6989586621679932315"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679932300"><span id="local-6989586621679932302"><span id="local-6989586621679932304"><span id="local-6989586621679932306"><span id="local-6989586621679932308"><span id="local-6989586621679932310"><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679932315"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932314"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932315"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-107"></span><span>  </span><span class="hs-comment">-- decreasing on the y-coord, then increasing on x-coord, and increasing on event-type</span><span>
</span><span id="line-108"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span id="local-6989586621679932299"><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679932299"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679932298"><span class="annot"><span class="annottext">EventType (LineSegment 2 p r)
</span><a href="#local-6989586621679932298"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679932297"><span class="annot"><span class="annottext">compare :: Event p r -&gt; Event p r -&gt; Ordering
</span><a href="#local-6989586621679932297"><span class="hs-operator hs-var hs-var hs-var hs-var">`compare`</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span id="local-6989586621679932296"><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679932296"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621679932295"><span class="annot"><span class="annottext">EventType (LineSegment 2 p r)
</span><a href="#local-6989586621679932295"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Point 2 r -&gt; Ordering
forall r. Ord r =&gt; Point 2 r -&gt; Point 2 r -&gt; Ordering
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#ordPoints"><span class="hs-identifier hs-var">ordPoints</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679932299"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679932296"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-109"></span><span>                                        </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">EventType (LineSegment 2 p r)
</span><a href="#local-6989586621679932298"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">EventType (LineSegment 2 p r)
-&gt; EventType (LineSegment 2 p r) -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-operator hs-var">`compare`</span></span><span> </span><span class="annot"><span class="annottext">EventType (LineSegment 2 p r)
</span><a href="#local-6989586621679932295"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-110"></span><span>                                        </span><span id="local-6989586621679932294"><span class="annot"><span class="annottext">Ordering
</span><a href="#local-6989586621679932294"><span class="hs-identifier hs-var">x</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><a href="#local-6989586621679932294"><span class="hs-identifier hs-var">x</span></a></span></span></span><span>
</span><span id="line-111"></span><span>
</span><span id="line-112"></span><span class="hs-comment">-- | An ordering that is decreasing on y, increasing on x</span><span>
</span><span id="line-113"></span><span id="local-6989586621679932597"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#ordPoints"><span class="hs-identifier hs-type">ordPoints</span></a></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679932597"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679932597"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679932597"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ordering</span></span></span><span>
</span><span id="line-114"></span><span id="ordPoints"><span class="annot"><span class="annottext">ordPoints :: Point 2 r -&gt; Point 2 r -&gt; Ordering
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#ordPoints"><span class="hs-identifier hs-var hs-var">ordPoints</span></a></span></span><span> </span><span id="local-6989586621679932293"><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679932293"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679932292"><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679932292"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679932291"><span class="annot"><span class="annottext">f :: point d b -&gt; (Down b, b)
</span><a href="#local-6989586621679932291"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679932290"><span class="annot"><span class="annottext">point d b
</span><a href="#local-6989586621679932290"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b -&gt; Down b
forall a. a -&gt; Down a
</span><span class="hs-identifier hs-var">Down</span></span><span> </span><span class="annot"><span class="annottext">(b -&gt; Down b) -&gt; b -&gt; Down b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">point d b
</span><a href="#local-6989586621679932290"><span class="hs-identifier hs-var">p</span></a></span><span class="annot"><span class="annottext">point d b -&gt; Getting b (point d b) b -&gt; b
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting b (point d b) b
forall (d :: Nat) (point :: Nat -&gt; * -&gt; *) r.
(2 &lt;= d, Arity d, AsAPoint point) =&gt;
Lens' (point d r) r
</span><a href="Data.Geometry.Point.Class.html#yCoord"><span class="hs-identifier hs-var">yCoord</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">point d b
</span><a href="#local-6989586621679932290"><span class="hs-identifier hs-var">p</span></a></span><span class="annot"><span class="annottext">point d b -&gt; Getting b (point d b) b -&gt; b
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting b (point d b) b
forall (d :: Nat) (point :: Nat -&gt; * -&gt; *) r.
(1 &lt;= d, Arity d, AsAPoint point) =&gt;
Lens' (point d r) r
</span><a href="Data.Geometry.Point.Class.html#xCoord"><span class="hs-identifier hs-var">xCoord</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(Point 2 r -&gt; (Down r, r)) -&gt; Point 2 r -&gt; Point 2 r -&gt; Ordering
forall a b. Ord a =&gt; (b -&gt; a) -&gt; b -&gt; b -&gt; Ordering
</span><span class="hs-identifier hs-var">comparing</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; (Down r, r)
forall (d :: Nat) (point :: Nat -&gt; * -&gt; *) b.
(ImplicitPeano (Peano d), ArityPeano (Peano (FromPeano (Peano d))),
 KnownNat (FromPeano (Peano d)), KnownNat d, AsAPoint point,
 (1 &lt;=? d) ~ 'True, (2 &lt;=? d) ~ 'True,
 Peano (FromPeano (Peano d) + 1)
 ~ 'S (Peano (FromPeano (Peano d)))) =&gt;
point d b -&gt; (Down b, b)
</span><a href="#local-6989586621679932291"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679932293"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679932292"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span class="hs-comment">-- | Get the segments that start at the given event point</span><span>
</span><span id="line-117"></span><span id="local-6989586621679932556"><span id="local-6989586621679932557"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#startSegs"><span class="hs-identifier hs-type">startSegs</span></a></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932557"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932556"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679932557"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932556"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-118"></span><span id="startSegs"><span class="annot"><span class="annottext">startSegs :: Event p r -&gt; [LineSegment 2 p r]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#startSegs"><span class="hs-identifier hs-var hs-var">startSegs</span></a></span></span><span> </span><span id="local-6989586621679932286"><span class="annot"><span class="annottext">Event p r
</span><a href="#local-6989586621679932286"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Event p r -&gt; EventType (LineSegment 2 p r)
forall p r. Event p r -&gt; EventType (LineSegment 2 p r)
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#eventType"><span class="hs-identifier hs-var hs-var">eventType</span></a></span><span> </span><span class="annot"><span class="annottext">Event p r
</span><a href="#local-6989586621679932286"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-119"></span><span>                </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Start"><span class="hs-identifier hs-type">Start</span></a></span><span> </span><span id="local-6989586621679932285"><span class="annot"><span class="annottext">NonEmpty (LineSegment 2 p r)
</span><a href="#local-6989586621679932285"><span class="hs-identifier hs-var">ss</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NonEmpty (LineSegment 2 p r) -&gt; [LineSegment 2 p r]
forall a. NonEmpty a -&gt; [a]
</span><span class="hs-identifier hs-var">NonEmpty.toList</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty (LineSegment 2 p r)
</span><a href="#local-6989586621679932285"><span class="hs-identifier hs-var">ss</span></a></span><span>
</span><span id="line-120"></span><span>                </span><span class="annot"><span class="annottext">EventType (LineSegment 2 p r)
</span><span class="hs-identifier">_</span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-121"></span><span>
</span><span id="line-122"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span class="hs-comment">-- | Compare based on the x-coordinate of the intersection with the horizontal</span><span>
</span><span id="line-125"></span><span class="hs-comment">-- line through y</span><span>
</span><span id="line-126"></span><span id="local-6989586621679932445"><span id="local-6989586621679932446"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#ordAt"><span class="hs-identifier hs-type">ordAt</span></a></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679932446"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679932446"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679932446"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.Types.html#Compare"><span class="hs-identifier hs-type">Compare</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679932445"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932446"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-127"></span><span id="ordAt"><span class="annot"><span class="annottext">ordAt :: r -&gt; Compare (LineSegment 2 p r)
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#ordAt"><span class="hs-identifier hs-var hs-var">ordAt</span></a></span></span><span> </span><span id="local-6989586621679932283"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679932283"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LineSegment 2 p r -&gt; r) -&gt; Compare (LineSegment 2 p r)
forall a b. Ord a =&gt; (b -&gt; a) -&gt; b -&gt; b -&gt; Ordering
</span><span class="hs-identifier hs-var">comparing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">r -&gt; LineSegment 2 p r -&gt; r
forall r p. (Fractional r, Ord r) =&gt; r -&gt; LineSegment 2 p r -&gt; r
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#xCoordAt"><span class="hs-identifier hs-var">xCoordAt</span></a></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679932283"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span class="hs-comment">-- | Given a y coord and a line segment that intersects the horizontal line</span><span>
</span><span id="line-130"></span><span class="hs-comment">-- through y, compute the x-coordinate of this intersection point.</span><span>
</span><span id="line-131"></span><span class="hs-comment">--</span><span>
</span><span id="line-132"></span><span class="hs-comment">-- note that we will pretend that the line segment is closed, even if it is not</span><span>
</span><span id="line-133"></span><span id="local-6989586621679932507"><span id="local-6989586621679932508"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#xCoordAt"><span class="hs-identifier hs-type">xCoordAt</span></a></span><span>             </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679932508"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679932508"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679932508"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679932507"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932508"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679932508"><span class="hs-identifier hs-type">r</span></a></span></span></span><span>
</span><span id="line-134"></span><span id="xCoordAt"><span class="annot"><span class="annottext">xCoordAt :: r -&gt; LineSegment 2 p r -&gt; r
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#xCoordAt"><span class="hs-identifier hs-var hs-var">xCoordAt</span></a></span></span><span> </span><span id="local-6989586621679932282"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679932282"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment%27"><span class="hs-identifier hs-type">LineSegment'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point2"><span class="hs-identifier hs-type">Point2</span></a></span><span> </span><span id="local-6989586621679932279"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679932279"><span class="hs-identifier hs-var">px</span></a></span></span><span> </span><span id="local-6989586621679932278"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679932278"><span class="hs-identifier hs-var">py</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point2"><span class="hs-identifier hs-type">Point2</span></a></span><span> </span><span id="local-6989586621679932276"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679932276"><span class="hs-identifier hs-var">qx</span></a></span></span><span> </span><span id="local-6989586621679932275"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679932275"><span class="hs-identifier hs-var">qy</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-135"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679932278"><span class="hs-identifier hs-var">py</span></a></span><span> </span><span class="annot"><span class="annottext">r -&gt; r -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679932275"><span class="hs-identifier hs-var">qy</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679932279"><span class="hs-identifier hs-var">px</span></a></span><span> </span><span class="annot"><span class="annottext">r -&gt; r -&gt; r
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`max`</span></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679932276"><span class="hs-identifier hs-var">qx</span></a></span><span>  </span><span class="hs-comment">-- s is horizontal, and since it by the</span><span>
</span><span id="line-136"></span><span>                                    </span><span class="hs-comment">-- precondition it intersects the sweep</span><span>
</span><span id="line-137"></span><span>                                    </span><span class="hs-comment">-- line, we return the x-coord of the</span><span>
</span><span id="line-138"></span><span>                                    </span><span class="hs-comment">-- rightmost endpoint.</span><span>
</span><span id="line-139"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679932279"><span class="hs-identifier hs-var">px</span></a></span><span> </span><span class="annot"><span class="annottext">r -&gt; r -&gt; r
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679932272"><span class="hs-identifier hs-var">alpha</span></a></span><span> </span><span class="annot"><span class="annottext">r -&gt; r -&gt; r
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679932276"><span class="hs-identifier hs-var">qx</span></a></span><span> </span><span class="annot"><span class="annottext">r -&gt; r -&gt; r
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679932279"><span class="hs-identifier hs-var">px</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-141"></span><span>    </span><span id="local-6989586621679932272"><span class="annot"><span class="annottext">alpha :: r
</span><a href="#local-6989586621679932272"><span class="hs-identifier hs-var hs-var">alpha</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679932282"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">r -&gt; r -&gt; r
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679932278"><span class="hs-identifier hs-var">py</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">r -&gt; r -&gt; r
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679932275"><span class="hs-identifier hs-var">qy</span></a></span><span> </span><span class="annot"><span class="annottext">r -&gt; r -&gt; r
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679932278"><span class="hs-identifier hs-var">py</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-144"></span><span class="hs-comment">-- * The Main Sweep</span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span class="hs-keyword">type</span><span> </span><span id="EventQueue"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#EventQueue"><span class="hs-identifier hs-var">EventQueue</span></a></span></span><span>      </span><span id="local-6989586621679932269"><span class="annot"><a href="#local-6989586621679932269"><span class="hs-identifier hs-type">p</span></a></span></span><span> </span><span id="local-6989586621679932268"><span class="annot"><a href="#local-6989586621679932268"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EQ.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932269"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932268"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-147"></span><span class="hs-keyword">type</span><span> </span><span id="StatusStructure"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#StatusStructure"><span class="hs-identifier hs-var">StatusStructure</span></a></span></span><span> </span><span id="local-6989586621679932267"><span class="annot"><a href="#local-6989586621679932267"><span class="hs-identifier hs-type">p</span></a></span></span><span> </span><span id="local-6989586621679932266"><span class="annot"><a href="#local-6989586621679932266"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SS.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679932267"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932266"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span>
</span><span id="line-149"></span><span class="hs-comment">-- | Run the sweep handling all events</span><span>
</span><span id="line-150"></span><span id="local-6989586621679932627"><span id="local-6989586621679932628"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#sweep"><span class="hs-identifier hs-type">sweep</span></a></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679932628"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679932628"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span>            </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#EventQueue"><span class="hs-identifier hs-type">EventQueue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932627"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932628"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#StatusStructure"><span class="hs-identifier hs-type">StatusStructure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932627"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932628"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.Types.html#IntersectionPoint"><span class="hs-identifier hs-type">IntersectionPoint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932627"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932628"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-152"></span><span id="sweep"><span class="annot"><span class="annottext">sweep :: EventQueue p r -&gt; StatusStructure p r -&gt; [IntersectionPoint p r]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#sweep"><span class="hs-identifier hs-var hs-var">sweep</span></a></span></span><span> </span><span id="local-6989586621679932265"><span class="annot"><span class="annottext">EventQueue p r
</span><a href="#local-6989586621679932265"><span class="hs-identifier hs-var">eq</span></a></span></span><span> </span><span id="local-6989586621679932264"><span class="annot"><span class="annottext">StatusStructure p r
</span><a href="#local-6989586621679932264"><span class="hs-identifier hs-var">ss</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">EventQueue p r -&gt; Maybe (Event p r, EventQueue p r)
forall a. Set a -&gt; Maybe (a, Set a)
</span><span class="hs-identifier hs-var">EQ.minView</span></span><span> </span><span class="annot"><span class="annottext">EventQueue p r
</span><a href="#local-6989586621679932265"><span class="hs-identifier hs-var">eq</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-153"></span><span>    </span><span class="annot"><span class="annottext">Maybe (Event p r, EventQueue p r)
</span><span class="hs-identifier hs-var">Nothing</span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-154"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679932262"><span class="annot"><span class="annottext">Event p r
</span><a href="#local-6989586621679932262"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679932261"><span class="annot"><span class="annottext">EventQueue p r
</span><a href="#local-6989586621679932261"><span class="hs-identifier hs-var">eq'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Event p r
-&gt; EventQueue p r -&gt; StatusStructure p r -&gt; [IntersectionPoint p r]
forall r p.
(Ord r, Fractional r) =&gt;
Event p r
-&gt; EventQueue p r -&gt; StatusStructure p r -&gt; [IntersectionPoint p r]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#handle"><span class="hs-identifier hs-var">handle</span></a></span><span> </span><span class="annot"><span class="annottext">Event p r
</span><a href="#local-6989586621679932262"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">EventQueue p r
</span><a href="#local-6989586621679932261"><span class="hs-identifier hs-var">eq'</span></a></span><span> </span><span class="annot"><span class="annottext">StatusStructure p r
</span><a href="#local-6989586621679932264"><span class="hs-identifier hs-var">ss</span></a></span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span id="local-6989586621679932483"><span id="local-6989586621679932484"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#isClosedStart"><span class="hs-identifier hs-type">isClosedStart</span></a></span><span>                     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679932484"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679932484"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679932483"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932484"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span><span>
</span><span id="line-157"></span><span id="isClosedStart"><span class="annot"><span class="annottext">isClosedStart :: Point 2 r -&gt; LineSegment 2 p r -&gt; Bool
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#isClosedStart"><span class="hs-identifier hs-var hs-var">isClosedStart</span></a></span></span><span> </span><span id="local-6989586621679932258"><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679932258"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span id="local-6989586621679932256"><span class="annot"><span class="annottext">EndPoint (Point 2 r :+ p)
</span><a href="#local-6989586621679932256"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679932255"><span class="annot"><span class="annottext">EndPoint (Point 2 r :+ p)
</span><a href="#local-6989586621679932255"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679932258"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Point 2 r -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">EndPoint (Point 2 r :+ p)
</span><a href="#local-6989586621679932256"><span class="hs-identifier hs-var">s</span></a></span><span class="annot"><span class="annottext">EndPoint (Point 2 r :+ p)
-&gt; Getting (Point 2 r) (EndPoint (Point 2 r :+ p)) (Point 2 r)
-&gt; Point 2 r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">((Point 2 r :+ p) -&gt; Const (Point 2 r) (Point 2 r :+ p))
-&gt; EndPoint (Point 2 r :+ p)
-&gt; Const (Point 2 r) (EndPoint (Point 2 r :+ p))
forall a b. Lens (EndPoint a) (EndPoint b) a b
</span><span class="hs-identifier hs-var">unEndPoint</span></span><span class="annot"><span class="annottext">(((Point 2 r :+ p) -&gt; Const (Point 2 r) (Point 2 r :+ p))
 -&gt; EndPoint (Point 2 r :+ p)
 -&gt; Const (Point 2 r) (EndPoint (Point 2 r :+ p)))
-&gt; ((Point 2 r -&gt; Const (Point 2 r) (Point 2 r))
    -&gt; (Point 2 r :+ p) -&gt; Const (Point 2 r) (Point 2 r :+ p))
-&gt; Getting (Point 2 r) (EndPoint (Point 2 r :+ p)) (Point 2 r)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(Point 2 r -&gt; Const (Point 2 r) (Point 2 r))
-&gt; (Point 2 r :+ p) -&gt; Const (Point 2 r) (Point 2 r :+ p)
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EndPoint (Point 2 r :+ p) -&gt; Bool
forall a. EndPoint a -&gt; Bool
</span><span class="hs-identifier hs-var">isClosed</span></span><span> </span><span class="annot"><span class="annottext">EndPoint (Point 2 r :+ p)
</span><a href="#local-6989586621679932256"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-159"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EndPoint (Point 2 r :+ p) -&gt; Bool
forall a. EndPoint a -&gt; Bool
</span><span class="hs-identifier hs-var">isClosed</span></span><span> </span><span class="annot"><span class="annottext">EndPoint (Point 2 r :+ p)
</span><a href="#local-6989586621679932255"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span class="hs-comment">-- | Handle an event point</span><span>
</span><span id="line-162"></span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#handle"><span class="hs-identifier hs-type">handle</span></a></span><span>                           </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679932499"><span class="annot"><a href="#local-6989586621679932499"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span id="local-6989586621679932498"><span class="annot"><a href="#local-6989586621679932498"><span class="hs-identifier hs-type">p</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679932499"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679932499"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-163"></span><span>                                 </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932498"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932499"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#EventQueue"><span class="hs-identifier hs-type">EventQueue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932498"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932499"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#StatusStructure"><span class="hs-identifier hs-type">StatusStructure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932498"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932499"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-164"></span><span>                                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.Types.html#IntersectionPoint"><span class="hs-identifier hs-type">IntersectionPoint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932498"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932499"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-165"></span><span id="handle"><span class="annot"><span class="annottext">handle :: Event p r
-&gt; EventQueue p r -&gt; StatusStructure p r -&gt; [IntersectionPoint p r]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#handle"><span class="hs-identifier hs-var hs-var">handle</span></a></span></span><span> </span><span id="local-6989586621679932252"><span class="annot"><span class="annottext">e :: Event p r
</span><a href="#local-6989586621679932252"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Event p r -&gt; Point 2 r
forall p r. Event p r -&gt; Point 2 r
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#eventPoint"><span class="hs-identifier hs-var hs-var">eventPoint</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679932251"><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679932251"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679932250"><span class="annot"><span class="annottext">EventQueue p r
</span><a href="#local-6989586621679932250"><span class="hs-identifier hs-var">eq</span></a></span></span><span> </span><span id="local-6989586621679932249"><span class="annot"><span class="annottext">StatusStructure p r
</span><a href="#local-6989586621679932249"><span class="hs-identifier hs-var">ss</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[IntersectionPoint p r]
</span><a href="#local-6989586621679932248"><span class="hs-identifier hs-var">toReport</span></a></span><span> </span><span class="annot"><span class="annottext">[IntersectionPoint p r]
-&gt; [IntersectionPoint p r] -&gt; [IntersectionPoint p r]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">EventQueue p r -&gt; StatusStructure p r -&gt; [IntersectionPoint p r]
forall r p.
(Ord r, Fractional r) =&gt;
EventQueue p r -&gt; StatusStructure p r -&gt; [IntersectionPoint p r]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#sweep"><span class="hs-identifier hs-var">sweep</span></a></span><span> </span><span class="annot"><span class="annottext">EventQueue p r
</span><a href="#local-6989586621679932247"><span class="hs-identifier hs-var">eq'</span></a></span><span> </span><span class="annot"><span class="annottext">StatusStructure p r
</span><a href="#local-6989586621679932246"><span class="hs-identifier hs-var">ss'</span></a></span><span>
</span><span id="line-166"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-167"></span><span>    </span><span id="local-6989586621679932245"><span class="annot"><span class="annottext">starts :: [LineSegment 2 p r]
</span><a href="#local-6989586621679932245"><span class="hs-identifier hs-var hs-var">starts</span></a></span></span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Event p r -&gt; [LineSegment 2 p r]
forall p r. Event p r -&gt; [LineSegment 2 p r]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#startSegs"><span class="hs-identifier hs-var">startSegs</span></a></span><span> </span><span class="annot"><span class="annottext">Event p r
</span><a href="#local-6989586621679932252"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-168"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679932244"><span class="annot"><span class="annottext">StatusStructure p r
</span><a href="#local-6989586621679932244"><span class="hs-identifier hs-var">before</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679932243"><span class="annot"><span class="annottext">[LineSegment 2 p r]
</span><a href="#local-6989586621679932243"><span class="hs-identifier hs-var">contains'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679932242"><span class="annot"><span class="annottext">StatusStructure p r
</span><a href="#local-6989586621679932242"><span class="hs-identifier hs-var">after</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point 2 r
-&gt; StatusStructure p r
-&gt; (StatusStructure p r, [LineSegment 2 p r], StatusStructure p r)
forall r p.
(Fractional r, Ord r) =&gt;
Point 2 r
-&gt; StatusStructure p r
-&gt; (StatusStructure p r, [LineSegment 2 p r], StatusStructure p r)
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#extractContains"><span class="hs-identifier hs-var">extractContains</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679932251"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">StatusStructure p r
</span><a href="#local-6989586621679932249"><span class="hs-identifier hs-var">ss</span></a></span><span>
</span><span id="line-169"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679932240"><span class="annot"><span class="annottext">[LineSegment 2 p r]
</span><a href="#local-6989586621679932240"><span class="hs-identifier hs-var">ends</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679932239"><span class="annot"><span class="annottext">[LineSegment 2 p r]
</span><a href="#local-6989586621679932239"><span class="hs-identifier hs-var">contains</span></a></span></span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LineSegment 2 p r -&gt; Bool)
-&gt; [LineSegment 2 p r]
-&gt; ([LineSegment 2 p r], [LineSegment 2 p r])
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">L.partition</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r -&gt; LineSegment 2 p r -&gt; Bool
forall r p. Ord r =&gt; Point 2 r -&gt; LineSegment 2 p r -&gt; Bool
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#endsAt"><span class="hs-identifier hs-var">endsAt</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679932251"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r]
</span><a href="#local-6989586621679932243"><span class="hs-identifier hs-var">contains'</span></a></span><span>
</span><span id="line-170"></span><span>    </span><span class="hs-comment">-- starting segments, exluding those that have an open starting point</span><span>
</span><span id="line-171"></span><span>    </span><span id="local-6989586621679932236"><span class="annot"><span class="annottext">starts' :: [LineSegment 2 p r]
</span><a href="#local-6989586621679932236"><span class="hs-identifier hs-var hs-var">starts'</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LineSegment 2 p r -&gt; Bool)
-&gt; [LineSegment 2 p r] -&gt; [LineSegment 2 p r]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r -&gt; LineSegment 2 p r -&gt; Bool
forall r p. Eq r =&gt; Point 2 r -&gt; LineSegment 2 p r -&gt; Bool
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#isClosedStart"><span class="hs-identifier hs-var">isClosedStart</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679932251"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r]
</span><a href="#local-6989586621679932245"><span class="hs-identifier hs-var">starts</span></a></span><span>
</span><span id="line-172"></span><span>    </span><span id="local-6989586621679932248"><span class="annot"><span class="annottext">toReport :: [IntersectionPoint p r]
</span><a href="#local-6989586621679932248"><span class="hs-identifier hs-var hs-var">toReport</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r]
</span><a href="#local-6989586621679932236"><span class="hs-identifier hs-var">starts'</span></a></span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r] -&gt; [LineSegment 2 p r] -&gt; [LineSegment 2 p r]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r]
</span><a href="#local-6989586621679932243"><span class="hs-identifier hs-var">contains'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-173"></span><span>                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LineSegment 2 p r
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">LineSegment 2 p r
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[LineSegment 2 p r]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Point 2 r -&gt; Associated p r -&gt; IntersectionPoint p r
forall p r. Point 2 r -&gt; Associated p r -&gt; IntersectionPoint p r
</span><a href="Algorithms.Geometry.LineSegmentIntersection.Types.html#IntersectionPoint"><span class="hs-identifier hs-var">IntersectionPoint</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679932251"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">(Associated p r -&gt; IntersectionPoint p r)
-&gt; Associated p r -&gt; IntersectionPoint p r
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r] -&gt; [LineSegment 2 p r] -&gt; Associated p r
forall r p.
Ord r =&gt;
[LineSegment 2 p r] -&gt; [LineSegment 2 p r] -&gt; Associated p r
</span><a href="Algorithms.Geometry.LineSegmentIntersection.Types.html#associated"><span class="hs-identifier hs-var">associated</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[LineSegment 2 p r]
</span><a href="#local-6989586621679932236"><span class="hs-identifier hs-var">starts'</span></a></span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r] -&gt; [LineSegment 2 p r] -&gt; [LineSegment 2 p r]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r]
</span><a href="#local-6989586621679932240"><span class="hs-identifier hs-var">ends</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r]
</span><a href="#local-6989586621679932239"><span class="hs-identifier hs-var">contains</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-174"></span><span>                 </span><span class="annot"><span class="annottext">[LineSegment 2 p r]
</span><span class="hs-identifier">_</span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span>    </span><span class="hs-comment">-- new status structure</span><span>
</span><span id="line-177"></span><span>    </span><span id="local-6989586621679932246"><span class="annot"><span class="annottext">ss' :: StatusStructure p r
</span><a href="#local-6989586621679932246"><span class="hs-identifier hs-var hs-var">ss'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StatusStructure p r
</span><a href="#local-6989586621679932244"><span class="hs-identifier hs-var">before</span></a></span><span> </span><span class="annot"><span class="annottext">StatusStructure p r -&gt; StatusStructure p r -&gt; StatusStructure p r
forall a. Set a -&gt; Set a -&gt; Set a
</span><span class="hs-operator hs-var">`SS.join`</span></span><span> </span><span class="annot"><span class="annottext">StatusStructure p r
</span><a href="#local-6989586621679932233"><span class="hs-identifier hs-var">newSegs</span></a></span><span> </span><span class="annot"><span class="annottext">StatusStructure p r -&gt; StatusStructure p r -&gt; StatusStructure p r
forall a. Set a -&gt; Set a -&gt; Set a
</span><span class="hs-operator hs-var">`SS.join`</span></span><span> </span><span class="annot"><span class="annottext">StatusStructure p r
</span><a href="#local-6989586621679932242"><span class="hs-identifier hs-var">after</span></a></span><span>
</span><span id="line-178"></span><span>    </span><span id="local-6989586621679932233"><span class="annot"><span class="annottext">newSegs :: StatusStructure p r
</span><a href="#local-6989586621679932233"><span class="hs-identifier hs-var hs-var">newSegs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; [LineSegment 2 p r] -&gt; StatusStructure p r
forall r p.
(Fractional r, Ord r) =&gt;
Point 2 r -&gt; [LineSegment 2 p r] -&gt; StatusStructure p r
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#toStatusStruct"><span class="hs-identifier hs-var">toStatusStruct</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679932251"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">([LineSegment 2 p r] -&gt; StatusStructure p r)
-&gt; [LineSegment 2 p r] -&gt; StatusStructure p r
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r]
</span><a href="#local-6989586621679932245"><span class="hs-identifier hs-var">starts</span></a></span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r] -&gt; [LineSegment 2 p r] -&gt; [LineSegment 2 p r]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r]
</span><a href="#local-6989586621679932239"><span class="hs-identifier hs-var">contains</span></a></span><span>
</span><span id="line-179"></span><span>
</span><span id="line-180"></span><span>    </span><span class="hs-comment">-- the new eeventqueue</span><span>
</span><span id="line-181"></span><span>    </span><span id="local-6989586621679932247"><span class="annot"><span class="annottext">eq' :: EventQueue p r
</span><a href="#local-6989586621679932247"><span class="hs-identifier hs-var hs-var">eq'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Event p r -&gt; EventQueue p r -&gt; EventQueue p r)
-&gt; EventQueue p r -&gt; [Event p r] -&gt; EventQueue p r
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="annot"><span class="annottext">Event p r -&gt; EventQueue p r -&gt; EventQueue p r
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">EQ.insert</span></span><span> </span><span class="annot"><span class="annottext">EventQueue p r
</span><a href="#local-6989586621679932250"><span class="hs-identifier hs-var">eq</span></a></span><span> </span><span class="annot"><span class="annottext">[Event p r]
</span><a href="#local-6989586621679932230"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-182"></span><span>    </span><span class="hs-comment">-- the new events:</span><span>
</span><span id="line-183"></span><span>    </span><span id="local-6989586621679932230"><span class="annot"><span class="annottext">es :: [Event p r]
</span><a href="#local-6989586621679932230"><span class="hs-identifier hs-var hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">StatusStructure p r -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">F.null</span></span><span> </span><span class="annot"><span class="annottext">StatusStructure p r
</span><a href="#local-6989586621679932233"><span class="hs-identifier hs-var">newSegs</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Event p r) -&gt; [Event p r]
forall a. Maybe a -&gt; [a]
</span><span class="hs-identifier hs-var">maybeToList</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (Event p r) -&gt; [Event p r])
-&gt; Maybe (Event p r) -&gt; [Event p r]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(LineSegment 2 p r -&gt; LineSegment 2 p r -&gt; Maybe (Event p r))
-&gt; Maybe (LineSegment 2 p r)
-&gt; Maybe (LineSegment 2 p r)
-&gt; Maybe (Event p r)
forall (m :: * -&gt; *) t t b.
Monad m =&gt;
(t -&gt; t -&gt; m b) -&gt; m t -&gt; m t -&gt; m b
</span><a href="#local-6989586621679932227"><span class="hs-identifier hs-var">app</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r
-&gt; LineSegment 2 p r -&gt; LineSegment 2 p r -&gt; Maybe (Event p r)
forall r p.
(Ord r, Fractional r) =&gt;
Point 2 r
-&gt; LineSegment 2 p r -&gt; LineSegment 2 p r -&gt; Maybe (Event p r)
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#findNewEvent"><span class="hs-identifier hs-var">findNewEvent</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679932251"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (LineSegment 2 p r)
</span><a href="#local-6989586621679932225"><span class="hs-identifier hs-var">sl</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (LineSegment 2 p r)
</span><a href="#local-6989586621679932224"><span class="hs-identifier hs-var">sr</span></a></span><span>
</span><span id="line-184"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679932223"><span class="annot"><span class="annottext">s' :: Maybe (LineSegment 2 p r)
</span><a href="#local-6989586621679932223"><span class="hs-identifier hs-var hs-var">s'</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StatusStructure p r -&gt; Maybe (LineSegment 2 p r)
forall a. Set a -&gt; Maybe a
</span><span class="hs-identifier hs-var">SS.lookupMin</span></span><span> </span><span class="annot"><span class="annottext">StatusStructure p r
</span><a href="#local-6989586621679932233"><span class="hs-identifier hs-var">newSegs</span></a></span><span>
</span><span id="line-185"></span><span>                               </span><span id="local-6989586621679932221"><span class="annot"><span class="annottext">s'' :: Maybe (LineSegment 2 p r)
</span><a href="#local-6989586621679932221"><span class="hs-identifier hs-var hs-var">s''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StatusStructure p r -&gt; Maybe (LineSegment 2 p r)
forall a. Set a -&gt; Maybe a
</span><span class="hs-identifier hs-var">SS.lookupMax</span></span><span> </span><span class="annot"><span class="annottext">StatusStructure p r
</span><a href="#local-6989586621679932233"><span class="hs-identifier hs-var">newSegs</span></a></span><span>
</span><span id="line-186"></span><span>                           </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[Maybe (Event p r)] -&gt; [Event p r]
forall a. [Maybe a] -&gt; [a]
</span><span class="hs-identifier hs-var">catMaybes</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(LineSegment 2 p r -&gt; LineSegment 2 p r -&gt; Maybe (Event p r))
-&gt; Maybe (LineSegment 2 p r)
-&gt; Maybe (LineSegment 2 p r)
-&gt; Maybe (Event p r)
forall (m :: * -&gt; *) t t b.
Monad m =&gt;
(t -&gt; t -&gt; m b) -&gt; m t -&gt; m t -&gt; m b
</span><a href="#local-6989586621679932227"><span class="hs-identifier hs-var">app</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r
-&gt; LineSegment 2 p r -&gt; LineSegment 2 p r -&gt; Maybe (Event p r)
forall r p.
(Ord r, Fractional r) =&gt;
Point 2 r
-&gt; LineSegment 2 p r -&gt; LineSegment 2 p r -&gt; Maybe (Event p r)
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#findNewEvent"><span class="hs-identifier hs-var">findNewEvent</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679932251"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (LineSegment 2 p r)
</span><a href="#local-6989586621679932225"><span class="hs-identifier hs-var">sl</span></a></span><span>  </span><span class="annot"><span class="annottext">Maybe (LineSegment 2 p r)
</span><a href="#local-6989586621679932223"><span class="hs-identifier hs-var">s'</span></a></span><span>
</span><span id="line-187"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(LineSegment 2 p r -&gt; LineSegment 2 p r -&gt; Maybe (Event p r))
-&gt; Maybe (LineSegment 2 p r)
-&gt; Maybe (LineSegment 2 p r)
-&gt; Maybe (Event p r)
forall (m :: * -&gt; *) t t b.
Monad m =&gt;
(t -&gt; t -&gt; m b) -&gt; m t -&gt; m t -&gt; m b
</span><a href="#local-6989586621679932227"><span class="hs-identifier hs-var">app</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r
-&gt; LineSegment 2 p r -&gt; LineSegment 2 p r -&gt; Maybe (Event p r)
forall r p.
(Ord r, Fractional r) =&gt;
Point 2 r
-&gt; LineSegment 2 p r -&gt; LineSegment 2 p r -&gt; Maybe (Event p r)
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#findNewEvent"><span class="hs-identifier hs-var">findNewEvent</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679932251"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (LineSegment 2 p r)
</span><a href="#local-6989586621679932221"><span class="hs-identifier hs-var">s''</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (LineSegment 2 p r)
</span><a href="#local-6989586621679932224"><span class="hs-identifier hs-var">sr</span></a></span><span>
</span><span id="line-188"></span><span>                                        </span><span class="hs-special">]</span><span>
</span><span id="line-189"></span><span>    </span><span id="local-6989586621679932225"><span class="annot"><span class="annottext">sl :: Maybe (LineSegment 2 p r)
</span><a href="#local-6989586621679932225"><span class="hs-identifier hs-var hs-var">sl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StatusStructure p r -&gt; Maybe (LineSegment 2 p r)
forall a. Set a -&gt; Maybe a
</span><span class="hs-identifier hs-var">SS.lookupMax</span></span><span> </span><span class="annot"><span class="annottext">StatusStructure p r
</span><a href="#local-6989586621679932244"><span class="hs-identifier hs-var">before</span></a></span><span>
</span><span id="line-190"></span><span>    </span><span id="local-6989586621679932224"><span class="annot"><span class="annottext">sr :: Maybe (LineSegment 2 p r)
</span><a href="#local-6989586621679932224"><span class="hs-identifier hs-var hs-var">sr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StatusStructure p r -&gt; Maybe (LineSegment 2 p r)
forall a. Set a -&gt; Maybe a
</span><span class="hs-identifier hs-var">SS.lookupMin</span></span><span> </span><span class="annot"><span class="annottext">StatusStructure p r
</span><a href="#local-6989586621679932242"><span class="hs-identifier hs-var">after</span></a></span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span>    </span><span id="local-6989586621679932227"><span class="annot"><span class="annottext">app :: (t -&gt; t -&gt; m b) -&gt; m t -&gt; m t -&gt; m b
</span><a href="#local-6989586621679932227"><span class="hs-identifier hs-var hs-var">app</span></a></span></span><span> </span><span id="local-6989586621679932218"><span class="annot"><span class="annottext">t -&gt; t -&gt; m b
</span><a href="#local-6989586621679932218"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679932217"><span class="annot"><span class="annottext">m t
</span><a href="#local-6989586621679932217"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679932216"><span class="annot"><span class="annottext">m t
</span><a href="#local-6989586621679932216"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621679932215"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679932215"><span class="hs-identifier hs-var">x'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m t
</span><a href="#local-6989586621679932217"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">;</span><span> </span><span id="local-6989586621679932214"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679932214"><span class="hs-identifier hs-var">y'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m t
</span><a href="#local-6989586621679932216"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">t -&gt; t -&gt; m b
</span><a href="#local-6989586621679932218"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679932215"><span class="hs-identifier hs-var">x'</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679932214"><span class="hs-identifier hs-var">y'</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span class="hs-comment">-- | split the status structure, extracting the segments that contain p.</span><span>
</span><span id="line-195"></span><span class="hs-comment">-- the result is (before,contains,after)</span><span>
</span><span id="line-196"></span><span id="local-6989586621679932488"><span id="local-6989586621679932489"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#extractContains"><span class="hs-identifier hs-type">extractContains</span></a></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679932489"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679932489"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-197"></span><span>                     </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679932489"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#StatusStructure"><span class="hs-identifier hs-type">StatusStructure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932488"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932489"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-198"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#StatusStructure"><span class="hs-identifier hs-type">StatusStructure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932488"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932489"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679932488"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932489"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#StatusStructure"><span class="hs-identifier hs-type">StatusStructure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932488"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932489"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-199"></span><span id="extractContains"><span class="annot"><span class="annottext">extractContains :: Point 2 r
-&gt; StatusStructure p r
-&gt; (StatusStructure p r, [LineSegment 2 p r], StatusStructure p r)
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#extractContains"><span class="hs-identifier hs-var hs-var">extractContains</span></a></span></span><span> </span><span id="local-6989586621679932213"><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679932213"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679932212"><span class="annot"><span class="annottext">StatusStructure p r
</span><a href="#local-6989586621679932212"><span class="hs-identifier hs-var">ss</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StatusStructure p r
</span><a href="#local-6989586621679932211"><span class="hs-identifier hs-var">before</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">StatusStructure p r -&gt; [LineSegment 2 p r]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">F.toList</span></span><span> </span><span class="annot"><span class="annottext">StatusStructure p r
</span><a href="#local-6989586621679932209"><span class="hs-identifier hs-var">mid1</span></a></span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r] -&gt; [LineSegment 2 p r] -&gt; [LineSegment 2 p r]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StatusStructure p r -&gt; [LineSegment 2 p r]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">F.toList</span></span><span> </span><span class="annot"><span class="annottext">StatusStructure p r
</span><a href="#local-6989586621679932208"><span class="hs-identifier hs-var">mid2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">StatusStructure p r
</span><a href="#local-6989586621679932207"><span class="hs-identifier hs-var">after</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-200"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-201"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679932211"><span class="annot"><span class="annottext">StatusStructure p r
</span><a href="#local-6989586621679932211"><span class="hs-identifier hs-var">before</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679932209"><span class="annot"><span class="annottext">StatusStructure p r
</span><a href="#local-6989586621679932209"><span class="hs-identifier hs-var">mid1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679932206"><span class="annot"><span class="annottext">StatusStructure p r
</span><a href="#local-6989586621679932206"><span class="hs-identifier hs-var">after'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LineSegment 2 p r -&gt; r)
-&gt; r
-&gt; StatusStructure p r
-&gt; (StatusStructure p r, StatusStructure p r, StatusStructure p r)
forall b a.
Ord b =&gt;
(a -&gt; b) -&gt; b -&gt; Set a -&gt; (Set a, Set a, Set a)
</span><span class="hs-identifier hs-var">SS.splitOn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">r -&gt; LineSegment 2 p r -&gt; r
forall r p. (Fractional r, Ord r) =&gt; r -&gt; LineSegment 2 p r -&gt; r
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#xCoordAt"><span class="hs-identifier hs-var">xCoordAt</span></a></span><span> </span><span class="annot"><span class="annottext">(r -&gt; LineSegment 2 p r -&gt; r) -&gt; r -&gt; LineSegment 2 p r -&gt; r
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679932213"><span class="hs-identifier hs-var">p</span></a></span><span class="annot"><span class="annottext">Point 2 r -&gt; Getting r (Point 2 r) r -&gt; r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting r (Point 2 r) r
forall (d :: Nat) (point :: Nat -&gt; * -&gt; *) r.
(2 &lt;= d, Arity d, AsAPoint point) =&gt;
Lens' (point d r) r
</span><a href="Data.Geometry.Point.Class.html#yCoord"><span class="hs-identifier hs-var">yCoord</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679932213"><span class="hs-identifier hs-var">p</span></a></span><span class="annot"><span class="annottext">Point 2 r -&gt; Getting r (Point 2 r) r -&gt; r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting r (Point 2 r) r
forall (d :: Nat) (point :: Nat -&gt; * -&gt; *) r.
(1 &lt;= d, Arity d, AsAPoint point) =&gt;
Lens' (point d r) r
</span><a href="Data.Geometry.Point.Class.html#xCoord"><span class="hs-identifier hs-var">xCoord</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StatusStructure p r
</span><a href="#local-6989586621679932212"><span class="hs-identifier hs-var">ss</span></a></span><span>
</span><span id="line-202"></span><span>    </span><span class="hs-comment">-- Make sure to also select the horizontal segments containing p</span><span>
</span><span id="line-203"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679932208"><span class="annot"><span class="annottext">StatusStructure p r
</span><a href="#local-6989586621679932208"><span class="hs-identifier hs-var">mid2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679932207"><span class="annot"><span class="annottext">StatusStructure p r
</span><a href="#local-6989586621679932207"><span class="hs-identifier hs-var">after</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LineSegment 2 p r -&gt; Bool)
-&gt; StatusStructure p r
-&gt; (StatusStructure p r, StatusStructure p r)
forall a. (a -&gt; Bool) -&gt; Set a -&gt; (Set a, Set a)
</span><span class="hs-identifier hs-var">SS.spanAntitone</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r -&gt; LineSegment 2 p r -&gt; Bool
forall g h. IsIntersectableWith g h =&gt; g -&gt; h -&gt; Bool
</span><span class="hs-identifier hs-var">intersects</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679932213"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StatusStructure p r
</span><a href="#local-6989586621679932206"><span class="hs-identifier hs-var">after'</span></a></span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span>
</span><span id="line-206"></span><span class="hs-comment">-- | Given a point and the linesegements that contain it. Create a piece of</span><span>
</span><span id="line-207"></span><span class="hs-comment">-- status structure for it.</span><span>
</span><span id="line-208"></span><span id="local-6989586621679932476"><span id="local-6989586621679932477"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#toStatusStruct"><span class="hs-identifier hs-type">toStatusStruct</span></a></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679932477"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679932477"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-209"></span><span>                    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679932477"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679932476"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932477"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#StatusStructure"><span class="hs-identifier hs-type">StatusStructure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932476"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932477"><span class="hs-identifier hs-type">r</span></a></span></span></span><span>
</span><span id="line-210"></span><span id="toStatusStruct"><span class="annot"><span class="annottext">toStatusStruct :: Point 2 r -&gt; [LineSegment 2 p r] -&gt; StatusStructure p r
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#toStatusStruct"><span class="hs-identifier hs-var hs-var">toStatusStruct</span></a></span></span><span> </span><span id="local-6989586621679932202"><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679932202"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679932201"><span class="annot"><span class="annottext">[LineSegment 2 p r]
</span><a href="#local-6989586621679932201"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StatusStructure p r
</span><a href="#local-6989586621679932200"><span class="hs-identifier hs-var">ss</span></a></span><span> </span><span class="annot"><span class="annottext">StatusStructure p r -&gt; StatusStructure p r -&gt; StatusStructure p r
forall a. Set a -&gt; Set a -&gt; Set a
</span><span class="hs-operator hs-var">`SS.join`</span></span><span> </span><span class="annot"><span class="annottext">StatusStructure p r
</span><a href="#local-6989586621679932199"><span class="hs-identifier hs-var">hors</span></a></span><span>
</span><span id="line-211"></span><span>  </span><span class="hs-comment">-- ss { SS.nav = ordAtNav $ p^.yCoord } `SS.join` hors</span><span>
</span><span id="line-212"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-213"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679932198"><span class="annot"><span class="annottext">[LineSegment 2 p r]
</span><a href="#local-6989586621679932198"><span class="hs-identifier hs-var">hors'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679932197"><span class="annot"><span class="annottext">[LineSegment 2 p r]
</span><a href="#local-6989586621679932197"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LineSegment 2 p r -&gt; Bool)
-&gt; [LineSegment 2 p r]
-&gt; ([LineSegment 2 p r], [LineSegment 2 p r])
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">L.partition</span></span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r -&gt; Bool
forall (d :: Nat) (d :: Nat) s a (point :: Nat -&gt; * -&gt; *)
       (point :: Nat -&gt; * -&gt; *).
(ImplicitPeano (Peano d), ImplicitPeano (Peano d), HasEnd s, Eq a,
 HasStart s, ArityPeano (Peano (FromPeano (Peano d))),
 ArityPeano (Peano (FromPeano (Peano d))), KnownNat d,
 KnownNat (FromPeano (Peano d)), KnownNat (FromPeano (Peano d)),
 KnownNat d, AsAPoint point, AsAPoint point, (2 &lt;=? d) ~ 'True,
 (2 &lt;=? d) ~ 'True,
 Peano (FromPeano (Peano d) + 1) ~ 'S (Peano (FromPeano (Peano d))),
 EndCore s ~ point d a, StartCore s ~ point d a,
 Peano (FromPeano (Peano d) + 1)
 ~ 'S (Peano (FromPeano (Peano d)))) =&gt;
s -&gt; Bool
</span><a href="#local-6989586621679932196"><span class="hs-identifier hs-var">isHorizontal</span></a></span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r]
</span><a href="#local-6989586621679932201"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-214"></span><span>    </span><span id="local-6989586621679932200"><span class="annot"><span class="annottext">ss :: StatusStructure p r
</span><a href="#local-6989586621679932200"><span class="hs-identifier hs-var hs-var">ss</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LineSegment 2 p r -&gt; LineSegment 2 p r -&gt; Ordering)
-&gt; [LineSegment 2 p r] -&gt; StatusStructure p r
forall a. (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">SS.fromListBy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">r -&gt; LineSegment 2 p r -&gt; LineSegment 2 p r -&gt; Ordering
forall r p.
(Fractional r, Ord r) =&gt;
r -&gt; Compare (LineSegment 2 p r)
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#ordAt"><span class="hs-identifier hs-var">ordAt</span></a></span><span> </span><span class="annot"><span class="annottext">(r -&gt; LineSegment 2 p r -&gt; LineSegment 2 p r -&gt; Ordering)
-&gt; r -&gt; LineSegment 2 p r -&gt; LineSegment 2 p r -&gt; Ordering
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r] -&gt; r
</span><a href="#local-6989586621679932194"><span class="hs-identifier hs-var">maxY</span></a></span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r]
</span><a href="#local-6989586621679932201"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r]
</span><a href="#local-6989586621679932197"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-215"></span><span>    </span><span id="local-6989586621679932199"><span class="annot"><span class="annottext">hors :: StatusStructure p r
</span><a href="#local-6989586621679932199"><span class="hs-identifier hs-var hs-var">hors</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LineSegment 2 p r -&gt; LineSegment 2 p r -&gt; Ordering)
-&gt; [LineSegment 2 p r] -&gt; StatusStructure p r
forall a. (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">SS.fromListBy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(LineSegment 2 p r -&gt; r)
-&gt; LineSegment 2 p r -&gt; LineSegment 2 p r -&gt; Ordering
forall a b. Ord a =&gt; (b -&gt; a) -&gt; b -&gt; b -&gt; Ordering
</span><span class="hs-identifier hs-var">comparing</span></span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r -&gt; r
forall r p. Ord r =&gt; LineSegment 2 p r -&gt; r
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#rightEndpoint"><span class="hs-identifier hs-var">rightEndpoint</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r]
</span><a href="#local-6989586621679932198"><span class="hs-identifier hs-var">hors'</span></a></span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span>    </span><span id="local-6989586621679932196"><span class="annot"><span class="annottext">isHorizontal :: s -&gt; Bool
</span><a href="#local-6989586621679932196"><span class="hs-identifier hs-var hs-var">isHorizontal</span></a></span></span><span> </span><span id="local-6989586621679932192"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679932192"><span class="hs-identifier hs-var">s</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679932192"><span class="hs-identifier hs-var">s</span></a></span><span class="annot"><span class="annottext">s -&gt; Getting a s a -&gt; a
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">((point d a :+ StartExtra s)
 -&gt; Const a (point d a :+ StartExtra s))
-&gt; s -&gt; Const a s
forall t. HasStart t =&gt; Lens' t (StartCore t :+ StartExtra t)
</span><a href="Data.Geometry.Interval.html#start"><span class="hs-identifier hs-var">start</span></a></span><span class="annot"><span class="annottext">(((point d a :+ StartExtra s)
  -&gt; Const a (point d a :+ StartExtra s))
 -&gt; s -&gt; Const a s)
-&gt; ((a -&gt; Const a a)
    -&gt; (point d a :+ StartExtra s)
    -&gt; Const a (point d a :+ StartExtra s))
-&gt; Getting a s a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(point d a -&gt; Const a (point d a))
-&gt; (point d a :+ StartExtra s)
-&gt; Const a (point d a :+ StartExtra s)
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="annot"><span class="annottext">((point d a -&gt; Const a (point d a))
 -&gt; (point d a :+ StartExtra s)
 -&gt; Const a (point d a :+ StartExtra s))
-&gt; ((a -&gt; Const a a) -&gt; point d a -&gt; Const a (point d a))
-&gt; (a -&gt; Const a a)
-&gt; (point d a :+ StartExtra s)
-&gt; Const a (point d a :+ StartExtra s)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(a -&gt; Const a a) -&gt; point d a -&gt; Const a (point d a)
forall (d :: Nat) (point :: Nat -&gt; * -&gt; *) r.
(2 &lt;= d, Arity d, AsAPoint point) =&gt;
Lens' (point d r) r
</span><a href="Data.Geometry.Point.Class.html#yCoord"><span class="hs-identifier hs-var">yCoord</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679932192"><span class="hs-identifier hs-var">s</span></a></span><span class="annot"><span class="annottext">s -&gt; Getting a s a -&gt; a
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">((point d a :+ EndExtra s) -&gt; Const a (point d a :+ EndExtra s))
-&gt; s -&gt; Const a s
forall t. HasEnd t =&gt; Lens' t (EndCore t :+ EndExtra t)
</span><a href="Data.Geometry.Interval.html#end"><span class="hs-identifier hs-var">end</span></a></span><span class="annot"><span class="annottext">(((point d a :+ EndExtra s) -&gt; Const a (point d a :+ EndExtra s))
 -&gt; s -&gt; Const a s)
-&gt; ((a -&gt; Const a a)
    -&gt; (point d a :+ EndExtra s) -&gt; Const a (point d a :+ EndExtra s))
-&gt; Getting a s a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(point d a -&gt; Const a (point d a))
-&gt; (point d a :+ EndExtra s) -&gt; Const a (point d a :+ EndExtra s)
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="annot"><span class="annottext">((point d a -&gt; Const a (point d a))
 -&gt; (point d a :+ EndExtra s) -&gt; Const a (point d a :+ EndExtra s))
-&gt; ((a -&gt; Const a a) -&gt; point d a -&gt; Const a (point d a))
-&gt; (a -&gt; Const a a)
-&gt; (point d a :+ EndExtra s)
-&gt; Const a (point d a :+ EndExtra s)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(a -&gt; Const a a) -&gt; point d a -&gt; Const a (point d a)
forall (d :: Nat) (point :: Nat -&gt; * -&gt; *) r.
(2 &lt;= d, Arity d, AsAPoint point) =&gt;
Lens' (point d r) r
</span><a href="Data.Geometry.Point.Class.html#yCoord"><span class="hs-identifier hs-var">yCoord</span></a></span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span>    </span><span class="hs-comment">-- find the y coord of the first interesting thing below the sweep at y</span><span>
</span><span id="line-220"></span><span>    </span><span id="local-6989586621679932194"><span class="annot"><span class="annottext">maxY :: [LineSegment 2 p r] -&gt; r
</span><a href="#local-6989586621679932194"><span class="hs-identifier hs-var hs-var">maxY</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[r] -&gt; r
forall (t :: * -&gt; *) a. (Foldable t, Ord a) =&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">maximum</span></span><span> </span><span class="annot"><span class="annottext">([r] -&gt; r)
-&gt; ([LineSegment 2 p r] -&gt; [r]) -&gt; [LineSegment 2 p r] -&gt; r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(r -&gt; Bool) -&gt; [r] -&gt; [r]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">r -&gt; r -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679932202"><span class="hs-identifier hs-var">p</span></a></span><span class="annot"><span class="annottext">Point 2 r -&gt; Getting r (Point 2 r) r -&gt; r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting r (Point 2 r) r
forall (d :: Nat) (point :: Nat -&gt; * -&gt; *) r.
(2 &lt;= d, Arity d, AsAPoint point) =&gt;
Lens' (point d r) r
</span><a href="Data.Geometry.Point.Class.html#yCoord"><span class="hs-identifier hs-var">yCoord</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-221"></span><span>         </span><span class="annot"><span class="annottext">([r] -&gt; [r])
-&gt; ([LineSegment 2 p r] -&gt; [r]) -&gt; [LineSegment 2 p r] -&gt; [r]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(LineSegment 2 p r -&gt; [r]) -&gt; [LineSegment 2 p r] -&gt; [r]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679932189"><span class="annot"><span class="annottext">LineSegment 2 p r
</span><a href="#local-6989586621679932189"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">LineSegment 2 p r
</span><a href="#local-6989586621679932189"><span class="hs-identifier hs-var">s</span></a></span><span class="annot"><span class="annottext">LineSegment 2 p r -&gt; Getting r (LineSegment 2 p r) r -&gt; r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">((Point 2 r :+ p) -&gt; Const r (Point 2 r :+ p))
-&gt; LineSegment 2 p r -&gt; Const r (LineSegment 2 p r)
forall t. HasStart t =&gt; Lens' t (StartCore t :+ StartExtra t)
</span><a href="Data.Geometry.Interval.html#start"><span class="hs-identifier hs-var">start</span></a></span><span class="annot"><span class="annottext">(((Point 2 r :+ p) -&gt; Const r (Point 2 r :+ p))
 -&gt; LineSegment 2 p r -&gt; Const r (LineSegment 2 p r))
-&gt; ((r -&gt; Const r r)
    -&gt; (Point 2 r :+ p) -&gt; Const r (Point 2 r :+ p))
-&gt; Getting r (LineSegment 2 p r) r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(Point 2 r -&gt; Const r (Point 2 r))
-&gt; (Point 2 r :+ p) -&gt; Const r (Point 2 r :+ p)
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="annot"><span class="annottext">((Point 2 r -&gt; Const r (Point 2 r))
 -&gt; (Point 2 r :+ p) -&gt; Const r (Point 2 r :+ p))
-&gt; Getting r (Point 2 r) r
-&gt; (r -&gt; Const r r)
-&gt; (Point 2 r :+ p)
-&gt; Const r (Point 2 r :+ p)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">Getting r (Point 2 r) r
forall (d :: Nat) (point :: Nat -&gt; * -&gt; *) r.
(2 &lt;= d, Arity d, AsAPoint point) =&gt;
Lens' (point d r) r
</span><a href="Data.Geometry.Point.Class.html#yCoord"><span class="hs-identifier hs-var">yCoord</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">LineSegment 2 p r
</span><a href="#local-6989586621679932189"><span class="hs-identifier hs-var">s</span></a></span><span class="annot"><span class="annottext">LineSegment 2 p r -&gt; Getting r (LineSegment 2 p r) r -&gt; r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">((Point 2 r :+ p) -&gt; Const r (Point 2 r :+ p))
-&gt; LineSegment 2 p r -&gt; Const r (LineSegment 2 p r)
forall t. HasEnd t =&gt; Lens' t (EndCore t :+ EndExtra t)
</span><a href="Data.Geometry.Interval.html#end"><span class="hs-identifier hs-var">end</span></a></span><span class="annot"><span class="annottext">(((Point 2 r :+ p) -&gt; Const r (Point 2 r :+ p))
 -&gt; LineSegment 2 p r -&gt; Const r (LineSegment 2 p r))
-&gt; ((r -&gt; Const r r)
    -&gt; (Point 2 r :+ p) -&gt; Const r (Point 2 r :+ p))
-&gt; Getting r (LineSegment 2 p r) r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(Point 2 r -&gt; Const r (Point 2 r))
-&gt; (Point 2 r :+ p) -&gt; Const r (Point 2 r :+ p)
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="annot"><span class="annottext">((Point 2 r -&gt; Const r (Point 2 r))
 -&gt; (Point 2 r :+ p) -&gt; Const r (Point 2 r :+ p))
-&gt; Getting r (Point 2 r) r
-&gt; (r -&gt; Const r r)
-&gt; (Point 2 r :+ p)
-&gt; Const r (Point 2 r :+ p)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">Getting r (Point 2 r) r
forall (d :: Nat) (point :: Nat -&gt; * -&gt; *) r.
(2 &lt;= d, Arity d, AsAPoint point) =&gt;
Lens' (point d r) r
</span><a href="Data.Geometry.Point.Class.html#yCoord"><span class="hs-identifier hs-var">yCoord</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-222"></span><span>
</span><span id="line-223"></span><span class="hs-comment">-- | Get the right endpoint of a segment</span><span>
</span><span id="line-224"></span><span id="local-6989586621679932443"><span id="local-6989586621679932444"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#rightEndpoint"><span class="hs-identifier hs-type">rightEndpoint</span></a></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679932444"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679932443"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932444"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679932444"><span class="hs-identifier hs-type">r</span></a></span></span></span><span>
</span><span id="line-225"></span><span id="rightEndpoint"><span class="annot"><span class="annottext">rightEndpoint :: LineSegment 2 p r -&gt; r
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#rightEndpoint"><span class="hs-identifier hs-var hs-var">rightEndpoint</span></a></span></span><span> </span><span id="local-6989586621679932188"><span class="annot"><span class="annottext">LineSegment 2 p r
</span><a href="#local-6989586621679932188"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LineSegment 2 p r
</span><a href="#local-6989586621679932188"><span class="hs-identifier hs-var">s</span></a></span><span class="annot"><span class="annottext">LineSegment 2 p r -&gt; Getting r (LineSegment 2 p r) r -&gt; r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">((Point 2 r :+ p) -&gt; Const r (Point 2 r :+ p))
-&gt; LineSegment 2 p r -&gt; Const r (LineSegment 2 p r)
forall t. HasStart t =&gt; Lens' t (StartCore t :+ StartExtra t)
</span><a href="Data.Geometry.Interval.html#start"><span class="hs-identifier hs-var">start</span></a></span><span class="annot"><span class="annottext">(((Point 2 r :+ p) -&gt; Const r (Point 2 r :+ p))
 -&gt; LineSegment 2 p r -&gt; Const r (LineSegment 2 p r))
-&gt; ((r -&gt; Const r r)
    -&gt; (Point 2 r :+ p) -&gt; Const r (Point 2 r :+ p))
-&gt; Getting r (LineSegment 2 p r) r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(Point 2 r -&gt; Const r (Point 2 r))
-&gt; (Point 2 r :+ p) -&gt; Const r (Point 2 r :+ p)
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="annot"><span class="annottext">((Point 2 r -&gt; Const r (Point 2 r))
 -&gt; (Point 2 r :+ p) -&gt; Const r (Point 2 r :+ p))
-&gt; ((r -&gt; Const r r) -&gt; Point 2 r -&gt; Const r (Point 2 r))
-&gt; (r -&gt; Const r r)
-&gt; (Point 2 r :+ p)
-&gt; Const r (Point 2 r :+ p)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(r -&gt; Const r r) -&gt; Point 2 r -&gt; Const r (Point 2 r)
forall (d :: Nat) (point :: Nat -&gt; * -&gt; *) r.
(1 &lt;= d, Arity d, AsAPoint point) =&gt;
Lens' (point d r) r
</span><a href="Data.Geometry.Point.Class.html#xCoord"><span class="hs-identifier hs-var">xCoord</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">r -&gt; r -&gt; r
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`max`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LineSegment 2 p r
</span><a href="#local-6989586621679932188"><span class="hs-identifier hs-var">s</span></a></span><span class="annot"><span class="annottext">LineSegment 2 p r -&gt; Getting r (LineSegment 2 p r) r -&gt; r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">((Point 2 r :+ p) -&gt; Const r (Point 2 r :+ p))
-&gt; LineSegment 2 p r -&gt; Const r (LineSegment 2 p r)
forall t. HasEnd t =&gt; Lens' t (EndCore t :+ EndExtra t)
</span><a href="Data.Geometry.Interval.html#end"><span class="hs-identifier hs-var">end</span></a></span><span class="annot"><span class="annottext">(((Point 2 r :+ p) -&gt; Const r (Point 2 r :+ p))
 -&gt; LineSegment 2 p r -&gt; Const r (LineSegment 2 p r))
-&gt; ((r -&gt; Const r r)
    -&gt; (Point 2 r :+ p) -&gt; Const r (Point 2 r :+ p))
-&gt; Getting r (LineSegment 2 p r) r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(Point 2 r -&gt; Const r (Point 2 r))
-&gt; (Point 2 r :+ p) -&gt; Const r (Point 2 r :+ p)
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="annot"><span class="annottext">((Point 2 r -&gt; Const r (Point 2 r))
 -&gt; (Point 2 r :+ p) -&gt; Const r (Point 2 r :+ p))
-&gt; ((r -&gt; Const r r) -&gt; Point 2 r -&gt; Const r (Point 2 r))
-&gt; (r -&gt; Const r r)
-&gt; (Point 2 r :+ p)
-&gt; Const r (Point 2 r :+ p)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(r -&gt; Const r r) -&gt; Point 2 r -&gt; Const r (Point 2 r)
forall (d :: Nat) (point :: Nat -&gt; * -&gt; *) r.
(1 &lt;= d, Arity d, AsAPoint point) =&gt;
Lens' (point d r) r
</span><a href="Data.Geometry.Point.Class.html#xCoord"><span class="hs-identifier hs-var">xCoord</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-226"></span><span>
</span><span id="line-227"></span><span class="hs-comment">-- | Test if a segment ends at p</span><span>
</span><span id="line-228"></span><span id="local-6989586621679932486"><span id="local-6989586621679932487"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#endsAt"><span class="hs-identifier hs-type">endsAt</span></a></span><span>                      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679932487"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679932487"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679932486"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932487"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span><span>
</span><span id="line-229"></span><span id="endsAt"><span class="annot"><span class="annottext">endsAt :: Point 2 r -&gt; LineSegment 2 p r -&gt; Bool
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#endsAt"><span class="hs-identifier hs-var hs-var">endsAt</span></a></span></span><span> </span><span id="local-6989586621679932187"><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679932187"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment%27"><span class="hs-identifier hs-type">LineSegment'</span></a></span><span> </span><span id="local-6989586621679932186"><span class="annot"><span class="annottext">Point 2 r :+ p
</span><a href="#local-6989586621679932186"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679932185"><span class="annot"><span class="annottext">Point 2 r :+ p
</span><a href="#local-6989586621679932185"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Point 2 r :+ p) -&gt; Bool) -&gt; [Point 2 r :+ p] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679932183"><span class="annot"><span class="annottext">Point 2 r :+ p
</span><a href="#local-6989586621679932183"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Point 2 r -&gt; Ordering
forall r. Ord r =&gt; Point 2 r -&gt; Point 2 r -&gt; Ordering
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#ordPoints"><span class="hs-identifier hs-var">ordPoints</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r :+ p
</span><a href="#local-6989586621679932183"><span class="hs-identifier hs-var">q</span></a></span><span class="annot"><span class="annottext">(Point 2 r :+ p)
-&gt; Getting (Point 2 r) (Point 2 r :+ p) (Point 2 r) -&gt; Point 2 r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting (Point 2 r) (Point 2 r :+ p) (Point 2 r)
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679932187"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Ordering -&gt; Ordering -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">GT</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Point 2 r :+ p
</span><a href="#local-6989586621679932186"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Point 2 r :+ p
</span><a href="#local-6989586621679932185"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-230"></span><span>
</span><span id="line-231"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-232"></span><span class="hs-comment">-- * Finding New events</span><span>
</span><span id="line-233"></span><span>
</span><span id="line-234"></span><span class="hs-comment">-- | Find all events</span><span>
</span><span id="line-235"></span><span id="local-6989586621679932467"><span id="local-6989586621679932468"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#findNewEvent"><span class="hs-identifier hs-type">findNewEvent</span></a></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679932468"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679932468"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-236"></span><span>                   </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679932468"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679932467"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932468"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679932467"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932468"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-237"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932467"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679932468"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-238"></span><span id="findNewEvent"><span class="annot"><span class="annottext">findNewEvent :: Point 2 r
-&gt; LineSegment 2 p r -&gt; LineSegment 2 p r -&gt; Maybe (Event p r)
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#findNewEvent"><span class="hs-identifier hs-var hs-var">findNewEvent</span></a></span></span><span> </span><span id="local-6989586621679932181"><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679932181"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679932180"><span class="annot"><span class="annottext">LineSegment 2 p r
</span><a href="#local-6989586621679932180"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621679932179"><span class="annot"><span class="annottext">LineSegment 2 p r
</span><a href="#local-6989586621679932179"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoRec Identity '[NoIntersection, Point 2 r, LineSegment 2 p r]
-&gt; Handlers
     '[NoIntersection, Point 2 r, LineSegment 2 p r] (Maybe (Event p r))
-&gt; Maybe (Event p r)
forall (ts :: [*]) b. CoRec Identity ts -&gt; Handlers ts b -&gt; b
</span><span class="hs-identifier hs-var">match</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LineSegment 2 p r
</span><a href="#local-6989586621679932180"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r
-&gt; LineSegment 2 p r
-&gt; Intersection (LineSegment 2 p r) (LineSegment 2 p r)
forall g h. IsIntersectableWith g h =&gt; g -&gt; h -&gt; Intersection g h
</span><span class="hs-operator hs-var">`intersect`</span></span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r
</span><a href="#local-6989586621679932179"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Handlers
   '[NoIntersection, Point 2 r, LineSegment 2 p r] (Maybe (Event p r))
 -&gt; Maybe (Event p r))
-&gt; Handlers
     '[NoIntersection, Point 2 r, LineSegment 2 p r] (Maybe (Event p r))
-&gt; Maybe (Event p r)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-239"></span><span>     </span><span class="annot"><span class="annottext">(NoIntersection -&gt; Maybe (Event p r))
-&gt; Handler (Maybe (Event p r)) NoIntersection
forall b a. (a -&gt; b) -&gt; Handler b a
</span><span class="hs-identifier hs-var">H</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (Event p r) -&gt; NoIntersection -&gt; Maybe (Event p r)
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Event p r)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- NoIntersection</span><span>
</span><span id="line-240"></span><span>  </span><span class="annot"><span class="annottext">Handler (Maybe (Event p r)) NoIntersection
-&gt; Rec
     (Handler (Maybe (Event p r))) '[Point 2 r, LineSegment 2 p r]
-&gt; Handlers
     '[NoIntersection, Point 2 r, LineSegment 2 p r] (Maybe (Event p r))
forall u (a :: u -&gt; *) (r :: u) (rs :: [u]).
a r -&gt; Rec a rs -&gt; Rec a (r : rs)
</span><span class="hs-operator hs-var">:&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Point 2 r -&gt; Maybe (Event p r))
-&gt; Handler (Maybe (Event p r)) (Point 2 r)
forall b a. (a -&gt; b) -&gt; Handler b a
</span><span class="hs-identifier hs-var">H</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679932173"><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679932173"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Point 2 r -&gt; Ordering
forall r. Ord r =&gt; Point 2 r -&gt; Point 2 r -&gt; Ordering
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#ordPoints"><span class="hs-identifier hs-var">ordPoints</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679932173"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679932181"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Ordering -&gt; Ordering -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">GT</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Event p r -&gt; Maybe (Event p r)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r -&gt; EventType (LineSegment 2 p r) -&gt; Event p r
forall p r. Point 2 r -&gt; EventType (LineSegment 2 p r) -&gt; Event p r
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-var">Event</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679932173"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">EventType (LineSegment 2 p r)
forall s. EventType s
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Intersection"><span class="hs-identifier hs-var">Intersection</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-241"></span><span>                                     </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe (Event p r)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-242"></span><span>  </span><span class="annot"><span class="annottext">Handler (Maybe (Event p r)) (Point 2 r)
-&gt; Rec (Handler (Maybe (Event p r))) '[LineSegment 2 p r]
-&gt; Rec
     (Handler (Maybe (Event p r))) '[Point 2 r, LineSegment 2 p r]
forall u (a :: u -&gt; *) (r :: u) (rs :: [u]).
a r -&gt; Rec a rs -&gt; Rec a (r : rs)
</span><span class="hs-operator hs-var">:&amp;</span></span><span> </span><span class="annot"><span class="annottext">(LineSegment 2 p r -&gt; Maybe (Event p r))
-&gt; Handler (Maybe (Event p r)) (LineSegment 2 p r)
forall b a. (a -&gt; b) -&gt; Handler b a
</span><span class="hs-identifier hs-var">H</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (Event p r) -&gt; LineSegment 2 p r -&gt; Maybe (Event p r)
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Event p r)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- full segment intersectsions are handled</span><span>
</span><span id="line-243"></span><span>                       </span><span class="hs-comment">-- at insertion time</span><span>
</span><span id="line-244"></span><span>  </span><span class="annot"><span class="annottext">Handler (Maybe (Event p r)) (LineSegment 2 p r)
-&gt; Rec (Handler (Maybe (Event p r))) '[]
-&gt; Rec (Handler (Maybe (Event p r))) '[LineSegment 2 p r]
forall u (a :: u -&gt; *) (r :: u) (rs :: [u]).
a r -&gt; Rec a rs -&gt; Rec a (r : rs)
</span><span class="hs-operator hs-var">:&amp;</span></span><span> </span><span class="annot"><span class="annottext">Rec (Handler (Maybe (Event p r))) '[]
forall u (a :: u -&gt; *). Rec a '[]
</span><span class="hs-identifier hs-var">RNil</span></span><span>
</span><span id="line-245"></span></pre></body></html>