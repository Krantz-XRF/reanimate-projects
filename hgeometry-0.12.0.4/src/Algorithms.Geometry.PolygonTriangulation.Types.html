<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-2"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-3"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-4"></span><span class="hs-comment">-- Module      :  Algorithms.Geometry.PolygonTriangulation.Types</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- Copyright   :  (C) Frank Staals</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- License     :  see the LICENSE file</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- Maintainer  :  Frank Staals</span><span>
</span><span id="line-8"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-9"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Algorithms.Geometry.PolygonTriangulation.Types</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">forM_</span></span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Ext</span></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">F</span></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Data.Geometry.LineSegment.html"><span class="hs-identifier">Data.Geometry.LineSegment</span></a></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Data.Geometry.PlanarSubdivision.Basic.html"><span class="hs-identifier">Data.Geometry.PlanarSubdivision.Basic</span></a></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.List.NonEmpty</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NonEmpty</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.List.NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NonEmpty</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Data.PlaneGraph.html"><span class="hs-identifier">Data.PlaneGraph</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PG</span></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">V</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector.Mutable</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">MV</span></span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span class="hs-comment">-- | After triangulation, edges are either from the original polygon or a new diagonal.</span><span>
</span><span id="line-26"></span><span class="hs-keyword">data</span><span> </span><span id="PolygonEdgeType"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.Types.html#PolygonEdgeType"><span class="hs-identifier hs-var">PolygonEdgeType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Original"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.Types.html#Original"><span class="hs-identifier hs-var">Original</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Diagonal"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.Types.html#Diagonal"><span class="hs-identifier hs-var">Diagonal</span></a></span></span><span>
</span><span id="line-27"></span><span>                     </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679956758"><span id="local-6989586621679956760"><span id="local-6989586621679956762"><span class="annot"><span class="annottext">Int -&gt; PolygonEdgeType -&gt; ShowS
[PolygonEdgeType] -&gt; ShowS
PolygonEdgeType -&gt; String
(Int -&gt; PolygonEdgeType -&gt; ShowS)
-&gt; (PolygonEdgeType -&gt; String)
-&gt; ([PolygonEdgeType] -&gt; ShowS)
-&gt; Show PolygonEdgeType
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [PolygonEdgeType] -&gt; ShowS
$cshowList :: [PolygonEdgeType] -&gt; ShowS
show :: PolygonEdgeType -&gt; String
$cshow :: PolygonEdgeType -&gt; String
showsPrec :: Int -&gt; PolygonEdgeType -&gt; ShowS
$cshowsPrec :: Int -&gt; PolygonEdgeType -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span id="local-6989586621679956749"><span id="local-6989586621679956751"><span id="local-6989586621679956753"><span id="local-6989586621679956755"><span class="annot"><span class="annottext">ReadPrec [PolygonEdgeType]
ReadPrec PolygonEdgeType
Int -&gt; ReadS PolygonEdgeType
ReadS [PolygonEdgeType]
(Int -&gt; ReadS PolygonEdgeType)
-&gt; ReadS [PolygonEdgeType]
-&gt; ReadPrec PolygonEdgeType
-&gt; ReadPrec [PolygonEdgeType]
-&gt; Read PolygonEdgeType
forall a.
(Int -&gt; ReadS a)
-&gt; ReadS [a] -&gt; ReadPrec a -&gt; ReadPrec [a] -&gt; Read a
readListPrec :: ReadPrec [PolygonEdgeType]
$creadListPrec :: ReadPrec [PolygonEdgeType]
readPrec :: ReadPrec PolygonEdgeType
$creadPrec :: ReadPrec PolygonEdgeType
readList :: ReadS [PolygonEdgeType]
$creadList :: ReadS [PolygonEdgeType]
readsPrec :: Int -&gt; ReadS PolygonEdgeType
$creadsPrec :: Int -&gt; ReadS PolygonEdgeType
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Read</span></span></span></span></span></span><span class="hs-special">,</span><span id="local-6989586621679956744"><span id="local-6989586621679956746"><span class="annot"><span class="annottext">PolygonEdgeType -&gt; PolygonEdgeType -&gt; Bool
(PolygonEdgeType -&gt; PolygonEdgeType -&gt; Bool)
-&gt; (PolygonEdgeType -&gt; PolygonEdgeType -&gt; Bool)
-&gt; Eq PolygonEdgeType
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: PolygonEdgeType -&gt; PolygonEdgeType -&gt; Bool
$c/= :: PolygonEdgeType -&gt; PolygonEdgeType -&gt; Bool
== :: PolygonEdgeType -&gt; PolygonEdgeType -&gt; Bool
$c== :: PolygonEdgeType -&gt; PolygonEdgeType -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span class="hs-comment">-- | Given a list of original edges and a list of diagonals, creates a</span><span>
</span><span id="line-30"></span><span class="hs-comment">-- planar-subdivision</span><span>
</span><span id="line-31"></span><span class="hs-comment">--</span><span>
</span><span id="line-32"></span><span class="hs-comment">--</span><span>
</span><span id="line-33"></span><span class="hs-comment">-- running time: \(O(n\log n)\)</span><span>
</span><span id="line-34"></span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.Types.html#constructSubdivision"><span class="hs-identifier hs-type">constructSubdivision</span></a></span><span>                  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679956741"><span class="annot"><a href="#local-6989586621679956741"><span class="hs-identifier hs-type">proxy</span></a></span></span><span> </span><span id="local-6989586621679956740"><span class="annot"><a href="#local-6989586621679956740"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span id="local-6989586621679956739"><span class="annot"><a href="#local-6989586621679956739"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621679956738"><span class="annot"><a href="#local-6989586621679956738"><span class="hs-identifier hs-type">p</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679956740"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679956740"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span>                                      </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679956741"><span class="hs-identifier hs-type">proxy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679956739"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-36"></span><span>                                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679956738"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679956740"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-comment">-- ^ A counter-clockwise</span><span>
</span><span id="line-37"></span><span>                                                         </span><span class="hs-comment">-- edge along the outer</span><span>
</span><span id="line-38"></span><span>                                                         </span><span class="hs-comment">-- boundary</span><span>
</span><span id="line-39"></span><span>                                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679956738"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679956740"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ remaining original edges</span><span>
</span><span id="line-40"></span><span>                                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679956738"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679956740"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ diagonals</span><span>
</span><span id="line-41"></span><span>                                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.PlanarSubdivision.Basic.html#PlanarSubdivision"><span class="hs-identifier hs-type">PlanarSubdivision</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679956739"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-42"></span><span>                                            </span><span class="annot"><a href="#local-6989586621679956738"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.Types.html#PolygonEdgeType"><span class="hs-identifier hs-type">PolygonEdgeType</span></a></span><span> </span><span class="annot"><a href="Data.Geometry.PlanarSubdivision.Basic.html#PolygonFaceData"><span class="hs-identifier hs-type">PolygonFaceData</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679956740"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-43"></span><span id="constructSubdivision"><span class="annot"><span class="annottext">constructSubdivision :: proxy s
-&gt; LineSegment 2 p r
-&gt; [LineSegment 2 p r]
-&gt; [LineSegment 2 p r]
-&gt; PlanarSubdivision s p PolygonEdgeType PolygonFaceData r
</span><a href="Algorithms.Geometry.PolygonTriangulation.Types.html#constructSubdivision"><span class="hs-identifier hs-var hs-var">constructSubdivision</span></a></span></span><span> </span><span id="local-6989586621679956737"><span class="annot"><span class="annottext">proxy s
</span><a href="#local-6989586621679956737"><span class="hs-identifier hs-var">px</span></a></span></span><span> </span><span id="local-6989586621679956736"><span class="annot"><span class="annottext">LineSegment 2 p r
</span><a href="#local-6989586621679956736"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621679956735"><span class="annot"><span class="annottext">[LineSegment 2 p r]
</span><a href="#local-6989586621679956735"><span class="hs-identifier hs-var">origs</span></a></span></span><span> </span><span id="local-6989586621679956734"><span class="annot"><span class="annottext">[LineSegment 2 p r]
</span><a href="#local-6989586621679956734"><span class="hs-identifier hs-var">diags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PlaneGraph s p PolygonEdgeType PolygonFaceData r
-&gt; PlanarSubdivision s p PolygonEdgeType PolygonFaceData r
forall k (s :: k) v e f r.
(Ord r, Fractional r) =&gt;
PlaneGraph s v e f r -&gt; PlanarSubdivision s v e f r
</span><a href="Data.Geometry.PlanarSubdivision.Basic.html#fromPlaneGraph"><span class="hs-identifier hs-var">fromPlaneGraph</span></a></span><span> </span><span class="annot"><span class="annottext">(PlaneGraph s p PolygonEdgeType PolygonFaceData r
 -&gt; PlanarSubdivision s p PolygonEdgeType PolygonFaceData r)
-&gt; PlaneGraph s p PolygonEdgeType PolygonFaceData r
-&gt; PlanarSubdivision s p PolygonEdgeType PolygonFaceData r
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">proxy s
-&gt; LineSegment 2 p r
-&gt; [LineSegment 2 p r]
-&gt; [LineSegment 2 p r]
-&gt; PlaneGraph s p PolygonEdgeType PolygonFaceData r
forall k (proxy :: k -&gt; *) r (s :: k) p.
(Fractional r, Ord r) =&gt;
proxy s
-&gt; LineSegment 2 p r
-&gt; [LineSegment 2 p r]
-&gt; [LineSegment 2 p r]
-&gt; PlaneGraph s p PolygonEdgeType PolygonFaceData r
</span><a href="Algorithms.Geometry.PolygonTriangulation.Types.html#constructGraph"><span class="hs-identifier hs-var">constructGraph</span></a></span><span> </span><span class="annot"><span class="annottext">proxy s
</span><a href="#local-6989586621679956737"><span class="hs-identifier hs-var">px</span></a></span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r
</span><a href="#local-6989586621679956736"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r]
</span><a href="#local-6989586621679956735"><span class="hs-identifier hs-var">origs</span></a></span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r]
</span><a href="#local-6989586621679956734"><span class="hs-identifier hs-var">diags</span></a></span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span class="hs-comment">-- constructSubdivision px e origs diags =</span><span>
</span><span id="line-46"></span><span class="hs-comment">--     subdiv &amp; rawVertexData.traverse.dataVal  %~ NonEmpty.head</span><span>
</span><span id="line-47"></span><span class="hs-comment">--            &amp; rawFaceData                     %~ V.zipWith zipF faceData'</span><span>
</span><span id="line-48"></span><span class="hs-comment">--            &amp; rawDartData.traverse.dataVal    %~ snd</span><span>
</span><span id="line-49"></span><span class="hs-comment">--   where</span><span>
</span><span id="line-50"></span><span class="hs-comment">--     subdiv :: PlanarSubdivision s (NonEmpty p) (Bool,PolygonEdgeType) () r</span><span>
</span><span id="line-51"></span><span class="hs-comment">--     subdiv = fromConnectedSegments px $ e' : origs' &lt;&gt; diags'</span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span class="hs-comment">--     diags' = (:+ (True, Diagonal)) &lt;$&gt; diags</span><span>
</span><span id="line-54"></span><span class="hs-comment">--     origs' = (:+ (False,Original)) &lt;$&gt; origs</span><span>
</span><span id="line-55"></span><span class="hs-comment">--     e'     = e :+ (True, Original)</span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span class="hs-comment">--     -- the darts incident to internal faces</span><span>
</span><span id="line-58"></span><span class="hs-comment">--     queryDarts = concatMap shouldQuery . F.toList . edges' $ subdiv</span><span>
</span><span id="line-59"></span><span class="hs-comment">--     shouldQuery d = case subdiv^.dataOf d of</span><span>
</span><span id="line-60"></span><span class="hs-comment">--                       (True, Original) -&gt; [d]</span><span>
</span><span id="line-61"></span><span class="hs-comment">--                       (True, Diagonal) -&gt; [d, twin d]</span><span>
</span><span id="line-62"></span><span class="hs-comment">--                       _                -&gt; []</span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span class="hs-comment">--     -- the interior faces</span><span>
</span><span id="line-65"></span><span class="hs-comment">--     intFaces = flip leftFace subdiv &lt;$&gt; queryDarts</span><span>
</span><span id="line-66"></span><span class="hs-comment">--     faceData' = V.create $ do</span><span>
</span><span id="line-67"></span><span class="hs-comment">--                   v' &lt;- MV.replicate (numFaces subdiv) Outside</span><span>
</span><span id="line-68"></span><span class="hs-comment">--                   forM_ intFaces $ \(PG.FaceId (PG.VertexId f)) -&gt;</span><span>
</span><span id="line-69"></span><span class="hs-comment">--                     MV.write v' f Inside</span><span>
</span><span id="line-70"></span><span class="hs-comment">--                   pure v'</span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span class="hs-comment">--     -- set the inside/outside data value</span><span>
</span><span id="line-73"></span><span class="hs-comment">--     zipF x rfd = rfd&amp;dataVal .~ x</span><span>
</span><span id="line-74"></span><span class="hs-comment">-- -- TODO: Idea: generalize the face data assignment into a function</span><span>
</span><span id="line-75"></span><span class="hs-comment">-- -- that does something like: [(Dart, fLeft, fRight] -&gt; FaceData</span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span class="hs-comment">-- | Given a list of original edges and a list of diagonals, creates a</span><span>
</span><span id="line-79"></span><span class="hs-comment">-- planar-subdivision</span><span>
</span><span id="line-80"></span><span class="hs-comment">--</span><span>
</span><span id="line-81"></span><span class="hs-comment">--</span><span>
</span><span id="line-82"></span><span class="hs-comment">-- running time: \(O(n\log n)\)</span><span>
</span><span id="line-83"></span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.Types.html#constructGraph"><span class="hs-identifier hs-type">constructGraph</span></a></span><span>                  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679956893"><span class="annot"><a href="#local-6989586621679956893"><span class="hs-identifier hs-type">proxy</span></a></span></span><span> </span><span id="local-6989586621679956894"><span class="annot"><a href="#local-6989586621679956894"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span id="local-6989586621679956892"><span class="annot"><a href="#local-6989586621679956892"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621679956891"><span class="annot"><a href="#local-6989586621679956891"><span class="hs-identifier hs-type">p</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679956894"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679956894"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span>                                      </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679956893"><span class="hs-identifier hs-type">proxy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679956892"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-85"></span><span>                                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679956891"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679956894"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-comment">-- ^ A counter-clockwise</span><span>
</span><span id="line-86"></span><span>                                                         </span><span class="hs-comment">-- edge along the outer</span><span>
</span><span id="line-87"></span><span>                                                         </span><span class="hs-comment">-- boundary</span><span>
</span><span id="line-88"></span><span>                                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679956891"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679956894"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ remaining original edges</span><span>
</span><span id="line-89"></span><span>                                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679956891"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679956894"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ diagonals</span><span>
</span><span id="line-90"></span><span>                                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.PlaneGraph.Core.html#PlaneGraph"><span class="hs-identifier hs-type">PG.PlaneGraph</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679956892"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-91"></span><span>                                            </span><span class="annot"><a href="#local-6989586621679956891"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.Types.html#PolygonEdgeType"><span class="hs-identifier hs-type">PolygonEdgeType</span></a></span><span> </span><span class="annot"><a href="Data.Geometry.PlanarSubdivision.Basic.html#PolygonFaceData"><span class="hs-identifier hs-type">PolygonFaceData</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679956894"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-92"></span><span id="constructGraph"><span class="annot"><span class="annottext">constructGraph :: proxy s
-&gt; LineSegment 2 p r
-&gt; [LineSegment 2 p r]
-&gt; [LineSegment 2 p r]
-&gt; PlaneGraph s p PolygonEdgeType PolygonFaceData r
</span><a href="Algorithms.Geometry.PolygonTriangulation.Types.html#constructGraph"><span class="hs-identifier hs-var hs-var">constructGraph</span></a></span></span><span> </span><span id="local-6989586621679956731"><span class="annot"><span class="annottext">proxy s
</span><a href="#local-6989586621679956731"><span class="hs-identifier hs-var">px</span></a></span></span><span> </span><span id="local-6989586621679956730"><span class="annot"><span class="annottext">LineSegment 2 p r
</span><a href="#local-6989586621679956730"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621679956729"><span class="annot"><span class="annottext">[LineSegment 2 p r]
</span><a href="#local-6989586621679956729"><span class="hs-identifier hs-var">origs</span></a></span></span><span> </span><span id="local-6989586621679956728"><span class="annot"><span class="annottext">[LineSegment 2 p r]
</span><a href="#local-6989586621679956728"><span class="hs-identifier hs-var">diags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-93"></span><span>    </span><span class="annot"><span class="annottext">PlaneGraph s (NonEmpty p) (Bool, PolygonEdgeType) () r
</span><a href="#local-6989586621679956727"><span class="hs-identifier hs-var">subdiv</span></a></span><span> </span><span class="annot"><span class="annottext">PlaneGraph s (NonEmpty p) (Bool, PolygonEdgeType) () r
-&gt; (PlaneGraph s (NonEmpty p) (Bool, PolygonEdgeType) () r
    -&gt; PlaneGraph s p (Bool, PolygonEdgeType) () r)
-&gt; PlaneGraph s p (Bool, PolygonEdgeType) () r
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Vector (NonEmpty p) -&gt; Identity (Vector p))
-&gt; PlaneGraph s (NonEmpty p) (Bool, PolygonEdgeType) () r
-&gt; Identity (PlaneGraph s p (Bool, PolygonEdgeType) () r)
forall k (s :: k) v e f r v'.
Lens
  (PlaneGraph s v e f r)
  (PlaneGraph s v' e f r)
  (Vector v)
  (Vector v')
</span><a href="Data.PlaneGraph.Core.html#vertexData"><span class="hs-identifier hs-var">PG.vertexData</span></a></span><span class="annot"><span class="annottext">((Vector (NonEmpty p) -&gt; Identity (Vector p))
 -&gt; PlaneGraph s (NonEmpty p) (Bool, PolygonEdgeType) () r
 -&gt; Identity (PlaneGraph s p (Bool, PolygonEdgeType) () r))
-&gt; ((NonEmpty p -&gt; Identity p)
    -&gt; Vector (NonEmpty p) -&gt; Identity (Vector p))
-&gt; (NonEmpty p -&gt; Identity p)
-&gt; PlaneGraph s (NonEmpty p) (Bool, PolygonEdgeType) () r
-&gt; Identity (PlaneGraph s p (Bool, PolygonEdgeType) () r)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(NonEmpty p -&gt; Identity p)
-&gt; Vector (NonEmpty p) -&gt; Identity (Vector p)
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span>  </span><span class="annot"><span class="annottext">((NonEmpty p -&gt; Identity p)
 -&gt; PlaneGraph s (NonEmpty p) (Bool, PolygonEdgeType) () r
 -&gt; Identity (PlaneGraph s p (Bool, PolygonEdgeType) () r))
-&gt; (NonEmpty p -&gt; p)
-&gt; PlaneGraph s (NonEmpty p) (Bool, PolygonEdgeType) () r
-&gt; PlaneGraph s p (Bool, PolygonEdgeType) () r
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-operator hs-var">%~</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty p -&gt; p
forall a. NonEmpty a -&gt; a
</span><span class="hs-identifier hs-var">NonEmpty.head</span></span><span>
</span><span id="line-94"></span><span>           </span><span class="annot"><span class="annottext">PlaneGraph s p (Bool, PolygonEdgeType) () r
-&gt; (PlaneGraph s p (Bool, PolygonEdgeType) () r
    -&gt; PlaneGraph s p (Bool, PolygonEdgeType) PolygonFaceData r)
-&gt; PlaneGraph s p (Bool, PolygonEdgeType) PolygonFaceData r
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Vector () -&gt; Identity (Vector PolygonFaceData))
-&gt; PlaneGraph s p (Bool, PolygonEdgeType) () r
-&gt; Identity
     (PlaneGraph s p (Bool, PolygonEdgeType) PolygonFaceData r)
forall k (s :: k) v e f r f'.
Lens
  (PlaneGraph s v e f r)
  (PlaneGraph s v e f' r)
  (Vector f)
  (Vector f')
</span><a href="Data.PlaneGraph.Core.html#faceData"><span class="hs-identifier hs-var">PG.faceData</span></a></span><span>             </span><span class="annot"><span class="annottext">((Vector () -&gt; Identity (Vector PolygonFaceData))
 -&gt; PlaneGraph s p (Bool, PolygonEdgeType) () r
 -&gt; Identity
      (PlaneGraph s p (Bool, PolygonEdgeType) PolygonFaceData r))
-&gt; Vector PolygonFaceData
-&gt; PlaneGraph s p (Bool, PolygonEdgeType) () r
-&gt; PlaneGraph s p (Bool, PolygonEdgeType) PolygonFaceData r
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">Vector PolygonFaceData
</span><a href="#local-6989586621679956718"><span class="hs-identifier hs-var">faceData'</span></a></span><span>
</span><span id="line-95"></span><span>           </span><span class="annot"><span class="annottext">PlaneGraph s p (Bool, PolygonEdgeType) PolygonFaceData r
-&gt; (PlaneGraph s p (Bool, PolygonEdgeType) PolygonFaceData r
    -&gt; PlaneGraph s p PolygonEdgeType PolygonFaceData r)
-&gt; PlaneGraph s p PolygonEdgeType PolygonFaceData r
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Vector (Bool, PolygonEdgeType)
 -&gt; Identity (Vector PolygonEdgeType))
-&gt; PlaneGraph s p (Bool, PolygonEdgeType) PolygonFaceData r
-&gt; Identity (PlaneGraph s p PolygonEdgeType PolygonFaceData r)
forall k (s :: k) v e f r e'.
Lens
  (PlaneGraph s v e f r)
  (PlaneGraph s v e' f r)
  (Vector e)
  (Vector e')
</span><a href="Data.PlaneGraph.Core.html#rawDartData"><span class="hs-identifier hs-var">PG.rawDartData</span></a></span><span class="annot"><span class="annottext">((Vector (Bool, PolygonEdgeType)
  -&gt; Identity (Vector PolygonEdgeType))
 -&gt; PlaneGraph s p (Bool, PolygonEdgeType) PolygonFaceData r
 -&gt; Identity (PlaneGraph s p PolygonEdgeType PolygonFaceData r))
-&gt; (((Bool, PolygonEdgeType) -&gt; Identity PolygonEdgeType)
    -&gt; Vector (Bool, PolygonEdgeType)
    -&gt; Identity (Vector PolygonEdgeType))
-&gt; ((Bool, PolygonEdgeType) -&gt; Identity PolygonEdgeType)
-&gt; PlaneGraph s p (Bool, PolygonEdgeType) PolygonFaceData r
-&gt; Identity (PlaneGraph s p PolygonEdgeType PolygonFaceData r)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">((Bool, PolygonEdgeType) -&gt; Identity PolygonEdgeType)
-&gt; Vector (Bool, PolygonEdgeType)
-&gt; Identity (Vector PolygonEdgeType)
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">(((Bool, PolygonEdgeType) -&gt; Identity PolygonEdgeType)
 -&gt; PlaneGraph s p (Bool, PolygonEdgeType) PolygonFaceData r
 -&gt; Identity (PlaneGraph s p PolygonEdgeType PolygonFaceData r))
-&gt; ((Bool, PolygonEdgeType) -&gt; PolygonEdgeType)
-&gt; PlaneGraph s p (Bool, PolygonEdgeType) PolygonFaceData r
-&gt; PlaneGraph s p PolygonEdgeType PolygonFaceData r
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-operator hs-var">%~</span></span><span> </span><span class="annot"><span class="annottext">(Bool, PolygonEdgeType) -&gt; PolygonEdgeType
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span>
</span><span id="line-96"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-97"></span><span>    </span><span class="annot"><a href="#local-6989586621679956727"><span class="hs-identifier hs-type">subdiv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.PlaneGraph.Core.html#PlaneGraph"><span class="hs-identifier hs-type">PG.PlaneGraph</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679956892"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="annot"><a href="#local-6989586621679956891"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">,</span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.Types.html#PolygonEdgeType"><span class="hs-identifier hs-type">PolygonEdgeType</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679956894"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-98"></span><span>    </span><span id="local-6989586621679956727"><span class="annot"><span class="annottext">subdiv :: PlaneGraph s (NonEmpty p) (Bool, PolygonEdgeType) () r
</span><a href="#local-6989586621679956727"><span class="hs-identifier hs-var hs-var">subdiv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">proxy s
-&gt; [LineSegment 2 p r :+ (Bool, PolygonEdgeType)]
-&gt; PlaneGraph s (NonEmpty p) (Bool, PolygonEdgeType) () r
forall k (f :: * -&gt; *) r (proxy :: k -&gt; *) (s :: k) p e.
(Foldable f, Ord r, Num r) =&gt;
proxy s
-&gt; f (LineSegment 2 p r :+ e) -&gt; PlaneGraph s (NonEmpty p) e () r
</span><a href="Data.PlaneGraph.Core.html#fromConnectedSegments"><span class="hs-identifier hs-var">PG.fromConnectedSegments</span></a></span><span> </span><span class="annot"><span class="annottext">proxy s
</span><a href="#local-6989586621679956731"><span class="hs-identifier hs-var">px</span></a></span><span> </span><span class="annot"><span class="annottext">([LineSegment 2 p r :+ (Bool, PolygonEdgeType)]
 -&gt; PlaneGraph s (NonEmpty p) (Bool, PolygonEdgeType) () r)
-&gt; [LineSegment 2 p r :+ (Bool, PolygonEdgeType)]
-&gt; PlaneGraph s (NonEmpty p) (Bool, PolygonEdgeType) () r
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r :+ (Bool, PolygonEdgeType)
</span><a href="#local-6989586621679956715"><span class="hs-identifier hs-var">e'</span></a></span><span> </span><span class="annot"><span class="annottext">(LineSegment 2 p r :+ (Bool, PolygonEdgeType))
-&gt; [LineSegment 2 p r :+ (Bool, PolygonEdgeType)]
-&gt; [LineSegment 2 p r :+ (Bool, PolygonEdgeType)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r :+ (Bool, PolygonEdgeType)]
</span><a href="#local-6989586621679956714"><span class="hs-identifier hs-var">origs'</span></a></span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r :+ (Bool, PolygonEdgeType)]
-&gt; [LineSegment 2 p r :+ (Bool, PolygonEdgeType)]
-&gt; [LineSegment 2 p r :+ (Bool, PolygonEdgeType)]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r :+ (Bool, PolygonEdgeType)]
</span><a href="#local-6989586621679956713"><span class="hs-identifier hs-var">diags'</span></a></span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span>    </span><span id="local-6989586621679956713"><span class="annot"><span class="annottext">diags' :: [LineSegment 2 p r :+ (Bool, PolygonEdgeType)]
</span><a href="#local-6989586621679956713"><span class="hs-identifier hs-var hs-var">diags'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LineSegment 2 p r
-&gt; (Bool, PolygonEdgeType)
-&gt; LineSegment 2 p r :+ (Bool, PolygonEdgeType)
forall core extra. core -&gt; extra -&gt; core :+ extra
</span><span class="hs-operator hs-var">:+</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PolygonEdgeType
</span><a href="Algorithms.Geometry.PolygonTriangulation.Types.html#Diagonal"><span class="hs-identifier hs-var">Diagonal</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(LineSegment 2 p r -&gt; LineSegment 2 p r :+ (Bool, PolygonEdgeType))
-&gt; [LineSegment 2 p r]
-&gt; [LineSegment 2 p r :+ (Bool, PolygonEdgeType)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r]
</span><a href="#local-6989586621679956728"><span class="hs-identifier hs-var">diags</span></a></span><span>
</span><span id="line-101"></span><span>    </span><span id="local-6989586621679956714"><span class="annot"><span class="annottext">origs' :: [LineSegment 2 p r :+ (Bool, PolygonEdgeType)]
</span><a href="#local-6989586621679956714"><span class="hs-identifier hs-var hs-var">origs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LineSegment 2 p r
-&gt; (Bool, PolygonEdgeType)
-&gt; LineSegment 2 p r :+ (Bool, PolygonEdgeType)
forall core extra. core -&gt; extra -&gt; core :+ extra
</span><span class="hs-operator hs-var">:+</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">PolygonEdgeType
</span><a href="Algorithms.Geometry.PolygonTriangulation.Types.html#Original"><span class="hs-identifier hs-var">Original</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(LineSegment 2 p r -&gt; LineSegment 2 p r :+ (Bool, PolygonEdgeType))
-&gt; [LineSegment 2 p r]
-&gt; [LineSegment 2 p r :+ (Bool, PolygonEdgeType)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r]
</span><a href="#local-6989586621679956729"><span class="hs-identifier hs-var">origs</span></a></span><span>
</span><span id="line-102"></span><span>    </span><span id="local-6989586621679956715"><span class="annot"><span class="annottext">e' :: LineSegment 2 p r :+ (Bool, PolygonEdgeType)
</span><a href="#local-6989586621679956715"><span class="hs-identifier hs-var hs-var">e'</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r
</span><a href="#local-6989586621679956730"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r
-&gt; (Bool, PolygonEdgeType)
-&gt; LineSegment 2 p r :+ (Bool, PolygonEdgeType)
forall core extra. core -&gt; extra -&gt; core :+ extra
</span><span class="hs-operator hs-var">:+</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PolygonEdgeType
</span><a href="Algorithms.Geometry.PolygonTriangulation.Types.html#Original"><span class="hs-identifier hs-var">Original</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span>    </span><span class="hs-comment">-- the darts incident to internal faces</span><span>
</span><span id="line-105"></span><span>    </span><span id="local-6989586621679956710"><span class="annot"><span class="annottext">queryDarts :: [Dart s]
</span><a href="#local-6989586621679956710"><span class="hs-identifier hs-var hs-var">queryDarts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Dart s -&gt; [Dart s]) -&gt; [Dart s] -&gt; [Dart s]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">Dart s -&gt; [Dart s]
</span><a href="#local-6989586621679956708"><span class="hs-identifier hs-var">shouldQuery</span></a></span><span> </span><span class="annot"><span class="annottext">([Dart s] -&gt; [Dart s])
-&gt; (PlaneGraph s (NonEmpty p) (Bool, PolygonEdgeType) () r
    -&gt; [Dart s])
-&gt; PlaneGraph s (NonEmpty p) (Bool, PolygonEdgeType) () r
-&gt; [Dart s]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Vector (Dart s) -&gt; [Dart s]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">F.toList</span></span><span> </span><span class="annot"><span class="annottext">(Vector (Dart s) -&gt; [Dart s])
-&gt; (PlaneGraph s (NonEmpty p) (Bool, PolygonEdgeType) () r
    -&gt; Vector (Dart s))
-&gt; PlaneGraph s (NonEmpty p) (Bool, PolygonEdgeType) () r
-&gt; [Dart s]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PlaneGraph s (NonEmpty p) (Bool, PolygonEdgeType) () r
-&gt; Vector (Dart s)
forall k (s :: k) v e f r. PlaneGraph s v e f r -&gt; Vector (Dart s)
</span><a href="Data.PlaneGraph.Core.html#edges%27"><span class="hs-identifier hs-var">PG.edges'</span></a></span><span> </span><span class="annot"><span class="annottext">(PlaneGraph s (NonEmpty p) (Bool, PolygonEdgeType) () r
 -&gt; [Dart s])
-&gt; PlaneGraph s (NonEmpty p) (Bool, PolygonEdgeType) () r
-&gt; [Dart s]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PlaneGraph s (NonEmpty p) (Bool, PolygonEdgeType) () r
</span><a href="#local-6989586621679956727"><span class="hs-identifier hs-var">subdiv</span></a></span><span>
</span><span id="line-106"></span><span>    </span><span id="local-6989586621679956708"><span class="annot"><span class="annottext">shouldQuery :: Dart s -&gt; [Dart s]
</span><a href="#local-6989586621679956708"><span class="hs-identifier hs-var hs-var">shouldQuery</span></a></span></span><span> </span><span id="local-6989586621679956705"><span class="annot"><span class="annottext">Dart s
</span><a href="#local-6989586621679956705"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PlaneGraph s (NonEmpty p) (Bool, PolygonEdgeType) () r
</span><a href="#local-6989586621679956727"><span class="hs-identifier hs-var">subdiv</span></a></span><span class="annot"><span class="annottext">PlaneGraph s (NonEmpty p) (Bool, PolygonEdgeType) () r
-&gt; Getting
     (Bool, PolygonEdgeType)
     (PlaneGraph s (NonEmpty p) (Bool, PolygonEdgeType) () r)
     (Bool, PolygonEdgeType)
-&gt; (Bool, PolygonEdgeType)
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Dart s
-&gt; Lens'
     (PlaneGraph s (NonEmpty p) (Bool, PolygonEdgeType) () r)
     (DataOf
        (PlaneGraph s (NonEmpty p) (Bool, PolygonEdgeType) () r) (Dart s))
forall g i. HasDataOf g i =&gt; i -&gt; Lens' g (DataOf g i)
</span><span class="hs-identifier hs-var">dataOf</span></span><span> </span><span class="annot"><span class="annottext">Dart s
</span><a href="#local-6989586621679956705"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-107"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PolygonEdgeType
</span><a href="Algorithms.Geometry.PolygonTriangulation.Types.html#Original"><span class="hs-identifier hs-var">Original</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Dart s
</span><a href="#local-6989586621679956705"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-108"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PolygonEdgeType
</span><a href="Algorithms.Geometry.PolygonTriangulation.Types.html#Diagonal"><span class="hs-identifier hs-var">Diagonal</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Dart s
</span><a href="#local-6989586621679956705"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Dart s -&gt; Dart s
forall k (s :: k). Dart s -&gt; Dart s
</span><span class="hs-identifier hs-var">twin</span></span><span> </span><span class="annot"><span class="annottext">Dart s
</span><a href="#local-6989586621679956705"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-109"></span><span>                      </span><span class="annot"><span class="annottext">(Bool, PolygonEdgeType)
</span><span class="hs-identifier">_</span></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span>    </span><span class="hs-comment">-- the interior faces</span><span>
</span><span id="line-112"></span><span>    </span><span id="local-6989586621679956701"><span class="annot"><span class="annottext">intFaces :: [FaceId' s]
</span><a href="#local-6989586621679956701"><span class="hs-identifier hs-var hs-var">intFaces</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Dart s
 -&gt; PlaneGraph s (NonEmpty p) (Bool, PolygonEdgeType) () r
 -&gt; FaceId' s)
-&gt; PlaneGraph s (NonEmpty p) (Bool, PolygonEdgeType) () r
-&gt; Dart s
-&gt; FaceId' s
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">Dart s
-&gt; PlaneGraph s (NonEmpty p) (Bool, PolygonEdgeType) () r
-&gt; FaceId' s
forall k (s :: k) v e f r.
Dart s -&gt; PlaneGraph s v e f r -&gt; FaceId' s
</span><a href="Data.PlaneGraph.Core.html#leftFace"><span class="hs-identifier hs-var">PG.leftFace</span></a></span><span> </span><span class="annot"><span class="annottext">PlaneGraph s (NonEmpty p) (Bool, PolygonEdgeType) () r
</span><a href="#local-6989586621679956727"><span class="hs-identifier hs-var">subdiv</span></a></span><span> </span><span class="annot"><span class="annottext">(Dart s -&gt; FaceId' s) -&gt; [Dart s] -&gt; [FaceId' s]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Dart s]
</span><a href="#local-6989586621679956710"><span class="hs-identifier hs-var">queryDarts</span></a></span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span>    </span><span class="annot"><a href="#local-6989586621679956718"><span class="hs-identifier hs-type">faceData'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V.Vector</span></span><span> </span><span class="annot"><a href="Data.Geometry.PlanarSubdivision.Basic.html#PolygonFaceData"><span class="hs-identifier hs-type">PolygonFaceData</span></a></span><span>
</span><span id="line-115"></span><span>    </span><span id="local-6989586621679956718"><span class="annot"><span class="annottext">faceData' :: Vector PolygonFaceData
</span><a href="#local-6989586621679956718"><span class="hs-identifier hs-var hs-var">faceData'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall s. ST s (MVector s PolygonFaceData))
-&gt; Vector PolygonFaceData
forall a. (forall s. ST s (MVector s a)) -&gt; Vector a
</span><span class="hs-identifier hs-var">V.create</span></span><span> </span><span class="annot"><span class="annottext">((forall s. ST s (MVector s PolygonFaceData))
 -&gt; Vector PolygonFaceData)
-&gt; (forall s. ST s (MVector s PolygonFaceData))
-&gt; Vector PolygonFaceData
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-116"></span><span>                  </span><span id="local-6989586621679956697"><span class="annot"><span class="annottext">MVector s PolygonFaceData
</span><a href="#local-6989586621679956697"><span class="hs-identifier hs-var">v'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; PolygonFaceData
-&gt; ST s (MVector (PrimState (ST s)) PolygonFaceData)
forall (m :: * -&gt; *) a.
PrimMonad m =&gt;
Int -&gt; a -&gt; m (MVector (PrimState m) a)
</span><span class="hs-identifier hs-var">MV.replicate</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PlaneGraph s (NonEmpty p) (Bool, PolygonEdgeType) () r -&gt; Int
forall k (s :: k) v e f r. PlaneGraph s v e f r -&gt; Int
</span><a href="Data.PlaneGraph.Core.html#numFaces"><span class="hs-identifier hs-var">PG.numFaces</span></a></span><span> </span><span class="annot"><span class="annottext">PlaneGraph s (NonEmpty p) (Bool, PolygonEdgeType) () r
</span><a href="#local-6989586621679956727"><span class="hs-identifier hs-var">subdiv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PolygonFaceData
</span><a href="Data.Geometry.PlanarSubdivision.Basic.html#Outside"><span class="hs-identifier hs-var">Outside</span></a></span><span>
</span><span id="line-117"></span><span>                  </span><span class="annot"><span class="annottext">[FaceId' s] -&gt; (FaceId' s -&gt; ST s ()) -&gt; ST s ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="annot"><span class="annottext">[FaceId' s]
</span><a href="#local-6989586621679956701"><span class="hs-identifier hs-var">intFaces</span></a></span><span> </span><span class="annot"><span class="annottext">((FaceId' s -&gt; ST s ()) -&gt; ST s ())
-&gt; (FaceId' s -&gt; ST s ()) -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PG.FaceId</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PG.VertexId</span></span><span> </span><span id="local-6989586621679956691"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679956691"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-118"></span><span>                    </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) PolygonFaceData
-&gt; Int -&gt; PolygonFaceData -&gt; ST s ()
forall (m :: * -&gt; *) a.
PrimMonad m =&gt;
MVector (PrimState m) a -&gt; Int -&gt; a -&gt; m ()
</span><span class="hs-identifier hs-var">MV.write</span></span><span> </span><span class="annot"><span class="annottext">MVector s PolygonFaceData
MVector (PrimState (ST s)) PolygonFaceData
</span><a href="#local-6989586621679956697"><span class="hs-identifier hs-var">v'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679956691"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">PolygonFaceData
</span><a href="Data.Geometry.PlanarSubdivision.Basic.html#Inside"><span class="hs-identifier hs-var">Inside</span></a></span><span>
</span><span id="line-119"></span><span>                  </span><span class="annot"><span class="annottext">MVector s PolygonFaceData -&gt; ST s (MVector s PolygonFaceData)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">MVector s PolygonFaceData
</span><a href="#local-6989586621679956697"><span class="hs-identifier hs-var">v'</span></a></span><span>
</span><span id="line-120"></span><span>
</span><span id="line-121"></span><span class="hs-comment">-- -constructSubdivision px e origs diags =</span><span>
</span><span id="line-122"></span><span class="hs-comment">-- -    subdiv &amp; planeGraph.PG.vertexData.traverse        %~ NonEmpty.head</span><span>
</span><span id="line-123"></span><span class="hs-comment">-- -           &amp; planeGraph.PG.faceData                   .~ faceData'</span><span>
</span><span id="line-124"></span><span class="hs-comment">-- -           &amp; planeGraph.PG.rawDartData.traverse.eData %~ snd</span><span>
</span><span id="line-125"></span><span class="hs-comment">-- -  where</span><span>
</span><span id="line-126"></span><span class="hs-comment">-- -    subdiv = fromConnectedSegments px $ e' : origs' &lt;&gt; diags'</span><span>
</span><span id="line-127"></span><span class="hs-comment">-- -</span><span>
</span><span id="line-128"></span><span class="hs-comment">-- -    diags' = (:+ EdgeData Visible (True, Diagonal)) &lt;$&gt; diags</span><span>
</span><span id="line-129"></span><span class="hs-comment">-- -    origs' = (:+ EdgeData Visible (False,Original)) &lt;$&gt; origs</span><span>
</span><span id="line-130"></span><span class="hs-comment">-- -    e'     = e :+ EdgeData Visible (True, Original)</span><span>
</span><span id="line-131"></span><span class="hs-comment">-- -</span><span>
</span><span id="line-132"></span><span class="hs-comment">-- -    g = subdiv^.planeGraph</span><span>
</span><span id="line-133"></span><span class="hs-comment">-- -</span><span>
</span><span id="line-134"></span><span class="hs-comment">-- -    -- the darts incident to internal faces</span><span>
</span><span id="line-135"></span><span class="hs-comment">-- -    queryDarts = concatMap shouldQuery . F.toList . PG.edges' $ g</span><span>
</span><span id="line-136"></span><span class="hs-comment">-- -    shouldQuery d = case g^.dataOf d.eData of</span><span>
</span><span id="line-137"></span><span class="hs-comment">-- -                      (True, Original) -&gt; [d]</span><span>
</span><span id="line-138"></span><span class="hs-comment">-- -                      (True, Diagonal) -&gt; [d, twin d]</span><span>
</span><span id="line-139"></span><span class="hs-comment">-- -                      _                -&gt; []</span><span>
</span><span id="line-140"></span><span class="hs-comment">-- -</span><span>
</span><span id="line-141"></span><span class="hs-comment">-- -    -- the interior faces</span><span>
</span><span id="line-142"></span><span class="hs-comment">-- -    intFaces = flip PG.leftFace g &lt;$&gt; queryDarts</span><span>
</span><span id="line-143"></span><span class="hs-comment">-- -    faceData' = V.create $ do</span><span>
</span><span id="line-144"></span><span class="hs-comment">-- -                  v' &lt;- MV.replicate (PG.numFaces g) (FaceData [] Outside)</span><span>
</span><span id="line-145"></span><span class="hs-comment">-- -                  forM_ intFaces $ \(PG.FaceId (PG.VertexId f)) -&gt;</span><span>
</span><span id="line-146"></span><span class="hs-comment">-- -                    MV.write v' f (FaceData [] Inside)</span><span>
</span><span id="line-147"></span><span class="hs-comment">-- -                  pure v'</span><span>
</span><span id="line-148"></span></pre></body></html>