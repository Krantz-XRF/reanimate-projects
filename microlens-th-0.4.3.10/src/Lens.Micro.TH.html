<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span id="%24con2tag_BZ8L98Fmb6nI5zAE1pDwFG"></span><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE Trustworthy #-}</span><span class="hs-cpp">

#ifndef MIN_VERSION_template_haskell
</span><span class="hs-cpp">#define MIN_VERSION_template_haskell(x,y,z) (defined(__GLASGOW_HASKELL__) &amp;&amp; __GLASGOW_HASKELL__ &gt;= 706)
</span><span class="hs-cpp">#endif
</span><span class="hs-cpp">
#ifndef MIN_VERSION_containers
</span><span class="hs-cpp">#define MIN_VERSION_containers(x,y,z) 1
</span><span class="hs-cpp">#endif
</span><span class="hs-cpp">
#if __GLASGOW_HASKELL__ &gt;= 800
</span><span class="hs-pragma">{-# LANGUAGE TemplateHaskellQuotes #-}</span><span class="hs-cpp">
#else
</span><span class="hs-pragma">{-# LANGUAGE TemplateHaskell #-}</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span class="hs-comment">{- |
Module      :  Lens.Micro.TH
Copyright   :  (C) 2013-2016 Eric Mertens, Edward Kmett, Artyom Kazak; 2018 Monadfix
License     :  BSD-style (see the file LICENSE)
-}</span><span>
</span><span id="line-27"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Lens.Micro.TH</span><span>
</span><span id="line-28"></span><span class="hs-special">(</span><span>
</span><span id="line-29"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Dealing with &#8220;not in scope&#8221; errors</span></span><span>
</span><span id="line-30"></span><span>  </span><span class="annot"><span class="hs-comment">-- $errors-note</span></span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Using this module in GHCi</span></span><span>
</span><span id="line-33"></span><span>  </span><span class="annot"><span class="hs-comment">-- $ghci-note</span></span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span>  </span><span class="annot"><span class="hs-comment">-- * 'SimpleGetter' and 'SimpleFold'</span></span><span>
</span><span id="line-36"></span><span>  </span><span class="annot"><span class="hs-comment">-- $getter-fold-note</span></span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Generating lenses</span></span><span>
</span><span id="line-39"></span><span>  </span><span class="annot"><a href="Lens.Micro.TH.html#makeLenses"><span class="hs-identifier">makeLenses</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>  </span><span class="annot"><a href="Lens.Micro.TH.html#makeLensesFor"><span class="hs-identifier">makeLensesFor</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>  </span><span class="annot"><a href="Lens.Micro.TH.html#makeLensesWith"><span class="hs-identifier">makeLensesWith</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-42"></span><span>  </span><span class="annot"><a href="Lens.Micro.TH.html#makeFields"><span class="hs-identifier">makeFields</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>  </span><span class="annot"><a href="Lens.Micro.TH.html#makeClassy"><span class="hs-identifier">makeClassy</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Default lens rules</span></span><span>
</span><span id="line-46"></span><span>  </span><span class="annot"><a href="Lens.Micro.TH.html#LensRules"><span class="hs-identifier">LensRules</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-47"></span><span>  </span><span class="annot"><a href="Lens.Micro.TH.html#DefName"><span class="hs-identifier">DefName</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-48"></span><span>  </span><span class="annot"><a href="Lens.Micro.TH.html#lensRules"><span class="hs-identifier">lensRules</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-49"></span><span>  </span><span class="annot"><a href="Lens.Micro.TH.html#lensRulesFor"><span class="hs-identifier">lensRulesFor</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-50"></span><span>  </span><span class="annot"><a href="Lens.Micro.TH.html#classyRules"><span class="hs-identifier">classyRules</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span>  </span><span class="annot"><a href="Lens.Micro.TH.html#camelCaseFields"><span class="hs-identifier">camelCaseFields</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-52"></span><span>  </span><span class="annot"><a href="Lens.Micro.TH.html#abbreviatedFields"><span class="hs-identifier">abbreviatedFields</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Configuring lens rules</span></span><span>
</span><span id="line-55"></span><span>  </span><span class="annot"><a href="Lens.Micro.TH.html#lensField"><span class="hs-identifier">lensField</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-56"></span><span>  </span><span class="annot"><a href="Lens.Micro.TH.html#lensClass"><span class="hs-identifier">lensClass</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-57"></span><span>  </span><span class="annot"><a href="Lens.Micro.TH.html#createClass"><span class="hs-identifier">createClass</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-58"></span><span>  </span><span class="annot"><a href="Lens.Micro.TH.html#simpleLenses"><span class="hs-identifier">simpleLenses</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-59"></span><span>  </span><span class="annot"><a href="Lens.Micro.TH.html#generateSignatures"><span class="hs-identifier">generateSignatures</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-60"></span><span>  </span><span class="annot"><a href="Lens.Micro.TH.html#generateUpdateableOptics"><span class="hs-identifier">generateUpdateableOptics</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-61"></span><span>  </span><span class="annot"><a href="Lens.Micro.TH.html#generateLazyPatterns"><span class="hs-identifier">generateLazyPatterns</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-62"></span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span class="hs-keyword">where</span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.State</span></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Char</span></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Data</span></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Either</span></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Map</span></span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Set</span></span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">nub</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">findIndices</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">stripPrefix</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">isPrefixOf</span></span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Lens.Micro</span></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Lens.Micro.Internal</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">phantom</span></span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Lens.Micro.TH.Internal.html"><span class="hs-identifier">Lens.Micro.TH.Internal</span></a></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Language.Haskell.TH</span></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Language.Haskell.TH.Datatype</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">D</span></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Language.Haskell.TH.Datatype.TyVarBndr</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">D</span></span><span class="hs-cpp">

#if __GLASGOW_HASKELL__ &lt; 710
</span><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Applicative</span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Traversable</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">traverse</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">sequenceA</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span class="hs-comment">{- $errors-note

When you use Template Haskell, the order of declarations suddenly starts to matter. For instance, if you try to use 'makeLenses', 'makeFields', etc before the type is defined, you'll get a &#8220;not in scope&#8221; error:

@
'makeLenses' ''Foo

data Foo = Foo {_foo :: Int}
@

@
Not in scope: type constructor or class &#8216;Foo&#8217; &#8230;
    In the Template Haskell quotation ''Foo
@

You can't refer to generated lenses before you call 'makeLenses', either:

@
data Foo = Foo {_foo :: Int}

bar :: Lens' Foo Int
bar = foo

'makeLenses' ''Foo
@

@
Not in scope: &#8216;foo&#8217; &#8230;
    Perhaps you meant one of these:
      data constructor &#8216;Foo&#8217; (line 1), &#8216;_foo&#8217; (line 1)
@
-}</span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span class="hs-comment">{- $ghci-note

You can use 'makeLenses' and friends to define lenses right from GHCi, but it's slightly tricky.

First, enable Template Haskell:

&gt;&gt;&gt; :set -XTemplateHaskell

Then define a bogus type (you can use any name in place of @M@, and you can use the same name many times), and follow the definition by the actual Template Haskell command you want to use:

&gt;&gt;&gt; data M; makeLenses ''Foo

This will generate lenses for @Foo@ and you'll be able to use them from GHCi.

If you want, you can define the type and lenses for it simultaneously with @:{@ and @:}@:

@
&gt;&gt;&gt; :{
data Foobar = Foobar {
  _foo :: Int,
  _bar :: Bool }
  deriving (Eq, Show)

makeLenses ''Foobar
:}
@
-}</span><span>
</span><span id="line-150"></span><span>
</span><span id="line-151"></span><span class="hs-comment">{- $getter-fold-note

When updates are forbidden (by using 'generateUpdateableOptics'), or when a field simply can't be updated (for instance, in the presence of @forall@), instead of 'Lens' and 'Traversal' we generate 'SimpleGetter' and 'SimpleFold'. These aren't true @Getter@ and @Fold@ from lens, so beware. (Still, they're compatible, it's just that you can't do some things with them that you can do with original ones &#8211; for instance, @backwards@ and @takingWhile@ don't work on 'SimpleFold'.)

If you want to export true folds, it's recommended that you depend on &lt;http://hackage.haskell.org/package/microlens-contra microlens-contra&gt;, use 'makeLensesFor' to generate 'SimpleFold's with prefixes, and then export versions of those folds with @&lt;http://hackage.haskell.org/package/microlens-contra/docs/Lens-Micro-Contra.html#v:fromSimpleFold fromSimpleFold&gt;@ applied.
-}</span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span class="hs-comment">-- Utilities</span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span class="hs-comment">-- like 'rewrite' from uniplate</span><span>
</span><span id="line-161"></span><span id="local-6989586621679052894"><span id="local-6989586621679052895"><span class="annot"><a href="Lens.Micro.TH.html#rewrite"><span class="hs-identifier hs-type">rewrite</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Data</span></span><span> </span><span class="annot"><a href="#local-6989586621679052895"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Data</span></span><span> </span><span class="annot"><a href="#local-6989586621679052894"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679052895"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679052895"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679052894"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679052894"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-162"></span><span id="rewrite"><span class="annot"><span class="annottext">rewrite :: (a -&gt; Maybe a) -&gt; b -&gt; b
</span><a href="Lens.Micro.TH.html#rewrite"><span class="hs-identifier hs-var hs-var">rewrite</span></a></span></span><span> </span><span id="local-6989586621679052630"><span class="annot"><span class="annottext">a -&gt; Maybe a
</span><a href="#local-6989586621679052630"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679052629"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679052629"><span class="hs-identifier hs-var">mbA</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">b -&gt; Maybe a
forall a b. (Typeable a, Typeable b) =&gt; a -&gt; Maybe b
</span><span class="hs-identifier hs-var">cast</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679052629"><span class="hs-identifier hs-var">mbA</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-163"></span><span>  </span><span class="annot"><span class="annottext">Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(forall b. Data b =&gt; b -&gt; b) -&gt; b -&gt; b
forall a. Data a =&gt; (forall b. Data b =&gt; b -&gt; b) -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">gmapT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a -&gt; Maybe a) -&gt; b -&gt; b
forall a b. (Data a, Data b) =&gt; (a -&gt; Maybe a) -&gt; b -&gt; b
</span><a href="Lens.Micro.TH.html#rewrite"><span class="hs-identifier hs-var">rewrite</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe a
</span><a href="#local-6989586621679052630"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679052629"><span class="hs-identifier hs-var">mbA</span></a></span><span>
</span><span id="line-164"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679052626"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679052626"><span class="hs-identifier hs-var">a</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679052625"><span class="annot"><span class="annottext">a' :: a
</span><a href="#local-6989586621679052625"><span class="hs-identifier hs-var hs-var">a'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall b. Data b =&gt; b -&gt; b) -&gt; a -&gt; a
forall a. Data a =&gt; (forall b. Data b =&gt; b -&gt; b) -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">gmapT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a -&gt; Maybe a) -&gt; b -&gt; b
forall a b. (Data a, Data b) =&gt; (a -&gt; Maybe a) -&gt; b -&gt; b
</span><a href="Lens.Micro.TH.html#rewrite"><span class="hs-identifier hs-var">rewrite</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe a
</span><a href="#local-6989586621679052630"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679052626"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-165"></span><span>             </span><span class="hs-keyword">in</span><span>  </span><span class="annot"><span class="annottext">Maybe b -&gt; b
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromJust</span></span><span> </span><span class="annot"><span class="annottext">(Maybe b -&gt; b) -&gt; (a -&gt; Maybe b) -&gt; a -&gt; b
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe b
forall a b. (Typeable a, Typeable b) =&gt; a -&gt; Maybe b
</span><span class="hs-identifier hs-var">cast</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; b) -&gt; a -&gt; b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe a -&gt; a
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679052625"><span class="hs-identifier hs-var">a'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Maybe a
</span><a href="#local-6989586621679052630"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679052625"><span class="hs-identifier hs-var">a'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-166"></span><span>
</span><span id="line-167"></span><span class="hs-comment">-- like 'children' from uniplate</span><span>
</span><span id="line-168"></span><span id="local-6989586621679052701"><span class="annot"><a href="Lens.Micro.TH.html#children"><span class="hs-identifier hs-type">children</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Data</span></span><span> </span><span class="annot"><a href="#local-6989586621679052701"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679052701"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679052701"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-169"></span><span id="children"><span class="annot"><span class="annottext">children :: a -&gt; [a]
</span><a href="Lens.Micro.TH.html#children"><span class="hs-identifier hs-var hs-var">children</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Maybe a] -&gt; [a]
forall a. [Maybe a] -&gt; [a]
</span><span class="hs-identifier hs-var">catMaybes</span></span><span> </span><span class="annot"><span class="annottext">([Maybe a] -&gt; [a]) -&gt; (a -&gt; [Maybe a]) -&gt; a -&gt; [a]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(forall d. Data d =&gt; d -&gt; Maybe a) -&gt; a -&gt; [Maybe a]
forall a u. Data a =&gt; (forall d. Data d =&gt; d -&gt; u) -&gt; a -&gt; [u]
</span><span class="hs-identifier hs-var">gmapQ</span></span><span> </span><span class="annot"><span class="annottext">forall d. Data d =&gt; d -&gt; Maybe a
forall a b. (Typeable a, Typeable b) =&gt; a -&gt; Maybe b
</span><span class="hs-identifier hs-var">cast</span></span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span class="hs-comment">-- Control.Lens.TH</span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span class="hs-comment">{- |
Generate lenses for a data type or a newtype.

To use it, you have to enable Template Haskell first:

@
\{\-\# LANGUAGE TemplateHaskell \#\-\}
@

Then, after declaring the datatype (let's say @Foo@), add @makeLenses ''Foo@ on a separate line (if you do it before the type is declared, you'll get a &#8220;not in scope&#8221; error &#8211; see the section at the top of this page):

@
data Foo = Foo {
  _x :: Int,
  _y :: Bool }

'makeLenses' ''Foo
@

This would generate the following lenses, which can be used to access the fields of @Foo@:

@
x :: 'Lens'' Foo Int
x f foo = (\\x' -&gt; foo {_x = x'}) '&lt;$&gt;' f (_x foo)

y :: 'Lens'' Foo Bool
y f foo = (\\y' -&gt; foo {_y = y'}) '&lt;$&gt;' f (_y foo)
@

(If you don't want a lens to be generated for some field, don't prefix it with &#8220;_&#8221;.)

If you want to create lenses for many types, you can do it all in one place like this (of course, instead you just can use 'makeLenses' several times if you feel it would be more readable):

@
data Foo = ...
data Bar = ...
data Quux = ...

'concat' '&lt;$&gt;' 'mapM' 'makeLenses' [''Foo, ''Bar, ''Quux]
@

When the data type has type parameters, it's possible for a lens to do a polymorphic update &#8211; i.e. change the type of the thing along with changing the type of the field. For instance, with this type

@
data Foo a = Foo {
  _x :: a,
  _y :: Bool }
@

the following lenses would be generated:

@
x :: 'Lens' (Foo a) (Foo b) a b
y :: 'Lens'' (Foo a) Bool
@

However, when there are several fields using the same type parameter, type-changing updates are no longer possible:

@
data Foo a = Foo {
  _x :: a,
  _y :: a }
@

generates

@
x :: 'Lens'' (Foo a) a
y :: 'Lens'' (Foo a) a
@

Finally, when the type has several constructors, some of fields may not be /always/ present &#8211; for those, a 'Traversal' is generated instead. For instance, in this example @y@ can be present or absent:

@
data FooBar
  = Foo { _x :: Int, _y :: Bool }
  | Bar { _x :: Int }
@

and the following accessors would be generated:

@
x :: 'Lens'' FooBar Int
y :: 'Traversal'' FooBar Bool
@

So, to get @_y@, you'd have to either use ('^?') if you're not sure it's there, or ('^?!') if you're absolutely sure (and if you're wrong, you'll get an exception). Setting and updating @_y@ can be done as usual.
-}</span><span>
</span><span id="line-261"></span><span class="annot"><a href="Lens.Micro.TH.html#makeLenses"><span class="hs-identifier hs-type">makeLenses</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DecsQ</span></span><span>
</span><span id="line-262"></span><span id="makeLenses"><span class="annot"><span class="annottext">makeLenses :: Name -&gt; DecsQ
</span><a href="Lens.Micro.TH.html#makeLenses"><span class="hs-identifier hs-var hs-var">makeLenses</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LensRules -&gt; Name -&gt; DecsQ
</span><a href="Lens.Micro.TH.html#makeFieldOptics"><span class="hs-identifier hs-var">makeFieldOptics</span></a></span><span> </span><span class="annot"><span class="annottext">LensRules
</span><a href="Lens.Micro.TH.html#lensRules"><span class="hs-identifier hs-var">lensRules</span></a></span><span>
</span><span id="line-263"></span><span>
</span><span id="line-264"></span><span class="hs-comment">{- |
Like 'makeLenses', but lets you choose your own names for lenses:

@
data Foo = Foo {foo :: Int, bar :: Bool}

'makeLensesFor' [(\&quot;foo\&quot;, \&quot;fooLens\&quot;), (\&quot;bar\&quot;, \&quot;_bar\&quot;)] ''Foo
@

would create lenses called @fooLens@ and @_bar@. This is useful, for instance, when you don't want to prefix your fields with underscores and want to prefix /lenses/ with underscores instead.

If you give the same name to different fields, it will generate a 'Traversal' instead:

@
data Foo = Foo {slot1, slot2, slot3 :: Int}

'makeLensesFor' [(\&quot;slot1\&quot;, \&quot;slots\&quot;),
               (\&quot;slot2\&quot;, \&quot;slots\&quot;),
               (\&quot;slot3\&quot;, \&quot;slots\&quot;)] ''Foo
@

would generate

@
slots :: 'Traversal'' Foo Int
slots f foo = Foo '&lt;$&gt;' f (slot1 foo)
                  '&lt;*&gt;' f (slot2 foo)
                  '&lt;*&gt;' f (slot3 foo)
@
-}</span><span>
</span><span id="line-294"></span><span class="annot"><a href="Lens.Micro.TH.html#makeLensesFor"><span class="hs-identifier hs-type">makeLensesFor</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DecsQ</span></span><span>
</span><span id="line-295"></span><span id="makeLensesFor"><span class="annot"><span class="annottext">makeLensesFor :: [(String, String)] -&gt; Name -&gt; DecsQ
</span><a href="Lens.Micro.TH.html#makeLensesFor"><span class="hs-identifier hs-var hs-var">makeLensesFor</span></a></span></span><span> </span><span id="local-6989586621679052617"><span class="annot"><span class="annottext">[(String, String)]
</span><a href="#local-6989586621679052617"><span class="hs-identifier hs-var">fields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LensRules -&gt; Name -&gt; DecsQ
</span><a href="Lens.Micro.TH.html#makeFieldOptics"><span class="hs-identifier hs-var">makeFieldOptics</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(String, String)] -&gt; LensRules
</span><a href="Lens.Micro.TH.html#lensRulesFor"><span class="hs-identifier hs-var">lensRulesFor</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, String)]
</span><a href="#local-6989586621679052617"><span class="hs-identifier hs-var">fields</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-296"></span><span>
</span><span id="line-297"></span><span class="hs-comment">{- |
Generate lenses with custom parameters.

To see what exactly you can customise, look at the &#8220;Configuring lens rules&#8221; section. Usually you would build upon the 'lensRules' configuration, which is used by 'makeLenses':

@
'makeLenses' = 'makeLensesWith' 'lensRules'
@

Here's an example of generating lenses that would use lazy patterns:

@
data Foo = Foo {_x, _y :: Int}

'makeLensesWith' ('lensRules' '&amp;' 'generateLazyPatterns' '.~' True) ''Foo
@

When there are several modifications to the rules, the code looks nicer when you use 'flip':

@
'flip' 'makeLensesWith' ''Foo $
  'lensRules'
    '&amp;' 'generateLazyPatterns' '.~' True
    '&amp;' 'generateSignatures'   '.~' False
@
-}</span><span>
</span><span id="line-323"></span><span class="annot"><a href="Lens.Micro.TH.html#makeLensesWith"><span class="hs-identifier hs-type">makeLensesWith</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Lens.Micro.TH.html#LensRules"><span class="hs-identifier hs-type">LensRules</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DecsQ</span></span><span>
</span><span id="line-324"></span><span id="makeLensesWith"><span class="annot"><span class="annottext">makeLensesWith :: LensRules -&gt; Name -&gt; DecsQ
</span><a href="Lens.Micro.TH.html#makeLensesWith"><span class="hs-identifier hs-var hs-var">makeLensesWith</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LensRules -&gt; Name -&gt; DecsQ
</span><a href="Lens.Micro.TH.html#makeFieldOptics"><span class="hs-identifier hs-var">makeFieldOptics</span></a></span><span>
</span><span id="line-325"></span><span>
</span><span id="line-326"></span><span class="hs-comment">{- |
Generate overloaded lenses.

This lets you deal with several data types having same fields. For instance, let's say you have @Foo@ and @Bar@, and both have a field named @x@. To avoid those fields clashing, you would have to use prefixes:

@
data Foo a = Foo {
  fooX :: Int,
  fooY :: a }

data Bar = Bar {
  barX :: Char }
@

However, if you use 'makeFields' on both @Foo@ and @Bar@ now, it would generate lenses called @x@ and @y@ &#8211; and @x@ would be able to access both @fooX@ and @barX@! This is done by generating a separate class for each field, and making relevant types instances of that class:

@
class HasX s a | s -&gt; a where
  x :: 'Lens'' s a

instance HasX (Foo a) Int where
  x :: 'Lens'' (Foo a) Int
  x = ...

instance HasX Bar Char where
  x :: 'Lens'' Bar Char
  x = ...


class HasY s a | s -&gt; a where
  y :: 'Lens'' s a

instance HasY (Foo a) a where
  y :: 'Lens'' (Foo a) a
  y = ...
@

(There's a minor drawback, though: you can't perform type-changing updates with these lenses.)

If you only want to make lenses for some fields, you can prefix them with underscores &#8211; the rest would be untouched. If no fields are prefixed with underscores, lenses would be created for all fields.

The prefix must be the same as the name of the name of the data type (/not/ the constructor). If you don't like this behavior, use @'makeLensesWith' 'abbreviatedFields'@ &#8211; it allows any prefix (and even different prefixes).

If you want to use 'makeFields' on types declared in different modules, you can do it, but then you would have to export the @Has*@ classes from one of the modules &#8211; 'makeFields' creates a class if it's not in scope yet, so the class must be in scope or else there would be duplicate classes and you would get an &#8220;Ambiguous occurrence&#8221; error.

Finally, 'makeFields' is implemented as @'makeLensesWith' 'camelCaseFields'@, so you can build on 'camelCaseFields' if you want to customise behavior of 'makeFields'.
-}</span><span>
</span><span id="line-373"></span><span class="annot"><a href="Lens.Micro.TH.html#makeFields"><span class="hs-identifier hs-type">makeFields</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DecsQ</span></span><span>
</span><span id="line-374"></span><span id="makeFields"><span class="annot"><span class="annottext">makeFields :: Name -&gt; DecsQ
</span><a href="Lens.Micro.TH.html#makeFields"><span class="hs-identifier hs-var hs-var">makeFields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LensRules -&gt; Name -&gt; DecsQ
</span><a href="Lens.Micro.TH.html#makeFieldOptics"><span class="hs-identifier hs-var">makeFieldOptics</span></a></span><span> </span><span class="annot"><span class="annottext">LensRules
</span><a href="Lens.Micro.TH.html#camelCaseFields"><span class="hs-identifier hs-var">camelCaseFields</span></a></span><span>
</span><span id="line-375"></span><span>
</span><span id="line-376"></span><span class="hs-comment">{- |
Generate overloaded lenses without ad-hoc classes; useful when there's a collection of fields that you want to make common for several types.

Like 'makeFields', each lens is a member of a class. However, the classes are per-type and not per-field. Let's take the following type:

@
data Person = Person {
  _name :: String,
  _age :: Double }
@

'makeClassy' would generate a single class with 3 methods:

@
class HasPerson c where
  person :: Lens' c Person

  age :: Lens' c Double
  age = person.age

  name :: Lens' c String
  name = person.name
@

And an instance:

@
instance HasPerson Person where
  person = id

  name = ...
  age = ...
@

So, you can use @name@ and @age@ to refer to the @_name@ and @_age@ fields, as usual. However, the extra lens &#8211; @person@ &#8211; allows you to do a kind of subtyping. Let's say that there's a type called @Worker@ and every worker has the same fields that a person has, but also a @job@. If you were using 'makeFields', you'd do the following:

@
data Worker = Worker {
  _workerName :: String,
  _workerAge :: Double,
  _workerJob :: String }
@

However, with 'makeClassy' you can say &#8220;every worker is a person&#8221; in a more principled way:

@
data Worker = Worker {
  _workerPerson :: Person,
  _job :: String }

makeClassy ''Worker

instance HasPerson Worker where person = workerPerson
@

Now you can use @age@ and @name@ to access name\/age of a @Worker@, but you also can use @person@ to &#8220;downgrade&#8221; a @Worker@ to a @Person@ (and e.g. apply some @Person@-specific function to it).

Unlike 'makeFields', 'makeClassy' doesn't make use of prefixes. @_workerPerson@ could've just as well been named @_foobar@.

'makeClassy' is implemented as @'makeLensesWith' 'classyRules'@, so you can build on 'classyRules' if you want to customise behavior of 'makeClassy'.
-}</span><span>
</span><span id="line-437"></span><span class="annot"><a href="Lens.Micro.TH.html#makeClassy"><span class="hs-identifier hs-type">makeClassy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DecsQ</span></span><span>
</span><span id="line-438"></span><span id="makeClassy"><span class="annot"><span class="annottext">makeClassy :: Name -&gt; DecsQ
</span><a href="Lens.Micro.TH.html#makeClassy"><span class="hs-identifier hs-var hs-var">makeClassy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LensRules -&gt; Name -&gt; DecsQ
</span><a href="Lens.Micro.TH.html#makeFieldOptics"><span class="hs-identifier hs-var">makeFieldOptics</span></a></span><span> </span><span class="annot"><span class="annottext">LensRules
</span><a href="Lens.Micro.TH.html#classyRules"><span class="hs-identifier hs-var">classyRules</span></a></span><span>
</span><span id="line-439"></span><span>
</span><span id="line-440"></span><span class="hs-comment">{- |
Generate simple (monomorphic) lenses even when type-changing lenses are possible &#8211; i.e. 'Lens'' instead of 'Lens' and 'Traversal'' instead of 'Traversal'. Just in case, here's an example of a situation when type-changing lenses would be normally generated:

@
data Foo a = Foo { _foo :: a }
@

Generated lens:

@
foo :: 'Lens' (Foo a) (Foo b) a b
@

Generated lens with 'simpleLenses' turned on:

@
foo :: 'Lens'' (Foo a) a
@

This option is disabled by default.
-}</span><span>
</span><span id="line-461"></span><span class="annot"><a href="Lens.Micro.TH.html#simpleLenses"><span class="hs-identifier hs-type">simpleLenses</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="annot"><a href="Lens.Micro.TH.html#LensRules"><span class="hs-identifier hs-type">LensRules</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-462"></span><span id="simpleLenses"><span class="annot"><span class="annottext">simpleLenses :: (Bool -&gt; f Bool) -&gt; LensRules -&gt; f LensRules
</span><a href="Lens.Micro.TH.html#simpleLenses"><span class="hs-identifier hs-var hs-var">simpleLenses</span></a></span></span><span> </span><span id="local-6989586621679052616"><span class="annot"><span class="annottext">Bool -&gt; f Bool
</span><a href="#local-6989586621679052616"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679052615"><span class="annot"><span class="annottext">LensRules
</span><a href="#local-6989586621679052615"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; LensRules) -&gt; f Bool -&gt; f LensRules
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679052614"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679052614"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LensRules
</span><a href="#local-6989586621679052615"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_simpleLenses :: Bool
</span><a href="Lens.Micro.TH.html#_simpleLenses"><span class="hs-identifier hs-var">_simpleLenses</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679052614"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; f Bool
</span><a href="#local-6989586621679052616"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LensRules -&gt; Bool
</span><a href="Lens.Micro.TH.html#_simpleLenses"><span class="hs-identifier hs-var hs-var">_simpleLenses</span></a></span><span> </span><span class="annot"><span class="annottext">LensRules
</span><a href="#local-6989586621679052615"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-463"></span><span>
</span><span id="line-464"></span><span class="hs-comment">{- |
Supply type signatures for the generated lenses.

This option is enabled by default. Disable it if you want to write the signature by yourself &#8211; for instance, if the signature should be more restricted, or if you want to write haddocks for the lens (as haddocks are attached to the signature and not to the definition).
-}</span><span>
</span><span id="line-469"></span><span class="annot"><a href="Lens.Micro.TH.html#generateSignatures"><span class="hs-identifier hs-type">generateSignatures</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="annot"><a href="Lens.Micro.TH.html#LensRules"><span class="hs-identifier hs-type">LensRules</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-470"></span><span id="generateSignatures"><span class="annot"><span class="annottext">generateSignatures :: (Bool -&gt; f Bool) -&gt; LensRules -&gt; f LensRules
</span><a href="Lens.Micro.TH.html#generateSignatures"><span class="hs-identifier hs-var hs-var">generateSignatures</span></a></span></span><span> </span><span id="local-6989586621679052612"><span class="annot"><span class="annottext">Bool -&gt; f Bool
</span><a href="#local-6989586621679052612"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679052611"><span class="annot"><span class="annottext">LensRules
</span><a href="#local-6989586621679052611"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-471"></span><span>  </span><span class="annot"><span class="annottext">(Bool -&gt; LensRules) -&gt; f Bool -&gt; f LensRules
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679052610"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679052610"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LensRules
</span><a href="#local-6989586621679052611"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_generateSigs :: Bool
</span><a href="Lens.Micro.TH.html#_generateSigs"><span class="hs-identifier hs-var">_generateSigs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679052610"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; f Bool
</span><a href="#local-6989586621679052612"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LensRules -&gt; Bool
</span><a href="Lens.Micro.TH.html#_generateSigs"><span class="hs-identifier hs-var hs-var">_generateSigs</span></a></span><span> </span><span class="annot"><span class="annottext">LensRules
</span><a href="#local-6989586621679052611"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-472"></span><span>
</span><span id="line-473"></span><span class="hs-comment">{- |
Generate &#8220;updateable&#8221; optics. When turned off, 'SimpleFold's will be generated instead of 'Traversal's and 'SimpleGetter's will be generated instead of 'Lens'es.

This option is enabled by default. Disabling it can be useful for types with invariants (also known as &#8220;types with smart constructors&#8221;) &#8211; if you generate updateable optics, anyone would be able to use them to break your invariants.
-}</span><span>
</span><span id="line-478"></span><span class="annot"><a href="Lens.Micro.TH.html#generateUpdateableOptics"><span class="hs-identifier hs-type">generateUpdateableOptics</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="annot"><a href="Lens.Micro.TH.html#LensRules"><span class="hs-identifier hs-type">LensRules</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-479"></span><span id="generateUpdateableOptics"><span class="annot"><span class="annottext">generateUpdateableOptics :: (Bool -&gt; f Bool) -&gt; LensRules -&gt; f LensRules
</span><a href="Lens.Micro.TH.html#generateUpdateableOptics"><span class="hs-identifier hs-var hs-var">generateUpdateableOptics</span></a></span></span><span> </span><span id="local-6989586621679052608"><span class="annot"><span class="annottext">Bool -&gt; f Bool
</span><a href="#local-6989586621679052608"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679052607"><span class="annot"><span class="annottext">LensRules
</span><a href="#local-6989586621679052607"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-480"></span><span>  </span><span class="annot"><span class="annottext">(Bool -&gt; LensRules) -&gt; f Bool -&gt; f LensRules
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679052606"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679052606"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LensRules
</span><a href="#local-6989586621679052607"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_allowUpdates :: Bool
</span><a href="Lens.Micro.TH.html#_allowUpdates"><span class="hs-identifier hs-var">_allowUpdates</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679052606"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; f Bool
</span><a href="#local-6989586621679052608"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LensRules -&gt; Bool
</span><a href="Lens.Micro.TH.html#_allowUpdates"><span class="hs-identifier hs-var hs-var">_allowUpdates</span></a></span><span> </span><span class="annot"><span class="annottext">LensRules
</span><a href="#local-6989586621679052607"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-481"></span><span>
</span><span id="line-482"></span><span class="hs-comment">{- |
Generate lenses using lazy pattern matches. This can allow fields of an undefined value to be initialized with lenses:

@
data Foo = Foo {_x :: Int, _y :: Bool}
  deriving Show

'makeLensesWith' ('lensRules' '&amp;' 'generateLazyPatterns' '.~' True) ''Foo
@

@
&gt;&gt;&gt; 'undefined' '&amp;' x '.~' 8 '&amp;' y '.~' True
Foo {_x = 8, _y = True}
@

(Without 'generateLazyPatterns', the result would be just 'undefined'.)

This option is disabled by default. The downside of enabling it is that it can lead to space-leaks and code-size\/compile-time increases when lenses are generated for large records.

When you have a lazy lens, you can get a strict lens from it by composing with ('$!'):

@
strictLens = ('$!') . lazyLens
@
-}</span><span>
</span><span id="line-507"></span><span class="annot"><a href="Lens.Micro.TH.html#generateLazyPatterns"><span class="hs-identifier hs-type">generateLazyPatterns</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="annot"><a href="Lens.Micro.TH.html#LensRules"><span class="hs-identifier hs-type">LensRules</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-508"></span><span id="generateLazyPatterns"><span class="annot"><span class="annottext">generateLazyPatterns :: (Bool -&gt; f Bool) -&gt; LensRules -&gt; f LensRules
</span><a href="Lens.Micro.TH.html#generateLazyPatterns"><span class="hs-identifier hs-var hs-var">generateLazyPatterns</span></a></span></span><span> </span><span id="local-6989586621679052604"><span class="annot"><span class="annottext">Bool -&gt; f Bool
</span><a href="#local-6989586621679052604"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679052603"><span class="annot"><span class="annottext">LensRules
</span><a href="#local-6989586621679052603"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-509"></span><span>  </span><span class="annot"><span class="annottext">(Bool -&gt; LensRules) -&gt; f Bool -&gt; f LensRules
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679052602"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679052602"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LensRules
</span><a href="#local-6989586621679052603"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_lazyPatterns :: Bool
</span><a href="Lens.Micro.TH.html#_lazyPatterns"><span class="hs-identifier hs-var">_lazyPatterns</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679052602"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; f Bool
</span><a href="#local-6989586621679052604"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LensRules -&gt; Bool
</span><a href="Lens.Micro.TH.html#_lazyPatterns"><span class="hs-identifier hs-var hs-var">_lazyPatterns</span></a></span><span> </span><span class="annot"><span class="annottext">LensRules
</span><a href="#local-6989586621679052603"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-510"></span><span>
</span><span id="line-511"></span><span class="hs-comment">{- |
This lets you choose which fields would have lenses generated for them and how would those lenses be called. To do that, you provide a function that would take a field name and output a list (possibly empty) of lenses that should be generated for that field.

Here's the full type of the function you have to provide:

@
'Name' -&gt;     -- The datatype lenses are being generated for
['Name'] -&gt;   -- A list of all fields of the datatype
'Name' -&gt;     -- The current field
['DefName']   -- A list of lens names
@

Most of the time you won't need the first 2 parameters, but sometimes they are useful &#8211; for instance, the list of all fields would be useful if you wanted to implement a slightly more complicated rule like &#8220;if some fields are prefixed with underscores, generate lenses for them, but if no fields are prefixed with underscores, generate lenses for /all/ fields&#8221;.

As an example, here's a function used by default. It strips &#8220;_&#8221; off the field name, lowercases the next character after &#8220;_&#8221;, and skips the field entirely if it doesn't start with &#8220;_&#8221;:

@
\\_ _ n -&gt;
  case 'nameBase' n of
    \'_\':x:xs -&gt; ['TopName' ('mkName' ('toLower' x : xs))]
    _        -&gt; []
@

You can also generate classes (i.e. what 'makeFields' does) by using @'MethodName' className lensName@ instead of @'TopName' lensName@.
-}</span><span>
</span><span id="line-536"></span><span class="annot"><a href="Lens.Micro.TH.html#lensField"><span class="hs-identifier hs-type">lensField</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="annot"><a href="Lens.Micro.TH.html#LensRules"><span class="hs-identifier hs-type">LensRules</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Lens.Micro.TH.html#DefName"><span class="hs-identifier hs-type">DefName</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-537"></span><span id="lensField"><span class="annot"><span class="annottext">lensField :: ((Name -&gt; [Name] -&gt; Name -&gt; [DefName])
 -&gt; f (Name -&gt; [Name] -&gt; Name -&gt; [DefName]))
-&gt; LensRules -&gt; f LensRules
</span><a href="Lens.Micro.TH.html#lensField"><span class="hs-identifier hs-var hs-var">lensField</span></a></span></span><span> </span><span id="local-6989586621679052600"><span class="annot"><span class="annottext">(Name -&gt; [Name] -&gt; Name -&gt; [DefName])
-&gt; f (Name -&gt; [Name] -&gt; Name -&gt; [DefName])
</span><a href="#local-6989586621679052600"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679052599"><span class="annot"><span class="annottext">LensRules
</span><a href="#local-6989586621679052599"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Name -&gt; [Name] -&gt; Name -&gt; [DefName]) -&gt; LensRules)
-&gt; f (Name -&gt; [Name] -&gt; Name -&gt; [DefName]) -&gt; f LensRules
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679052598"><span class="annot"><span class="annottext">Name -&gt; [Name] -&gt; Name -&gt; [DefName]
</span><a href="#local-6989586621679052598"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LensRules
</span><a href="#local-6989586621679052599"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_fieldToDef :: Name -&gt; [Name] -&gt; Name -&gt; [DefName]
</span><a href="Lens.Micro.TH.html#_fieldToDef"><span class="hs-identifier hs-var">_fieldToDef</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Name] -&gt; Name -&gt; [DefName]
</span><a href="#local-6989586621679052598"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Name -&gt; [Name] -&gt; Name -&gt; [DefName])
-&gt; f (Name -&gt; [Name] -&gt; Name -&gt; [DefName])
</span><a href="#local-6989586621679052600"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LensRules -&gt; Name -&gt; [Name] -&gt; Name -&gt; [DefName]
</span><a href="Lens.Micro.TH.html#_fieldToDef"><span class="hs-identifier hs-var hs-var">_fieldToDef</span></a></span><span> </span><span class="annot"><span class="annottext">LensRules
</span><a href="#local-6989586621679052599"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-538"></span><span>
</span><span id="line-539"></span><span class="hs-comment">{- |
This lets you choose whether a class would be generated for the type itself (like 'makeClassy' does). If so, you can choose the name of the class and the name of the type-specific lens.

For 'makeLenses' and 'makeFields' this is just @const Nothing@. For 'makeClassy' this function is defined like this:

@
\\n -&gt;
  case 'nameBase' n of
    x:xs -&gt; Just ('mkName' (&quot;Has&quot; ++ x:xs), 'mkName' ('toLower' x : xs))
    []   -&gt; Nothing
@
-}</span><span>
</span><span id="line-551"></span><span class="annot"><a href="Lens.Micro.TH.html#lensClass"><span class="hs-identifier hs-type">lensClass</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="annot"><a href="Lens.Micro.TH.html#LensRules"><span class="hs-identifier hs-type">LensRules</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-552"></span><span id="lensClass"><span class="annot"><span class="annottext">lensClass :: ((Name -&gt; Maybe (Name, Name)) -&gt; f (Name -&gt; Maybe (Name, Name)))
-&gt; LensRules -&gt; f LensRules
</span><a href="Lens.Micro.TH.html#lensClass"><span class="hs-identifier hs-var hs-var">lensClass</span></a></span></span><span> </span><span id="local-6989586621679052596"><span class="annot"><span class="annottext">(Name -&gt; Maybe (Name, Name)) -&gt; f (Name -&gt; Maybe (Name, Name))
</span><a href="#local-6989586621679052596"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679052595"><span class="annot"><span class="annottext">LensRules
</span><a href="#local-6989586621679052595"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Name -&gt; Maybe (Name, Name)) -&gt; LensRules)
-&gt; f (Name -&gt; Maybe (Name, Name)) -&gt; f LensRules
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679052594"><span class="annot"><span class="annottext">Name -&gt; Maybe (Name, Name)
</span><a href="#local-6989586621679052594"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LensRules
</span><a href="#local-6989586621679052595"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_classyLenses :: Name -&gt; Maybe (Name, Name)
</span><a href="Lens.Micro.TH.html#_classyLenses"><span class="hs-identifier hs-var">_classyLenses</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Maybe (Name, Name)
</span><a href="#local-6989586621679052594"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Name -&gt; Maybe (Name, Name)) -&gt; f (Name -&gt; Maybe (Name, Name))
</span><a href="#local-6989586621679052596"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LensRules -&gt; Name -&gt; Maybe (Name, Name)
</span><a href="Lens.Micro.TH.html#_classyLenses"><span class="hs-identifier hs-var hs-var">_classyLenses</span></a></span><span> </span><span class="annot"><span class="annottext">LensRules
</span><a href="#local-6989586621679052595"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-553"></span><span>
</span><span id="line-554"></span><span class="hs-comment">{- |
Decide whether generation of classes is allowed at all.

If this is disabled, neither 'makeFields' nor 'makeClassy' would work, regardless of values of 'lensField' or 'lensClass'. On the other hand, if 'lensField' and 'lensClass' don't generate any classes, enabling this won't have any effect.
-}</span><span>
</span><span id="line-559"></span><span class="annot"><a href="Lens.Micro.TH.html#createClass"><span class="hs-identifier hs-type">createClass</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="annot"><a href="Lens.Micro.TH.html#LensRules"><span class="hs-identifier hs-type">LensRules</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-560"></span><span id="createClass"><span class="annot"><span class="annottext">createClass :: (Bool -&gt; f Bool) -&gt; LensRules -&gt; f LensRules
</span><a href="Lens.Micro.TH.html#createClass"><span class="hs-identifier hs-var hs-var">createClass</span></a></span></span><span> </span><span id="local-6989586621679052592"><span class="annot"><span class="annottext">Bool -&gt; f Bool
</span><a href="#local-6989586621679052592"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679052591"><span class="annot"><span class="annottext">LensRules
</span><a href="#local-6989586621679052591"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-561"></span><span>  </span><span class="annot"><span class="annottext">(Bool -&gt; LensRules) -&gt; f Bool -&gt; f LensRules
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679052590"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679052590"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LensRules
</span><a href="#local-6989586621679052591"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_generateClasses :: Bool
</span><a href="Lens.Micro.TH.html#_generateClasses"><span class="hs-identifier hs-var">_generateClasses</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679052590"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; f Bool
</span><a href="#local-6989586621679052592"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LensRules -&gt; Bool
</span><a href="Lens.Micro.TH.html#_generateClasses"><span class="hs-identifier hs-var hs-var">_generateClasses</span></a></span><span> </span><span class="annot"><span class="annottext">LensRules
</span><a href="#local-6989586621679052591"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-562"></span><span>
</span><span id="line-563"></span><span class="hs-comment">{- |
Lens rules used by default (i.e. in 'makeLenses'):

* 'generateSignatures' is turned on
* 'generateUpdateableOptics' is turned on
* 'generateLazyPatterns' is turned off
* 'simpleLenses' is turned off
* 'lensField' strips &#8220;_&#8221; off the field name, lowercases the next character after &#8220;_&#8221;, and skips the field entirely if it doesn't start with &#8220;_&#8221; (you can see how it's implemented in the docs for 'lensField')
* 'lensClass' isn't used (i.e. defined as @const Nothing@)
-}</span><span>
</span><span id="line-573"></span><span class="annot"><a href="Lens.Micro.TH.html#lensRules"><span class="hs-identifier hs-type">lensRules</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Lens.Micro.TH.html#LensRules"><span class="hs-identifier hs-type">LensRules</span></a></span><span>
</span><span id="line-574"></span><span id="lensRules"><span class="annot"><span class="annottext">lensRules :: LensRules
</span><a href="Lens.Micro.TH.html#lensRules"><span class="hs-identifier hs-var hs-var">lensRules</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LensRules :: Bool
-&gt; Bool
-&gt; Bool
-&gt; Bool
-&gt; Bool
-&gt; (Name -&gt; [Name] -&gt; Name -&gt; [DefName])
-&gt; (Name -&gt; Maybe (Name, Name))
-&gt; LensRules
</span><a href="Lens.Micro.TH.html#LensRules"><span class="hs-identifier hs-type">LensRules</span></a></span><span>
</span><span id="line-575"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_simpleLenses :: Bool
</span><a href="Lens.Micro.TH.html#_simpleLenses"><span class="hs-identifier hs-var">_simpleLenses</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-576"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_generateSigs :: Bool
</span><a href="Lens.Micro.TH.html#_generateSigs"><span class="hs-identifier hs-var">_generateSigs</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-577"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_generateClasses :: Bool
</span><a href="Lens.Micro.TH.html#_generateClasses"><span class="hs-identifier hs-var">_generateClasses</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-578"></span><span>  </span><span class="hs-comment">-- , _allowIsos       = True</span><span>
</span><span id="line-579"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_allowUpdates :: Bool
</span><a href="Lens.Micro.TH.html#_allowUpdates"><span class="hs-identifier hs-var">_allowUpdates</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-580"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_lazyPatterns :: Bool
</span><a href="Lens.Micro.TH.html#_lazyPatterns"><span class="hs-identifier hs-var">_lazyPatterns</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-581"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_classyLenses :: Name -&gt; Maybe (Name, Name)
</span><a href="Lens.Micro.TH.html#_classyLenses"><span class="hs-identifier hs-var">_classyLenses</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Name, Name) -&gt; Name -&gt; Maybe (Name, Name)
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Name, Name)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-582"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_fieldToDef :: Name -&gt; [Name] -&gt; Name -&gt; [DefName]
</span><a href="Lens.Micro.TH.html#_fieldToDef"><span class="hs-identifier hs-var">_fieldToDef</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679052586"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052586"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-583"></span><span>       </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Name -&gt; String
</span><span class="hs-identifier hs-var">nameBase</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052586"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-584"></span><span>         </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'_'</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679052584"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679052584"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679052583"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679052583"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; DefName
</span><a href="Lens.Micro.TH.html#TopName"><span class="hs-identifier hs-var">TopName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">mkName</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Char
</span><span class="hs-identifier hs-var">toLower</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679052584"><span class="hs-identifier hs-var">x</span></a></span><span class="annot"><span class="annottext">Char -&gt; String -&gt; String
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679052583"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-585"></span><span>         </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-586"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-587"></span><span>
</span><span id="line-588"></span><span class="hs-comment">{- |
A modification of 'lensRules' used by 'makeLensesFor' (the only difference is that a simple lookup function is used for 'lensField').
-}</span><span>
</span><span id="line-591"></span><span class="annot"><a href="Lens.Micro.TH.html#lensRulesFor"><span class="hs-identifier hs-type">lensRulesFor</span></a></span><span>
</span><span id="line-592"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ @[(fieldName, lensName)]@</span><span>
</span><span id="line-593"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Lens.Micro.TH.html#LensRules"><span class="hs-identifier hs-type">LensRules</span></a></span><span>
</span><span id="line-594"></span><span id="lensRulesFor"><span class="annot"><span class="annottext">lensRulesFor :: [(String, String)] -&gt; LensRules
</span><a href="Lens.Micro.TH.html#lensRulesFor"><span class="hs-identifier hs-var hs-var">lensRulesFor</span></a></span></span><span> </span><span id="local-6989586621679052580"><span class="annot"><span class="annottext">[(String, String)]
</span><a href="#local-6989586621679052580"><span class="hs-identifier hs-var">fields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LensRules
</span><a href="Lens.Micro.TH.html#lensRules"><span class="hs-identifier hs-var">lensRules</span></a></span><span> </span><span class="annot"><span class="annottext">LensRules -&gt; (LensRules -&gt; LensRules) -&gt; LensRules
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">((Name -&gt; [Name] -&gt; Name -&gt; [DefName])
 -&gt; Identity (Name -&gt; [Name] -&gt; Name -&gt; [DefName]))
-&gt; LensRules -&gt; Identity LensRules
Lens' LensRules (Name -&gt; [Name] -&gt; Name -&gt; [DefName])
</span><a href="Lens.Micro.TH.html#lensField"><span class="hs-identifier hs-var">lensField</span></a></span><span> </span><span class="annot"><span class="annottext">(((Name -&gt; [Name] -&gt; Name -&gt; [DefName])
  -&gt; Identity (Name -&gt; [Name] -&gt; Name -&gt; [DefName]))
 -&gt; LensRules -&gt; Identity LensRules)
-&gt; (Name -&gt; [Name] -&gt; Name -&gt; [DefName]) -&gt; LensRules -&gt; LensRules
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">[(String, String)] -&gt; Name -&gt; [Name] -&gt; Name -&gt; [DefName]
</span><a href="Lens.Micro.TH.html#mkNameLookup"><span class="hs-identifier hs-var">mkNameLookup</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, String)]
</span><a href="#local-6989586621679052580"><span class="hs-identifier hs-var">fields</span></a></span><span>
</span><span id="line-595"></span><span>
</span><span id="line-596"></span><span class="annot"><a href="Lens.Micro.TH.html#mkNameLookup"><span class="hs-identifier hs-type">mkNameLookup</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Lens.Micro.TH.html#DefName"><span class="hs-identifier hs-type">DefName</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-597"></span><span id="mkNameLookup"><span class="annot"><span class="annottext">mkNameLookup :: [(String, String)] -&gt; Name -&gt; [Name] -&gt; Name -&gt; [DefName]
</span><a href="Lens.Micro.TH.html#mkNameLookup"><span class="hs-identifier hs-var hs-var">mkNameLookup</span></a></span></span><span> </span><span id="local-6989586621679052576"><span class="annot"><span class="annottext">[(String, String)]
</span><a href="#local-6989586621679052576"><span class="hs-identifier hs-var">kvs</span></a></span></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679052575"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052575"><span class="hs-identifier hs-var">field</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-598"></span><span>  </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Name -&gt; DefName
</span><a href="Lens.Micro.TH.html#TopName"><span class="hs-identifier hs-var">TopName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">mkName</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679052574"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679052573"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679052573"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679052574"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679052574"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(String, String)]
</span><a href="#local-6989586621679052576"><span class="hs-identifier hs-var">kvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679052573"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; String
</span><span class="hs-identifier hs-var">nameBase</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052575"><span class="hs-identifier hs-var">field</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-599"></span><span>
</span><span id="line-600"></span><span class="hs-comment">{- |
Lens rules used by 'makeFields':

* 'generateSignatures' is turned on
* 'generateUpdateableOptics' is turned on
* 'generateLazyPatterns' is turned off
* 'simpleLenses' is turned on (unlike in 'lensRules')
* 'lensField' is more complicated &#8211; it takes fields which are prefixed with the name of the type they belong to (e.g. &#8220;fooFieldName&#8221; for &#8220;Foo&#8221;), strips that prefix, and generates a class called &#8220;HasFieldName&#8221; with a single method called &#8220;fieldName&#8221;. If some fields are prefixed with underscores, underscores would be stripped too, but then fields without underscores won't have any lenses generated for them. Also note that e.g. &#8220;foolish&#8221; won't have a lens called &#8220;lish&#8221; generated for it &#8211; the prefix must be followed by a capital letter (or else it wouldn't be camel case).
* 'lensClass' isn't used (i.e. defined as @const Nothing@)
-}</span><span>
</span><span id="line-610"></span><span class="annot"><a href="Lens.Micro.TH.html#camelCaseFields"><span class="hs-identifier hs-type">camelCaseFields</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Lens.Micro.TH.html#LensRules"><span class="hs-identifier hs-type">LensRules</span></a></span><span>
</span><span id="line-611"></span><span id="camelCaseFields"><span class="annot"><span class="annottext">camelCaseFields :: LensRules
</span><a href="Lens.Micro.TH.html#camelCaseFields"><span class="hs-identifier hs-var hs-var">camelCaseFields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LensRules
</span><a href="Lens.Micro.TH.html#defaultFieldRules"><span class="hs-identifier hs-var">defaultFieldRules</span></a></span><span>
</span><span id="line-612"></span><span>
</span><span id="line-613"></span><span class="annot"><a href="Lens.Micro.TH.html#camelCaseNamer"><span class="hs-identifier hs-type">camelCaseNamer</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Lens.Micro.TH.html#DefName"><span class="hs-identifier hs-type">DefName</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-614"></span><span id="camelCaseNamer"><span class="annot"><span class="annottext">camelCaseNamer :: Name -&gt; [Name] -&gt; Name -&gt; [DefName]
</span><a href="Lens.Micro.TH.html#camelCaseNamer"><span class="hs-identifier hs-var hs-var">camelCaseNamer</span></a></span></span><span> </span><span id="local-6989586621679052570"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052570"><span class="hs-identifier hs-var">tyName</span></a></span></span><span> </span><span id="local-6989586621679052569"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679052569"><span class="hs-identifier hs-var">fields</span></a></span></span><span> </span><span id="local-6989586621679052568"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052568"><span class="hs-identifier hs-var">field</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe DefName -&gt; [DefName]
forall a. Maybe a -&gt; [a]
</span><span class="hs-identifier hs-var">maybeToList</span></span><span> </span><span class="annot"><span class="annottext">(Maybe DefName -&gt; [DefName]) -&gt; Maybe DefName -&gt; [DefName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-615"></span><span>
</span><span id="line-616"></span><span>  </span><span id="local-6989586621679052566"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679052566"><span class="hs-identifier hs-var">fieldPart</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Maybe String
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; Maybe [a]
</span><span class="hs-identifier hs-var">stripPrefix</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679052565"><span class="hs-identifier hs-var">expectedPrefix</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; String
</span><span class="hs-identifier hs-var">nameBase</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052568"><span class="hs-identifier hs-var">field</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-617"></span><span>  </span><span id="local-6989586621679052564"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679052564"><span class="hs-identifier hs-var">method</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe String
</span><a href="#local-6989586621679052563"><span class="hs-identifier hs-var">computeMethod</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679052566"><span class="hs-identifier hs-var">fieldPart</span></a></span><span>
</span><span id="line-618"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679052562"><span class="annot"><span class="annottext">cls :: String
</span><a href="#local-6989586621679052562"><span class="hs-identifier hs-var hs-var">cls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Has&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679052566"><span class="hs-identifier hs-var">fieldPart</span></a></span><span>
</span><span id="line-619"></span><span>  </span><span class="annot"><span class="annottext">DefName -&gt; Maybe DefName
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; DefName
</span><a href="Lens.Micro.TH.html#MethodName"><span class="hs-identifier hs-var">MethodName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">mkName</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679052562"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">mkName</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679052564"><span class="hs-identifier hs-var">method</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-620"></span><span>
</span><span id="line-621"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-622"></span><span>  </span><span id="local-6989586621679052565"><span class="annot"><span class="annottext">expectedPrefix :: String
</span><a href="#local-6989586621679052565"><span class="hs-identifier hs-var hs-var">expectedPrefix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679052560"><span class="hs-identifier hs-var">optUnderscore</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ASetter String String Char Char
-&gt; (Char -&gt; Char) -&gt; String -&gt; String
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">over</span></span><span> </span><span class="annot"><span class="annottext">ASetter String String Char Char
forall s a. Cons s s a a =&gt; Traversal' s a
</span><span class="hs-identifier hs-var">_head</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char
</span><span class="hs-identifier hs-var">toLower</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; String
</span><span class="hs-identifier hs-var">nameBase</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052570"><span class="hs-identifier hs-var">tyName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-623"></span><span>
</span><span id="line-624"></span><span>  </span><span id="local-6989586621679052560"><span class="annot"><span class="annottext">optUnderscore :: String
</span><a href="#local-6989586621679052560"><span class="hs-identifier hs-var hs-var">optUnderscore</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'_'</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Bool) -&gt; [Name] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; String -&gt; Bool
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; Bool
</span><span class="hs-identifier hs-var">isPrefixOf</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;_&quot;</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Bool) -&gt; (Name -&gt; String) -&gt; Name -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; String
</span><span class="hs-identifier hs-var">nameBase</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679052569"><span class="hs-identifier hs-var">fields</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-625"></span><span>
</span><span id="line-626"></span><span>  </span><span id="local-6989586621679052563"><span class="annot"><span class="annottext">computeMethod :: String -&gt; Maybe String
</span><a href="#local-6989586621679052563"><span class="hs-identifier hs-var hs-var">computeMethod</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679052556"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679052556"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679052555"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679052555"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><span class="hs-identifier hs-var">isUpper</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679052556"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe String
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Char
</span><span class="hs-identifier hs-var">toLower</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679052556"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; String -&gt; String
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679052555"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-627"></span><span>  </span><span class="annot"><a href="#local-6989586621679052563"><span class="hs-identifier hs-var">computeMethod</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-628"></span><span>
</span><span id="line-629"></span><span class="hs-comment">{- |
Like standard rules used by 'makeFields', but doesn't put any restrictions on the prefix. I.e. if you have fields called

* @_fooBarBaz@
* @_someX@
* @someY@

then the generated lenses would be called @barBaz@ and @x@.
-}</span><span>
</span><span id="line-638"></span><span class="annot"><a href="Lens.Micro.TH.html#abbreviatedFields"><span class="hs-identifier hs-type">abbreviatedFields</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Lens.Micro.TH.html#LensRules"><span class="hs-identifier hs-type">LensRules</span></a></span><span>
</span><span id="line-639"></span><span id="abbreviatedFields"><span class="annot"><span class="annottext">abbreviatedFields :: LensRules
</span><a href="Lens.Micro.TH.html#abbreviatedFields"><span class="hs-identifier hs-var hs-var">abbreviatedFields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LensRules
</span><a href="Lens.Micro.TH.html#defaultFieldRules"><span class="hs-identifier hs-var">defaultFieldRules</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_fieldToDef :: Name -&gt; [Name] -&gt; Name -&gt; [DefName]
</span><a href="Lens.Micro.TH.html#_fieldToDef"><span class="hs-identifier hs-var">_fieldToDef</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Name] -&gt; Name -&gt; [DefName]
</span><a href="Lens.Micro.TH.html#abbreviatedNamer"><span class="hs-identifier hs-var">abbreviatedNamer</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-640"></span><span>
</span><span id="line-641"></span><span class="annot"><a href="Lens.Micro.TH.html#abbreviatedNamer"><span class="hs-identifier hs-type">abbreviatedNamer</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Lens.Micro.TH.html#DefName"><span class="hs-identifier hs-type">DefName</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-642"></span><span id="abbreviatedNamer"><span class="annot"><span class="annottext">abbreviatedNamer :: Name -&gt; [Name] -&gt; Name -&gt; [DefName]
</span><a href="Lens.Micro.TH.html#abbreviatedNamer"><span class="hs-identifier hs-var hs-var">abbreviatedNamer</span></a></span></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679052552"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679052552"><span class="hs-identifier hs-var">fields</span></a></span></span><span> </span><span id="local-6989586621679052551"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052551"><span class="hs-identifier hs-var">field</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe DefName -&gt; [DefName]
forall a. Maybe a -&gt; [a]
</span><span class="hs-identifier hs-var">maybeToList</span></span><span> </span><span class="annot"><span class="annottext">(Maybe DefName -&gt; [DefName]) -&gt; Maybe DefName -&gt; [DefName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-643"></span><span>
</span><span id="line-644"></span><span>  </span><span id="local-6989586621679052550"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679052550"><span class="hs-identifier hs-var">fieldPart</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe String
</span><a href="#local-6989586621679052549"><span class="hs-identifier hs-var">stripMaxLc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; String
</span><span class="hs-identifier hs-var">nameBase</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052551"><span class="hs-identifier hs-var">field</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-645"></span><span>  </span><span id="local-6989586621679052548"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679052548"><span class="hs-identifier hs-var">method</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe String
</span><a href="#local-6989586621679052547"><span class="hs-identifier hs-var">computeMethod</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679052550"><span class="hs-identifier hs-var">fieldPart</span></a></span><span>
</span><span id="line-646"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679052546"><span class="annot"><span class="annottext">cls :: String
</span><a href="#local-6989586621679052546"><span class="hs-identifier hs-var hs-var">cls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Has&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679052550"><span class="hs-identifier hs-var">fieldPart</span></a></span><span>
</span><span id="line-647"></span><span>  </span><span class="annot"><span class="annottext">DefName -&gt; Maybe DefName
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; DefName
</span><a href="Lens.Micro.TH.html#MethodName"><span class="hs-identifier hs-var">MethodName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">mkName</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679052546"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">mkName</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679052548"><span class="hs-identifier hs-var">method</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-648"></span><span>
</span><span id="line-649"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-650"></span><span>  </span><span id="local-6989586621679052549"><span class="annot"><span class="annottext">stripMaxLc :: String -&gt; Maybe String
</span><a href="#local-6989586621679052549"><span class="hs-identifier hs-var hs-var">stripMaxLc</span></a></span></span><span> </span><span id="local-6989586621679052545"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679052545"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679052544"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679052544"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Maybe String
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; Maybe [a]
</span><span class="hs-identifier hs-var">stripPrefix</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679052543"><span class="hs-identifier hs-var">optUnderscore</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679052545"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-651"></span><span>                    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; String -&gt; (String, String)
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">break</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><span class="hs-identifier hs-var">isUpper</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679052544"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-652"></span><span>                      </span><span class="hs-special">(</span><span id="local-6989586621679052541"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679052541"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679052540"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679052540"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">String -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679052541"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679052540"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-653"></span><span>                            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe String
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679052540"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-654"></span><span>  </span><span id="local-6989586621679052543"><span class="annot"><span class="annottext">optUnderscore :: String
</span><a href="#local-6989586621679052543"><span class="hs-identifier hs-var hs-var">optUnderscore</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'_'</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Bool) -&gt; [Name] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; String -&gt; Bool
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; Bool
</span><span class="hs-identifier hs-var">isPrefixOf</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;_&quot;</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Bool) -&gt; (Name -&gt; String) -&gt; Name -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; String
</span><span class="hs-identifier hs-var">nameBase</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679052552"><span class="hs-identifier hs-var">fields</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-655"></span><span>
</span><span id="line-656"></span><span>  </span><span id="local-6989586621679052547"><span class="annot"><span class="annottext">computeMethod :: String -&gt; Maybe String
</span><a href="#local-6989586621679052547"><span class="hs-identifier hs-var hs-var">computeMethod</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679052537"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679052537"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679052536"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679052536"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><span class="hs-identifier hs-var">isUpper</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679052537"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe String
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Char
</span><span class="hs-identifier hs-var">toLower</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679052537"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; String -&gt; String
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679052536"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-657"></span><span>  </span><span class="annot"><a href="#local-6989586621679052547"><span class="hs-identifier hs-var">computeMethod</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-658"></span><span>
</span><span id="line-659"></span><span class="annot"><a href="Lens.Micro.TH.html#defaultFieldRules"><span class="hs-identifier hs-type">defaultFieldRules</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Lens.Micro.TH.html#LensRules"><span class="hs-identifier hs-type">LensRules</span></a></span><span>
</span><span id="line-660"></span><span id="defaultFieldRules"><span class="annot"><span class="annottext">defaultFieldRules :: LensRules
</span><a href="Lens.Micro.TH.html#defaultFieldRules"><span class="hs-identifier hs-var hs-var">defaultFieldRules</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LensRules :: Bool
-&gt; Bool
-&gt; Bool
-&gt; Bool
-&gt; Bool
-&gt; (Name -&gt; [Name] -&gt; Name -&gt; [DefName])
-&gt; (Name -&gt; Maybe (Name, Name))
-&gt; LensRules
</span><a href="Lens.Micro.TH.html#LensRules"><span class="hs-identifier hs-type">LensRules</span></a></span><span>
</span><span id="line-661"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_simpleLenses :: Bool
</span><a href="Lens.Micro.TH.html#_simpleLenses"><span class="hs-identifier hs-var">_simpleLenses</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-662"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_generateSigs :: Bool
</span><a href="Lens.Micro.TH.html#_generateSigs"><span class="hs-identifier hs-var">_generateSigs</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-663"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_generateClasses :: Bool
</span><a href="Lens.Micro.TH.html#_generateClasses"><span class="hs-identifier hs-var">_generateClasses</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>  </span><span class="hs-comment">-- classes will still be skipped if they already exist</span><span>
</span><span id="line-664"></span><span>  </span><span class="hs-comment">-- , _allowIsos       = False -- generating Isos would hinder field class reuse</span><span>
</span><span id="line-665"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_allowUpdates :: Bool
</span><a href="Lens.Micro.TH.html#_allowUpdates"><span class="hs-identifier hs-var">_allowUpdates</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-666"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_lazyPatterns :: Bool
</span><a href="Lens.Micro.TH.html#_lazyPatterns"><span class="hs-identifier hs-var">_lazyPatterns</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-667"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_classyLenses :: Name -&gt; Maybe (Name, Name)
</span><a href="Lens.Micro.TH.html#_classyLenses"><span class="hs-identifier hs-var">_classyLenses</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Name, Name) -&gt; Name -&gt; Maybe (Name, Name)
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Name, Name)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-668"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_fieldToDef :: Name -&gt; [Name] -&gt; Name -&gt; [DefName]
</span><a href="Lens.Micro.TH.html#_fieldToDef"><span class="hs-identifier hs-var">_fieldToDef</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Name] -&gt; Name -&gt; [DefName]
</span><a href="Lens.Micro.TH.html#camelCaseNamer"><span class="hs-identifier hs-var">camelCaseNamer</span></a></span><span>
</span><span id="line-669"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-670"></span><span>
</span><span id="line-671"></span><span class="annot"><a href="Lens.Micro.TH.html#underscoreNoPrefixNamer"><span class="hs-identifier hs-type">underscoreNoPrefixNamer</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Lens.Micro.TH.html#DefName"><span class="hs-identifier hs-type">DefName</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-672"></span><span id="underscoreNoPrefixNamer"><span class="annot"><span class="annottext">underscoreNoPrefixNamer :: Name -&gt; [Name] -&gt; Name -&gt; [DefName]
</span><a href="Lens.Micro.TH.html#underscoreNoPrefixNamer"><span class="hs-identifier hs-var hs-var">underscoreNoPrefixNamer</span></a></span></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679052534"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052534"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-673"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Name -&gt; String
</span><span class="hs-identifier hs-var">nameBase</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052534"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-674"></span><span>    </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'_'</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679052533"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679052533"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679052532"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679052532"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; DefName
</span><a href="Lens.Micro.TH.html#TopName"><span class="hs-identifier hs-var">TopName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">mkName</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Char
</span><span class="hs-identifier hs-var">toLower</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679052533"><span class="hs-identifier hs-var">x</span></a></span><span class="annot"><span class="annottext">Char -&gt; String -&gt; String
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679052532"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-675"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-676"></span><span>
</span><span id="line-677"></span><span class="hs-comment">{- |
Lens rules used by 'makeClassy':

* 'generateSignatures' is turned on
* 'generateUpdateableOptics' is turned on
* 'generateLazyPatterns' is turned off
* 'simpleLenses' is turned on (unlike in 'lensRules')
* 'lensField' is the same as in 'lensRules'
* 'lensClass' just adds &#8220;Has&#8221; to the name of the type (so for &#8220;Person&#8221; the generated class would be called &#8220;HasPerson&#8221; and the type-specific lens in that class would be called &#8220;person&#8221;)
-}</span><span>
</span><span id="line-687"></span><span class="annot"><a href="Lens.Micro.TH.html#classyRules"><span class="hs-identifier hs-type">classyRules</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Lens.Micro.TH.html#LensRules"><span class="hs-identifier hs-type">LensRules</span></a></span><span>
</span><span id="line-688"></span><span id="classyRules"><span class="annot"><span class="annottext">classyRules :: LensRules
</span><a href="Lens.Micro.TH.html#classyRules"><span class="hs-identifier hs-var hs-var">classyRules</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LensRules :: Bool
-&gt; Bool
-&gt; Bool
-&gt; Bool
-&gt; Bool
-&gt; (Name -&gt; [Name] -&gt; Name -&gt; [DefName])
-&gt; (Name -&gt; Maybe (Name, Name))
-&gt; LensRules
</span><a href="Lens.Micro.TH.html#LensRules"><span class="hs-identifier hs-type">LensRules</span></a></span><span>
</span><span id="line-689"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_simpleLenses :: Bool
</span><a href="Lens.Micro.TH.html#_simpleLenses"><span class="hs-identifier hs-var">_simpleLenses</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-690"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_generateSigs :: Bool
</span><a href="Lens.Micro.TH.html#_generateSigs"><span class="hs-identifier hs-var">_generateSigs</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-691"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_generateClasses :: Bool
</span><a href="Lens.Micro.TH.html#_generateClasses"><span class="hs-identifier hs-var">_generateClasses</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-692"></span><span>  </span><span class="hs-comment">-- , _allowIsos       = False -- generating Isos would hinder &quot;subtyping&quot;</span><span>
</span><span id="line-693"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_allowUpdates :: Bool
</span><a href="Lens.Micro.TH.html#_allowUpdates"><span class="hs-identifier hs-var">_allowUpdates</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-694"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_lazyPatterns :: Bool
</span><a href="Lens.Micro.TH.html#_lazyPatterns"><span class="hs-identifier hs-var">_lazyPatterns</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-695"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_classyLenses :: Name -&gt; Maybe (Name, Name)
</span><a href="Lens.Micro.TH.html#_classyLenses"><span class="hs-identifier hs-var">_classyLenses</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679052531"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052531"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-696"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Name -&gt; String
</span><span class="hs-identifier hs-var">nameBase</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052531"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-697"></span><span>          </span><span id="local-6989586621679052530"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679052530"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679052529"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679052529"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Name, Name) -&gt; Maybe (Name, Name)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">mkName</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Has&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679052530"><span class="hs-identifier hs-var">x</span></a></span><span class="annot"><span class="annottext">Char -&gt; String -&gt; String
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679052529"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">mkName</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Char
</span><span class="hs-identifier hs-var">toLower</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679052530"><span class="hs-identifier hs-var">x</span></a></span><span class="annot"><span class="annottext">Char -&gt; String -&gt; String
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679052529"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-698"></span><span>          </span><span class="hs-special">[</span><span class="hs-special">]</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Name, Name)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-699"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_fieldToDef :: Name -&gt; [Name] -&gt; Name -&gt; [DefName]
</span><a href="Lens.Micro.TH.html#_fieldToDef"><span class="hs-identifier hs-var">_fieldToDef</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Name] -&gt; Name -&gt; [DefName]
</span><a href="Lens.Micro.TH.html#underscoreNoPrefixNamer"><span class="hs-identifier hs-var">underscoreNoPrefixNamer</span></a></span><span>
</span><span id="line-700"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-701"></span><span>
</span><span id="line-702"></span><span class="hs-comment">-- FieldTH.hs</span><span>
</span><span id="line-703"></span><span>
</span><span id="line-704"></span><span class="hs-comment">------------------------------------------------------------------------</span><span>
</span><span id="line-705"></span><span class="hs-comment">-- Field generation entry point</span><span>
</span><span id="line-706"></span><span class="hs-comment">------------------------------------------------------------------------</span><span>
</span><span id="line-707"></span><span>
</span><span id="line-708"></span><span>
</span><span id="line-709"></span><span class="hs-comment">-- Compute the field optics for the type identified by the given type name.</span><span>
</span><span id="line-710"></span><span class="hs-comment">-- Lenses will be computed when possible, Traversals otherwise.</span><span>
</span><span id="line-711"></span><span class="annot"><a href="Lens.Micro.TH.html#makeFieldOptics"><span class="hs-identifier hs-type">makeFieldOptics</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Lens.Micro.TH.html#LensRules"><span class="hs-identifier hs-type">LensRules</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DecsQ</span></span><span>
</span><span id="line-712"></span><span id="makeFieldOptics"><span class="annot"><span class="annottext">makeFieldOptics :: LensRules -&gt; Name -&gt; DecsQ
</span><a href="Lens.Micro.TH.html#makeFieldOptics"><span class="hs-identifier hs-var hs-var">makeFieldOptics</span></a></span></span><span> </span><span id="local-6989586621679052528"><span class="annot"><span class="annottext">LensRules
</span><a href="#local-6989586621679052528"><span class="hs-identifier hs-var">rules</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateT (Set Name) Q [Dec] -&gt; Set Name -&gt; DecsQ
forall (m :: * -&gt; *) s a. Monad m =&gt; StateT s m a -&gt; s -&gt; m a
</span><span class="hs-operator hs-var">`evalStateT`</span></span><span> </span><span class="annot"><span class="annottext">Set Name
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(StateT (Set Name) Q [Dec] -&gt; DecsQ)
-&gt; (DatatypeInfo -&gt; StateT (Set Name) Q [Dec])
-&gt; DatatypeInfo
-&gt; DecsQ
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">LensRules -&gt; DatatypeInfo -&gt; StateT (Set Name) Q [Dec]
</span><a href="Lens.Micro.TH.html#makeFieldOpticsForDatatype"><span class="hs-identifier hs-var">makeFieldOpticsForDatatype</span></a></span><span> </span><span class="annot"><span class="annottext">LensRules
</span><a href="#local-6989586621679052528"><span class="hs-identifier hs-var">rules</span></a></span><span> </span><span class="annot"><span class="annottext">(DatatypeInfo -&gt; DecsQ)
-&gt; (Name -&gt; Q DatatypeInfo) -&gt; Name -&gt; DecsQ
forall (m :: * -&gt; *) b c a.
Monad m =&gt;
(b -&gt; m c) -&gt; (a -&gt; m b) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&lt;=&lt;</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Q DatatypeInfo
</span><span class="hs-identifier hs-var">D.reifyDatatype</span></span><span>
</span><span id="line-713"></span><span>
</span><span id="line-714"></span><span class="hs-keyword">type</span><span> </span><span id="HasFieldClasses"><span class="annot"><a href="Lens.Micro.TH.html#HasFieldClasses"><span class="hs-identifier hs-var">HasFieldClasses</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span>
</span><span id="line-715"></span><span>
</span><span id="line-716"></span><span class="annot"><a href="Lens.Micro.TH.html#addFieldClassName"><span class="hs-identifier hs-type">addFieldClassName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Lens.Micro.TH.html#HasFieldClasses"><span class="hs-identifier hs-type">HasFieldClasses</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-717"></span><span id="addFieldClassName"><span class="annot"><span class="annottext">addFieldClassName :: Name -&gt; HasFieldClasses ()
</span><a href="Lens.Micro.TH.html#addFieldClassName"><span class="hs-identifier hs-var hs-var">addFieldClassName</span></a></span></span><span> </span><span id="local-6989586621679052521"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052521"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Set Name -&gt; Set Name) -&gt; HasFieldClasses ()
forall (m :: * -&gt; *) s. Monad m =&gt; (s -&gt; s) -&gt; StateT s m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((Set Name -&gt; Set Name) -&gt; HasFieldClasses ())
-&gt; (Set Name -&gt; Set Name) -&gt; HasFieldClasses ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Set Name -&gt; Set Name
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.insert</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052521"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-718"></span><span>
</span><span id="line-719"></span><span class="hs-comment">-- | Compute the field optics for a deconstructed datatype Dec</span><span>
</span><span id="line-720"></span><span class="hs-comment">-- When possible build an Iso otherwise build one optic per field.</span><span>
</span><span id="line-721"></span><span class="annot"><a href="Lens.Micro.TH.html#makeFieldOpticsForDatatype"><span class="hs-identifier hs-type">makeFieldOpticsForDatatype</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Lens.Micro.TH.html#LensRules"><span class="hs-identifier hs-type">LensRules</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">D.DatatypeInfo</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Lens.Micro.TH.html#HasFieldClasses"><span class="hs-identifier hs-type">HasFieldClasses</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span><span>
</span><span id="line-722"></span><span id="makeFieldOpticsForDatatype"><span class="annot"><span class="annottext">makeFieldOpticsForDatatype :: LensRules -&gt; DatatypeInfo -&gt; StateT (Set Name) Q [Dec]
</span><a href="Lens.Micro.TH.html#makeFieldOpticsForDatatype"><span class="hs-identifier hs-var hs-var">makeFieldOpticsForDatatype</span></a></span></span><span> </span><span id="local-6989586621679052518"><span class="annot"><span class="annottext">LensRules
</span><a href="#local-6989586621679052518"><span class="hs-identifier hs-var">rules</span></a></span></span><span> </span><span id="local-6989586621679052517"><span class="annot"><span class="annottext">DatatypeInfo
</span><a href="#local-6989586621679052517"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-723"></span><span>  </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679052516"><span class="annot"><span class="annottext">Map DefName (OpticType, OpticStab, [(Name, Int, [Int])])
</span><a href="#local-6989586621679052516"><span class="hs-identifier hs-var">perDef</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Q (Map DefName (OpticType, OpticStab, [(Name, Int, [Int])]))
-&gt; StateT
     (Set Name)
     Q
     (Map DefName (OpticType, OpticStab, [(Name, Int, [Int])]))
forall (m :: * -&gt; *) a s. Monad m =&gt; m a -&gt; StateT s m a
</span><a href="Lens.Micro.TH.html#liftState"><span class="hs-identifier hs-var">liftState</span></a></span><span> </span><span class="annot"><span class="annottext">(Q (Map DefName (OpticType, OpticStab, [(Name, Int, [Int])]))
 -&gt; StateT
      (Set Name)
      Q
      (Map DefName (OpticType, OpticStab, [(Name, Int, [Int])])))
-&gt; Q (Map DefName (OpticType, OpticStab, [(Name, Int, [Int])]))
-&gt; StateT
     (Set Name)
     Q
     (Map DefName (OpticType, OpticStab, [(Name, Int, [Int])]))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-724"></span><span>       </span><span id="local-6989586621679052514"><span class="annot"><span class="annottext">[(Name, [(Maybe Name, Type)])]
</span><a href="#local-6989586621679052514"><span class="hs-identifier hs-var">fieldCons</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ConstructorInfo -&gt; Q (Name, [(Maybe Name, Type)]))
-&gt; [ConstructorInfo] -&gt; Q [(Name, [(Maybe Name, Type)])]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">ConstructorInfo -&gt; Q (Name, [(Maybe Name, Type)])
</span><a href="Lens.Micro.TH.html#normalizeConstructor"><span class="hs-identifier hs-var">normalizeConstructor</span></a></span><span> </span><span class="annot"><span class="annottext">[ConstructorInfo]
</span><a href="#local-6989586621679052511"><span class="hs-identifier hs-var">cons</span></a></span><span>
</span><span id="line-725"></span><span>       </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679052510"><span class="annot"><span class="annottext">allFields :: [Name]
</span><a href="#local-6989586621679052510"><span class="hs-identifier hs-var hs-var">allFields</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Getting (Endo [Name]) [(Name, [(Maybe Name, Type)])] Name
-&gt; [(Name, [(Maybe Name, Type)])] -&gt; [Name]
forall a s. Getting (Endo [a]) s a -&gt; s -&gt; [a]
</span><span class="hs-identifier hs-var">toListOf</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Getting
  (Endo [Name])
  [(Name, [(Maybe Name, Type)])]
  (Name, [(Maybe Name, Type)])
forall (f :: * -&gt; *) a. Foldable f =&gt; SimpleFold (f a) a
</span><span class="hs-identifier hs-var">folded</span></span><span> </span><span class="annot"><span class="annottext">Getting
  (Endo [Name])
  [(Name, [(Maybe Name, Type)])]
  (Name, [(Maybe Name, Type)])
-&gt; ((Name -&gt; Const (Endo [Name]) Name)
    -&gt; (Name, [(Maybe Name, Type)])
    -&gt; Const (Endo [Name]) (Name, [(Maybe Name, Type)]))
-&gt; Getting (Endo [Name]) [(Name, [(Maybe Name, Type)])] Name
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">([(Maybe Name, Type)] -&gt; Const (Endo [Name]) [(Maybe Name, Type)])
-&gt; (Name, [(Maybe Name, Type)])
-&gt; Const (Endo [Name]) (Name, [(Maybe Name, Type)])
forall s t a b. Field2 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_2</span></span><span> </span><span class="annot"><span class="annottext">(([(Maybe Name, Type)] -&gt; Const (Endo [Name]) [(Maybe Name, Type)])
 -&gt; (Name, [(Maybe Name, Type)])
 -&gt; Const (Endo [Name]) (Name, [(Maybe Name, Type)]))
-&gt; ((Name -&gt; Const (Endo [Name]) Name)
    -&gt; [(Maybe Name, Type)]
    -&gt; Const (Endo [Name]) [(Maybe Name, Type)])
-&gt; (Name -&gt; Const (Endo [Name]) Name)
-&gt; (Name, [(Maybe Name, Type)])
-&gt; Const (Endo [Name]) (Name, [(Maybe Name, Type)])
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Getting (Endo [Name]) [(Maybe Name, Type)] (Maybe Name, Type)
forall (f :: * -&gt; *) a. Foldable f =&gt; SimpleFold (f a) a
</span><span class="hs-identifier hs-var">folded</span></span><span> </span><span class="annot"><span class="annottext">Getting (Endo [Name]) [(Maybe Name, Type)] (Maybe Name, Type)
-&gt; ((Name -&gt; Const (Endo [Name]) Name)
    -&gt; (Maybe Name, Type) -&gt; Const (Endo [Name]) (Maybe Name, Type))
-&gt; (Name -&gt; Const (Endo [Name]) Name)
-&gt; [(Maybe Name, Type)]
-&gt; Const (Endo [Name]) [(Maybe Name, Type)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Name -&gt; Const (Endo [Name]) (Maybe Name))
-&gt; (Maybe Name, Type) -&gt; Const (Endo [Name]) (Maybe Name, Type)
forall s t a b. Field1 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_1</span></span><span> </span><span class="annot"><span class="annottext">((Maybe Name -&gt; Const (Endo [Name]) (Maybe Name))
 -&gt; (Maybe Name, Type) -&gt; Const (Endo [Name]) (Maybe Name, Type))
-&gt; ((Name -&gt; Const (Endo [Name]) Name)
    -&gt; Maybe Name -&gt; Const (Endo [Name]) (Maybe Name))
-&gt; (Name -&gt; Const (Endo [Name]) Name)
-&gt; (Maybe Name, Type)
-&gt; Const (Endo [Name]) (Maybe Name, Type)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Const (Endo [Name]) Name)
-&gt; Maybe Name -&gt; Const (Endo [Name]) (Maybe Name)
forall (f :: * -&gt; *) a. Foldable f =&gt; SimpleFold (f a) a
</span><span class="hs-identifier hs-var">folded</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Name, [(Maybe Name, Type)])]
</span><a href="#local-6989586621679052514"><span class="hs-identifier hs-var">fieldCons</span></a></span><span>
</span><span id="line-726"></span><span>       </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679052505"><span class="annot"><span class="annottext">defCons :: [(Name, [([DefName], Type)])]
</span><a href="#local-6989586621679052505"><span class="hs-identifier hs-var hs-var">defCons</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ASetter
  [(Name, [(Maybe Name, Type)])]
  [(Name, [([DefName], Type)])]
  (Maybe Name)
  [DefName]
-&gt; (Maybe Name -&gt; [DefName])
-&gt; [(Name, [(Maybe Name, Type)])]
-&gt; [(Name, [([DefName], Type)])]
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">over</span></span><span> </span><span class="annot"><span class="annottext">ASetter
  [(Name, [(Maybe Name, Type)])]
  [(Name, [([DefName], Type)])]
  (Maybe Name)
  [DefName]
forall a b.
Traversal [(Name, [(a, Type)])] [(Name, [(b, Type)])] a b
</span><a href="#local-6989586621679052504"><span class="hs-identifier hs-var">normFieldLabels</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Name] -&gt; Maybe Name -&gt; [DefName]
</span><a href="#local-6989586621679052503"><span class="hs-identifier hs-var">expandName</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679052510"><span class="hs-identifier hs-var">allFields</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Name, [(Maybe Name, Type)])]
</span><a href="#local-6989586621679052514"><span class="hs-identifier hs-var">fieldCons</span></a></span><span>
</span><span id="line-727"></span><span>           </span><span id="local-6989586621679052502"><span class="annot"><span class="annottext">allDefs :: Set DefName
</span><a href="#local-6989586621679052502"><span class="hs-identifier hs-var hs-var">allDefs</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Getting (Endo [DefName]) [(Name, [([DefName], Type)])] DefName
-&gt; [(Name, [([DefName], Type)])] -&gt; Set DefName
forall a s. Ord a =&gt; Getting (Endo [a]) s a -&gt; s -&gt; Set a
</span><a href="Lens.Micro.TH.Internal.html#setOf"><span class="hs-identifier hs-var">setOf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([DefName] -&gt; Const (Endo [DefName]) [DefName])
-&gt; [(Name, [([DefName], Type)])]
-&gt; Const (Endo [DefName]) [(Name, [([DefName], Type)])]
forall a b.
Traversal [(Name, [(a, Type)])] [(Name, [(b, Type)])] a b
</span><a href="#local-6989586621679052504"><span class="hs-identifier hs-var">normFieldLabels</span></a></span><span> </span><span class="annot"><span class="annottext">(([DefName] -&gt; Const (Endo [DefName]) [DefName])
 -&gt; [(Name, [([DefName], Type)])]
 -&gt; Const (Endo [DefName]) [(Name, [([DefName], Type)])])
-&gt; ((DefName -&gt; Const (Endo [DefName]) DefName)
    -&gt; [DefName] -&gt; Const (Endo [DefName]) [DefName])
-&gt; Getting (Endo [DefName]) [(Name, [([DefName], Type)])] DefName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(DefName -&gt; Const (Endo [DefName]) DefName)
-&gt; [DefName] -&gt; Const (Endo [DefName]) [DefName]
forall (f :: * -&gt; *) a. Foldable f =&gt; SimpleFold (f a) a
</span><span class="hs-identifier hs-var">folded</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Name, [([DefName], Type)])]
</span><a href="#local-6989586621679052505"><span class="hs-identifier hs-var">defCons</span></a></span><span>
</span><span id="line-728"></span><span>       </span><span class="annot"><span class="annottext">Map DefName (Q (OpticType, OpticStab, [(Name, Int, [Int])]))
-&gt; Q (Map DefName (OpticType, OpticStab, [(Name, Int, [Int])]))
forall (t :: * -&gt; *) (f :: * -&gt; *) a.
(Traversable t, Applicative f) =&gt;
t (f a) -&gt; f (t a)
</span><span class="hs-identifier hs-var">sequenceA</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(DefName -&gt; Q (OpticType, OpticStab, [(Name, Int, [Int])]))
-&gt; Set DefName
-&gt; Map DefName (Q (OpticType, OpticStab, [(Name, Int, [Int])]))
forall k a. (k -&gt; a) -&gt; Set k -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromSet</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LensRules
-&gt; Type
-&gt; [(Name, [([DefName], Type)])]
-&gt; DefName
-&gt; Q (OpticType, OpticStab, [(Name, Int, [Int])])
</span><a href="Lens.Micro.TH.html#buildScaffold"><span class="hs-identifier hs-var">buildScaffold</span></a></span><span> </span><span class="annot"><span class="annottext">LensRules
</span><a href="#local-6989586621679052518"><span class="hs-identifier hs-var">rules</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052497"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, [([DefName], Type)])]
</span><a href="#local-6989586621679052505"><span class="hs-identifier hs-var">defCons</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set DefName
</span><a href="#local-6989586621679052502"><span class="hs-identifier hs-var">allDefs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-729"></span><span>
</span><span id="line-730"></span><span>     </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679052496"><span class="annot"><span class="annottext">defs :: [(DefName, (OpticType, OpticStab, [(Name, Int, [Int])]))]
</span><a href="#local-6989586621679052496"><span class="hs-identifier hs-var hs-var">defs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map DefName (OpticType, OpticStab, [(Name, Int, [Int])])
-&gt; [(DefName, (OpticType, OpticStab, [(Name, Int, [Int])]))]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">Map DefName (OpticType, OpticStab, [(Name, Int, [Int])])
</span><a href="#local-6989586621679052516"><span class="hs-identifier hs-var">perDef</span></a></span><span>
</span><span id="line-731"></span><span>     </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">LensRules -&gt; Name -&gt; Maybe (Name, Name)
</span><a href="Lens.Micro.TH.html#_classyLenses"><span class="hs-identifier hs-var hs-var">_classyLenses</span></a></span><span> </span><span class="annot"><span class="annottext">LensRules
</span><a href="#local-6989586621679052518"><span class="hs-identifier hs-var">rules</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052494"><span class="hs-identifier hs-var">tyName</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-732"></span><span>       </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679052493"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052493"><span class="hs-identifier hs-var">className</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679052492"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052492"><span class="hs-identifier hs-var">methodName</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-733"></span><span>         </span><span class="annot"><span class="annottext">LensRules
-&gt; Name
-&gt; Name
-&gt; Type
-&gt; [(DefName, (OpticType, OpticStab, [(Name, Int, [Int])]))]
-&gt; StateT (Set Name) Q [Dec]
</span><a href="Lens.Micro.TH.html#makeClassyDriver"><span class="hs-identifier hs-var">makeClassyDriver</span></a></span><span> </span><span class="annot"><span class="annottext">LensRules
</span><a href="#local-6989586621679052518"><span class="hs-identifier hs-var">rules</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052493"><span class="hs-identifier hs-var">className</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052492"><span class="hs-identifier hs-var">methodName</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052497"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">[(DefName, (OpticType, OpticStab, [(Name, Int, [Int])]))]
</span><a href="#local-6989586621679052496"><span class="hs-identifier hs-var">defs</span></a></span><span>
</span><span id="line-734"></span><span>       </span><span class="annot"><span class="annottext">Maybe (Name, Name)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679052490"><span class="annot"><span class="annottext">[[Dec]]
</span><a href="#local-6989586621679052490"><span class="hs-identifier hs-var">decss</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((DefName, (OpticType, OpticStab, [(Name, Int, [Int])]))
 -&gt; StateT (Set Name) Q [Dec])
-&gt; [(DefName, (OpticType, OpticStab, [(Name, Int, [Int])]))]
-&gt; StateT (Set Name) Q [[Dec]]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LensRules
-&gt; (DefName, (OpticType, OpticStab, [(Name, Int, [Int])]))
-&gt; StateT (Set Name) Q [Dec]
</span><a href="Lens.Micro.TH.html#makeFieldOptic"><span class="hs-identifier hs-var">makeFieldOptic</span></a></span><span> </span><span class="annot"><span class="annottext">LensRules
</span><a href="#local-6989586621679052518"><span class="hs-identifier hs-var">rules</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(DefName, (OpticType, OpticStab, [(Name, Int, [Int])]))]
</span><a href="#local-6989586621679052496"><span class="hs-identifier hs-var">defs</span></a></span><span>
</span><span id="line-735"></span><span>                     </span><span class="annot"><span class="annottext">[Dec] -&gt; StateT (Set Name) Q [Dec]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[[Dec]] -&gt; [Dec]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">[[Dec]]
</span><a href="#local-6989586621679052490"><span class="hs-identifier hs-var">decss</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-736"></span><span>
</span><span id="line-737"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-738"></span><span>  </span><span id="local-6989586621679052494"><span class="annot"><span class="annottext">tyName :: Name
</span><a href="#local-6989586621679052494"><span class="hs-identifier hs-var hs-var">tyName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DatatypeInfo -&gt; Name
</span><span class="hs-identifier hs-var hs-var">D.datatypeName</span></span><span>     </span><span class="annot"><span class="annottext">DatatypeInfo
</span><a href="#local-6989586621679052517"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-739"></span><span>  </span><span id="local-6989586621679052497"><span class="annot"><span class="annottext">s :: Type
</span><a href="#local-6989586621679052497"><span class="hs-identifier hs-var hs-var">s</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DatatypeInfo -&gt; Type
</span><a href="Lens.Micro.TH.Internal.html#datatypeTypeKinded"><span class="hs-identifier hs-var">datatypeTypeKinded</span></a></span><span> </span><span class="annot"><span class="annottext">DatatypeInfo
</span><a href="#local-6989586621679052517"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-740"></span><span>  </span><span id="local-6989586621679052511"><span class="annot"><span class="annottext">cons :: [ConstructorInfo]
</span><a href="#local-6989586621679052511"><span class="hs-identifier hs-var hs-var">cons</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DatatypeInfo -&gt; [ConstructorInfo]
</span><span class="hs-identifier hs-var hs-var">D.datatypeCons</span></span><span>     </span><span class="annot"><span class="annottext">DatatypeInfo
</span><a href="#local-6989586621679052517"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-741"></span><span>
</span><span id="line-742"></span><span>  </span><span class="hs-comment">-- Traverse the field labels of a normalized constructor</span><span>
</span><span id="line-743"></span><span>  </span><span id="local-6989586621679052789"><span id="local-6989586621679052790"><span class="annot"><a href="#local-6989586621679052504"><span class="hs-identifier hs-type">normFieldLabels</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Traversal</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679052790"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679052789"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621679052790"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679052789"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-744"></span><span>  </span><span id="local-6989586621679052504"><span class="annot"><span class="annottext">normFieldLabels :: (a -&gt; f b) -&gt; [(Name, [(a, Type)])] -&gt; f [(Name, [(b, Type)])]
</span><a href="#local-6989586621679052504"><span class="hs-identifier hs-var hs-var">normFieldLabels</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Name, [(a, Type)]) -&gt; f (Name, [(b, Type)]))
-&gt; [(Name, [(a, Type)])] -&gt; f [(Name, [(b, Type)])]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">(((Name, [(a, Type)]) -&gt; f (Name, [(b, Type)]))
 -&gt; [(Name, [(a, Type)])] -&gt; f [(Name, [(b, Type)])])
-&gt; ((a -&gt; f b) -&gt; (Name, [(a, Type)]) -&gt; f (Name, [(b, Type)]))
-&gt; (a -&gt; f b)
-&gt; [(Name, [(a, Type)])]
-&gt; f [(Name, [(b, Type)])]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">([(a, Type)] -&gt; f [(b, Type)])
-&gt; (Name, [(a, Type)]) -&gt; f (Name, [(b, Type)])
forall s t a b. Field2 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_2</span></span><span> </span><span class="annot"><span class="annottext">(([(a, Type)] -&gt; f [(b, Type)])
 -&gt; (Name, [(a, Type)]) -&gt; f (Name, [(b, Type)]))
-&gt; ((a -&gt; f b) -&gt; [(a, Type)] -&gt; f [(b, Type)])
-&gt; (a -&gt; f b)
-&gt; (Name, [(a, Type)])
-&gt; f (Name, [(b, Type)])
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((a, Type) -&gt; f (b, Type)) -&gt; [(a, Type)] -&gt; f [(b, Type)]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">(((a, Type) -&gt; f (b, Type)) -&gt; [(a, Type)] -&gt; f [(b, Type)])
-&gt; ((a -&gt; f b) -&gt; (a, Type) -&gt; f (b, Type))
-&gt; (a -&gt; f b)
-&gt; [(a, Type)]
-&gt; f [(b, Type)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; f b) -&gt; (a, Type) -&gt; f (b, Type)
forall s t a b. Field1 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_1</span></span><span>
</span><span id="line-745"></span><span>
</span><span id="line-746"></span><span>  </span><span class="hs-comment">-- Map a (possibly missing) field's name to zero-to-many optic definitions</span><span>
</span><span id="line-747"></span><span>  </span><span class="annot"><a href="#local-6989586621679052503"><span class="hs-identifier hs-type">expandName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Lens.Micro.TH.html#DefName"><span class="hs-identifier hs-type">DefName</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-748"></span><span>  </span><span id="local-6989586621679052503"><span class="annot"><span class="annottext">expandName :: [Name] -&gt; Maybe Name -&gt; [DefName]
</span><a href="#local-6989586621679052503"><span class="hs-identifier hs-var hs-var">expandName</span></a></span></span><span> </span><span id="local-6989586621679052484"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679052484"><span class="hs-identifier hs-var">allFields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; [DefName]) -&gt; [Name] -&gt; [DefName]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LensRules -&gt; Name -&gt; [Name] -&gt; Name -&gt; [DefName]
</span><a href="Lens.Micro.TH.html#_fieldToDef"><span class="hs-identifier hs-var hs-var">_fieldToDef</span></a></span><span> </span><span class="annot"><span class="annottext">LensRules
</span><a href="#local-6989586621679052518"><span class="hs-identifier hs-var">rules</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052494"><span class="hs-identifier hs-var">tyName</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679052484"><span class="hs-identifier hs-var">allFields</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Name] -&gt; [DefName])
-&gt; (Maybe Name -&gt; [Name]) -&gt; Maybe Name -&gt; [DefName]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; [Name]
forall a. Maybe a -&gt; [a]
</span><span class="hs-identifier hs-var">maybeToList</span></span><span>
</span><span id="line-749"></span><span>
</span><span id="line-750"></span><span class="annot"><a href="Lens.Micro.TH.html#normalizeConstructor"><span class="hs-identifier hs-type">normalizeConstructor</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-751"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">D.ConstructorInfo</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-752"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ constructor name, field name, field type</span><span>
</span><span id="line-753"></span><span>
</span><span id="line-754"></span><span id="normalizeConstructor"><span class="annot"><span class="annottext">normalizeConstructor :: ConstructorInfo -&gt; Q (Name, [(Maybe Name, Type)])
</span><a href="Lens.Micro.TH.html#normalizeConstructor"><span class="hs-identifier hs-var hs-var">normalizeConstructor</span></a></span></span><span> </span><span id="local-6989586621679052482"><span class="annot"><span class="annottext">ConstructorInfo
</span><a href="#local-6989586621679052482"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-755"></span><span>  </span><span class="annot"><span class="annottext">(Name, [(Maybe Name, Type)]) -&gt; Q (Name, [(Maybe Name, Type)])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConstructorInfo -&gt; Name
</span><span class="hs-identifier hs-var hs-var">D.constructorName</span></span><span> </span><span class="annot"><span class="annottext">ConstructorInfo
</span><a href="#local-6989586621679052482"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-756"></span><span>          </span><span class="annot"><span class="annottext">(Maybe Name -&gt; Type -&gt; (Maybe Name, Type))
-&gt; [Maybe Name] -&gt; [Type] -&gt; [(Maybe Name, Type)]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; Type -&gt; (Maybe Name, Type)
forall s a. HasTypeVars s =&gt; Maybe a -&gt; s -&gt; (Maybe a, s)
</span><a href="#local-6989586621679052479"><span class="hs-identifier hs-var">checkForExistentials</span></a></span><span> </span><span class="annot"><span class="annottext">[Maybe Name]
</span><a href="#local-6989586621679052478"><span class="hs-identifier hs-var">fieldNames</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConstructorInfo -&gt; [Type]
</span><span class="hs-identifier hs-var hs-var">D.constructorFields</span></span><span> </span><span class="annot"><span class="annottext">ConstructorInfo
</span><a href="#local-6989586621679052482"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-757"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-758"></span><span>    </span><span id="local-6989586621679052478"><span class="annot"><span class="annottext">fieldNames :: [Maybe Name]
</span><a href="#local-6989586621679052478"><span class="hs-identifier hs-var hs-var">fieldNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-759"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ConstructorInfo -&gt; ConstructorVariant
</span><span class="hs-identifier hs-var hs-var">D.constructorVariant</span></span><span> </span><span class="annot"><span class="annottext">ConstructorInfo
</span><a href="#local-6989586621679052482"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-760"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">D.RecordConstructor</span></span><span> </span><span id="local-6989586621679052474"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679052474"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Maybe Name) -&gt; [Name] -&gt; [Maybe Name]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Maybe Name
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679052474"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-761"></span><span>        </span><span class="annot"><span class="annottext">ConstructorVariant
</span><span class="hs-identifier hs-var">D.NormalConstructor</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; [Maybe Name]
forall a. a -&gt; [a]
</span><span class="hs-identifier hs-var">repeat</span></span><span> </span><span class="annot"><span class="annottext">Maybe Name
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-762"></span><span>        </span><span class="annot"><span class="annottext">ConstructorVariant
</span><span class="hs-identifier hs-var">D.InfixConstructor</span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; [Maybe Name]
forall a. a -&gt; [a]
</span><span class="hs-identifier hs-var">repeat</span></span><span> </span><span class="annot"><span class="annottext">Maybe Name
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-763"></span><span>
</span><span id="line-764"></span><span>    </span><span class="hs-comment">-- Fields mentioning existentially quantified types are not</span><span>
</span><span id="line-765"></span><span>    </span><span class="hs-comment">-- elligible for TH generated optics.</span><span>
</span><span id="line-766"></span><span>    </span><span id="local-6989586621679052479"><span class="annot"><span class="annottext">checkForExistentials :: Maybe a -&gt; s -&gt; (Maybe a, s)
</span><a href="#local-6989586621679052479"><span class="hs-identifier hs-var hs-var">checkForExistentials</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679052470"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679052470"><span class="hs-identifier hs-var">fieldtype</span></a></span></span><span>
</span><span id="line-767"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(TyVarBndr_ Any -&gt; Bool) -&gt; [TyVarBndr_ Any] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679052469"><span class="annot"><span class="annottext">TyVarBndr_ Any
</span><a href="#local-6989586621679052469"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyVarBndr_ Any -&gt; Name
forall flag. TyVarBndr_ Any -&gt; Name
</span><span class="hs-identifier hs-var">D.tvName</span></span><span> </span><span class="annot"><span class="annottext">TyVarBndr_ Any
</span><a href="#local-6989586621679052469"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Set Name -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`Set.member`</span></span><span> </span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621679052466"><span class="hs-identifier hs-var">used</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TyVarBndr_ Any]
</span><a href="#local-6989586621679052465"><span class="hs-identifier hs-var">unallowable</span></a></span><span>
</span><span id="line-768"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679052470"><span class="hs-identifier hs-var">fieldtype</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-769"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-770"></span><span>        </span><span id="local-6989586621679052466"><span class="annot"><span class="annottext">used :: Set Name
</span><a href="#local-6989586621679052466"><span class="hs-identifier hs-var hs-var">used</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Getting (Endo [Name]) s Name -&gt; s -&gt; Set Name
forall a s. Ord a =&gt; Getting (Endo [a]) s a -&gt; s -&gt; Set a
</span><a href="Lens.Micro.TH.Internal.html#setOf"><span class="hs-identifier hs-var">setOf</span></a></span><span> </span><span class="annot"><span class="annottext">Getting (Endo [Name]) s Name
forall t. HasTypeVars t =&gt; Traversal' t Name
</span><a href="Lens.Micro.TH.Internal.html#typeVars"><span class="hs-identifier hs-var">typeVars</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679052470"><span class="hs-identifier hs-var">fieldtype</span></a></span><span>
</span><span id="line-771"></span><span>        </span><span id="local-6989586621679052465"><span class="annot"><span class="annottext">unallowable :: [TyVarBndr_ Any]
</span><a href="#local-6989586621679052465"><span class="hs-identifier hs-var hs-var">unallowable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConstructorInfo -&gt; [TyVarBndr_ Any]
</span><span class="hs-identifier hs-var hs-var">D.constructorVars</span></span><span> </span><span class="annot"><span class="annottext">ConstructorInfo
</span><a href="#local-6989586621679052482"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-772"></span><span>    </span><span class="annot"><a href="#local-6989586621679052479"><span class="hs-identifier hs-var">checkForExistentials</span></a></span><span> </span><span id="local-6989586621679052462"><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621679052462"><span class="hs-identifier hs-var">fieldname</span></a></span></span><span> </span><span id="local-6989586621679052461"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679052461"><span class="hs-identifier hs-var">fieldtype</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621679052462"><span class="hs-identifier hs-var">fieldname</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679052461"><span class="hs-identifier hs-var">fieldtype</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-773"></span><span>
</span><span id="line-774"></span><span class="annot"><a href="Lens.Micro.TH.html#makeClassyDriver"><span class="hs-identifier hs-type">makeClassyDriver</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-775"></span><span>  </span><span class="annot"><a href="Lens.Micro.TH.html#LensRules"><span class="hs-identifier hs-type">LensRules</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-776"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-777"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-778"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-comment">{- ^ Outer 's' type -}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-779"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Lens.Micro.TH.html#DefName"><span class="hs-identifier hs-type">DefName</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Lens.Micro.TH.html#OpticType"><span class="hs-identifier hs-type">OpticType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Lens.Micro.TH.html#OpticStab"><span class="hs-identifier hs-type">OpticStab</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-780"></span><span>  </span><span class="annot"><a href="Lens.Micro.TH.html#HasFieldClasses"><span class="hs-identifier hs-type">HasFieldClasses</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span><span>
</span><span id="line-781"></span><span id="makeClassyDriver"><span class="annot"><span class="annottext">makeClassyDriver :: LensRules
-&gt; Name
-&gt; Name
-&gt; Type
-&gt; [(DefName, (OpticType, OpticStab, [(Name, Int, [Int])]))]
-&gt; StateT (Set Name) Q [Dec]
</span><a href="Lens.Micro.TH.html#makeClassyDriver"><span class="hs-identifier hs-var hs-var">makeClassyDriver</span></a></span></span><span> </span><span id="local-6989586621679052460"><span class="annot"><span class="annottext">LensRules
</span><a href="#local-6989586621679052460"><span class="hs-identifier hs-var">rules</span></a></span></span><span> </span><span id="local-6989586621679052459"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052459"><span class="hs-identifier hs-var">className</span></a></span></span><span> </span><span id="local-6989586621679052458"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052458"><span class="hs-identifier hs-var">methodName</span></a></span></span><span> </span><span id="local-6989586621679052457"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052457"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679052456"><span class="annot"><span class="annottext">[(DefName, (OpticType, OpticStab, [(Name, Int, [Int])]))]
</span><a href="#local-6989586621679052456"><span class="hs-identifier hs-var">defs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[StateT (Set Name) Q Dec] -&gt; StateT (Set Name) Q [Dec]
forall (t :: * -&gt; *) (f :: * -&gt; *) a.
(Traversable t, Applicative f) =&gt;
t (f a) -&gt; f (t a)
</span><span class="hs-identifier hs-var">sequenceA</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[StateT (Set Name) Q Dec]
forall s. [StateT s Q Dec]
</span><a href="#local-6989586621679052455"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">[StateT (Set Name) Q Dec]
-&gt; [StateT (Set Name) Q Dec] -&gt; [StateT (Set Name) Q Dec]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[StateT (Set Name) Q Dec]
</span><a href="#local-6989586621679052454"><span class="hs-identifier hs-var">inst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-782"></span><span>
</span><span id="line-783"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-784"></span><span>  </span><span id="local-6989586621679052455"><span class="annot"><span class="annottext">cls :: [StateT s Q Dec]
</span><a href="#local-6989586621679052455"><span class="hs-identifier hs-var hs-var">cls</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">LensRules -&gt; Bool
</span><a href="Lens.Micro.TH.html#_generateClasses"><span class="hs-identifier hs-var hs-var">_generateClasses</span></a></span><span> </span><span class="annot"><span class="annottext">LensRules
</span><a href="#local-6989586621679052460"><span class="hs-identifier hs-var">rules</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Q Dec -&gt; StateT s Q Dec
forall (m :: * -&gt; *) a s. Monad m =&gt; m a -&gt; StateT s m a
</span><a href="Lens.Micro.TH.html#liftState"><span class="hs-identifier hs-var">liftState</span></a></span><span> </span><span class="annot"><span class="annottext">(Q Dec -&gt; StateT s Q Dec) -&gt; Q Dec -&gt; StateT s Q Dec
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name
-&gt; Name
-&gt; Type
-&gt; [(DefName, (OpticType, OpticStab, [(Name, Int, [Int])]))]
-&gt; Q Dec
</span><a href="Lens.Micro.TH.html#makeClassyClass"><span class="hs-identifier hs-var">makeClassyClass</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052459"><span class="hs-identifier hs-var">className</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052458"><span class="hs-identifier hs-var">methodName</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052457"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">[(DefName, (OpticType, OpticStab, [(Name, Int, [Int])]))]
</span><a href="#local-6989586621679052456"><span class="hs-identifier hs-var">defs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-785"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-786"></span><span>
</span><span id="line-787"></span><span>  </span><span id="local-6989586621679052454"><span class="annot"><span class="annottext">inst :: [StateT (Set Name) Q Dec]
</span><a href="#local-6989586621679052454"><span class="hs-identifier hs-var hs-var">inst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">LensRules
-&gt; Name
-&gt; Name
-&gt; Type
-&gt; [(DefName, (OpticType, OpticStab, [(Name, Int, [Int])]))]
-&gt; StateT (Set Name) Q Dec
</span><a href="Lens.Micro.TH.html#makeClassyInstance"><span class="hs-identifier hs-var">makeClassyInstance</span></a></span><span> </span><span class="annot"><span class="annottext">LensRules
</span><a href="#local-6989586621679052460"><span class="hs-identifier hs-var">rules</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052459"><span class="hs-identifier hs-var">className</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052458"><span class="hs-identifier hs-var">methodName</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052457"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">[(DefName, (OpticType, OpticStab, [(Name, Int, [Int])]))]
</span><a href="#local-6989586621679052456"><span class="hs-identifier hs-var">defs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-788"></span><span>
</span><span id="line-789"></span><span class="annot"><a href="Lens.Micro.TH.html#makeClassyClass"><span class="hs-identifier hs-type">makeClassyClass</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-790"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-791"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-792"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-comment">{- ^ Outer 's' type -}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-793"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Lens.Micro.TH.html#DefName"><span class="hs-identifier hs-type">DefName</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Lens.Micro.TH.html#OpticType"><span class="hs-identifier hs-type">OpticType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Lens.Micro.TH.html#OpticStab"><span class="hs-identifier hs-type">OpticStab</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-794"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">DecQ</span></span><span>
</span><span id="line-795"></span><span id="makeClassyClass"><span class="annot"><span class="annottext">makeClassyClass :: Name
-&gt; Name
-&gt; Type
-&gt; [(DefName, (OpticType, OpticStab, [(Name, Int, [Int])]))]
-&gt; Q Dec
</span><a href="Lens.Micro.TH.html#makeClassyClass"><span class="hs-identifier hs-var hs-var">makeClassyClass</span></a></span></span><span> </span><span id="local-6989586621679052451"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052451"><span class="hs-identifier hs-var">className</span></a></span></span><span> </span><span id="local-6989586621679052450"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052450"><span class="hs-identifier hs-var">methodName</span></a></span></span><span> </span><span id="local-6989586621679052449"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052449"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679052448"><span class="annot"><span class="annottext">[(DefName, (OpticType, OpticStab, [(Name, Int, [Int])]))]
</span><a href="#local-6989586621679052448"><span class="hs-identifier hs-var">defs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-796"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679052447"><span class="annot"><span class="annottext">ss :: [Type]
</span><a href="#local-6989586621679052447"><span class="hs-identifier hs-var hs-var">ss</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((DefName, (OpticType, OpticStab, [(Name, Int, [Int])])) -&gt; Type)
-&gt; [(DefName, (OpticType, OpticStab, [(Name, Int, [Int])]))]
-&gt; [Type]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OpticStab -&gt; Type
</span><a href="Lens.Micro.TH.html#stabToS"><span class="hs-identifier hs-var">stabToS</span></a></span><span> </span><span class="annot"><span class="annottext">(OpticStab -&gt; Type)
-&gt; ((DefName, (OpticType, OpticStab, [(Name, Int, [Int])]))
    -&gt; OpticStab)
-&gt; (DefName, (OpticType, OpticStab, [(Name, Int, [Int])]))
-&gt; Type
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(DefName, (OpticType, OpticStab, [(Name, Int, [Int])]))
-&gt; Getting
     OpticStab
     (DefName, (OpticType, OpticStab, [(Name, Int, [Int])]))
     OpticStab
-&gt; OpticStab
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">((OpticType, OpticStab, [(Name, Int, [Int])])
 -&gt; Const OpticStab (OpticType, OpticStab, [(Name, Int, [Int])]))
-&gt; (DefName, (OpticType, OpticStab, [(Name, Int, [Int])]))
-&gt; Const
     OpticStab (DefName, (OpticType, OpticStab, [(Name, Int, [Int])]))
forall s t a b. Field2 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_2</span></span><span class="annot"><span class="annottext">(((OpticType, OpticStab, [(Name, Int, [Int])])
  -&gt; Const OpticStab (OpticType, OpticStab, [(Name, Int, [Int])]))
 -&gt; (DefName, (OpticType, OpticStab, [(Name, Int, [Int])]))
 -&gt; Const
      OpticStab (DefName, (OpticType, OpticStab, [(Name, Int, [Int])])))
-&gt; ((OpticStab -&gt; Const OpticStab OpticStab)
    -&gt; (OpticType, OpticStab, [(Name, Int, [Int])])
    -&gt; Const OpticStab (OpticType, OpticStab, [(Name, Int, [Int])]))
-&gt; Getting
     OpticStab
     (DefName, (OpticType, OpticStab, [(Name, Int, [Int])]))
     OpticStab
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(OpticStab -&gt; Const OpticStab OpticStab)
-&gt; (OpticType, OpticStab, [(Name, Int, [Int])])
-&gt; Const OpticStab (OpticType, OpticStab, [(Name, Int, [Int])])
forall s t a b. Field2 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_2</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(DefName, (OpticType, OpticStab, [(Name, Int, [Int])]))]
</span><a href="#local-6989586621679052448"><span class="hs-identifier hs-var">defs</span></a></span><span>
</span><span id="line-797"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679052444"><span class="annot"><span class="annottext">Map Name Type
</span><a href="#local-6989586621679052444"><span class="hs-identifier hs-var">sub</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679052443"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052443"><span class="hs-identifier hs-var">s'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; Q (Map Name Type, Type)
</span><a href="Lens.Micro.TH.html#unifyTypes"><span class="hs-identifier hs-var">unifyTypes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052449"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; [Type]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679052447"><span class="hs-identifier hs-var">ss</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-798"></span><span>  </span><span id="local-6989586621679052441"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052441"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; Q Name
</span><span class="hs-identifier hs-var">newName</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;c&quot;</span></span><span>
</span><span id="line-799"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679052440"><span class="annot"><span class="annottext">vars :: [TyVarBndr_ Any]
</span><a href="#local-6989586621679052440"><span class="hs-identifier hs-var hs-var">vars</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [TyVarBndr_ Any]
</span><span class="hs-identifier hs-var">D.freeVariablesWellScoped</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052443"><span class="hs-identifier hs-var">s'</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-800"></span><span>      </span><span id="local-6989586621679052438"><span class="annot"><span class="annottext">varNames :: [Name]
</span><a href="#local-6989586621679052438"><span class="hs-identifier hs-var hs-var">varNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TyVarBndr_ Any -&gt; Name) -&gt; [TyVarBndr_ Any] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">TyVarBndr_ Any -&gt; Name
forall flag. TyVarBndr_ Any -&gt; Name
</span><span class="hs-identifier hs-var">D.tvName</span></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr_ Any]
</span><a href="#local-6989586621679052440"><span class="hs-identifier hs-var">vars</span></a></span><span>
</span><span id="line-801"></span><span>      </span><span id="local-6989586621679052437"><span class="annot"><span class="annottext">fd :: [FunDep]
</span><a href="#local-6989586621679052437"><span class="hs-identifier hs-var hs-var">fd</span></a></span></span><span>   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[TyVarBndr_ Any] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr_ Any]
</span><a href="#local-6989586621679052440"><span class="hs-identifier hs-var">vars</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-802"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Name] -&gt; [Name] -&gt; FunDep
</span><span class="hs-identifier hs-var">FunDep</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052441"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679052438"><span class="hs-identifier hs-var">varNames</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-803"></span><span>
</span><span id="line-804"></span><span>
</span><span id="line-805"></span><span>  </span><span class="annot"><span class="annottext">CxtQ -&gt; Name -&gt; [TyVarBndr_ Any] -&gt; [FunDep] -&gt; [Q Dec] -&gt; Q Dec
</span><span class="hs-identifier hs-var">classD</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[PredQ] -&gt; CxtQ
</span><span class="hs-identifier hs-var">cxt</span></span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052451"><span class="hs-identifier hs-var">className</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; TyVarBndr_ Any
</span><span class="hs-identifier hs-var">D.plainTV</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052441"><span class="hs-identifier hs-var">c</span></a></span><span class="annot"><span class="annottext">TyVarBndr_ Any -&gt; [TyVarBndr_ Any] -&gt; [TyVarBndr_ Any]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[TyVarBndr_ Any]
</span><a href="#local-6989586621679052440"><span class="hs-identifier hs-var">vars</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[FunDep]
</span><a href="#local-6989586621679052437"><span class="hs-identifier hs-var">fd</span></a></span><span>
</span><span id="line-806"></span><span>    </span><span class="annot"><span class="annottext">([Q Dec] -&gt; Q Dec) -&gt; [Q Dec] -&gt; Q Dec
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; PredQ -&gt; Q Dec
</span><span class="hs-identifier hs-var">sigD</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052450"><span class="hs-identifier hs-var">methodName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; PredQ
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">''</span><span class="hs-identifier">Lens'</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Type] -&gt; Type
</span><a href="Lens.Micro.TH.Internal.html#conAppsT"><span class="hs-operator hs-var">`conAppsT`</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">VarT</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052441"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052443"><span class="hs-identifier hs-var">s'</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-807"></span><span>    </span><span class="annot"><span class="annottext">Q Dec -&gt; [Q Dec] -&gt; [Q Dec]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[[Q Dec]] -&gt; [Q Dec]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span>
</span><span id="line-808"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; PredQ -&gt; Q Dec
</span><span class="hs-identifier hs-var">sigD</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052431"><span class="hs-identifier hs-var">defName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; PredQ
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052430"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-809"></span><span>        </span><span class="hs-special">,</span><span class="annot"><span class="annottext">PatQ -&gt; BodyQ -&gt; [Q Dec] -&gt; Q Dec
</span><span class="hs-identifier hs-var">valD</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; PatQ
</span><span class="hs-identifier hs-var">varP</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052431"><span class="hs-identifier hs-var">defName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExpQ -&gt; BodyQ
</span><span class="hs-identifier hs-var">normalB</span></span><span> </span><span class="annot"><span class="annottext">ExpQ
</span><a href="#local-6989586621679052429"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-810"></span><span>        </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Q Dec] -&gt; [Q Dec] -&gt; [Q Dec]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-811"></span><span>        </span><span class="annot"><span class="annottext">Name -&gt; [Q Dec]
</span><a href="Lens.Micro.TH.Internal.html#inlinePragma"><span class="hs-identifier hs-var">inlinePragma</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052431"><span class="hs-identifier hs-var">defName</span></a></span><span>
</span><span id="line-812"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Lens.Micro.TH.html#TopName"><span class="hs-identifier hs-type">TopName</span></a></span><span> </span><span id="local-6989586621679052431"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052431"><span class="hs-identifier hs-var">defName</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OpticType
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679052427"><span class="annot"><span class="annottext">OpticStab
</span><a href="#local-6989586621679052427"><span class="hs-identifier hs-var">stab</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Name, Int, [Int])]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(DefName, (OpticType, OpticStab, [(Name, Int, [Int])]))]
</span><a href="#local-6989586621679052448"><span class="hs-identifier hs-var">defs</span></a></span><span>
</span><span id="line-813"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679052429"><span class="annot"><span class="annottext">body :: ExpQ
</span><a href="#local-6989586621679052429"><span class="hs-identifier hs-var hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ExpQ] -&gt; ExpQ
</span><span class="hs-identifier hs-var">appsE</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; ExpQ
</span><span class="hs-identifier hs-var">varE</span></span><span> </span><span class="hs-special">'</span><span class="hs-special">(</span><span class="hs-operator">.</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; ExpQ
</span><span class="hs-identifier hs-var">varE</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052450"><span class="hs-identifier hs-var">methodName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; ExpQ
</span><span class="hs-identifier hs-var">varE</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052431"><span class="hs-identifier hs-var">defName</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-814"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679052430"><span class="annot"><span class="annottext">ty :: Type
</span><a href="#local-6989586621679052430"><span class="hs-identifier hs-var hs-var">ty</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Name -&gt; [Type] -&gt; Type -&gt; Type
</span><a href="Lens.Micro.TH.Internal.html#quantifyType%27"><span class="hs-identifier hs-var">quantifyType'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Name] -&gt; Set Name
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052441"><span class="hs-identifier hs-var">c</span></a></span><span class="annot"><span class="annottext">Name -&gt; [Name] -&gt; [Name]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679052438"><span class="hs-identifier hs-var">varNames</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-815"></span><span>                                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OpticStab -&gt; [Type]
</span><a href="Lens.Micro.TH.html#stabToContext"><span class="hs-identifier hs-var">stabToContext</span></a></span><span> </span><span class="annot"><span class="annottext">OpticStab
</span><a href="#local-6989586621679052427"><span class="hs-identifier hs-var">stab</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-816"></span><span>                 </span><span class="annot"><span class="annottext">(Type -&gt; Type) -&gt; Type -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">OpticStab -&gt; Name
</span><a href="Lens.Micro.TH.html#stabToOptic"><span class="hs-identifier hs-var">stabToOptic</span></a></span><span> </span><span class="annot"><span class="annottext">OpticStab
</span><a href="#local-6989586621679052427"><span class="hs-identifier hs-var">stab</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Type] -&gt; Type
</span><a href="Lens.Micro.TH.Internal.html#conAppsT"><span class="hs-operator hs-var">`conAppsT`</span></a></span><span>
</span><span id="line-817"></span><span>                       </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">VarT</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052441"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map Name Type -&gt; Type -&gt; Type
</span><a href="Lens.Micro.TH.html#applyTypeSubst"><span class="hs-identifier hs-var">applyTypeSubst</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name Type
</span><a href="#local-6989586621679052444"><span class="hs-identifier hs-var">sub</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OpticStab -&gt; Type
</span><a href="Lens.Micro.TH.html#stabToA"><span class="hs-identifier hs-var">stabToA</span></a></span><span> </span><span class="annot"><span class="annottext">OpticStab
</span><a href="#local-6989586621679052427"><span class="hs-identifier hs-var">stab</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-818"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-819"></span><span>
</span><span id="line-820"></span><span class="annot"><a href="Lens.Micro.TH.html#makeClassyInstance"><span class="hs-identifier hs-type">makeClassyInstance</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-821"></span><span>  </span><span class="annot"><a href="Lens.Micro.TH.html#LensRules"><span class="hs-identifier hs-type">LensRules</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-822"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-823"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-824"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-comment">{- ^ Outer 's' type -}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-825"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Lens.Micro.TH.html#DefName"><span class="hs-identifier hs-type">DefName</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Lens.Micro.TH.html#OpticType"><span class="hs-identifier hs-type">OpticType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Lens.Micro.TH.html#OpticStab"><span class="hs-identifier hs-type">OpticStab</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-826"></span><span>  </span><span class="annot"><a href="Lens.Micro.TH.html#HasFieldClasses"><span class="hs-identifier hs-type">HasFieldClasses</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span>
</span><span id="line-827"></span><span id="makeClassyInstance"><span class="annot"><span class="annottext">makeClassyInstance :: LensRules
-&gt; Name
-&gt; Name
-&gt; Type
-&gt; [(DefName, (OpticType, OpticStab, [(Name, Int, [Int])]))]
-&gt; StateT (Set Name) Q Dec
</span><a href="Lens.Micro.TH.html#makeClassyInstance"><span class="hs-identifier hs-var hs-var">makeClassyInstance</span></a></span></span><span> </span><span id="local-6989586621679052419"><span class="annot"><span class="annottext">LensRules
</span><a href="#local-6989586621679052419"><span class="hs-identifier hs-var">rules</span></a></span></span><span> </span><span id="local-6989586621679052418"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052418"><span class="hs-identifier hs-var">className</span></a></span></span><span> </span><span id="local-6989586621679052417"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052417"><span class="hs-identifier hs-var">methodName</span></a></span></span><span> </span><span id="local-6989586621679052416"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052416"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679052415"><span class="annot"><span class="annottext">[(DefName, (OpticType, OpticStab, [(Name, Int, [Int])]))]
</span><a href="#local-6989586621679052415"><span class="hs-identifier hs-var">defs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-828"></span><span>  </span><span id="local-6989586621679052414"><span class="annot"><span class="annottext">[[Dec]]
</span><a href="#local-6989586621679052414"><span class="hs-identifier hs-var">methodss</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((DefName, (OpticType, OpticStab, [(Name, Int, [Int])]))
 -&gt; StateT (Set Name) Q [Dec])
-&gt; [(DefName, (OpticType, OpticStab, [(Name, Int, [Int])]))]
-&gt; StateT (Set Name) Q [[Dec]]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LensRules
-&gt; (DefName, (OpticType, OpticStab, [(Name, Int, [Int])]))
-&gt; StateT (Set Name) Q [Dec]
</span><a href="Lens.Micro.TH.html#makeFieldOptic"><span class="hs-identifier hs-var">makeFieldOptic</span></a></span><span> </span><span class="annot"><span class="annottext">LensRules
</span><a href="#local-6989586621679052413"><span class="hs-identifier hs-var">rules'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(DefName, (OpticType, OpticStab, [(Name, Int, [Int])]))]
</span><a href="#local-6989586621679052415"><span class="hs-identifier hs-var">defs</span></a></span><span>
</span><span id="line-829"></span><span>
</span><span id="line-830"></span><span>  </span><span class="annot"><span class="annottext">Q Dec -&gt; StateT (Set Name) Q Dec
forall (m :: * -&gt; *) a s. Monad m =&gt; m a -&gt; StateT s m a
</span><a href="Lens.Micro.TH.html#liftState"><span class="hs-identifier hs-var">liftState</span></a></span><span> </span><span class="annot"><span class="annottext">(Q Dec -&gt; StateT (Set Name) Q Dec)
-&gt; Q Dec -&gt; StateT (Set Name) Q Dec
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CxtQ -&gt; PredQ -&gt; [Q Dec] -&gt; Q Dec
</span><span class="hs-identifier hs-var">instanceD</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[PredQ] -&gt; CxtQ
</span><span class="hs-identifier hs-var">cxt</span></span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; PredQ
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052411"><span class="hs-identifier hs-var">instanceHead</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-831"></span><span>    </span><span class="annot"><span class="annottext">([Q Dec] -&gt; Q Dec) -&gt; [Q Dec] -&gt; Q Dec
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PatQ -&gt; BodyQ -&gt; [Q Dec] -&gt; Q Dec
</span><span class="hs-identifier hs-var">valD</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; PatQ
</span><span class="hs-identifier hs-var">varP</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052417"><span class="hs-identifier hs-var">methodName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExpQ -&gt; BodyQ
</span><span class="hs-identifier hs-var">normalB</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; ExpQ
</span><span class="hs-identifier hs-var">varE</span></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">id</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-832"></span><span>    </span><span class="annot"><span class="annottext">Q Dec -&gt; [Q Dec] -&gt; [Q Dec]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">(Dec -&gt; Q Dec) -&gt; [Dec] -&gt; [Q Dec]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Dec -&gt; Q Dec
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[[Dec]] -&gt; [Dec]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">[[Dec]]
</span><a href="#local-6989586621679052414"><span class="hs-identifier hs-var">methodss</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-833"></span><span>
</span><span id="line-834"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-835"></span><span>  </span><span id="local-6989586621679052411"><span class="annot"><span class="annottext">instanceHead :: Type
</span><a href="#local-6989586621679052411"><span class="hs-identifier hs-var hs-var">instanceHead</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052418"><span class="hs-identifier hs-var">className</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Type] -&gt; Type
</span><a href="Lens.Micro.TH.Internal.html#conAppsT"><span class="hs-operator hs-var">`conAppsT`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052416"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; [Type]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">(TyVarBndr_ Any -&gt; Type) -&gt; [TyVarBndr_ Any] -&gt; [Type]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">TyVarBndr_ Any -&gt; Type
forall flag. TyVarBndr_ Any -&gt; Type
</span><a href="Lens.Micro.TH.Internal.html#tvbToType"><span class="hs-identifier hs-var">tvbToType</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr_ Any]
</span><a href="#local-6989586621679052409"><span class="hs-identifier hs-var">vars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-836"></span><span>  </span><span id="local-6989586621679052409"><span class="annot"><span class="annottext">vars :: [TyVarBndr_ Any]
</span><a href="#local-6989586621679052409"><span class="hs-identifier hs-var hs-var">vars</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [TyVarBndr_ Any]
</span><span class="hs-identifier hs-var">D.freeVariablesWellScoped</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052416"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-837"></span><span>  </span><span id="local-6989586621679052413"><span class="annot"><span class="annottext">rules' :: LensRules
</span><a href="#local-6989586621679052413"><span class="hs-identifier hs-var hs-var">rules'</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LensRules
</span><a href="#local-6989586621679052419"><span class="hs-identifier hs-var">rules</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_generateSigs :: Bool
</span><a href="Lens.Micro.TH.html#_generateSigs"><span class="hs-identifier hs-var">_generateSigs</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-838"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_generateClasses :: Bool
</span><a href="Lens.Micro.TH.html#_generateClasses"><span class="hs-identifier hs-var">_generateClasses</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-839"></span><span>                       </span><span class="hs-special">}</span><span>
</span><span id="line-840"></span><span>
</span><span id="line-841"></span><span class="hs-keyword">data</span><span> </span><span id="OpticType"><span class="annot"><a href="Lens.Micro.TH.html#OpticType"><span class="hs-identifier hs-var">OpticType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="GetterType"><span class="annot"><a href="Lens.Micro.TH.html#GetterType"><span class="hs-identifier hs-var">GetterType</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="LensType"><span class="annot"><a href="Lens.Micro.TH.html#LensType"><span class="hs-identifier hs-var">LensType</span></a></span></span><span> </span><span class="hs-comment">-- or IsoType</span><span>
</span><span id="line-842"></span><span>
</span><span id="line-843"></span><span>
</span><span id="line-844"></span><span class="hs-comment">-- Compute the positional location of the fields involved in</span><span>
</span><span id="line-845"></span><span class="hs-comment">-- each constructor for a given optic definition as well as the</span><span>
</span><span id="line-846"></span><span class="hs-comment">-- type of clauses to generate and the type to annotate the declaration</span><span>
</span><span id="line-847"></span><span class="hs-comment">-- with.</span><span>
</span><span id="line-848"></span><span class="annot"><a href="Lens.Micro.TH.html#buildScaffold"><span class="hs-identifier hs-type">buildScaffold</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-849"></span><span>  </span><span class="annot"><a href="Lens.Micro.TH.html#LensRules"><span class="hs-identifier hs-type">LensRules</span></a></span><span>                                                                </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-850"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>                              </span><span class="hs-comment">{- outer type                       -}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-851"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Lens.Micro.TH.html#DefName"><span class="hs-identifier hs-type">DefName</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>     </span><span class="hs-comment">{- normalized constructors          -}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-852"></span><span>  </span><span class="annot"><a href="Lens.Micro.TH.html#DefName"><span class="hs-identifier hs-type">DefName</span></a></span><span>                           </span><span class="hs-comment">{- target definition                -}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-853"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Lens.Micro.TH.html#OpticType"><span class="hs-identifier hs-type">OpticType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Lens.Micro.TH.html#OpticStab"><span class="hs-identifier hs-type">OpticStab</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-854"></span><span>              </span><span class="hs-comment">{- ^ optic type, definition type, field count, target fields -}</span><span>
</span><span id="line-855"></span><span id="buildScaffold"><span class="annot"><span class="annottext">buildScaffold :: LensRules
-&gt; Type
-&gt; [(Name, [([DefName], Type)])]
-&gt; DefName
-&gt; Q (OpticType, OpticStab, [(Name, Int, [Int])])
</span><a href="Lens.Micro.TH.html#buildScaffold"><span class="hs-identifier hs-var hs-var">buildScaffold</span></a></span></span><span> </span><span id="local-6989586621679052406"><span class="annot"><span class="annottext">LensRules
</span><a href="#local-6989586621679052406"><span class="hs-identifier hs-var">rules</span></a></span></span><span> </span><span id="local-6989586621679052405"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052405"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679052404"><span class="annot"><span class="annottext">[(Name, [([DefName], Type)])]
</span><a href="#local-6989586621679052404"><span class="hs-identifier hs-var">cons</span></a></span></span><span> </span><span id="local-6989586621679052403"><span class="annot"><span class="annottext">DefName
</span><a href="#local-6989586621679052403"><span class="hs-identifier hs-var">defName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-856"></span><span>
</span><span id="line-857"></span><span>  </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679052402"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052402"><span class="hs-identifier hs-var">s'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679052401"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052401"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679052400"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052400"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679052399"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052399"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; [Either Type Type] -&gt; Q (Type, Type, Type, Type)
</span><a href="Lens.Micro.TH.html#buildStab"><span class="hs-identifier hs-var">buildStab</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052405"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Name, [Either Type Type]) -&gt; [Either Type Type])
-&gt; [(Name, [Either Type Type])] -&gt; [Either Type Type]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">(Name, [Either Type Type]) -&gt; [Either Type Type]
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">[(Name, [Either Type Type])]
</span><a href="#local-6989586621679052397"><span class="hs-identifier hs-var">consForDef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-858"></span><span>
</span><span id="line-859"></span><span>     </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679052396"><span class="annot"><span class="annottext">defType :: OpticStab
</span><a href="#local-6989586621679052396"><span class="hs-identifier hs-var hs-var">defType</span></a></span></span><span>
</span><span id="line-860"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVarBndr_ Any]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621679052395"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679052395"><span class="hs-identifier hs-var">cx</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679052394"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052394"><span class="hs-identifier hs-var">a'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052400"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Type
-&gt; Getting
     (First ([TyVarBndr_ Any], [Type], Type))
     Type
     ([TyVarBndr_ Any], [Type], Type)
-&gt; Maybe ([TyVarBndr_ Any], [Type], Type)
forall s a. s -&gt; Getting (First a) s a -&gt; Maybe a
</span><span class="hs-operator hs-var">^?</span></span><span> </span><span class="annot"><span class="annottext">Getting
  (First ([TyVarBndr_ Any], [Type], Type))
  Type
  ([TyVarBndr_ Any], [Type], Type)
Traversal' Type ([TyVarBndr_ Any], [Type], Type)
</span><a href="Lens.Micro.TH.Internal.html#_ForallT"><span class="hs-identifier hs-var">_ForallT</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-861"></span><span>               </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679052391"><span class="annot"><span class="annottext">optic :: Name
</span><a href="#local-6989586621679052391"><span class="hs-identifier hs-var hs-var">optic</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679052390"><span class="hs-identifier hs-var">lensCase</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">SimpleGetter</span><span>
</span><span id="line-862"></span><span>                         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">SimpleFold</span><span>
</span><span id="line-863"></span><span>               </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; Name -&gt; Type -&gt; Type -&gt; OpticStab
</span><a href="Lens.Micro.TH.html#OpticSa"><span class="hs-identifier hs-var">OpticSa</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679052395"><span class="hs-identifier hs-var">cx</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052391"><span class="hs-identifier hs-var">optic</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052402"><span class="hs-identifier hs-var">s'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052394"><span class="hs-identifier hs-var">a'</span></a></span><span>
</span><span id="line-864"></span><span>
</span><span id="line-865"></span><span>           </span><span class="hs-comment">-- Getter and Fold are always simple</span><span>
</span><span id="line-866"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LensRules -&gt; Bool
</span><a href="Lens.Micro.TH.html#_allowUpdates"><span class="hs-identifier hs-var hs-var">_allowUpdates</span></a></span><span> </span><span class="annot"><span class="annottext">LensRules
</span><a href="#local-6989586621679052406"><span class="hs-identifier hs-var">rules</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-867"></span><span>               </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679052387"><span class="annot"><span class="annottext">optic :: Name
</span><a href="#local-6989586621679052387"><span class="hs-identifier hs-var hs-var">optic</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679052390"><span class="hs-identifier hs-var">lensCase</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">SimpleGetter</span><span>
</span><span id="line-868"></span><span>                         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">SimpleFold</span><span>
</span><span id="line-869"></span><span>               </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; Name -&gt; Type -&gt; Type -&gt; OpticStab
</span><a href="Lens.Micro.TH.html#OpticSa"><span class="hs-identifier hs-var">OpticSa</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052387"><span class="hs-identifier hs-var">optic</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052402"><span class="hs-identifier hs-var">s'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052400"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-870"></span><span>
</span><span id="line-871"></span><span>           </span><span class="hs-comment">-- Generate simple Lens and Traversal where possible</span><span>
</span><span id="line-872"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">LensRules -&gt; Bool
</span><a href="Lens.Micro.TH.html#_simpleLenses"><span class="hs-identifier hs-var hs-var">_simpleLenses</span></a></span><span> </span><span class="annot"><span class="annottext">LensRules
</span><a href="#local-6989586621679052406"><span class="hs-identifier hs-var">rules</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052402"><span class="hs-identifier hs-var">s'</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052401"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052400"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052399"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-873"></span><span>               </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679052385"><span class="annot"><span class="annottext">optic :: Name
</span><a href="#local-6989586621679052385"><span class="hs-identifier hs-var hs-var">optic</span></a></span></span><span> </span><span class="hs-comment">-- isoCase &amp;&amp; _allowIsos rules = ''Iso'</span><span>
</span><span id="line-874"></span><span>                         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679052390"><span class="hs-identifier hs-var">lensCase</span></a></span><span>                    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Lens'</span><span>
</span><span id="line-875"></span><span>                         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Traversal'</span><span>
</span><span id="line-876"></span><span>               </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; Name -&gt; Type -&gt; Type -&gt; OpticStab
</span><a href="Lens.Micro.TH.html#OpticSa"><span class="hs-identifier hs-var">OpticSa</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052385"><span class="hs-identifier hs-var">optic</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052402"><span class="hs-identifier hs-var">s'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052400"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-877"></span><span>
</span><span id="line-878"></span><span>           </span><span class="hs-comment">-- Generate type-changing Lens and Traversal otherwise</span><span>
</span><span id="line-879"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-880"></span><span>               </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679052384"><span class="annot"><span class="annottext">optic :: Name
</span><a href="#local-6989586621679052384"><span class="hs-identifier hs-var hs-var">optic</span></a></span></span><span> </span><span class="hs-comment">-- isoCase &amp;&amp; _allowIsos rules = ''Iso</span><span>
</span><span id="line-881"></span><span>                         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679052390"><span class="hs-identifier hs-var">lensCase</span></a></span><span>                    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Lens</span><span>
</span><span id="line-882"></span><span>                         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Traversal</span><span>
</span><span id="line-883"></span><span>               </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type -&gt; Type -&gt; Type -&gt; Type -&gt; OpticStab
</span><a href="Lens.Micro.TH.html#OpticStab"><span class="hs-identifier hs-var">OpticStab</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052384"><span class="hs-identifier hs-var">optic</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052402"><span class="hs-identifier hs-var">s'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052401"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052400"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052399"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-884"></span><span>
</span><span id="line-885"></span><span>         </span><span id="local-6989586621679052382"><span class="annot"><span class="annottext">opticType :: OpticType
</span><a href="#local-6989586621679052382"><span class="hs-identifier hs-var hs-var">opticType</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Getting Any Type ([TyVarBndr_ Any], [Type], Type) -&gt; Type -&gt; Bool
forall s a. Getting Any s a -&gt; s -&gt; Bool
</span><span class="hs-identifier hs-var">has</span></span><span> </span><span class="annot"><span class="annottext">Getting Any Type ([TyVarBndr_ Any], [Type], Type)
Traversal' Type ([TyVarBndr_ Any], [Type], Type)
</span><a href="Lens.Micro.TH.Internal.html#_ForallT"><span class="hs-identifier hs-var">_ForallT</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052400"><span class="hs-identifier hs-var">a</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OpticType
</span><a href="Lens.Micro.TH.html#GetterType"><span class="hs-identifier hs-var">GetterType</span></a></span><span>
</span><span id="line-886"></span><span>                   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LensRules -&gt; Bool
</span><a href="Lens.Micro.TH.html#_allowUpdates"><span class="hs-identifier hs-var hs-var">_allowUpdates</span></a></span><span> </span><span class="annot"><span class="annottext">LensRules
</span><a href="#local-6989586621679052406"><span class="hs-identifier hs-var">rules</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OpticType
</span><a href="Lens.Micro.TH.html#GetterType"><span class="hs-identifier hs-var">GetterType</span></a></span><span>
</span><span id="line-887"></span><span>                   </span><span class="hs-comment">-- isoCase                   = IsoType</span><span>
</span><span id="line-888"></span><span>                   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OpticType
</span><a href="Lens.Micro.TH.html#LensType"><span class="hs-identifier hs-var">LensType</span></a></span><span>
</span><span id="line-889"></span><span>
</span><span id="line-890"></span><span>     </span><span class="annot"><span class="annottext">(OpticType, OpticStab, [(Name, Int, [Int])])
-&gt; Q (OpticType, OpticStab, [(Name, Int, [Int])])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OpticType
</span><a href="#local-6989586621679052382"><span class="hs-identifier hs-var">opticType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OpticStab
</span><a href="#local-6989586621679052396"><span class="hs-identifier hs-var">defType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Name, Int, [Int])]
</span><a href="#local-6989586621679052380"><span class="hs-identifier hs-var">scaffolds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-891"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-892"></span><span>  </span><span class="annot"><a href="#local-6989586621679052397"><span class="hs-identifier hs-type">consForDef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-893"></span><span>  </span><span id="local-6989586621679052397"><span class="annot"><span class="annottext">consForDef :: [(Name, [Either Type Type])]
</span><a href="#local-6989586621679052397"><span class="hs-identifier hs-var hs-var">consForDef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ASetter
  [(Name, [([DefName], Type)])]
  [(Name, [Either Type Type])]
  ([DefName], Type)
  (Either Type Type)
-&gt; (([DefName], Type) -&gt; Either Type Type)
-&gt; [(Name, [([DefName], Type)])]
-&gt; [(Name, [Either Type Type])]
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">over</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ASetter
  [(Name, [([DefName], Type)])]
  [(Name, [Either Type Type])]
  (Name, [([DefName], Type)])
  (Name, [Either Type Type])
forall (f :: * -&gt; *) a b. Functor f =&gt; ASetter (f a) (f b) a b
</span><span class="hs-identifier hs-var">mapped</span></span><span> </span><span class="annot"><span class="annottext">ASetter
  [(Name, [([DefName], Type)])]
  [(Name, [Either Type Type])]
  (Name, [([DefName], Type)])
  (Name, [Either Type Type])
-&gt; ((([DefName], Type) -&gt; Identity (Either Type Type))
    -&gt; (Name, [([DefName], Type)])
    -&gt; Identity (Name, [Either Type Type]))
-&gt; ASetter
     [(Name, [([DefName], Type)])]
     [(Name, [Either Type Type])]
     ([DefName], Type)
     (Either Type Type)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">([([DefName], Type)] -&gt; Identity [Either Type Type])
-&gt; (Name, [([DefName], Type)])
-&gt; Identity (Name, [Either Type Type])
forall s t a b. Field2 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_2</span></span><span> </span><span class="annot"><span class="annottext">(([([DefName], Type)] -&gt; Identity [Either Type Type])
 -&gt; (Name, [([DefName], Type)])
 -&gt; Identity (Name, [Either Type Type]))
-&gt; ((([DefName], Type) -&gt; Identity (Either Type Type))
    -&gt; [([DefName], Type)] -&gt; Identity [Either Type Type])
-&gt; (([DefName], Type) -&gt; Identity (Either Type Type))
-&gt; (Name, [([DefName], Type)])
-&gt; Identity (Name, [Either Type Type])
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(([DefName], Type) -&gt; Identity (Either Type Type))
-&gt; [([DefName], Type)] -&gt; Identity [Either Type Type]
forall (f :: * -&gt; *) a b. Functor f =&gt; ASetter (f a) (f b) a b
</span><span class="hs-identifier hs-var">mapped</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([DefName], Type) -&gt; Either Type Type
</span><a href="#local-6989586621679052378"><span class="hs-identifier hs-var">categorize</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, [([DefName], Type)])]
</span><a href="#local-6989586621679052404"><span class="hs-identifier hs-var">cons</span></a></span><span>
</span><span id="line-894"></span><span>
</span><span id="line-895"></span><span>  </span><span class="annot"><a href="#local-6989586621679052380"><span class="hs-identifier hs-type">scaffolds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-896"></span><span>  </span><span id="local-6989586621679052380"><span class="annot"><span class="annottext">scaffolds :: [(Name, Int, [Int])]
</span><a href="#local-6989586621679052380"><span class="hs-identifier hs-var hs-var">scaffolds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052377"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Either Type Type] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Either Type Type]
</span><a href="#local-6989586621679052375"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Either Type Type] -&gt; [Int]
</span><a href="#local-6989586621679052374"><span class="hs-identifier hs-var">rightIndices</span></a></span><span> </span><span class="annot"><span class="annottext">[Either Type Type]
</span><a href="#local-6989586621679052375"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679052377"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052377"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679052375"><span class="annot"><span class="annottext">[Either Type Type]
</span><a href="#local-6989586621679052375"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Name, [Either Type Type])]
</span><a href="#local-6989586621679052397"><span class="hs-identifier hs-var">consForDef</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-897"></span><span>
</span><span id="line-898"></span><span>  </span><span class="annot"><a href="#local-6989586621679052374"><span class="hs-identifier hs-type">rightIndices</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span>
</span><span id="line-899"></span><span>  </span><span id="local-6989586621679052374"><span class="annot"><span class="annottext">rightIndices :: [Either Type Type] -&gt; [Int]
</span><a href="#local-6989586621679052374"><span class="hs-identifier hs-var hs-var">rightIndices</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Either Type Type -&gt; Bool) -&gt; [Either Type Type] -&gt; [Int]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [Int]
</span><span class="hs-identifier hs-var">findIndices</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Getting Any (Either Type Type) Type -&gt; Either Type Type -&gt; Bool
forall s a. Getting Any s a -&gt; s -&gt; Bool
</span><span class="hs-identifier hs-var">has</span></span><span> </span><span class="annot"><span class="annottext">Getting Any (Either Type Type) Type
forall a b b'. Traversal (Either a b) (Either a b') b b'
</span><span class="hs-identifier hs-var">_Right</span></span><span class="hs-special">)</span><span>
</span><span id="line-900"></span><span>
</span><span id="line-901"></span><span>  </span><span class="hs-comment">-- Right: types for this definition</span><span>
</span><span id="line-902"></span><span>  </span><span class="hs-comment">-- Left : other types</span><span>
</span><span id="line-903"></span><span>  </span><span class="annot"><a href="#local-6989586621679052378"><span class="hs-identifier hs-type">categorize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Lens.Micro.TH.html#DefName"><span class="hs-identifier hs-type">DefName</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-904"></span><span>  </span><span id="local-6989586621679052378"><span class="annot"><span class="annottext">categorize :: ([DefName], Type) -&gt; Either Type Type
</span><a href="#local-6989586621679052378"><span class="hs-identifier hs-var hs-var">categorize</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679052372"><span class="annot"><span class="annottext">[DefName]
</span><a href="#local-6989586621679052372"><span class="hs-identifier hs-var">defNames</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679052371"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052371"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-905"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DefName
</span><a href="#local-6989586621679052403"><span class="hs-identifier hs-var">defName</span></a></span><span> </span><span class="annot"><span class="annottext">DefName -&gt; [DefName] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">[DefName]
</span><a href="#local-6989586621679052372"><span class="hs-identifier hs-var">defNames</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Either Type Type
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052371"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-906"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Either Type Type
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span>  </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052371"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-907"></span><span>
</span><span id="line-908"></span><span>  </span><span class="annot"><a href="#local-6989586621679052390"><span class="hs-identifier hs-type">lensCase</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-909"></span><span>  </span><span id="local-6989586621679052390"><span class="annot"><span class="annottext">lensCase :: Bool
</span><a href="#local-6989586621679052390"><span class="hs-identifier hs-var hs-var">lensCase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Name, [Either Type Type]) -&gt; Bool)
-&gt; [(Name, [Either Type Type])] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679052368"><span class="annot"><span class="annottext">(Name, [Either Type Type])
</span><a href="#local-6989586621679052368"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Getting (Endo [Type]) (Name, [Either Type Type]) Type
-&gt; (Name, [Either Type Type]) -&gt; Int
forall a s. Getting (Endo [a]) s a -&gt; s -&gt; Int
</span><a href="Lens.Micro.TH.Internal.html#lengthOf"><span class="hs-identifier hs-var">lengthOf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([Either Type Type] -&gt; Const (Endo [Type]) [Either Type Type])
-&gt; (Name, [Either Type Type])
-&gt; Const (Endo [Type]) (Name, [Either Type Type])
forall s t a b. Field2 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_2</span></span><span> </span><span class="annot"><span class="annottext">(([Either Type Type] -&gt; Const (Endo [Type]) [Either Type Type])
 -&gt; (Name, [Either Type Type])
 -&gt; Const (Endo [Type]) (Name, [Either Type Type]))
-&gt; ((Type -&gt; Const (Endo [Type]) Type)
    -&gt; [Either Type Type] -&gt; Const (Endo [Type]) [Either Type Type])
-&gt; Getting (Endo [Type]) (Name, [Either Type Type]) Type
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Getting (Endo [Type]) [Either Type Type] (Either Type Type)
forall (f :: * -&gt; *) a. Foldable f =&gt; SimpleFold (f a) a
</span><span class="hs-identifier hs-var">folded</span></span><span> </span><span class="annot"><span class="annottext">Getting (Endo [Type]) [Either Type Type] (Either Type Type)
-&gt; ((Type -&gt; Const (Endo [Type]) Type)
    -&gt; Either Type Type -&gt; Const (Endo [Type]) (Either Type Type))
-&gt; (Type -&gt; Const (Endo [Type]) Type)
-&gt; [Either Type Type]
-&gt; Const (Endo [Type]) [Either Type Type]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Const (Endo [Type]) Type)
-&gt; Either Type Type -&gt; Const (Endo [Type]) (Either Type Type)
forall a b b'. Traversal (Either a b) (Either a b') b b'
</span><span class="hs-identifier hs-var">_Right</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Name, [Either Type Type])
</span><a href="#local-6989586621679052368"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Name, [Either Type Type])]
</span><a href="#local-6989586621679052397"><span class="hs-identifier hs-var">consForDef</span></a></span><span>
</span><span id="line-910"></span><span>
</span><span id="line-911"></span><span>  </span><span class="hs-comment">-- isoCase :: Bool</span><span>
</span><span id="line-912"></span><span>  </span><span class="hs-comment">-- isoCase = case scaffolds of</span><span>
</span><span id="line-913"></span><span>  </span><span class="hs-comment">--             [(_,1,[0])] -&gt; True</span><span>
</span><span id="line-914"></span><span>  </span><span class="hs-comment">--             _           -&gt; False</span><span>
</span><span id="line-915"></span><span>
</span><span id="line-916"></span><span class="hs-keyword">data</span><span> </span><span id="OpticStab"><span class="annot"><a href="Lens.Micro.TH.html#OpticStab"><span class="hs-identifier hs-var">OpticStab</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="OpticStab"><span class="annot"><a href="Lens.Micro.TH.html#OpticStab"><span class="hs-identifier hs-var">OpticStab</span></a></span></span><span>     </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-917"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span id="OpticSa"><span class="annot"><a href="Lens.Micro.TH.html#OpticSa"><span class="hs-identifier hs-var">OpticSa</span></a></span></span><span>   </span><span class="annot"><span class="hs-identifier hs-type">Cxt</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-918"></span><span>
</span><span id="line-919"></span><span>
</span><span id="line-920"></span><span class="annot"><a href="Lens.Micro.TH.html#stabToType"><span class="hs-identifier hs-type">stabToType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Lens.Micro.TH.html#OpticStab"><span class="hs-identifier hs-type">OpticStab</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-921"></span><span id="stabToType"><span class="annot"><span class="annottext">stabToType :: OpticStab -&gt; Type
</span><a href="Lens.Micro.TH.html#stabToType"><span class="hs-identifier hs-var hs-var">stabToType</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Lens.Micro.TH.html#OpticStab"><span class="hs-identifier hs-type">OpticStab</span></a></span><span>  </span><span id="local-6989586621679052364"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052364"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679052363"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052363"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679052362"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052362"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679052361"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052361"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679052360"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052360"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; Type -&gt; Type
</span><a href="Lens.Micro.TH.Internal.html#quantifyType"><span class="hs-identifier hs-var">quantifyType</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052364"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Type] -&gt; Type
</span><a href="Lens.Micro.TH.Internal.html#conAppsT"><span class="hs-operator hs-var">`conAppsT`</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052363"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052362"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052361"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052360"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-922"></span><span class="annot"><a href="Lens.Micro.TH.html#stabToType"><span class="hs-identifier hs-var">stabToType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Lens.Micro.TH.html#OpticSa"><span class="hs-identifier hs-type">OpticSa</span></a></span><span> </span><span id="local-6989586621679052358"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679052358"><span class="hs-identifier hs-var">cx</span></a></span></span><span> </span><span id="local-6989586621679052357"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052357"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679052356"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052356"><span class="hs-identifier hs-var">s</span></a></span></span><span>   </span><span id="local-6989586621679052355"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052355"><span class="hs-identifier hs-var">a</span></a></span></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; Type -&gt; Type
</span><a href="Lens.Micro.TH.Internal.html#quantifyType"><span class="hs-identifier hs-var">quantifyType</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679052358"><span class="hs-identifier hs-var">cx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052357"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Type] -&gt; Type
</span><a href="Lens.Micro.TH.Internal.html#conAppsT"><span class="hs-operator hs-var">`conAppsT`</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052356"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052355"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-923"></span><span>
</span><span id="line-924"></span><span class="annot"><a href="Lens.Micro.TH.html#stabToContext"><span class="hs-identifier hs-type">stabToContext</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Lens.Micro.TH.html#OpticStab"><span class="hs-identifier hs-type">OpticStab</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cxt</span></span><span>
</span><span id="line-925"></span><span id="stabToContext"><span class="annot"><span class="annottext">stabToContext :: OpticStab -&gt; [Type]
</span><a href="Lens.Micro.TH.html#stabToContext"><span class="hs-identifier hs-var hs-var">stabToContext</span></a></span></span><span> </span><span class="annot"><a href="Lens.Micro.TH.html#OpticStab"><span class="hs-identifier hs-type">OpticStab</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-926"></span><span class="annot"><a href="Lens.Micro.TH.html#stabToContext"><span class="hs-identifier hs-var">stabToContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Lens.Micro.TH.html#OpticSa"><span class="hs-identifier hs-type">OpticSa</span></a></span><span> </span><span id="local-6989586621679052354"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679052354"><span class="hs-identifier hs-var">cx</span></a></span></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679052354"><span class="hs-identifier hs-var">cx</span></a></span><span>
</span><span id="line-927"></span><span>
</span><span id="line-928"></span><span class="annot"><a href="Lens.Micro.TH.html#stabToOptic"><span class="hs-identifier hs-type">stabToOptic</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Lens.Micro.TH.html#OpticStab"><span class="hs-identifier hs-type">OpticStab</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-929"></span><span id="stabToOptic"><span class="annot"><span class="annottext">stabToOptic :: OpticStab -&gt; Name
</span><a href="Lens.Micro.TH.html#stabToOptic"><span class="hs-identifier hs-var hs-var">stabToOptic</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Lens.Micro.TH.html#OpticStab"><span class="hs-identifier hs-type">OpticStab</span></a></span><span> </span><span id="local-6989586621679052353"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052353"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052353"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-930"></span><span class="annot"><a href="Lens.Micro.TH.html#stabToOptic"><span class="hs-identifier hs-var">stabToOptic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Lens.Micro.TH.html#OpticSa"><span class="hs-identifier hs-type">OpticSa</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679052352"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052352"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052352"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-931"></span><span>
</span><span id="line-932"></span><span class="annot"><a href="Lens.Micro.TH.html#stabToS"><span class="hs-identifier hs-type">stabToS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Lens.Micro.TH.html#OpticStab"><span class="hs-identifier hs-type">OpticStab</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-933"></span><span id="stabToS"><span class="annot"><span class="annottext">stabToS :: OpticStab -&gt; Type
</span><a href="Lens.Micro.TH.html#stabToS"><span class="hs-identifier hs-var hs-var">stabToS</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Lens.Micro.TH.html#OpticStab"><span class="hs-identifier hs-type">OpticStab</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679052351"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052351"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052351"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-934"></span><span class="annot"><a href="Lens.Micro.TH.html#stabToS"><span class="hs-identifier hs-var">stabToS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Lens.Micro.TH.html#OpticSa"><span class="hs-identifier hs-type">OpticSa</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679052350"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052350"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052350"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-935"></span><span>
</span><span id="line-936"></span><span class="annot"><a href="Lens.Micro.TH.html#stabToA"><span class="hs-identifier hs-type">stabToA</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Lens.Micro.TH.html#OpticStab"><span class="hs-identifier hs-type">OpticStab</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-937"></span><span id="stabToA"><span class="annot"><span class="annottext">stabToA :: OpticStab -&gt; Type
</span><a href="Lens.Micro.TH.html#stabToA"><span class="hs-identifier hs-var hs-var">stabToA</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Lens.Micro.TH.html#OpticStab"><span class="hs-identifier hs-type">OpticStab</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679052349"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052349"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052349"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-938"></span><span class="annot"><a href="Lens.Micro.TH.html#stabToA"><span class="hs-identifier hs-var">stabToA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Lens.Micro.TH.html#OpticSa"><span class="hs-identifier hs-type">OpticSa</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679052348"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052348"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052348"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-939"></span><span>
</span><span id="line-940"></span><span class="hs-comment">-- Compute the s t a b types given the outer type 's' and the</span><span>
</span><span id="line-941"></span><span class="hs-comment">-- categorized field types. Left for fixed and Right for visited.</span><span>
</span><span id="line-942"></span><span class="hs-comment">-- These types are &quot;raw&quot; and will be packaged into an 'OpticStab'</span><span>
</span><span id="line-943"></span><span class="hs-comment">-- shortly after creation.</span><span>
</span><span id="line-944"></span><span class="annot"><a href="Lens.Micro.TH.html#buildStab"><span class="hs-identifier hs-type">buildStab</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span>
</span><span id="line-945"></span><span id="buildStab"><span class="annot"><span class="annottext">buildStab :: Type -&gt; [Either Type Type] -&gt; Q (Type, Type, Type, Type)
</span><a href="Lens.Micro.TH.html#buildStab"><span class="hs-identifier hs-var hs-var">buildStab</span></a></span></span><span> </span><span id="local-6989586621679052347"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052347"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679052346"><span class="annot"><span class="annottext">[Either Type Type]
</span><a href="#local-6989586621679052346"><span class="hs-identifier hs-var">categorizedFields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-946"></span><span>  </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679052345"><span class="annot"><span class="annottext">Map Name Type
</span><a href="#local-6989586621679052345"><span class="hs-identifier hs-var">subA</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679052344"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052344"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; Q (Map Name Type, Type)
</span><a href="Lens.Micro.TH.html#unifyTypes"><span class="hs-identifier hs-var">unifyTypes</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679052343"><span class="hs-identifier hs-var">targetFields</span></a></span><span>
</span><span id="line-947"></span><span>     </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679052342"><span class="annot"><span class="annottext">s' :: Type
</span><a href="#local-6989586621679052342"><span class="hs-identifier hs-var hs-var">s'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Name Type -&gt; Type -&gt; Type
</span><a href="Lens.Micro.TH.html#applyTypeSubst"><span class="hs-identifier hs-var">applyTypeSubst</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name Type
</span><a href="#local-6989586621679052345"><span class="hs-identifier hs-var">subA</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052347"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-948"></span><span>
</span><span id="line-949"></span><span>     </span><span class="hs-comment">-- compute possible type changes</span><span>
</span><span id="line-950"></span><span>     </span><span id="local-6989586621679052341"><span class="annot"><span class="annottext">Map Name Name
</span><a href="#local-6989586621679052341"><span class="hs-identifier hs-var">sub</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map Name (Q Name) -&gt; Q (Map Name Name)
forall (t :: * -&gt; *) (f :: * -&gt; *) a.
(Traversable t, Applicative f) =&gt;
t (f a) -&gt; f (t a)
</span><span class="hs-identifier hs-var">sequenceA</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Name -&gt; Q Name) -&gt; Set Name -&gt; Map Name (Q Name)
forall k a. (k -&gt; a) -&gt; Set k -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromSet</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Q Name
</span><span class="hs-identifier hs-var">newName</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Q Name) -&gt; (Name -&gt; String) -&gt; Name -&gt; Q Name
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; String
</span><span class="hs-identifier hs-var">nameBase</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621679052340"><span class="hs-identifier hs-var">unfixedTypeVars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-951"></span><span>     </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679052339"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052339"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679052338"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052338"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ASetter (Type, Type) (Type, Type) Type Type
-&gt; (Type -&gt; Type) -&gt; (Type, Type) -&gt; (Type, Type)
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">over</span></span><span> </span><span class="annot"><span class="annottext">ASetter (Type, Type) (Type, Type) Type Type
forall a b. Traversal (a, a) (b, b) a b
</span><span class="hs-identifier hs-var">both</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Name Name -&gt; Type -&gt; Type
forall t. HasTypeVars t =&gt; Map Name Name -&gt; t -&gt; t
</span><a href="Lens.Micro.TH.Internal.html#substTypeVars"><span class="hs-identifier hs-var">substTypeVars</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name Name
</span><a href="#local-6989586621679052341"><span class="hs-identifier hs-var">sub</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052342"><span class="hs-identifier hs-var">s'</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052344"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-952"></span><span>
</span><span id="line-953"></span><span>     </span><span class="annot"><span class="annottext">(Type, Type, Type, Type) -&gt; Q (Type, Type, Type, Type)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052342"><span class="hs-identifier hs-var">s'</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052339"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052344"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052338"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-954"></span><span>
</span><span id="line-955"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-956"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679052335"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679052335"><span class="hs-identifier hs-var">fixedFields</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679052343"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679052343"><span class="hs-identifier hs-var">targetFields</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Either Type Type] -&gt; ([Type], [Type])
forall a b. [Either a b] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">partitionEithers</span></span><span> </span><span class="annot"><span class="annottext">[Either Type Type]
</span><a href="#local-6989586621679052346"><span class="hs-identifier hs-var">categorizedFields</span></a></span><span>
</span><span id="line-957"></span><span>
</span><span id="line-958"></span><span>  </span><span class="annot"><a href="#local-6989586621679052333"><span class="hs-identifier hs-type">fixedTypeVars</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679052340"><span class="hs-identifier hs-type">unfixedTypeVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-959"></span><span>  </span><span id="local-6989586621679052333"><span class="annot"><span class="annottext">fixedTypeVars :: Set Name
</span><a href="#local-6989586621679052333"><span class="hs-identifier hs-var hs-var">fixedTypeVars</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Name -&gt; Set Name
</span><a href="#local-6989586621679052332"><span class="hs-identifier hs-var">closeOverKinds</span></a></span><span> </span><span class="annot"><span class="annottext">(Set Name -&gt; Set Name) -&gt; Set Name -&gt; Set Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Getting (Endo [Name]) [Type] Name -&gt; [Type] -&gt; Set Name
forall a s. Ord a =&gt; Getting (Endo [a]) s a -&gt; s -&gt; Set a
</span><a href="Lens.Micro.TH.Internal.html#setOf"><span class="hs-identifier hs-var">setOf</span></a></span><span> </span><span class="annot"><span class="annottext">Getting (Endo [Name]) [Type] Name
forall t. HasTypeVars t =&gt; Traversal' t Name
</span><a href="Lens.Micro.TH.Internal.html#typeVars"><span class="hs-identifier hs-var">typeVars</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679052335"><span class="hs-identifier hs-var">fixedFields</span></a></span><span>
</span><span id="line-960"></span><span>  </span><span id="local-6989586621679052340"><span class="annot"><span class="annottext">unfixedTypeVars :: Set Name
</span><a href="#local-6989586621679052340"><span class="hs-identifier hs-var hs-var">unfixedTypeVars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Getting (Endo [Name]) Type Name -&gt; Type -&gt; Set Name
forall a s. Ord a =&gt; Getting (Endo [a]) s a -&gt; s -&gt; Set a
</span><a href="Lens.Micro.TH.Internal.html#setOf"><span class="hs-identifier hs-var">setOf</span></a></span><span> </span><span class="annot"><span class="annottext">Getting (Endo [Name]) Type Name
forall t. HasTypeVars t =&gt; Traversal' t Name
</span><a href="Lens.Micro.TH.Internal.html#typeVars"><span class="hs-identifier hs-var">typeVars</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052347"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Set Name -&gt; Set Name -&gt; Set Name
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-operator hs-var">Set.\\</span></span><span> </span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621679052333"><span class="hs-identifier hs-var">fixedTypeVars</span></a></span><span>
</span><span id="line-961"></span><span>
</span><span id="line-962"></span><span>  </span><span class="hs-comment">-- Compute the kind variables that appear in the kind of a type variable</span><span>
</span><span id="line-963"></span><span>  </span><span class="hs-comment">-- binder. For example, @kindVarsOfTvb (x :: (a, b)) = (x, {a, b})@. If a</span><span>
</span><span id="line-964"></span><span>  </span><span class="hs-comment">-- type variable binder lacks an explicit kind annotation, this</span><span>
</span><span id="line-965"></span><span>  </span><span class="hs-comment">-- conservatively assumes that there are no kind variables. For example,</span><span>
</span><span id="line-966"></span><span>  </span><span class="hs-comment">-- @kindVarsOfTvb (y) = (y, {})@.</span><span>
</span><span id="line-967"></span><span>  </span><span id="local-6989586621679052719"><span class="annot"><a href="#local-6989586621679052330"><span class="hs-identifier hs-type">kindVarsOfTvb</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">D.TyVarBndr_</span></span><span> </span><span class="annot"><a href="#local-6989586621679052719"><span class="hs-identifier hs-type">flag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-968"></span><span>  </span><span id="local-6989586621679052330"><span class="annot"><span class="annottext">kindVarsOfTvb :: TyVarBndr_ Any -&gt; (Name, Set Name)
</span><a href="#local-6989586621679052330"><span class="hs-identifier hs-var hs-var">kindVarsOfTvb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; (Name, Set Name))
-&gt; (Name -&gt; Type -&gt; (Name, Set Name))
-&gt; TyVarBndr_ Any
-&gt; (Name, Set Name)
forall r flag.
(Name -&gt; r) -&gt; (Name -&gt; Type -&gt; r) -&gt; TyVarBndr_ Any -&gt; r
</span><span class="hs-identifier hs-var">D.elimTV</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679052328"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052328"><span class="hs-identifier hs-var">n</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052328"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set Name
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-969"></span><span>                           </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679052327"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052327"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679052326"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052326"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052327"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Getting (Endo [Name]) Type Name -&gt; Type -&gt; Set Name
forall a s. Ord a =&gt; Getting (Endo [a]) s a -&gt; s -&gt; Set a
</span><a href="Lens.Micro.TH.Internal.html#setOf"><span class="hs-identifier hs-var">setOf</span></a></span><span> </span><span class="annot"><span class="annottext">Getting (Endo [Name]) Type Name
forall t. HasTypeVars t =&gt; Traversal' t Name
</span><a href="Lens.Micro.TH.Internal.html#typeVars"><span class="hs-identifier hs-var">typeVars</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052326"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-970"></span><span>
</span><span id="line-971"></span><span>  </span><span class="hs-comment">-- For each type variable name that appears in @s@, map to the kind variables</span><span>
</span><span id="line-972"></span><span>  </span><span class="hs-comment">-- that appear in that type variable's kind.</span><span>
</span><span id="line-973"></span><span>  </span><span class="annot"><a href="#local-6989586621679052325"><span class="hs-identifier hs-type">sKindVarMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span>
</span><span id="line-974"></span><span>  </span><span id="local-6989586621679052325"><span class="annot"><span class="annottext">sKindVarMap :: Map Name (Set Name)
</span><a href="#local-6989586621679052325"><span class="hs-identifier hs-var hs-var">sKindVarMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Name, Set Name)] -&gt; Map Name (Set Name)
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="annot"><span class="annottext">([(Name, Set Name)] -&gt; Map Name (Set Name))
-&gt; [(Name, Set Name)] -&gt; Map Name (Set Name)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(TyVarBndr_ Any -&gt; (Name, Set Name))
-&gt; [TyVarBndr_ Any] -&gt; [(Name, Set Name)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">TyVarBndr_ Any -&gt; (Name, Set Name)
forall flag. TyVarBndr_ Any -&gt; (Name, Set Name)
</span><a href="#local-6989586621679052330"><span class="hs-identifier hs-var">kindVarsOfTvb</span></a></span><span> </span><span class="annot"><span class="annottext">([TyVarBndr_ Any] -&gt; [(Name, Set Name)])
-&gt; [TyVarBndr_ Any] -&gt; [(Name, Set Name)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [TyVarBndr_ Any]
</span><span class="hs-identifier hs-var">D.freeVariablesWellScoped</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052347"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-975"></span><span>
</span><span id="line-976"></span><span>  </span><span class="annot"><a href="#local-6989586621679052323"><span class="hs-identifier hs-type">lookupSKindVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-977"></span><span>  </span><span id="local-6989586621679052323"><span class="annot"><span class="annottext">lookupSKindVars :: Name -&gt; Set Name
</span><a href="#local-6989586621679052323"><span class="hs-identifier hs-var hs-var">lookupSKindVars</span></a></span></span><span> </span><span id="local-6989586621679052322"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052322"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Name -&gt; Maybe (Set Name) -&gt; Set Name
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Set Name
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (Set Name) -&gt; Set Name) -&gt; Maybe (Set Name) -&gt; Set Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Map Name (Set Name) -&gt; Maybe (Set Name)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052322"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name (Set Name)
</span><a href="#local-6989586621679052325"><span class="hs-identifier hs-var">sKindVarMap</span></a></span><span>
</span><span id="line-978"></span><span>
</span><span id="line-979"></span><span>  </span><span class="hs-comment">-- Consider this example (adapted from #972):</span><span>
</span><span id="line-980"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-981"></span><span>  </span><span class="hs-comment">--   data Dart (s :: k) = Dart { _arc :: Proxy s, _direction :: Int }</span><span>
</span><span id="line-982"></span><span>  </span><span class="hs-comment">--   $(makeLenses ''Dart)</span><span>
</span><span id="line-983"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-984"></span><span>  </span><span class="hs-comment">-- When generating a Lens for `direction`, the type variable `s` should be</span><span>
</span><span id="line-985"></span><span>  </span><span class="hs-comment">-- fixed. But note that (s :: k), and as a result, the kind variable `k`</span><span>
</span><span id="line-986"></span><span>  </span><span class="hs-comment">-- needs to be fixed as well. This is because a type like this would be</span><span>
</span><span id="line-987"></span><span>  </span><span class="hs-comment">-- ill kinded:</span><span>
</span><span id="line-988"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-989"></span><span>  </span><span class="hs-comment">--   direction :: Lens (Dart (s :: k1)) (Dart (s :: k2)) Direction Direction</span><span>
</span><span id="line-990"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-991"></span><span>  </span><span class="hs-comment">-- However, only `s` is mentioned syntactically in the type of `_arc`, so we</span><span>
</span><span id="line-992"></span><span>  </span><span class="hs-comment">-- have to infer that `k` is mentioned in the kind of `s`. We accomplish this</span><span>
</span><span id="line-993"></span><span>  </span><span class="hs-comment">-- with `closeOverKinds`, which does the following:</span><span>
</span><span id="line-994"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-995"></span><span>  </span><span class="hs-comment">-- 1. Use freeVariablesWellScoped to compute the free type variables of</span><span>
</span><span id="line-996"></span><span>  </span><span class="hs-comment">--    `Dart (s :: k)`, which gives us `(s :: k)`.</span><span>
</span><span id="line-997"></span><span>  </span><span class="hs-comment">-- 2. For each type variable name in `Proxy s`, the type of `_arc`, look up</span><span>
</span><span id="line-998"></span><span>  </span><span class="hs-comment">--    the kind variables in the type variable's kind. In the case of `s`,</span><span>
</span><span id="line-999"></span><span>  </span><span class="hs-comment">--    the only kind variable is `k`.</span><span>
</span><span id="line-1000"></span><span>  </span><span class="hs-comment">-- 3. Add these kind variables to the set of fixed type variables.</span><span>
</span><span id="line-1001"></span><span>  </span><span class="annot"><a href="#local-6989586621679052332"><span class="hs-identifier hs-type">closeOverKinds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-1002"></span><span>  </span><span id="local-6989586621679052332"><span class="annot"><span class="annottext">closeOverKinds :: Set Name -&gt; Set Name
</span><a href="#local-6989586621679052332"><span class="hs-identifier hs-var hs-var">closeOverKinds</span></a></span></span><span> </span><span id="local-6989586621679052320"><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621679052320"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Set Name -&gt; Set Name -&gt; Set Name)
-&gt; Set Name -&gt; Set (Set Name) -&gt; Set Name
forall a b. (a -&gt; b -&gt; a) -&gt; a -&gt; Set b -&gt; a
</span><span class="hs-identifier hs-var">Set.foldl'</span></span><span> </span><span class="annot"><span class="annottext">Set Name -&gt; Set Name -&gt; Set Name
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.union</span></span><span> </span><span class="annot"><span class="annottext">Set Name
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Name -&gt; Set Name) -&gt; Set Name -&gt; Set (Set Name)
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.map</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Set Name
</span><a href="#local-6989586621679052323"><span class="hs-identifier hs-var">lookupSKindVars</span></a></span><span> </span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621679052320"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set Name -&gt; Set Name -&gt; Set Name
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-operator hs-var">`Set.union`</span></span><span> </span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621679052320"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-1003"></span><span>
</span><span id="line-1004"></span><span class="hs-comment">-- Build the signature and definition for a single field optic.</span><span>
</span><span id="line-1005"></span><span class="hs-comment">-- In the case of a singleton constructor irrefutable matches are</span><span>
</span><span id="line-1006"></span><span class="hs-comment">-- used to enable the resulting lenses to be used on a bottom value.</span><span>
</span><span id="line-1007"></span><span class="annot"><a href="Lens.Micro.TH.html#makeFieldOptic"><span class="hs-identifier hs-type">makeFieldOptic</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1008"></span><span>  </span><span class="annot"><a href="Lens.Micro.TH.html#LensRules"><span class="hs-identifier hs-type">LensRules</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1009"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Lens.Micro.TH.html#DefName"><span class="hs-identifier hs-type">DefName</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Lens.Micro.TH.html#OpticType"><span class="hs-identifier hs-type">OpticType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Lens.Micro.TH.html#OpticStab"><span class="hs-identifier hs-type">OpticStab</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1010"></span><span>  </span><span class="annot"><a href="Lens.Micro.TH.html#HasFieldClasses"><span class="hs-identifier hs-type">HasFieldClasses</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span><span>
</span><span id="line-1011"></span><span id="makeFieldOptic"><span class="annot"><span class="annottext">makeFieldOptic :: LensRules
-&gt; (DefName, (OpticType, OpticStab, [(Name, Int, [Int])]))
-&gt; StateT (Set Name) Q [Dec]
</span><a href="Lens.Micro.TH.html#makeFieldOptic"><span class="hs-identifier hs-var hs-var">makeFieldOptic</span></a></span></span><span> </span><span id="local-6989586621679052316"><span class="annot"><span class="annottext">LensRules
</span><a href="#local-6989586621679052316"><span class="hs-identifier hs-var">rules</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679052315"><span class="annot"><span class="annottext">DefName
</span><a href="#local-6989586621679052315"><span class="hs-identifier hs-var">defName</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679052314"><span class="annot"><span class="annottext">OpticType
</span><a href="#local-6989586621679052314"><span class="hs-identifier hs-var">opticType</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679052313"><span class="annot"><span class="annottext">OpticStab
</span><a href="#local-6989586621679052313"><span class="hs-identifier hs-var">defType</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679052312"><span class="annot"><span class="annottext">[(Name, Int, [Int])]
</span><a href="#local-6989586621679052312"><span class="hs-identifier hs-var">cons</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1012"></span><span>  </span><span id="local-6989586621679052311"><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621679052311"><span class="hs-identifier hs-var">locals</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT (Set Name) Q (Set Name)
forall (m :: * -&gt; *) s. Monad m =&gt; StateT s m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-1013"></span><span>  </span><span class="annot"><span class="annottext">HasFieldClasses ()
</span><a href="#local-6989586621679052309"><span class="hs-identifier hs-var">addName</span></a></span><span>
</span><span id="line-1014"></span><span>  </span><span class="annot"><span class="annottext">DecsQ -&gt; StateT (Set Name) Q [Dec]
forall (m :: * -&gt; *) a s. Monad m =&gt; m a -&gt; StateT s m a
</span><a href="Lens.Micro.TH.html#liftState"><span class="hs-identifier hs-var">liftState</span></a></span><span> </span><span class="annot"><span class="annottext">(DecsQ -&gt; StateT (Set Name) Q [Dec])
-&gt; DecsQ -&gt; StateT (Set Name) Q [Dec]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1015"></span><span>    </span><span id="local-6989586621679052308"><span class="annot"><span class="annottext">[Q Dec]
</span><a href="#local-6989586621679052308"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Set Name -&gt; Q [Q Dec]
</span><a href="#local-6989586621679052307"><span class="hs-identifier hs-var">mkCls</span></a></span><span> </span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621679052311"><span class="hs-identifier hs-var">locals</span></a></span><span>
</span><span id="line-1016"></span><span>    </span><span class="annot"><span class="annottext">[Q Dec] -&gt; DecsQ
forall (t :: * -&gt; *) (f :: * -&gt; *) a.
(Traversable t, Applicative f) =&gt;
t (f a) -&gt; f (t a)
</span><span class="hs-identifier hs-var">sequenceA</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Q Dec]
</span><a href="#local-6989586621679052308"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">[Q Dec] -&gt; [Q Dec] -&gt; [Q Dec]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Q Dec]
</span><a href="#local-6989586621679052306"><span class="hs-identifier hs-var">sig</span></a></span><span> </span><span class="annot"><span class="annottext">[Q Dec] -&gt; [Q Dec] -&gt; [Q Dec]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Q Dec]
</span><a href="#local-6989586621679052305"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1017"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1018"></span><span>  </span><span id="local-6989586621679052307"><span class="annot"><span class="annottext">mkCls :: Set Name -&gt; Q [Q Dec]
</span><a href="#local-6989586621679052307"><span class="hs-identifier hs-var hs-var">mkCls</span></a></span></span><span> </span><span id="local-6989586621679052304"><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621679052304"><span class="hs-identifier hs-var">locals</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DefName
</span><a href="#local-6989586621679052315"><span class="hs-identifier hs-var">defName</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1019"></span><span>                 </span><span class="annot"><a href="Lens.Micro.TH.html#MethodName"><span class="hs-identifier hs-type">MethodName</span></a></span><span> </span><span id="local-6989586621679052303"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052303"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679052302"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052302"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">LensRules -&gt; Bool
</span><a href="Lens.Micro.TH.html#_generateClasses"><span class="hs-identifier hs-var hs-var">_generateClasses</span></a></span><span> </span><span class="annot"><span class="annottext">LensRules
</span><a href="#local-6989586621679052316"><span class="hs-identifier hs-var">rules</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1020"></span><span>                  </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679052301"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679052301"><span class="hs-identifier hs-var">classExists</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Name -&gt; Bool) -&gt; Q (Maybe Name) -&gt; Q Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Q (Maybe Name)
</span><span class="hs-identifier hs-var">lookupTypeName</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052303"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1021"></span><span>                     </span><span class="annot"><span class="annottext">[Q Dec] -&gt; Q [Q Dec]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679052301"><span class="hs-identifier hs-var">classExists</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Set Name -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.member</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052303"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621679052304"><span class="hs-identifier hs-var">locals</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">OpticStab -&gt; Name -&gt; Name -&gt; Q Dec
</span><a href="Lens.Micro.TH.html#makeFieldClass"><span class="hs-identifier hs-var">makeFieldClass</span></a></span><span> </span><span class="annot"><span class="annottext">OpticStab
</span><a href="#local-6989586621679052313"><span class="hs-identifier hs-var">defType</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052303"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052302"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1022"></span><span>                 </span><span class="annot"><span class="annottext">DefName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Q Dec] -&gt; Q [Q Dec]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1023"></span><span>
</span><span id="line-1024"></span><span>  </span><span id="local-6989586621679052309"><span class="annot"><span class="annottext">addName :: HasFieldClasses ()
</span><a href="#local-6989586621679052309"><span class="hs-identifier hs-var hs-var">addName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DefName
</span><a href="#local-6989586621679052315"><span class="hs-identifier hs-var">defName</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1025"></span><span>            </span><span class="annot"><a href="Lens.Micro.TH.html#MethodName"><span class="hs-identifier hs-type">MethodName</span></a></span><span> </span><span id="local-6989586621679052295"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052295"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; HasFieldClasses ()
</span><a href="Lens.Micro.TH.html#addFieldClassName"><span class="hs-identifier hs-var">addFieldClassName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052295"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-1026"></span><span>            </span><span class="annot"><span class="annottext">DefName
</span><span class="hs-identifier">_</span></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; HasFieldClasses ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1027"></span><span>
</span><span id="line-1028"></span><span>  </span><span id="local-6989586621679052306"><span class="annot"><span class="annottext">sig :: [Q Dec]
</span><a href="#local-6989586621679052306"><span class="hs-identifier hs-var hs-var">sig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DefName
</span><a href="#local-6989586621679052315"><span class="hs-identifier hs-var">defName</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1029"></span><span>          </span><span class="annot"><span class="annottext">DefName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LensRules -&gt; Bool
</span><a href="Lens.Micro.TH.html#_generateSigs"><span class="hs-identifier hs-var hs-var">_generateSigs</span></a></span><span> </span><span class="annot"><span class="annottext">LensRules
</span><a href="#local-6989586621679052316"><span class="hs-identifier hs-var">rules</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1030"></span><span>          </span><span class="annot"><a href="Lens.Micro.TH.html#TopName"><span class="hs-identifier hs-type">TopName</span></a></span><span> </span><span id="local-6989586621679052294"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052294"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; PredQ -&gt; Q Dec
</span><span class="hs-identifier hs-var">sigD</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052294"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; PredQ
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OpticStab -&gt; Type
</span><a href="Lens.Micro.TH.html#stabToType"><span class="hs-identifier hs-var">stabToType</span></a></span><span> </span><span class="annot"><span class="annottext">OpticStab
</span><a href="#local-6989586621679052313"><span class="hs-identifier hs-var">defType</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1031"></span><span>          </span><span class="annot"><a href="Lens.Micro.TH.html#MethodName"><span class="hs-identifier hs-type">MethodName</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1032"></span><span>
</span><span id="line-1033"></span><span>  </span><span id="local-6989586621679052293"><span class="annot"><span class="annottext">fun :: Name -&gt; [Q Dec]
</span><a href="#local-6989586621679052293"><span class="hs-identifier hs-var hs-var">fun</span></a></span></span><span> </span><span id="local-6989586621679052292"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052292"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [ClauseQ] -&gt; Q Dec
</span><span class="hs-identifier hs-var">funD</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052292"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">[ClauseQ]
</span><a href="#local-6989586621679052291"><span class="hs-identifier hs-var">clauses</span></a></span><span> </span><span class="annot"><span class="annottext">Q Dec -&gt; [Q Dec] -&gt; [Q Dec]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Q Dec]
</span><a href="Lens.Micro.TH.Internal.html#inlinePragma"><span class="hs-identifier hs-var">inlinePragma</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052292"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1034"></span><span>
</span><span id="line-1035"></span><span>  </span><span id="local-6989586621679052305"><span class="annot"><span class="annottext">def :: [Q Dec]
</span><a href="#local-6989586621679052305"><span class="hs-identifier hs-var hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DefName
</span><a href="#local-6989586621679052315"><span class="hs-identifier hs-var">defName</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1036"></span><span>          </span><span class="annot"><a href="Lens.Micro.TH.html#TopName"><span class="hs-identifier hs-type">TopName</span></a></span><span> </span><span id="local-6989586621679052290"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052290"><span class="hs-identifier hs-var">n</span></a></span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Q Dec]
</span><a href="#local-6989586621679052293"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052290"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1037"></span><span>          </span><span class="annot"><a href="Lens.Micro.TH.html#MethodName"><span class="hs-identifier hs-type">MethodName</span></a></span><span> </span><span id="local-6989586621679052289"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052289"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679052288"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052288"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">OpticStab -&gt; Name -&gt; [Q Dec] -&gt; Q Dec
</span><a href="Lens.Micro.TH.html#makeFieldInstance"><span class="hs-identifier hs-var">makeFieldInstance</span></a></span><span> </span><span class="annot"><span class="annottext">OpticStab
</span><a href="#local-6989586621679052313"><span class="hs-identifier hs-var">defType</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052289"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; [Q Dec]
</span><a href="#local-6989586621679052293"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052288"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1038"></span><span>
</span><span id="line-1039"></span><span>  </span><span id="local-6989586621679052291"><span class="annot"><span class="annottext">clauses :: [ClauseQ]
</span><a href="#local-6989586621679052291"><span class="hs-identifier hs-var hs-var">clauses</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LensRules -&gt; OpticType -&gt; [(Name, Int, [Int])] -&gt; [ClauseQ]
</span><a href="Lens.Micro.TH.html#makeFieldClauses"><span class="hs-identifier hs-var">makeFieldClauses</span></a></span><span> </span><span class="annot"><span class="annottext">LensRules
</span><a href="#local-6989586621679052316"><span class="hs-identifier hs-var">rules</span></a></span><span> </span><span class="annot"><span class="annottext">OpticType
</span><a href="#local-6989586621679052314"><span class="hs-identifier hs-var">opticType</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, Int, [Int])]
</span><a href="#local-6989586621679052312"><span class="hs-identifier hs-var">cons</span></a></span><span>
</span><span id="line-1040"></span><span>
</span><span id="line-1041"></span><span class="hs-comment">------------------------------------------------------------------------</span><span>
</span><span id="line-1042"></span><span class="hs-comment">-- Field class generation</span><span>
</span><span id="line-1043"></span><span class="hs-comment">------------------------------------------------------------------------</span><span>
</span><span id="line-1044"></span><span>
</span><span id="line-1045"></span><span class="annot"><a href="Lens.Micro.TH.html#makeFieldClass"><span class="hs-identifier hs-type">makeFieldClass</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Lens.Micro.TH.html#OpticStab"><span class="hs-identifier hs-type">OpticStab</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DecQ</span></span><span>
</span><span id="line-1046"></span><span id="makeFieldClass"><span class="annot"><span class="annottext">makeFieldClass :: OpticStab -&gt; Name -&gt; Name -&gt; Q Dec
</span><a href="Lens.Micro.TH.html#makeFieldClass"><span class="hs-identifier hs-var hs-var">makeFieldClass</span></a></span></span><span> </span><span id="local-6989586621679052285"><span class="annot"><span class="annottext">OpticStab
</span><a href="#local-6989586621679052285"><span class="hs-identifier hs-var">defType</span></a></span></span><span> </span><span id="local-6989586621679052284"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052284"><span class="hs-identifier hs-var">className</span></a></span></span><span> </span><span id="local-6989586621679052283"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052283"><span class="hs-identifier hs-var">methodName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1047"></span><span>  </span><span class="annot"><span class="annottext">CxtQ -&gt; Name -&gt; [TyVarBndr_ Any] -&gt; [FunDep] -&gt; [Q Dec] -&gt; Q Dec
</span><span class="hs-identifier hs-var">classD</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[PredQ] -&gt; CxtQ
</span><span class="hs-identifier hs-var">cxt</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052284"><span class="hs-identifier hs-var">className</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; TyVarBndr_ Any
</span><span class="hs-identifier hs-var">D.plainTV</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052282"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TyVarBndr_ Any
</span><span class="hs-identifier hs-var">D.plainTV</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052281"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Name] -&gt; [Name] -&gt; FunDep
</span><span class="hs-identifier hs-var">FunDep</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052282"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052281"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-1048"></span><span>         </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; PredQ -&gt; Q Dec
</span><span class="hs-identifier hs-var">sigD</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052283"><span class="hs-identifier hs-var">methodName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; PredQ
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052280"><span class="hs-identifier hs-var">methodType</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1049"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1050"></span><span>  </span><span id="local-6989586621679052280"><span class="annot"><span class="annottext">methodType :: Type
</span><a href="#local-6989586621679052280"><span class="hs-identifier hs-var hs-var">methodType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Name -&gt; [Type] -&gt; Type -&gt; Type
</span><a href="Lens.Micro.TH.Internal.html#quantifyType%27"><span class="hs-identifier hs-var">quantifyType'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Name] -&gt; Set Name
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052282"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052281"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1051"></span><span>                             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OpticStab -&gt; [Type]
</span><a href="Lens.Micro.TH.html#stabToContext"><span class="hs-identifier hs-var">stabToContext</span></a></span><span> </span><span class="annot"><span class="annottext">OpticStab
</span><a href="#local-6989586621679052285"><span class="hs-identifier hs-var">defType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1052"></span><span>             </span><span class="annot"><span class="annottext">(Type -&gt; Type) -&gt; Type -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">OpticStab -&gt; Name
</span><a href="Lens.Micro.TH.html#stabToOptic"><span class="hs-identifier hs-var">stabToOptic</span></a></span><span> </span><span class="annot"><span class="annottext">OpticStab
</span><a href="#local-6989586621679052285"><span class="hs-identifier hs-var">defType</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Type] -&gt; Type
</span><a href="Lens.Micro.TH.Internal.html#conAppsT"><span class="hs-operator hs-var">`conAppsT`</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">VarT</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052282"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">VarT</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052281"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1053"></span><span>  </span><span id="local-6989586621679052282"><span class="annot"><span class="annottext">s :: Name
</span><a href="#local-6989586621679052282"><span class="hs-identifier hs-var hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">mkName</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;s&quot;</span></span><span>
</span><span id="line-1054"></span><span>  </span><span id="local-6989586621679052281"><span class="annot"><span class="annottext">a :: Name
</span><a href="#local-6989586621679052281"><span class="hs-identifier hs-var hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">mkName</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;a&quot;</span></span><span>
</span><span id="line-1055"></span><span>
</span><span id="line-1056"></span><span class="hs-comment">-- | Build an instance for a field. If the field&#8217;s type contains any type</span><span>
</span><span id="line-1057"></span><span class="hs-comment">-- families, will produce an equality constraint to avoid a type family</span><span>
</span><span id="line-1058"></span><span class="hs-comment">-- application in the instance head.</span><span>
</span><span id="line-1059"></span><span class="annot"><a href="Lens.Micro.TH.html#makeFieldInstance"><span class="hs-identifier hs-type">makeFieldInstance</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Lens.Micro.TH.html#OpticStab"><span class="hs-identifier hs-type">OpticStab</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">DecQ</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DecQ</span></span><span>
</span><span id="line-1060"></span><span id="makeFieldInstance"><span class="annot"><span class="annottext">makeFieldInstance :: OpticStab -&gt; Name -&gt; [Q Dec] -&gt; Q Dec
</span><a href="Lens.Micro.TH.html#makeFieldInstance"><span class="hs-identifier hs-var hs-var">makeFieldInstance</span></a></span></span><span> </span><span id="local-6989586621679052279"><span class="annot"><span class="annottext">OpticStab
</span><a href="#local-6989586621679052279"><span class="hs-identifier hs-var">defType</span></a></span></span><span> </span><span id="local-6989586621679052278"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052278"><span class="hs-identifier hs-var">className</span></a></span></span><span> </span><span id="local-6989586621679052277"><span class="annot"><span class="annottext">[Q Dec]
</span><a href="#local-6989586621679052277"><span class="hs-identifier hs-var">decs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1061"></span><span>  </span><span class="annot"><span class="annottext">Type -&gt; Q Bool
</span><a href="#local-6989586621679052276"><span class="hs-identifier hs-var">containsTypeFamilies</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052275"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Q Bool -&gt; (Bool -&gt; Q Dec) -&gt; Q Dec
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Q Dec
</span><a href="#local-6989586621679052274"><span class="hs-identifier hs-var">pickInstanceDec</span></a></span><span>
</span><span id="line-1062"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1063"></span><span>  </span><span id="local-6989586621679052273"><span class="annot"><span class="annottext">s :: Type
</span><a href="#local-6989586621679052273"><span class="hs-identifier hs-var hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OpticStab -&gt; Type
</span><a href="Lens.Micro.TH.html#stabToS"><span class="hs-identifier hs-var">stabToS</span></a></span><span> </span><span class="annot"><span class="annottext">OpticStab
</span><a href="#local-6989586621679052279"><span class="hs-identifier hs-var">defType</span></a></span><span>
</span><span id="line-1064"></span><span>  </span><span id="local-6989586621679052275"><span class="annot"><span class="annottext">a :: Type
</span><a href="#local-6989586621679052275"><span class="hs-identifier hs-var hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OpticStab -&gt; Type
</span><a href="Lens.Micro.TH.html#stabToA"><span class="hs-identifier hs-var">stabToA</span></a></span><span> </span><span class="annot"><span class="annottext">OpticStab
</span><a href="#local-6989586621679052279"><span class="hs-identifier hs-var">defType</span></a></span><span>
</span><span id="line-1065"></span><span>
</span><span id="line-1066"></span><span>  </span><span id="local-6989586621679052276"><span class="annot"><span class="annottext">containsTypeFamilies :: Type -&gt; Q Bool
</span><a href="#local-6989586621679052276"><span class="hs-identifier hs-var hs-var">containsTypeFamilies</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Q Bool
</span><a href="#local-6989586621679052272"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Q Bool) -&gt; (Type -&gt; PredQ) -&gt; Type -&gt; Q Bool
forall (m :: * -&gt; *) b c a.
Monad m =&gt;
(b -&gt; m c) -&gt; (a -&gt; m b) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&lt;=&lt;</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; PredQ
</span><span class="hs-identifier hs-var">D.resolveTypeSynonyms</span></span><span>
</span><span id="line-1067"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-1068"></span><span>    </span><span id="local-6989586621679052272"><span class="annot"><span class="annottext">go :: Type -&gt; Q Bool
</span><a href="#local-6989586621679052272"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ConT</span></span><span> </span><span id="local-6989586621679052269"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052269"><span class="hs-identifier hs-var">nm</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679052268"><span class="annot"><span class="annottext">Info
</span><a href="#local-6989586621679052268"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Info
</span><a href="#local-6989586621679052268"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FamilyI</span></span><span> </span><span id="local-6989586621679052266"><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679052266"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Dec -&gt; Bool
</span><a href="#local-6989586621679052265"><span class="hs-identifier hs-var">isTypeFamily</span></a></span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679052266"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Info
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>
</span><span id="line-1069"></span><span>                   </span><span class="annot"><span class="annottext">(Info -&gt; Bool) -&gt; Q Info -&gt; Q Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Q Info
</span><span class="hs-identifier hs-var">reify</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052269"><span class="hs-identifier hs-var">nm</span></a></span><span>
</span><span id="line-1070"></span><span>    </span><span class="annot"><a href="#local-6989586621679052272"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621679052263"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052263"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Bool] -&gt; Bool
forall (t :: * -&gt; *). Foldable t =&gt; t Bool -&gt; Bool
</span><span class="hs-identifier hs-var">or</span></span><span> </span><span class="annot"><span class="annottext">([Bool] -&gt; Bool) -&gt; Q [Bool] -&gt; Q Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Q Bool) -&gt; [Type] -&gt; Q [Bool]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Q Bool
</span><a href="#local-6989586621679052272"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; [Type]
forall a. Data a =&gt; a -&gt; [a]
</span><a href="Lens.Micro.TH.html#children"><span class="hs-identifier hs-var">children</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052263"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span class="hs-cpp">

#if MIN_VERSION_template_haskell(2,11,0)
</span><span>  </span><span id="local-6989586621679052265"><span class="annot"><span class="annottext">isTypeFamily :: Dec -&gt; Bool
</span><a href="#local-6989586621679052265"><span class="hs-identifier hs-var hs-var">isTypeFamily</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">OpenTypeFamilyD</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1074"></span><span>  </span><span class="annot"><a href="#local-6989586621679052265"><span class="hs-identifier hs-var">isTypeFamily</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ClosedTypeFamilyD</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-cpp">
#elif MIN_VERSION_template_haskell(2,9,0)
</span><span>  </span><span class="hs-identifier">isTypeFamily</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">FamilyD</span><span> </span><span class="hs-identifier">TypeFam</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">True</span><span>
</span><span id="line-1077"></span><span>  </span><span class="hs-identifier">isTypeFamily</span><span> </span><span class="hs-identifier">ClosedTypeFamilyD</span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">True</span><span class="hs-cpp">
#else
</span><span>  </span><span class="hs-identifier">isTypeFamily</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">FamilyD</span><span> </span><span class="hs-identifier">TypeFam</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">True</span><span class="hs-cpp">
#endif
</span><span>  </span><span class="annot"><a href="#local-6989586621679052265"><span class="hs-identifier hs-var">isTypeFamily</span></a></span><span> </span><span class="annot"><span class="annottext">Dec
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1082"></span><span>
</span><span id="line-1083"></span><span>  </span><span id="local-6989586621679052274"><span class="annot"><span class="annottext">pickInstanceDec :: Bool -&gt; Q Dec
</span><a href="#local-6989586621679052274"><span class="hs-identifier hs-var hs-var">pickInstanceDec</span></a></span></span><span> </span><span id="local-6989586621679052259"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679052259"><span class="hs-identifier hs-var">hasFamilies</span></a></span></span><span>
</span><span id="line-1084"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679052259"><span class="hs-identifier hs-var">hasFamilies</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1085"></span><span>        </span><span id="local-6989586621679052258"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052258"><span class="hs-identifier hs-var">placeholder</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">VarT</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Type) -&gt; Q Name -&gt; PredQ
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Q Name
</span><span class="hs-identifier hs-var">newName</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;a&quot;</span></span><span>
</span><span id="line-1086"></span><span>        </span><span class="annot"><span class="annottext">[PredQ] -&gt; [Type] -&gt; Q Dec
</span><a href="#local-6989586621679052257"><span class="hs-identifier hs-var">mkInstanceDec</span></a></span><span>
</span><span id="line-1087"></span><span>          </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type -&gt; PredQ
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><span class="hs-identifier hs-var">D.equalPred</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052258"><span class="hs-identifier hs-var">placeholder</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052275"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1088"></span><span>          </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052273"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052258"><span class="hs-identifier hs-var">placeholder</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1089"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PredQ] -&gt; [Type] -&gt; Q Dec
</span><a href="#local-6989586621679052257"><span class="hs-identifier hs-var">mkInstanceDec</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052273"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052275"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1090"></span><span>
</span><span id="line-1091"></span><span>  </span><span id="local-6989586621679052257"><span class="annot"><span class="annottext">mkInstanceDec :: [PredQ] -&gt; [Type] -&gt; Q Dec
</span><a href="#local-6989586621679052257"><span class="hs-identifier hs-var hs-var">mkInstanceDec</span></a></span></span><span> </span><span id="local-6989586621679052255"><span class="annot"><span class="annottext">[PredQ]
</span><a href="#local-6989586621679052255"><span class="hs-identifier hs-var">context</span></a></span></span><span> </span><span id="local-6989586621679052254"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679052254"><span class="hs-identifier hs-var">headTys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1092"></span><span>    </span><span class="annot"><span class="annottext">CxtQ -&gt; PredQ -&gt; [Q Dec] -&gt; Q Dec
</span><span class="hs-identifier hs-var">instanceD</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[PredQ] -&gt; CxtQ
</span><span class="hs-identifier hs-var">cxt</span></span><span> </span><span class="annot"><span class="annottext">[PredQ]
</span><a href="#local-6989586621679052255"><span class="hs-identifier hs-var">context</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; PredQ
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052278"><span class="hs-identifier hs-var">className</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Type] -&gt; Type
</span><a href="Lens.Micro.TH.Internal.html#conAppsT"><span class="hs-operator hs-var">`conAppsT`</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679052254"><span class="hs-identifier hs-var">headTys</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Q Dec]
</span><a href="#local-6989586621679052277"><span class="hs-identifier hs-var">decs</span></a></span><span>
</span><span id="line-1093"></span><span>
</span><span id="line-1094"></span><span class="hs-comment">------------------------------------------------------------------------</span><span>
</span><span id="line-1095"></span><span class="hs-comment">-- Optic clause generators</span><span>
</span><span id="line-1096"></span><span class="hs-comment">------------------------------------------------------------------------</span><span>
</span><span id="line-1097"></span><span>
</span><span id="line-1098"></span><span class="annot"><a href="Lens.Micro.TH.html#makeFieldClauses"><span class="hs-identifier hs-type">makeFieldClauses</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Lens.Micro.TH.html#LensRules"><span class="hs-identifier hs-type">LensRules</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Lens.Micro.TH.html#OpticType"><span class="hs-identifier hs-type">OpticType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">ClauseQ</span></span><span class="hs-special">]</span><span>
</span><span id="line-1099"></span><span id="makeFieldClauses"><span class="annot"><span class="annottext">makeFieldClauses :: LensRules -&gt; OpticType -&gt; [(Name, Int, [Int])] -&gt; [ClauseQ]
</span><a href="Lens.Micro.TH.html#makeFieldClauses"><span class="hs-identifier hs-var hs-var">makeFieldClauses</span></a></span></span><span> </span><span id="local-6989586621679052253"><span class="annot"><span class="annottext">LensRules
</span><a href="#local-6989586621679052253"><span class="hs-identifier hs-var">rules</span></a></span></span><span> </span><span id="local-6989586621679052252"><span class="annot"><span class="annottext">OpticType
</span><a href="#local-6989586621679052252"><span class="hs-identifier hs-var">opticType</span></a></span></span><span> </span><span id="local-6989586621679052251"><span class="annot"><span class="annottext">[(Name, Int, [Int])]
</span><a href="#local-6989586621679052251"><span class="hs-identifier hs-var">cons</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1100"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">OpticType
</span><a href="#local-6989586621679052252"><span class="hs-identifier hs-var">opticType</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1101"></span><span>
</span><span id="line-1102"></span><span>    </span><span class="hs-comment">-- IsoType    -&gt; [ makeIsoClause conName | (conName, _, _) &lt;- cons ]</span><span>
</span><span id="line-1103"></span><span>
</span><span id="line-1104"></span><span>    </span><span class="annot"><span class="annottext">OpticType
</span><a href="Lens.Micro.TH.html#GetterType"><span class="hs-identifier hs-var">GetterType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Int -&gt; [Int] -&gt; ClauseQ
</span><a href="Lens.Micro.TH.html#makeGetterClause"><span class="hs-identifier hs-var">makeGetterClause</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052249"><span class="hs-identifier hs-var">conName</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679052248"><span class="hs-identifier hs-var">fieldCount</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679052247"><span class="hs-identifier hs-var">fields</span></a></span><span>
</span><span id="line-1105"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679052249"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052249"><span class="hs-identifier hs-var">conName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679052248"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679052248"><span class="hs-identifier hs-var">fieldCount</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679052247"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679052247"><span class="hs-identifier hs-var">fields</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Name, Int, [Int])]
</span><a href="#local-6989586621679052251"><span class="hs-identifier hs-var">cons</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1106"></span><span>
</span><span id="line-1107"></span><span>    </span><span class="annot"><span class="annottext">OpticType
</span><a href="Lens.Micro.TH.html#LensType"><span class="hs-identifier hs-var">LensType</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Int -&gt; [Int] -&gt; Bool -&gt; ClauseQ
</span><a href="Lens.Micro.TH.html#makeFieldOpticClause"><span class="hs-identifier hs-var">makeFieldOpticClause</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052245"><span class="hs-identifier hs-var">conName</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679052244"><span class="hs-identifier hs-var">fieldCount</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679052243"><span class="hs-identifier hs-var">fields</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679052242"><span class="hs-identifier hs-var">irref</span></a></span><span>
</span><span id="line-1108"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679052245"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052245"><span class="hs-identifier hs-var">conName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679052244"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679052244"><span class="hs-identifier hs-var">fieldCount</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679052243"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679052243"><span class="hs-identifier hs-var">fields</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Name, Int, [Int])]
</span><a href="#local-6989586621679052251"><span class="hs-identifier hs-var">cons</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1109"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1110"></span><span>      </span><span id="local-6989586621679052242"><span class="annot"><span class="annottext">irref :: Bool
</span><a href="#local-6989586621679052242"><span class="hs-identifier hs-var hs-var">irref</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LensRules -&gt; Bool
</span><a href="Lens.Micro.TH.html#_lazyPatterns"><span class="hs-identifier hs-var hs-var">_lazyPatterns</span></a></span><span> </span><span class="annot"><span class="annottext">LensRules
</span><a href="#local-6989586621679052253"><span class="hs-identifier hs-var">rules</span></a></span><span>
</span><span id="line-1111"></span><span>           </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">[(Name, Int, [Int])] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[(Name, Int, [Int])]
</span><a href="#local-6989586621679052251"><span class="hs-identifier hs-var">cons</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-1112"></span><span>
</span><span id="line-1113"></span><span class="hs-comment">-- Construct an optic clause that returns an unmodified value</span><span>
</span><span id="line-1114"></span><span class="hs-comment">-- given a constructor name and the number of fields on that</span><span>
</span><span id="line-1115"></span><span class="hs-comment">-- constructor.</span><span>
</span><span id="line-1116"></span><span class="annot"><a href="Lens.Micro.TH.html#makePureClause"><span class="hs-identifier hs-type">makePureClause</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ClauseQ</span></span><span>
</span><span id="line-1117"></span><span id="makePureClause"><span class="annot"><span class="annottext">makePureClause :: Name -&gt; Int -&gt; ClauseQ
</span><a href="Lens.Micro.TH.html#makePureClause"><span class="hs-identifier hs-var hs-var">makePureClause</span></a></span></span><span> </span><span id="local-6989586621679052240"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052240"><span class="hs-identifier hs-var">conName</span></a></span></span><span> </span><span id="local-6989586621679052239"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679052239"><span class="hs-identifier hs-var">fieldCount</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1118"></span><span>  </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679052238"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679052238"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; Q [Name]
</span><a href="Lens.Micro.TH.Internal.html#newNames"><span class="hs-identifier hs-var">newNames</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;x&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679052239"><span class="hs-identifier hs-var">fieldCount</span></a></span><span>
</span><span id="line-1119"></span><span>     </span><span class="hs-comment">-- clause: _ (Con x1..xn) = pure (Con x1..xn)</span><span>
</span><span id="line-1120"></span><span>     </span><span class="annot"><span class="annottext">[PatQ] -&gt; BodyQ -&gt; [Q Dec] -&gt; ClauseQ
</span><span class="hs-identifier hs-var">clause</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PatQ
</span><span class="hs-identifier hs-var">wildP</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [PatQ] -&gt; PatQ
</span><span class="hs-identifier hs-var">conP</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052240"><span class="hs-identifier hs-var">conName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Name -&gt; PatQ) -&gt; [Name] -&gt; [PatQ]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; PatQ
</span><span class="hs-identifier hs-var">varP</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679052238"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1121"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExpQ -&gt; BodyQ
</span><span class="hs-identifier hs-var">normalB</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExpQ -&gt; ExpQ -&gt; ExpQ
</span><span class="hs-identifier hs-var">appE</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; ExpQ
</span><span class="hs-identifier hs-var">varE</span></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">pure</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ExpQ] -&gt; ExpQ
</span><span class="hs-identifier hs-var">appsE</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; ExpQ
</span><span class="hs-identifier hs-var">conE</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052240"><span class="hs-identifier hs-var">conName</span></a></span><span> </span><span class="annot"><span class="annottext">ExpQ -&gt; [ExpQ] -&gt; [ExpQ]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; ExpQ) -&gt; [Name] -&gt; [ExpQ]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; ExpQ
</span><span class="hs-identifier hs-var">varE</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679052238"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1122"></span><span>            </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1123"></span><span>
</span><span id="line-1124"></span><span class="hs-comment">-- Construct an optic clause suitable for a Getter or Fold</span><span>
</span><span id="line-1125"></span><span class="hs-comment">-- by visited the fields identified by their 0 indexed positions</span><span>
</span><span id="line-1126"></span><span class="annot"><a href="Lens.Micro.TH.html#makeGetterClause"><span class="hs-identifier hs-type">makeGetterClause</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ClauseQ</span></span><span>
</span><span id="line-1127"></span><span id="makeGetterClause"><span class="annot"><span class="annottext">makeGetterClause :: Name -&gt; Int -&gt; [Int] -&gt; ClauseQ
</span><a href="Lens.Micro.TH.html#makeGetterClause"><span class="hs-identifier hs-var hs-var">makeGetterClause</span></a></span></span><span> </span><span id="local-6989586621679052236"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052236"><span class="hs-identifier hs-var">conName</span></a></span></span><span> </span><span id="local-6989586621679052235"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679052235"><span class="hs-identifier hs-var">fieldCount</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Int -&gt; ClauseQ
</span><a href="Lens.Micro.TH.html#makePureClause"><span class="hs-identifier hs-var">makePureClause</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052236"><span class="hs-identifier hs-var">conName</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679052235"><span class="hs-identifier hs-var">fieldCount</span></a></span><span>
</span><span id="line-1128"></span><span class="annot"><a href="Lens.Micro.TH.html#makeGetterClause"><span class="hs-identifier hs-var">makeGetterClause</span></a></span><span> </span><span id="local-6989586621679052234"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052234"><span class="hs-identifier hs-var">conName</span></a></span></span><span> </span><span id="local-6989586621679052233"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679052233"><span class="hs-identifier hs-var">fieldCount</span></a></span></span><span> </span><span id="local-6989586621679052232"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679052232"><span class="hs-identifier hs-var">fields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1129"></span><span>  </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679052231"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052231"><span class="hs-identifier hs-var">f</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; Q Name
</span><span class="hs-identifier hs-var">newName</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;f&quot;</span></span><span>
</span><span id="line-1130"></span><span>     </span><span id="local-6989586621679052230"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679052230"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; Q [Name]
</span><a href="Lens.Micro.TH.Internal.html#newNames"><span class="hs-identifier hs-var">newNames</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;x&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Int] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679052232"><span class="hs-identifier hs-var">fields</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1131"></span><span>
</span><span id="line-1132"></span><span>     </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679052229"><span class="annot"><span class="annottext">pats :: [Int] -&gt; [Name] -&gt; [PatQ]
</span><a href="#local-6989586621679052229"><span class="hs-identifier hs-var hs-var">pats</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679052228"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679052228"><span class="hs-identifier hs-var">i</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679052227"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679052227"><span class="hs-identifier hs-var">is</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679052226"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052226"><span class="hs-identifier hs-var">y</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679052225"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679052225"><span class="hs-identifier hs-var">ys</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1133"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679052228"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Int] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679052232"><span class="hs-identifier hs-var">fields</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; PatQ
</span><span class="hs-identifier hs-var">varP</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052226"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">PatQ -&gt; [PatQ] -&gt; [PatQ]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; [Name] -&gt; [PatQ]
</span><a href="#local-6989586621679052229"><span class="hs-identifier hs-var">pats</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679052227"><span class="hs-identifier hs-var">is</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679052225"><span class="hs-identifier hs-var">ys</span></a></span><span>
</span><span id="line-1134"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatQ
</span><span class="hs-identifier hs-var">wildP</span></span><span> </span><span class="annot"><span class="annottext">PatQ -&gt; [PatQ] -&gt; [PatQ]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; [Name] -&gt; [PatQ]
</span><a href="#local-6989586621679052229"><span class="hs-identifier hs-var">pats</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679052227"><span class="hs-identifier hs-var">is</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052226"><span class="hs-identifier hs-var">y</span></a></span><span class="annot"><span class="annottext">Name -&gt; [Name] -&gt; [Name]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679052225"><span class="hs-identifier hs-var">ys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1135"></span><span>         </span><span class="annot"><a href="#local-6989586621679052229"><span class="hs-identifier hs-var">pats</span></a></span><span> </span><span id="local-6989586621679052224"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679052224"><span class="hs-identifier hs-var">is</span></a></span></span><span>     </span><span class="annot"><span class="annottext">[Name]
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; PatQ) -&gt; [Int] -&gt; [PatQ]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatQ -&gt; Int -&gt; PatQ
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">PatQ
</span><span class="hs-identifier hs-var">wildP</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679052224"><span class="hs-identifier hs-var">is</span></a></span><span>
</span><span id="line-1136"></span><span>
</span><span id="line-1137"></span><span>         </span><span id="local-6989586621679052223"><span class="annot"><span class="annottext">fxs :: [ExpQ]
</span><a href="#local-6989586621679052223"><span class="hs-identifier hs-var hs-var">fxs</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">ExpQ -&gt; ExpQ -&gt; ExpQ
</span><span class="hs-identifier hs-var">appE</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; ExpQ
</span><span class="hs-identifier hs-var">varE</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052231"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; ExpQ
</span><span class="hs-identifier hs-var">varE</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052222"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679052222"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052222"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679052230"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1138"></span><span>         </span><span id="local-6989586621679052221"><span class="annot"><span class="annottext">body :: ExpQ
</span><a href="#local-6989586621679052221"><span class="hs-identifier hs-var hs-var">body</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ExpQ -&gt; ExpQ -&gt; ExpQ) -&gt; ExpQ -&gt; [ExpQ] -&gt; ExpQ
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679052219"><span class="annot"><span class="annottext">ExpQ
</span><a href="#local-6989586621679052219"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679052218"><span class="annot"><span class="annottext">ExpQ
</span><a href="#local-6989586621679052218"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[ExpQ] -&gt; ExpQ
</span><span class="hs-identifier hs-var">appsE</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; ExpQ
</span><span class="hs-identifier hs-var">varE</span></span><span> </span><span class="hs-special">'</span><span class="hs-special">(</span><span class="hs-operator">&lt;*&gt;</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ExpQ
</span><a href="#local-6989586621679052219"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ExpQ
</span><a href="#local-6989586621679052218"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1139"></span><span>                       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExpQ -&gt; ExpQ -&gt; ExpQ
</span><span class="hs-identifier hs-var">appE</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; ExpQ
</span><span class="hs-identifier hs-var">varE</span></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">phantom</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ExpQ] -&gt; ExpQ
forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[ExpQ]
</span><a href="#local-6989586621679052223"><span class="hs-identifier hs-var">fxs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1140"></span><span>                       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ExpQ] -&gt; [ExpQ]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">tail</span></span><span> </span><span class="annot"><span class="annottext">[ExpQ]
</span><a href="#local-6989586621679052223"><span class="hs-identifier hs-var">fxs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1141"></span><span>
</span><span id="line-1142"></span><span>     </span><span class="hs-comment">-- clause f (Con x1..xn) = coerce (f x1) &lt;*&gt; ... &lt;*&gt; f xn</span><span>
</span><span id="line-1143"></span><span>     </span><span class="annot"><span class="annottext">[PatQ] -&gt; BodyQ -&gt; [Q Dec] -&gt; ClauseQ
</span><span class="hs-identifier hs-var">clause</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; PatQ
</span><span class="hs-identifier hs-var">varP</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052231"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [PatQ] -&gt; PatQ
</span><span class="hs-identifier hs-var">conP</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052234"><span class="hs-identifier hs-var">conName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Int] -&gt; [Name] -&gt; [PatQ]
</span><a href="#local-6989586621679052229"><span class="hs-identifier hs-var">pats</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679052233"><span class="hs-identifier hs-var">fieldCount</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679052230"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1144"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExpQ -&gt; BodyQ
</span><span class="hs-identifier hs-var">normalB</span></span><span> </span><span class="annot"><span class="annottext">ExpQ
</span><a href="#local-6989586621679052221"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1145"></span><span>            </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1146"></span><span>
</span><span id="line-1147"></span><span class="hs-comment">-- Build a clause that updates the field at the given indexes</span><span>
</span><span id="line-1148"></span><span class="hs-comment">-- When irref is 'True' the value with me matched with an irrefutable</span><span>
</span><span id="line-1149"></span><span class="hs-comment">-- pattern. This is suitable for Lens and Traversal construction</span><span>
</span><span id="line-1150"></span><span class="annot"><a href="Lens.Micro.TH.html#makeFieldOpticClause"><span class="hs-identifier hs-type">makeFieldOpticClause</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ClauseQ</span></span><span>
</span><span id="line-1151"></span><span id="makeFieldOpticClause"><span class="annot"><span class="annottext">makeFieldOpticClause :: Name -&gt; Int -&gt; [Int] -&gt; Bool -&gt; ClauseQ
</span><a href="Lens.Micro.TH.html#makeFieldOpticClause"><span class="hs-identifier hs-var hs-var">makeFieldOpticClause</span></a></span></span><span> </span><span id="local-6989586621679052215"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052215"><span class="hs-identifier hs-var">conName</span></a></span></span><span> </span><span id="local-6989586621679052214"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679052214"><span class="hs-identifier hs-var">fieldCount</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1152"></span><span>  </span><span class="annot"><span class="annottext">Name -&gt; Int -&gt; ClauseQ
</span><a href="Lens.Micro.TH.html#makePureClause"><span class="hs-identifier hs-var">makePureClause</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052215"><span class="hs-identifier hs-var">conName</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679052214"><span class="hs-identifier hs-var">fieldCount</span></a></span><span>
</span><span id="line-1153"></span><span class="annot"><a href="Lens.Micro.TH.html#makeFieldOpticClause"><span class="hs-identifier hs-var">makeFieldOpticClause</span></a></span><span> </span><span id="local-6989586621679052213"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052213"><span class="hs-identifier hs-var">conName</span></a></span></span><span> </span><span id="local-6989586621679052212"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679052212"><span class="hs-identifier hs-var">fieldCount</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679052211"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679052211"><span class="hs-identifier hs-var">field</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679052210"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679052210"><span class="hs-identifier hs-var">fields</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679052209"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679052209"><span class="hs-identifier hs-var">irref</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1154"></span><span>  </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679052208"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052208"><span class="hs-identifier hs-var">f</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; Q Name
</span><span class="hs-identifier hs-var">newName</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;f&quot;</span></span><span>
</span><span id="line-1155"></span><span>     </span><span id="local-6989586621679052207"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679052207"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; Q [Name]
</span><a href="Lens.Micro.TH.Internal.html#newNames"><span class="hs-identifier hs-var">newNames</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;x&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679052212"><span class="hs-identifier hs-var">fieldCount</span></a></span><span>
</span><span id="line-1156"></span><span>     </span><span id="local-6989586621679052206"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679052206"><span class="hs-identifier hs-var">ys</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; Q [Name]
</span><a href="Lens.Micro.TH.Internal.html#newNames"><span class="hs-identifier hs-var">newNames</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;y&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679052210"><span class="hs-identifier hs-var">fields</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1157"></span><span>
</span><span id="line-1158"></span><span>     </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679052204"><span class="annot"><span class="annottext">xs' :: [Name]
</span><a href="#local-6989586621679052204"><span class="hs-identifier hs-var hs-var">xs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Int, Name) -&gt; [Name] -&gt; [Name])
-&gt; [Name] -&gt; [(Int, Name)] -&gt; [Name]
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679052202"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679052202"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679052201"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052201"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ASetter [Name] [Name] Name Name -&gt; Name -&gt; [Name] -&gt; [Name]
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Index [Name] -&gt; Traversal' [Name] (IxValue [Name])
forall m. Ixed m =&gt; Index m -&gt; Traversal' m (IxValue m)
</span><span class="hs-identifier hs-var">ix</span></span><span> </span><span class="annot"><span class="annottext">Int
Index [Name]
</span><a href="#local-6989586621679052202"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052201"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679052207"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Int] -&gt; [Name] -&gt; [(Int, Name)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679052211"><span class="hs-identifier hs-var">field</span></a></span><span class="annot"><span class="annottext">Int -&gt; [Int] -&gt; [Int]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679052210"><span class="hs-identifier hs-var">fields</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679052206"><span class="hs-identifier hs-var">ys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1159"></span><span>
</span><span id="line-1160"></span><span>         </span><span id="local-6989586621679052198"><span class="annot"><span class="annottext">mkFx :: Int -&gt; ExpQ
</span><a href="#local-6989586621679052198"><span class="hs-identifier hs-var hs-var">mkFx</span></a></span></span><span> </span><span id="local-6989586621679052197"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679052197"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExpQ -&gt; ExpQ -&gt; ExpQ
</span><span class="hs-identifier hs-var">appE</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; ExpQ
</span><span class="hs-identifier hs-var">varE</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052208"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; ExpQ
</span><span class="hs-identifier hs-var">varE</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679052207"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; Int -&gt; Name
forall a. [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679052197"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1161"></span><span>
</span><span id="line-1162"></span><span>         </span><span id="local-6989586621679052195"><span class="annot"><span class="annottext">body0 :: ExpQ
</span><a href="#local-6989586621679052195"><span class="hs-identifier hs-var hs-var">body0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ExpQ] -&gt; ExpQ
</span><span class="hs-identifier hs-var">appsE</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Name -&gt; ExpQ
</span><span class="hs-identifier hs-var">varE</span></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">fmap</span><span>
</span><span id="line-1163"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[PatQ] -&gt; ExpQ -&gt; ExpQ
</span><span class="hs-identifier hs-var">lamE</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Name -&gt; PatQ) -&gt; [Name] -&gt; [PatQ]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; PatQ
</span><span class="hs-identifier hs-var">varP</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679052206"><span class="hs-identifier hs-var">ys</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ExpQ] -&gt; ExpQ
</span><span class="hs-identifier hs-var">appsE</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; ExpQ
</span><span class="hs-identifier hs-var">conE</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052213"><span class="hs-identifier hs-var">conName</span></a></span><span> </span><span class="annot"><span class="annottext">ExpQ -&gt; [ExpQ] -&gt; [ExpQ]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; ExpQ) -&gt; [Name] -&gt; [ExpQ]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; ExpQ
</span><span class="hs-identifier hs-var">varE</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679052204"><span class="hs-identifier hs-var">xs'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1164"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ExpQ
</span><a href="#local-6989586621679052198"><span class="hs-identifier hs-var">mkFx</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679052211"><span class="hs-identifier hs-var">field</span></a></span><span>
</span><span id="line-1165"></span><span>                       </span><span class="hs-special">]</span><span>
</span><span id="line-1166"></span><span>
</span><span id="line-1167"></span><span>         </span><span id="local-6989586621679052194"><span class="annot"><span class="annottext">body :: ExpQ
</span><a href="#local-6989586621679052194"><span class="hs-identifier hs-var hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ExpQ -&gt; Int -&gt; ExpQ) -&gt; ExpQ -&gt; [Int] -&gt; ExpQ
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679052193"><span class="annot"><span class="annottext">ExpQ
</span><a href="#local-6989586621679052193"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679052192"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679052192"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[ExpQ] -&gt; ExpQ
</span><span class="hs-identifier hs-var">appsE</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; ExpQ
</span><span class="hs-identifier hs-var">varE</span></span><span> </span><span class="hs-special">'</span><span class="hs-special">(</span><span class="hs-operator">&lt;*&gt;</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ExpQ
</span><a href="#local-6989586621679052193"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ExpQ
</span><a href="#local-6989586621679052198"><span class="hs-identifier hs-var">mkFx</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679052192"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ExpQ
</span><a href="#local-6989586621679052195"><span class="hs-identifier hs-var">body0</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679052210"><span class="hs-identifier hs-var">fields</span></a></span><span>
</span><span id="line-1168"></span><span>
</span><span id="line-1169"></span><span>     </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679052191"><span class="annot"><span class="annottext">wrap :: PatQ -&gt; PatQ
</span><a href="#local-6989586621679052191"><span class="hs-identifier hs-var hs-var">wrap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679052209"><span class="hs-identifier hs-var">irref</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">PatQ -&gt; PatQ
</span><span class="hs-identifier hs-var">tildeP</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">PatQ -&gt; PatQ
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-1170"></span><span>
</span><span id="line-1171"></span><span>     </span><span class="annot"><span class="annottext">[PatQ] -&gt; BodyQ -&gt; [Q Dec] -&gt; ClauseQ
</span><span class="hs-identifier hs-var">clause</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; PatQ
</span><span class="hs-identifier hs-var">varP</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052208"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PatQ -&gt; PatQ
</span><a href="#local-6989586621679052191"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; [PatQ] -&gt; PatQ
</span><span class="hs-identifier hs-var">conP</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052213"><span class="hs-identifier hs-var">conName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Name -&gt; PatQ) -&gt; [Name] -&gt; [PatQ]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; PatQ
</span><span class="hs-identifier hs-var">varP</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679052207"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1172"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExpQ -&gt; BodyQ
</span><span class="hs-identifier hs-var">normalB</span></span><span> </span><span class="annot"><span class="annottext">ExpQ
</span><a href="#local-6989586621679052194"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1173"></span><span>            </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1174"></span><span>
</span><span id="line-1175"></span><span class="hs-comment">------------------------------------------------------------------------</span><span>
</span><span id="line-1176"></span><span class="hs-comment">-- Unification logic</span><span>
</span><span id="line-1177"></span><span class="hs-comment">------------------------------------------------------------------------</span><span>
</span><span id="line-1178"></span><span>
</span><span id="line-1179"></span><span class="hs-comment">-- The field-oriented optic generation supports incorporating fields</span><span>
</span><span id="line-1180"></span><span class="hs-comment">-- with distinct but unifiable types into a single definition.</span><span>
</span><span id="line-1181"></span><span>
</span><span id="line-1182"></span><span class="hs-comment">-- Unify the given list of types, if possible, and return the</span><span>
</span><span id="line-1183"></span><span class="hs-comment">-- substitution used to unify the types for unifying the outer</span><span>
</span><span id="line-1184"></span><span class="hs-comment">-- type when building a definition's type signature.</span><span>
</span><span id="line-1185"></span><span class="annot"><a href="Lens.Micro.TH.html#unifyTypes"><span class="hs-identifier hs-type">unifyTypes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span>
</span><span id="line-1186"></span><span id="unifyTypes"><span class="annot"><span class="annottext">unifyTypes :: [Type] -&gt; Q (Map Name Type, Type)
</span><a href="Lens.Micro.TH.html#unifyTypes"><span class="hs-identifier hs-var hs-var">unifyTypes</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679052189"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052189"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679052188"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679052188"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Map Name Type, Type) -&gt; Type -&gt; Q (Map Name Type, Type))
-&gt; (Map Name Type, Type) -&gt; [Type] -&gt; Q (Map Name Type, Type)
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><span class="hs-identifier hs-var">foldM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Map Name Type -&gt; Type -&gt; Type -&gt; Q (Map Name Type, Type))
-&gt; (Map Name Type, Type) -&gt; Type -&gt; Q (Map Name Type, Type)
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="annot"><span class="annottext">Map Name Type -&gt; Type -&gt; Type -&gt; Q (Map Name Type, Type)
</span><a href="Lens.Micro.TH.html#unify1"><span class="hs-identifier hs-var">unify1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Name Type
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052189"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679052188"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-1187"></span><span class="annot"><a href="Lens.Micro.TH.html#unifyTypes"><span class="hs-identifier hs-var">unifyTypes</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Q (Map Name Type, Type)
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unifyTypes: Bug: Unexpected empty list&quot;</span></span><span>
</span><span id="line-1188"></span><span>
</span><span id="line-1189"></span><span>
</span><span id="line-1190"></span><span class="hs-comment">-- Attempt to unify two given types using a running substitution</span><span>
</span><span id="line-1191"></span><span class="annot"><a href="Lens.Micro.TH.html#unify1"><span class="hs-identifier hs-type">unify1</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span>
</span><span id="line-1192"></span><span id="unify1"><span class="annot"><span class="annottext">unify1 :: Map Name Type -&gt; Type -&gt; Type -&gt; Q (Map Name Type, Type)
</span><a href="Lens.Micro.TH.html#unify1"><span class="hs-identifier hs-var hs-var">unify1</span></a></span></span><span> </span><span id="local-6989586621679052183"><span class="annot"><span class="annottext">Map Name Type
</span><a href="#local-6989586621679052183"><span class="hs-identifier hs-var">sub</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">VarT</span></span><span> </span><span id="local-6989586621679052182"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052182"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679052181"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052181"><span class="hs-identifier hs-var">y</span></a></span></span><span>
</span><span id="line-1193"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679052180"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052180"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Map Name Type -&gt; Maybe Type
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052182"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name Type
</span><a href="#local-6989586621679052183"><span class="hs-identifier hs-var">sub</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Name Type -&gt; Type -&gt; Type -&gt; Q (Map Name Type, Type)
</span><a href="Lens.Micro.TH.html#unify1"><span class="hs-identifier hs-var">unify1</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name Type
</span><a href="#local-6989586621679052183"><span class="hs-identifier hs-var">sub</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052180"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052181"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-1194"></span><span class="annot"><a href="Lens.Micro.TH.html#unify1"><span class="hs-identifier hs-var">unify1</span></a></span><span> </span><span id="local-6989586621679052179"><span class="annot"><span class="annottext">Map Name Type
</span><a href="#local-6989586621679052179"><span class="hs-identifier hs-var">sub</span></a></span></span><span> </span><span id="local-6989586621679052178"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052178"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">VarT</span></span><span> </span><span id="local-6989586621679052177"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052177"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1195"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679052176"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052176"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Map Name Type -&gt; Maybe Type
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052177"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name Type
</span><a href="#local-6989586621679052179"><span class="hs-identifier hs-var">sub</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Name Type -&gt; Type -&gt; Type -&gt; Q (Map Name Type, Type)
</span><a href="Lens.Micro.TH.html#unify1"><span class="hs-identifier hs-var">unify1</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name Type
</span><a href="#local-6989586621679052179"><span class="hs-identifier hs-var">sub</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052178"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052176"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-1196"></span><span class="annot"><a href="Lens.Micro.TH.html#unify1"><span class="hs-identifier hs-var">unify1</span></a></span><span> </span><span id="local-6989586621679052175"><span class="annot"><span class="annottext">Map Name Type
</span><a href="#local-6989586621679052175"><span class="hs-identifier hs-var">sub</span></a></span></span><span> </span><span id="local-6989586621679052174"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052174"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679052173"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052173"><span class="hs-identifier hs-var">y</span></a></span></span><span>
</span><span id="line-1197"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052174"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052173"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Map Name Type, Type) -&gt; Q (Map Name Type, Type)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Name Type
</span><a href="#local-6989586621679052175"><span class="hs-identifier hs-var">sub</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052174"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1198"></span><span class="annot"><a href="Lens.Micro.TH.html#unify1"><span class="hs-identifier hs-var">unify1</span></a></span><span> </span><span id="local-6989586621679052172"><span class="annot"><span class="annottext">Map Name Type
</span><a href="#local-6989586621679052172"><span class="hs-identifier hs-var">sub</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AppT</span></span><span> </span><span id="local-6989586621679052170"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052170"><span class="hs-identifier hs-var">f1</span></a></span></span><span> </span><span id="local-6989586621679052169"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052169"><span class="hs-identifier hs-var">x1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AppT</span></span><span> </span><span id="local-6989586621679052168"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052168"><span class="hs-identifier hs-var">f2</span></a></span></span><span> </span><span id="local-6989586621679052167"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052167"><span class="hs-identifier hs-var">x2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1199"></span><span>  </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679052166"><span class="annot"><span class="annottext">Map Name Type
</span><a href="#local-6989586621679052166"><span class="hs-identifier hs-var">sub1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679052165"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052165"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map Name Type -&gt; Type -&gt; Type -&gt; Q (Map Name Type, Type)
</span><a href="Lens.Micro.TH.html#unify1"><span class="hs-identifier hs-var">unify1</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name Type
</span><a href="#local-6989586621679052172"><span class="hs-identifier hs-var">sub</span></a></span><span>  </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052170"><span class="hs-identifier hs-var">f1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052168"><span class="hs-identifier hs-var">f2</span></a></span><span>
</span><span id="line-1200"></span><span>     </span><span class="hs-special">(</span><span id="local-6989586621679052164"><span class="annot"><span class="annottext">Map Name Type
</span><a href="#local-6989586621679052164"><span class="hs-identifier hs-var">sub2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679052163"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052163"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map Name Type -&gt; Type -&gt; Type -&gt; Q (Map Name Type, Type)
</span><a href="Lens.Micro.TH.html#unify1"><span class="hs-identifier hs-var">unify1</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name Type
</span><a href="#local-6989586621679052166"><span class="hs-identifier hs-var">sub1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052169"><span class="hs-identifier hs-var">x1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052167"><span class="hs-identifier hs-var">x2</span></a></span><span>
</span><span id="line-1201"></span><span>     </span><span class="annot"><span class="annottext">(Map Name Type, Type) -&gt; Q (Map Name Type, Type)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Name Type
</span><a href="#local-6989586621679052164"><span class="hs-identifier hs-var">sub2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><span class="hs-identifier hs-var">AppT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Name Type -&gt; Type -&gt; Type
</span><a href="Lens.Micro.TH.html#applyTypeSubst"><span class="hs-identifier hs-var">applyTypeSubst</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name Type
</span><a href="#local-6989586621679052164"><span class="hs-identifier hs-var">sub2</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052165"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052163"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1202"></span><span class="annot"><a href="Lens.Micro.TH.html#unify1"><span class="hs-identifier hs-var">unify1</span></a></span><span> </span><span id="local-6989586621679052162"><span class="annot"><span class="annottext">Map Name Type
</span><a href="#local-6989586621679052162"><span class="hs-identifier hs-var">sub</span></a></span></span><span> </span><span id="local-6989586621679052161"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052161"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">VarT</span></span><span> </span><span id="local-6989586621679052160"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052160"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1203"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Getting (Endo [Name]) Type Name -&gt; Name -&gt; Type -&gt; Bool
forall a s. Eq a =&gt; Getting (Endo [a]) s a -&gt; a -&gt; s -&gt; Bool
</span><a href="Lens.Micro.TH.Internal.html#elemOf"><span class="hs-identifier hs-var">elemOf</span></a></span><span> </span><span class="annot"><span class="annottext">Getting (Endo [Name]) Type Name
forall t. HasTypeVars t =&gt; Traversal' t Name
</span><a href="Lens.Micro.TH.Internal.html#typeVars"><span class="hs-identifier hs-var">typeVars</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052160"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Name Type -&gt; Type -&gt; Type
</span><a href="Lens.Micro.TH.html#applyTypeSubst"><span class="hs-identifier hs-var">applyTypeSubst</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name Type
</span><a href="#local-6989586621679052162"><span class="hs-identifier hs-var">sub</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052161"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1204"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; Q (Map Name Type, Type)
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Failed to unify types: occurs check&quot;</span></span><span>
</span><span id="line-1205"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Map Name Type, Type) -&gt; Q (Map Name Type, Type)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type -&gt; Map Name Type -&gt; Map Name Type
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insert</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052160"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052161"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name Type
</span><a href="#local-6989586621679052162"><span class="hs-identifier hs-var">sub</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052161"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1206"></span><span class="annot"><a href="Lens.Micro.TH.html#unify1"><span class="hs-identifier hs-var">unify1</span></a></span><span> </span><span id="local-6989586621679052157"><span class="annot"><span class="annottext">Map Name Type
</span><a href="#local-6989586621679052157"><span class="hs-identifier hs-var">sub</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">VarT</span></span><span> </span><span id="local-6989586621679052156"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052156"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679052155"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052155"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Name Type -&gt; Type -&gt; Type -&gt; Q (Map Name Type, Type)
</span><a href="Lens.Micro.TH.html#unify1"><span class="hs-identifier hs-var">unify1</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name Type
</span><a href="#local-6989586621679052157"><span class="hs-identifier hs-var">sub</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052155"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">VarT</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052156"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1207"></span><span>
</span><span id="line-1208"></span><span class="hs-comment">-- TODO: Unify contexts</span><span>
</span><span id="line-1209"></span><span class="annot"><a href="Lens.Micro.TH.html#unify1"><span class="hs-identifier hs-var">unify1</span></a></span><span> </span><span id="local-6989586621679052154"><span class="annot"><span class="annottext">Map Name Type
</span><a href="#local-6989586621679052154"><span class="hs-identifier hs-var">sub</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ForallT</span></span><span> </span><span id="local-6989586621679052152"><span class="annot"><span class="annottext">[TyVarBndr_ Any]
</span><a href="#local-6989586621679052152"><span class="hs-identifier hs-var">v1</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621679052151"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052151"><span class="hs-identifier hs-var">t1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ForallT</span></span><span> </span><span id="local-6989586621679052150"><span class="annot"><span class="annottext">[TyVarBndr_ Any]
</span><a href="#local-6989586621679052150"><span class="hs-identifier hs-var">v2</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621679052149"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052149"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1210"></span><span>     </span><span class="hs-comment">-- This approach works out because by the time this code runs</span><span>
</span><span id="line-1211"></span><span>     </span><span class="hs-comment">-- all of the type variables have been renamed. No risk of shadowing.</span><span>
</span><span id="line-1212"></span><span>  </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679052148"><span class="annot"><span class="annottext">Map Name Type
</span><a href="#local-6989586621679052148"><span class="hs-identifier hs-var">sub1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679052147"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052147"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map Name Type -&gt; Type -&gt; Type -&gt; Q (Map Name Type, Type)
</span><a href="Lens.Micro.TH.html#unify1"><span class="hs-identifier hs-var">unify1</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name Type
</span><a href="#local-6989586621679052154"><span class="hs-identifier hs-var">sub</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052151"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052149"><span class="hs-identifier hs-var">t2</span></a></span><span>
</span><span id="line-1213"></span><span>     </span><span id="local-6989586621679052146"><span class="annot"><span class="annottext">[TyVarBndr_ Any]
</span><a href="#local-6989586621679052146"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">([TyVarBndr_ Any] -&gt; [TyVarBndr_ Any])
-&gt; Q [TyVarBndr_ Any] -&gt; Q [TyVarBndr_ Any]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr_ Any] -&gt; [TyVarBndr_ Any]
forall a. Eq a =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">nub</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TyVarBndr_ Any -&gt; Q (TyVarBndr_ Any))
-&gt; [TyVarBndr_ Any] -&gt; Q [TyVarBndr_ Any]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Name Type -&gt; TyVarBndr_ Any -&gt; Q (TyVarBndr_ Any)
</span><a href="Lens.Micro.TH.html#limitedSubst"><span class="hs-identifier hs-var">limitedSubst</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name Type
</span><a href="#local-6989586621679052148"><span class="hs-identifier hs-var">sub1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVarBndr_ Any]
</span><a href="#local-6989586621679052152"><span class="hs-identifier hs-var">v1</span></a></span><span class="annot"><span class="annottext">[TyVarBndr_ Any] -&gt; [TyVarBndr_ Any] -&gt; [TyVarBndr_ Any]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="annot"><span class="annottext">[TyVarBndr_ Any]
</span><a href="#local-6989586621679052150"><span class="hs-identifier hs-var">v2</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1214"></span><span>     </span><span class="annot"><span class="annottext">(Map Name Type, Type) -&gt; Q (Map Name Type, Type)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Name Type
</span><a href="#local-6989586621679052148"><span class="hs-identifier hs-var">sub1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TyVarBndr_ Any] -&gt; [Type] -&gt; Type -&gt; Type
</span><span class="hs-identifier hs-var">ForallT</span></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr_ Any]
</span><a href="#local-6989586621679052146"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052147"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1215"></span><span>
</span><span id="line-1216"></span><span class="annot"><a href="Lens.Micro.TH.html#unify1"><span class="hs-identifier hs-var">unify1</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name Type
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679052144"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052144"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679052143"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052143"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Q (Map Name Type, Type)
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Failed to unify types: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">(Type, Type) -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052144"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052143"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1217"></span><span>
</span><span id="line-1218"></span><span class="hs-comment">-- Perform a limited substitution on type variables. This is used</span><span>
</span><span id="line-1219"></span><span class="hs-comment">-- when unifying rank-2 fields when trying to achieve a Getter or Fold.</span><span>
</span><span id="line-1220"></span><span class="annot"><a href="Lens.Micro.TH.html#limitedSubst"><span class="hs-identifier hs-type">limitedSubst</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">D.TyVarBndrSpec</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">D.TyVarBndrSpec</span></span><span>
</span><span id="line-1221"></span><span id="limitedSubst"><span class="annot"><span class="annottext">limitedSubst :: Map Name Type -&gt; TyVarBndr_ Any -&gt; Q (TyVarBndr_ Any)
</span><a href="Lens.Micro.TH.html#limitedSubst"><span class="hs-identifier hs-var hs-var">limitedSubst</span></a></span></span><span> </span><span id="local-6989586621679052141"><span class="annot"><span class="annottext">Map Name Type
</span><a href="#local-6989586621679052141"><span class="hs-identifier hs-var">sub</span></a></span></span><span> </span><span id="local-6989586621679052140"><span class="annot"><span class="annottext">TyVarBndr_ Any
</span><a href="#local-6989586621679052140"><span class="hs-identifier hs-var">tv</span></a></span></span><span>
</span><span id="line-1222"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679052139"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052139"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Map Name Type -&gt; Maybe Type
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVarBndr_ Any -&gt; Name
forall flag. TyVarBndr_ Any -&gt; Name
</span><span class="hs-identifier hs-var">D.tvName</span></span><span> </span><span class="annot"><span class="annottext">TyVarBndr_ Any
</span><a href="#local-6989586621679052140"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map Name Type
</span><a href="#local-6989586621679052141"><span class="hs-identifier hs-var">sub</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1223"></span><span>       </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679052139"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1224"></span><span>         </span><span class="annot"><span class="hs-identifier hs-type">VarT</span></span><span> </span><span id="local-6989586621679052138"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052138"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map Name Type -&gt; TyVarBndr_ Any -&gt; Q (TyVarBndr_ Any)
</span><a href="Lens.Micro.TH.html#limitedSubst"><span class="hs-identifier hs-var">limitedSubst</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name Type
</span><a href="#local-6989586621679052141"><span class="hs-identifier hs-var">sub</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Name -&gt; Name) -&gt; TyVarBndr_ Any -&gt; TyVarBndr_ Any
forall flag. (Name -&gt; Name) -&gt; TyVarBndr_ Any -&gt; TyVarBndr_ Any
</span><span class="hs-identifier hs-var">D.mapTVName</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Name
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052138"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyVarBndr_ Any
</span><a href="#local-6989586621679052140"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1225"></span><span>         </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Q (TyVarBndr_ Any)
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Unable to unify exotic higher-rank type&quot;</span></span><span>
</span><span id="line-1226"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyVarBndr_ Any -&gt; Q (TyVarBndr_ Any)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">TyVarBndr_ Any
</span><a href="#local-6989586621679052140"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-1227"></span><span>
</span><span id="line-1228"></span><span class="hs-comment">-- Apply a substitution to a type. This is used after unifying</span><span>
</span><span id="line-1229"></span><span class="hs-comment">-- the types of the fields in unifyTypes.</span><span>
</span><span id="line-1230"></span><span class="annot"><a href="Lens.Micro.TH.html#applyTypeSubst"><span class="hs-identifier hs-type">applyTypeSubst</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-1231"></span><span id="applyTypeSubst"><span class="annot"><span class="annottext">applyTypeSubst :: Map Name Type -&gt; Type -&gt; Type
</span><a href="Lens.Micro.TH.html#applyTypeSubst"><span class="hs-identifier hs-var hs-var">applyTypeSubst</span></a></span></span><span> </span><span id="local-6989586621679052136"><span class="annot"><span class="annottext">Map Name Type
</span><a href="#local-6989586621679052136"><span class="hs-identifier hs-var">sub</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Maybe Type) -&gt; Type -&gt; Type
forall a b. (Data a, Data b) =&gt; (a -&gt; Maybe a) -&gt; b -&gt; b
</span><a href="Lens.Micro.TH.html#rewrite"><span class="hs-identifier hs-var">rewrite</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe Type
</span><a href="#local-6989586621679052135"><span class="hs-identifier hs-var">aux</span></a></span><span>
</span><span id="line-1232"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1233"></span><span>  </span><span id="local-6989586621679052135"><span class="annot"><span class="annottext">aux :: Type -&gt; Maybe Type
</span><a href="#local-6989586621679052135"><span class="hs-identifier hs-var hs-var">aux</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">VarT</span></span><span> </span><span id="local-6989586621679052134"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052134"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Map Name Type -&gt; Maybe Type
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679052134"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name Type
</span><a href="#local-6989586621679052136"><span class="hs-identifier hs-var">sub</span></a></span><span>
</span><span id="line-1234"></span><span>  </span><span class="annot"><a href="#local-6989586621679052135"><span class="hs-identifier hs-var">aux</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Type
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1235"></span><span>
</span><span id="line-1236"></span><span class="hs-comment">------------------------------------------------------------------------</span><span>
</span><span id="line-1237"></span><span class="hs-comment">-- Field generation parameters</span><span>
</span><span id="line-1238"></span><span class="hs-comment">------------------------------------------------------------------------</span><span>
</span><span id="line-1239"></span><span>
</span><span id="line-1240"></span><span class="hs-comment">{- |
Rules used to generate lenses. The fields are intentionally not exported; to create your own rules, see lenses in the &#8220;Configuring lens rules&#8221; section. You'd have to customise one of the existing rulesets; for an example of doing that, see 'makeLensesWith'.
-}</span><span>
</span><span id="line-1243"></span><span class="hs-keyword">data</span><span> </span><span id="LensRules"><span class="annot"><a href="Lens.Micro.TH.html#LensRules"><span class="hs-identifier hs-var">LensRules</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="LensRules"><span class="annot"><a href="Lens.Micro.TH.html#LensRules"><span class="hs-identifier hs-var">LensRules</span></a></span></span><span>
</span><span id="line-1244"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="_simpleLenses"><span class="annot"><span class="annottext">LensRules -&gt; Bool
</span><a href="Lens.Micro.TH.html#_simpleLenses"><span class="hs-identifier hs-var hs-var">_simpleLenses</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1245"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_generateSigs"><span class="annot"><span class="annottext">LensRules -&gt; Bool
</span><a href="Lens.Micro.TH.html#_generateSigs"><span class="hs-identifier hs-var hs-var">_generateSigs</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1246"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_generateClasses"><span class="annot"><span class="annottext">LensRules -&gt; Bool
</span><a href="Lens.Micro.TH.html#_generateClasses"><span class="hs-identifier hs-var hs-var">_generateClasses</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1247"></span><span>  </span><span class="hs-comment">-- , _allowIsos       :: Bool</span><span>
</span><span id="line-1248"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_allowUpdates"><span class="annot"><span class="annottext">LensRules -&gt; Bool
</span><a href="Lens.Micro.TH.html#_allowUpdates"><span class="hs-identifier hs-var hs-var">_allowUpdates</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-comment">-- Allow Lens/Traversal (otherwise Getter/Fold)</span><span>
</span><span id="line-1249"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_lazyPatterns"><span class="annot"><span class="annottext">LensRules -&gt; Bool
</span><a href="Lens.Micro.TH.html#_lazyPatterns"><span class="hs-identifier hs-var hs-var">_lazyPatterns</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1250"></span><span>  </span><span class="hs-comment">-- Type Name -&gt; Field Names -&gt; Target Field Name -&gt; Definition Names</span><span>
</span><span id="line-1251"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_fieldToDef"><span class="annot"><span class="annottext">LensRules -&gt; Name -&gt; [Name] -&gt; Name -&gt; [DefName]
</span><a href="Lens.Micro.TH.html#_fieldToDef"><span class="hs-identifier hs-var hs-var">_fieldToDef</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Lens.Micro.TH.html#DefName"><span class="hs-identifier hs-type">DefName</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1252"></span><span>  </span><span class="hs-comment">-- Type Name -&gt; (Class Name, Top Method)</span><span>
</span><span id="line-1253"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_classyLenses"><span class="annot"><span class="annottext">LensRules -&gt; Name -&gt; Maybe (Name, Name)
</span><a href="Lens.Micro.TH.html#_classyLenses"><span class="hs-identifier hs-var hs-var">_classyLenses</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span>
</span><span id="line-1254"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-1255"></span><span>
</span><span id="line-1256"></span><span class="hs-comment">{- |
Name to give to a generated lens (used in 'lensField').
-}</span><span>
</span><span id="line-1259"></span><span class="hs-keyword">data</span><span> </span><span id="DefName"><span class="annot"><a href="Lens.Micro.TH.html#DefName"><span class="hs-identifier hs-var">DefName</span></a></span></span><span>
</span><span id="line-1260"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="TopName"><span class="annot"><a href="Lens.Micro.TH.html#TopName"><span class="hs-identifier hs-var">TopName</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>          </span><span class="hs-comment">-- ^ Simple top-level definiton name</span><span>
</span><span id="line-1261"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="MethodName"><span class="annot"><a href="Lens.Micro.TH.html#MethodName"><span class="hs-identifier hs-var">MethodName</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>  </span><span class="hs-comment">-- ^ 'makeFields'-style class name and method name</span><span>
</span><span id="line-1262"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679052128"><span id="local-6989586621679052130"><span id="local-6989586621679052132"><span class="annot"><span class="annottext">Int -&gt; DefName -&gt; String -&gt; String
[DefName] -&gt; String -&gt; String
DefName -&gt; String
(Int -&gt; DefName -&gt; String -&gt; String)
-&gt; (DefName -&gt; String)
-&gt; ([DefName] -&gt; String -&gt; String)
-&gt; Show DefName
forall a.
(Int -&gt; a -&gt; String -&gt; String)
-&gt; (a -&gt; String) -&gt; ([a] -&gt; String -&gt; String) -&gt; Show a
showList :: [DefName] -&gt; String -&gt; String
$cshowList :: [DefName] -&gt; String -&gt; String
show :: DefName -&gt; String
$cshow :: DefName -&gt; String
showsPrec :: Int -&gt; DefName -&gt; String -&gt; String
$cshowsPrec :: Int -&gt; DefName -&gt; String -&gt; String
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679052123"><span id="local-6989586621679052125"><span class="annot"><span class="annottext">DefName -&gt; DefName -&gt; Bool
(DefName -&gt; DefName -&gt; Bool)
-&gt; (DefName -&gt; DefName -&gt; Bool) -&gt; Eq DefName
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: DefName -&gt; DefName -&gt; Bool
$c/= :: DefName -&gt; DefName -&gt; Bool
== :: DefName -&gt; DefName -&gt; Bool
$c== :: DefName -&gt; DefName -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679052107"><span id="local-6989586621679052109"><span id="local-6989586621679052111"><span id="local-6989586621679052113"><span id="local-6989586621679052115"><span id="local-6989586621679052117"><span id="local-6989586621679052119"><span class="annot"><span class="annottext">Eq DefName
Eq DefName
-&gt; (DefName -&gt; DefName -&gt; Ordering)
-&gt; (DefName -&gt; DefName -&gt; Bool)
-&gt; (DefName -&gt; DefName -&gt; Bool)
-&gt; (DefName -&gt; DefName -&gt; Bool)
-&gt; (DefName -&gt; DefName -&gt; Bool)
-&gt; (DefName -&gt; DefName -&gt; DefName)
-&gt; (DefName -&gt; DefName -&gt; DefName)
-&gt; Ord DefName
DefName -&gt; DefName -&gt; Bool
DefName -&gt; DefName -&gt; Ordering
DefName -&gt; DefName -&gt; DefName
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
min :: DefName -&gt; DefName -&gt; DefName
$cmin :: DefName -&gt; DefName -&gt; DefName
max :: DefName -&gt; DefName -&gt; DefName
$cmax :: DefName -&gt; DefName -&gt; DefName
&gt;= :: DefName -&gt; DefName -&gt; Bool
$c&gt;= :: DefName -&gt; DefName -&gt; Bool
&gt; :: DefName -&gt; DefName -&gt; Bool
$c&gt; :: DefName -&gt; DefName -&gt; Bool
&lt;= :: DefName -&gt; DefName -&gt; Bool
$c&lt;= :: DefName -&gt; DefName -&gt; Bool
&lt; :: DefName -&gt; DefName -&gt; Bool
$c&lt; :: DefName -&gt; DefName -&gt; Bool
compare :: DefName -&gt; DefName -&gt; Ordering
$ccompare :: DefName -&gt; DefName -&gt; Ordering
$cp1Ord :: Eq DefName
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-1263"></span><span>
</span><span id="line-1264"></span><span>
</span><span id="line-1265"></span><span class="hs-comment">------------------------------------------------------------------------</span><span>
</span><span id="line-1266"></span><span class="hs-comment">-- Miscellaneous utility functions</span><span>
</span><span id="line-1267"></span><span class="hs-comment">------------------------------------------------------------------------</span><span>
</span><span id="line-1268"></span><span>
</span><span id="line-1269"></span><span id="local-6989586621679052815"><span id="local-6989586621679052816"><span id="local-6989586621679052817"><span class="annot"><a href="Lens.Micro.TH.html#liftState"><span class="hs-identifier hs-type">liftState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679052817"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679052817"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679052816"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="annot"><a href="#local-6989586621679052815"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679052817"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679052816"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-1270"></span><span id="liftState"><span class="annot"><span class="annottext">liftState :: m a -&gt; StateT s m a
</span><a href="Lens.Micro.TH.html#liftState"><span class="hs-identifier hs-var hs-var">liftState</span></a></span></span><span> </span><span id="local-6989586621679052105"><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679052105"><span class="hs-identifier hs-var">act</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(s -&gt; m (a, s)) -&gt; StateT s m a
forall s (m :: * -&gt; *) a. (s -&gt; m (a, s)) -&gt; StateT s m a
</span><span class="hs-identifier hs-var">StateT</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679052103"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679052103"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(a -&gt; (a, s)) -&gt; m a -&gt; m (a, s)
forall (m :: * -&gt; *) a1 r. Monad m =&gt; (a1 -&gt; r) -&gt; m a1 -&gt; m r
</span><span class="hs-identifier hs-var">liftM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a -&gt; s -&gt; (a, s)) -&gt; s -&gt; a -&gt; (a, s)
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679052103"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679052105"><span class="hs-identifier hs-var">act</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1271"></span></pre></body></html>