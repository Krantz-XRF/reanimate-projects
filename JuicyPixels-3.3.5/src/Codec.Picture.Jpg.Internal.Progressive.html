<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE TupleSections #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE TypeSynonymInstances #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><span id="line-6"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Codec.Picture.Jpg.Internal.Progressive</span><span>
</span><span id="line-7"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Codec.Picture.Jpg.Internal.Common.html#JpgUnpackerParameter"><span class="hs-identifier">JpgUnpackerParameter</span></a></span><span class="hs-special">(</span><span> </span><span class="hs-glyph">..</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-8"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Codec.Picture.Jpg.Internal.Progressive.html#progressiveUnpack"><span class="hs-identifier">progressiveUnpack</span></a></span><span>
</span><span id="line-9"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span class="hs-cpp">

#if !MIN_VERSION_base(4,8,0)
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Applicative</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">pure</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-operator">&lt;$&gt;</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">when</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">unless</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">forM_</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.ST</span></span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">ST</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans</span></span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">lift</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Bits</span></span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-operator">(.&amp;.)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(.|.)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">unsafeShiftL</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Int</span></span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">Int16</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Int32</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">B</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Lazy</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">V</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector.Storable</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">VS</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector</span></span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector.Mutable</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector.Storable.Mutable</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">MS</span></span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Codec.Picture.Types.html"><span class="hs-identifier">Codec.Picture.Types</span></a></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Codec.Picture.BitWriter.html"><span class="hs-identifier">Codec.Picture.BitWriter</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Codec.Picture.Jpg.Internal.Common.html"><span class="hs-identifier">Codec.Picture.Jpg.Internal.Common</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Codec.Picture.Jpg.Internal.Types.html"><span class="hs-identifier">Codec.Picture.Jpg.Internal.Types</span></a></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Codec.Picture.Jpg.Internal.DefaultTable.html"><span class="hs-identifier">Codec.Picture.Jpg.Internal.DefaultTable</span></a></span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span class="annot"><a href="Codec.Picture.Jpg.Internal.Progressive.html#createMcuLineIndices"><span class="hs-identifier hs-type">createMcuLineIndices</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Codec.Picture.Jpg.Internal.Types.html#JpgComponent"><span class="hs-identifier hs-type">JpgComponent</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V.Vector</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">VS.Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span id="createMcuLineIndices"><span class="annot"><span class="annottext">createMcuLineIndices :: JpgComponent -&gt; Int -&gt; Int -&gt; Vector (Vector Int)
</span><a href="Codec.Picture.Jpg.Internal.Progressive.html#createMcuLineIndices"><span class="hs-identifier hs-var hs-var">createMcuLineIndices</span></a></span></span><span> </span><span id="local-6989586621679167622"><span class="annot"><span class="annottext">JpgComponent
</span><a href="#local-6989586621679167622"><span class="hs-identifier hs-var">param</span></a></span></span><span> </span><span id="local-6989586621679167621"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167621"><span class="hs-identifier hs-var">imgWidth</span></a></span></span><span> </span><span id="local-6989586621679167620"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167620"><span class="hs-identifier hs-var">mcuWidth</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-36"></span><span> </span><span class="annot"><span class="annottext">[Vector Int] -&gt; Vector (Vector Int)
forall a. [a] -&gt; Vector a
</span><span class="hs-identifier hs-var">V.fromList</span></span><span> </span><span class="annot"><span class="annottext">([Vector Int] -&gt; Vector (Vector Int))
-&gt; [Vector Int] -&gt; Vector (Vector Int)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; Vector Int
forall a. Storable a =&gt; [a] -&gt; Vector a
</span><span class="hs-identifier hs-var">VS.fromList</span></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; Vector Int) -&gt; [[Int]] -&gt; [Vector Int]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679167616"><span class="hs-identifier hs-var">indexSolo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679167615"><span class="hs-identifier hs-var">indexMulti</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-37"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679167614"><span class="annot"><span class="annottext">compW :: Int
</span><a href="#local-6989586621679167614"><span class="hs-identifier hs-var hs-var">compW</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(Word8 -&gt; Int) -&gt; Word8 -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">JpgComponent -&gt; Word8
</span><a href="Codec.Picture.Jpg.Internal.Types.html#horizontalSamplingFactor"><span class="hs-identifier hs-var hs-var">horizontalSamplingFactor</span></a></span><span> </span><span class="annot"><span class="annottext">JpgComponent
</span><a href="#local-6989586621679167622"><span class="hs-identifier hs-var">param</span></a></span><span>
</span><span id="line-38"></span><span>        </span><span id="local-6989586621679167612"><span class="annot"><span class="annottext">compH :: Int
</span><a href="#local-6989586621679167612"><span class="hs-identifier hs-var hs-var">compH</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(Word8 -&gt; Int) -&gt; Word8 -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">JpgComponent -&gt; Word8
</span><a href="Codec.Picture.Jpg.Internal.Types.html#verticalSamplingFactor"><span class="hs-identifier hs-var hs-var">verticalSamplingFactor</span></a></span><span> </span><span class="annot"><span class="annottext">JpgComponent
</span><a href="#local-6989586621679167622"><span class="hs-identifier hs-var">param</span></a></span><span>
</span><span id="line-39"></span><span>        </span><span id="local-6989586621679167610"><span class="annot"><span class="annottext">imageBlockSize :: Int
</span><a href="#local-6989586621679167610"><span class="hs-identifier hs-var hs-var">imageBlockSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="Codec.Picture.Jpg.Internal.Common.html#toBlockSize"><span class="hs-identifier hs-var">toBlockSize</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167621"><span class="hs-identifier hs-var">imgWidth</span></a></span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span>        </span><span class="hs-comment">-- if the displayed MCU block is only displayed in half (like with</span><span>
</span><span id="line-42"></span><span>        </span><span class="hs-comment">-- width 500 then we loose one macroblock of the MCU at the end of</span><span>
</span><span id="line-43"></span><span>        </span><span class="hs-comment">-- the line. Previous implementation which naively used full mcu</span><span>
</span><span id="line-44"></span><span>        </span><span class="hs-comment">-- was wrong. Only taking into account visible macroblocks</span><span>
</span><span id="line-45"></span><span>        </span><span id="local-6989586621679167616"><span class="annot"><span class="annottext">indexSolo :: [Int]
</span><a href="#local-6989586621679167616"><span class="hs-identifier hs-var hs-var">indexSolo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167608"><span class="hs-identifier hs-var">base</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167606"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-46"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679167605"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167605"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167612"><span class="hs-identifier hs-var">compH</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span>
</span><span id="line-47"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679167608"><span class="annot"><span class="annottext">base :: Int
</span><a href="#local-6989586621679167608"><span class="hs-identifier hs-var hs-var">base</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167605"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167620"><span class="hs-identifier hs-var">mcuWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167614"><span class="hs-identifier hs-var">compW</span></a></span><span>
</span><span id="line-48"></span><span>            </span><span class="hs-special">,</span><span> </span><span id="local-6989586621679167606"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167606"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167610"><span class="hs-identifier hs-var">imageBlockSize</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span>        </span><span id="local-6989586621679167615"><span class="annot"><span class="annottext">indexMulti :: [Int]
</span><a href="#local-6989586621679167615"><span class="hs-identifier hs-var hs-var">indexMulti</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-51"></span><span>            </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167603"><span class="hs-identifier hs-var">mcu</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167602"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167620"><span class="hs-identifier hs-var">mcuWidth</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167614"><span class="hs-identifier hs-var">compW</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167601"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-52"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679167603"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167603"><span class="hs-identifier hs-var">mcu</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167620"><span class="hs-identifier hs-var">mcuWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span>
</span><span id="line-53"></span><span>                </span><span class="hs-special">,</span><span> </span><span id="local-6989586621679167602"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167602"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167612"><span class="hs-identifier hs-var">compH</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span>
</span><span id="line-54"></span><span>                </span><span class="hs-special">,</span><span> </span><span id="local-6989586621679167601"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167601"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167614"><span class="hs-identifier hs-var">compW</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span id="local-6989586621679167600"><span class="annot"><a href="Codec.Picture.Jpg.Internal.Progressive.html#decodeFirstDC"><span class="hs-identifier hs-type">decodeFirstDC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Codec.Picture.Jpg.Internal.Common.html#JpgUnpackerParameter"><span class="hs-identifier hs-type">JpgUnpackerParameter</span></a></span><span>
</span><span id="line-57"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MS.STVector</span></span><span> </span><span class="annot"><a href="#local-6989586621679167600"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int16</span></span><span>
</span><span id="line-58"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Picture.Jpg.Internal.Types.html#MutableMacroBlock"><span class="hs-identifier hs-type">MutableMacroBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679167600"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int16</span></span><span>
</span><span id="line-59"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int32</span></span><span>
</span><span id="line-60"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Picture.BitWriter.html#BoolReader"><span class="hs-identifier hs-type">BoolReader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679167600"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int32</span></span></span><span>
</span><span id="line-61"></span><span id="decodeFirstDC"><span class="annot"><span class="annottext">decodeFirstDC :: JpgUnpackerParameter
-&gt; STVector s Int16
-&gt; STVector s Int16
-&gt; Int32
-&gt; BoolReader s Int32
</span><a href="Codec.Picture.Jpg.Internal.Progressive.html#decodeFirstDC"><span class="hs-identifier hs-var hs-var">decodeFirstDC</span></a></span></span><span> </span><span id="local-6989586621679167598"><span class="annot"><span class="annottext">JpgUnpackerParameter
</span><a href="#local-6989586621679167598"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span id="local-6989586621679167597"><span class="annot"><span class="annottext">STVector s Int16
</span><a href="#local-6989586621679167597"><span class="hs-identifier hs-var">dcCoeffs</span></a></span></span><span> </span><span id="local-6989586621679167596"><span class="annot"><span class="annottext">STVector s Int16
</span><a href="#local-6989586621679167596"><span class="hs-identifier hs-var">block</span></a></span></span><span> </span><span id="local-6989586621679167595"><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621679167595"><span class="hs-identifier hs-var">eobrun</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateT BoolState (ST s) ()
</span><a href="#local-6989586621679167594"><span class="hs-identifier hs-var">unpack</span></a></span><span> </span><span class="annot"><span class="annottext">StateT BoolState (ST s) ()
-&gt; BoolReader s Int32 -&gt; BoolReader s Int32
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int32 -&gt; BoolReader s Int32
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621679167595"><span class="hs-identifier hs-var">eobrun</span></a></span><span>
</span><span id="line-62"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679167594"><span class="annot"><span class="annottext">unpack :: StateT BoolState (ST s) ()
</span><a href="#local-6989586621679167594"><span class="hs-identifier hs-var hs-var">unpack</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-63"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621679167593"><span class="annot"><span class="annottext">Int16
</span><a href="#local-6989586621679167593"><span class="hs-identifier hs-var">dcDeltaCoefficient</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HuffmanPackedTree -&gt; BoolReader s Int16
forall s. HuffmanPackedTree -&gt; BoolReader s Int16
</span><a href="Codec.Picture.Jpg.Internal.Common.html#dcCoefficientDecode"><span class="hs-identifier hs-var">dcCoefficientDecode</span></a></span><span> </span><span class="annot"><span class="annottext">(HuffmanPackedTree -&gt; BoolReader s Int16)
-&gt; HuffmanPackedTree -&gt; BoolReader s Int16
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">JpgUnpackerParameter -&gt; HuffmanPackedTree
</span><a href="Codec.Picture.Jpg.Internal.Common.html#dcHuffmanTree"><span class="hs-identifier hs-var hs-var">dcHuffmanTree</span></a></span><span> </span><span class="annot"><span class="annottext">JpgUnpackerParameter
</span><a href="#local-6989586621679167598"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-64"></span><span>          </span><span id="local-6989586621679167590"><span class="annot"><span class="annottext">Int16
</span><a href="#local-6989586621679167590"><span class="hs-identifier hs-var">previousDc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ST s Int16 -&gt; BoolReader s Int16
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(ST s Int16 -&gt; BoolReader s Int16)
-&gt; ST s Int16 -&gt; BoolReader s Int16
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">STVector s Int16
MVector (PrimState (ST s)) Int16
</span><a href="#local-6989586621679167597"><span class="hs-identifier hs-var">dcCoeffs</span></a></span><span> </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) Int16 -&gt; Int -&gt; ST s Int16
forall (m :: * -&gt; *) a.
(PrimMonad m, Storable a) =&gt;
MVector (PrimState m) a -&gt; Int -&gt; m a
</span><span class="hs-operator hs-var">`MS.unsafeRead`</span></span><span> </span><span class="annot"><span class="annottext">JpgUnpackerParameter -&gt; Int
</span><a href="Codec.Picture.Jpg.Internal.Common.html#componentIndex"><span class="hs-identifier hs-var hs-var">componentIndex</span></a></span><span> </span><span class="annot"><span class="annottext">JpgUnpackerParameter
</span><a href="#local-6989586621679167598"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-65"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679167587"><span class="annot"><span class="annottext">neoDcCoefficient :: Int16
</span><a href="#local-6989586621679167587"><span class="hs-identifier hs-var hs-var">neoDcCoefficient</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int16
</span><a href="#local-6989586621679167590"><span class="hs-identifier hs-var">previousDc</span></a></span><span> </span><span class="annot"><span class="annottext">Int16 -&gt; Int16 -&gt; Int16
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int16
</span><a href="#local-6989586621679167593"><span class="hs-identifier hs-var">dcDeltaCoefficient</span></a></span><span>
</span><span id="line-66"></span><span>              </span><span id="local-6989586621679167586"><span class="annot"><span class="annottext">approxLow :: Int
</span><a href="#local-6989586621679167586"><span class="hs-identifier hs-var hs-var">approxLow</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; Int
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((Int, Int) -&gt; Int) -&gt; (Int, Int) -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">JpgUnpackerParameter -&gt; (Int, Int)
</span><a href="Codec.Picture.Jpg.Internal.Common.html#successiveApprox"><span class="hs-identifier hs-var hs-var">successiveApprox</span></a></span><span> </span><span class="annot"><span class="annottext">JpgUnpackerParameter
</span><a href="#local-6989586621679167598"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-67"></span><span>              </span><span id="local-6989586621679167584"><span class="annot"><span class="annottext">scaledDc :: Int16
</span><a href="#local-6989586621679167584"><span class="hs-identifier hs-var hs-var">scaledDc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int16
</span><a href="#local-6989586621679167587"><span class="hs-identifier hs-var">neoDcCoefficient</span></a></span><span> </span><span class="annot"><span class="annottext">Int16 -&gt; Int -&gt; Int16
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`unsafeShiftL`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167586"><span class="hs-identifier hs-var">approxLow</span></a></span><span>
</span><span id="line-68"></span><span>          </span><span class="annot"><span class="annottext">ST s () -&gt; StateT BoolState (ST s) ()
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(ST s () -&gt; StateT BoolState (ST s) ())
-&gt; ST s () -&gt; StateT BoolState (ST s) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">STVector s Int16
MVector (PrimState (ST s)) Int16
</span><a href="#local-6989586621679167596"><span class="hs-identifier hs-var">block</span></a></span><span> </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) Int16 -&gt; Int -&gt; Int16 -&gt; ST s ()
forall (m :: * -&gt; *) a.
(PrimMonad m, Storable a) =&gt;
MVector (PrimState m) a -&gt; Int -&gt; a -&gt; m ()
</span><span class="hs-operator hs-var">`MS.unsafeWrite`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int16
</span><a href="#local-6989586621679167584"><span class="hs-identifier hs-var">scaledDc</span></a></span><span> </span><span>
</span><span id="line-69"></span><span>          </span><span class="annot"><span class="annottext">ST s () -&gt; StateT BoolState (ST s) ()
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(ST s () -&gt; StateT BoolState (ST s) ())
-&gt; ST s () -&gt; StateT BoolState (ST s) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">STVector s Int16
MVector (PrimState (ST s)) Int16
</span><a href="#local-6989586621679167597"><span class="hs-identifier hs-var">dcCoeffs</span></a></span><span> </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) Int16 -&gt; Int -&gt; Int16 -&gt; ST s ()
forall (m :: * -&gt; *) a.
(PrimMonad m, Storable a) =&gt;
MVector (PrimState m) a -&gt; Int -&gt; a -&gt; m ()
</span><span class="hs-operator hs-var">`MS.unsafeWrite`</span></span><span> </span><span class="annot"><span class="annottext">JpgUnpackerParameter -&gt; Int
</span><a href="Codec.Picture.Jpg.Internal.Common.html#componentIndex"><span class="hs-identifier hs-var hs-var">componentIndex</span></a></span><span> </span><span class="annot"><span class="annottext">JpgUnpackerParameter
</span><a href="#local-6989586621679167598"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int16
</span><a href="#local-6989586621679167587"><span class="hs-identifier hs-var">neoDcCoefficient</span></a></span><span>
</span><span id="line-70"></span><span>
</span><span id="line-71"></span><span id="local-6989586621679167581"><span id="local-6989586621679167582"><span class="annot"><a href="Codec.Picture.Jpg.Internal.Progressive.html#decodeRefineDc"><span class="hs-identifier hs-type">decodeRefineDc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Codec.Picture.Jpg.Internal.Common.html#JpgUnpackerParameter"><span class="hs-identifier hs-type">JpgUnpackerParameter</span></a></span><span>
</span><span id="line-72"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679167582"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-73"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Picture.Jpg.Internal.Types.html#MutableMacroBlock"><span class="hs-identifier hs-type">MutableMacroBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679167581"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int16</span></span><span>
</span><span id="line-74"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int32</span></span><span>
</span><span id="line-75"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Picture.BitWriter.html#BoolReader"><span class="hs-identifier hs-type">BoolReader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679167581"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int32</span></span></span></span><span>
</span><span id="line-76"></span><span id="decodeRefineDc"><span class="annot"><span class="annottext">decodeRefineDc :: JpgUnpackerParameter
-&gt; a -&gt; MutableMacroBlock s Int16 -&gt; Int32 -&gt; BoolReader s Int32
</span><a href="Codec.Picture.Jpg.Internal.Progressive.html#decodeRefineDc"><span class="hs-identifier hs-var hs-var">decodeRefineDc</span></a></span></span><span> </span><span id="local-6989586621679167579"><span class="annot"><span class="annottext">JpgUnpackerParameter
</span><a href="#local-6989586621679167579"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679167578"><span class="annot"><span class="annottext">MutableMacroBlock s Int16
</span><a href="#local-6989586621679167578"><span class="hs-identifier hs-var">block</span></a></span></span><span> </span><span id="local-6989586621679167577"><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621679167577"><span class="hs-identifier hs-var">eobrun</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateT BoolState (ST s) ()
</span><a href="#local-6989586621679167576"><span class="hs-identifier hs-var">unpack</span></a></span><span> </span><span class="annot"><span class="annottext">StateT BoolState (ST s) ()
-&gt; BoolReader s Int32 -&gt; BoolReader s Int32
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int32 -&gt; BoolReader s Int32
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621679167577"><span class="hs-identifier hs-var">eobrun</span></a></span><span>
</span><span id="line-77"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679167575"><span class="annot"><span class="annottext">approxLow :: Int
</span><a href="#local-6989586621679167575"><span class="hs-identifier hs-var hs-var">approxLow</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; Int
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((Int, Int) -&gt; Int) -&gt; (Int, Int) -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">JpgUnpackerParameter -&gt; (Int, Int)
</span><a href="Codec.Picture.Jpg.Internal.Common.html#successiveApprox"><span class="hs-identifier hs-var hs-var">successiveApprox</span></a></span><span> </span><span class="annot"><span class="annottext">JpgUnpackerParameter
</span><a href="#local-6989586621679167579"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-78"></span><span>        </span><span id="local-6989586621679167574"><span class="annot"><span class="annottext">plusOne :: Int16
</span><a href="#local-6989586621679167574"><span class="hs-identifier hs-var hs-var">plusOne</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int16
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Int16 -&gt; Int -&gt; Int16
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`unsafeShiftL`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167575"><span class="hs-identifier hs-var">approxLow</span></a></span><span>
</span><span id="line-79"></span><span>        </span><span id="local-6989586621679167576"><span class="annot"><span class="annottext">unpack :: StateT BoolState (ST s) ()
</span><a href="#local-6989586621679167576"><span class="hs-identifier hs-var hs-var">unpack</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-80"></span><span>            </span><span id="local-6989586621679167573"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679167573"><span class="hs-identifier hs-var">bit</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BoolReader s Bool
forall s. BoolReader s Bool
</span><a href="Codec.Picture.BitWriter.html#getNextBitJpg"><span class="hs-identifier hs-var">getNextBitJpg</span></a></span><span>
</span><span id="line-81"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; StateT BoolState (ST s) () -&gt; StateT BoolState (ST s) ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679167573"><span class="hs-identifier hs-var">bit</span></a></span><span> </span><span class="annot"><span class="annottext">(StateT BoolState (ST s) () -&gt; StateT BoolState (ST s) ())
-&gt; (ST s () -&gt; StateT BoolState (ST s) ())
-&gt; ST s ()
-&gt; StateT BoolState (ST s) ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ST s () -&gt; StateT BoolState (ST s) ()
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(ST s () -&gt; StateT BoolState (ST s) ())
-&gt; ST s () -&gt; StateT BoolState (ST s) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-82"></span><span>                </span><span id="local-6989586621679167570"><span class="annot"><span class="annottext">Int16
</span><a href="#local-6989586621679167570"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MutableMacroBlock s Int16
MVector (PrimState (ST s)) Int16
</span><a href="#local-6989586621679167578"><span class="hs-identifier hs-var">block</span></a></span><span> </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) Int16 -&gt; Int -&gt; ST s Int16
forall (m :: * -&gt; *) a.
(PrimMonad m, Storable a) =&gt;
MVector (PrimState m) a -&gt; Int -&gt; m a
</span><span class="hs-operator hs-var">`MS.unsafeRead`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-83"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MutableMacroBlock s Int16
MVector (PrimState (ST s)) Int16
</span><a href="#local-6989586621679167578"><span class="hs-identifier hs-var">block</span></a></span><span> </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) Int16 -&gt; Int -&gt; Int16 -&gt; ST s ()
forall (m :: * -&gt; *) a.
(PrimMonad m, Storable a) =&gt;
MVector (PrimState m) a -&gt; Int -&gt; a -&gt; m ()
</span><span class="hs-operator hs-var">`MS.unsafeWrite`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Int16 -&gt; ST s ()) -&gt; Int16 -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int16
</span><a href="#local-6989586621679167570"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Int16 -&gt; Int16 -&gt; Int16
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.|.</span></span><span> </span><span class="annot"><span class="annottext">Int16
</span><a href="#local-6989586621679167574"><span class="hs-identifier hs-var">plusOne</span></a></span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span id="local-6989586621679167696"><span id="local-6989586621679167697"><span class="annot"><a href="Codec.Picture.Jpg.Internal.Progressive.html#decodeFirstAc"><span class="hs-identifier hs-type">decodeFirstAc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Codec.Picture.Jpg.Internal.Common.html#JpgUnpackerParameter"><span class="hs-identifier hs-type">JpgUnpackerParameter</span></a></span><span>
</span><span id="line-86"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679167697"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-87"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Picture.Jpg.Internal.Types.html#MutableMacroBlock"><span class="hs-identifier hs-type">MutableMacroBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679167696"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int16</span></span><span>
</span><span id="line-88"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int32</span></span><span>
</span><span id="line-89"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Picture.BitWriter.html#BoolReader"><span class="hs-identifier hs-type">BoolReader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679167696"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int32</span></span></span></span><span>
</span><span id="line-90"></span><span id="decodeFirstAc"><span class="annot"><span class="annottext">decodeFirstAc :: JpgUnpackerParameter
-&gt; a -&gt; MutableMacroBlock s Int16 -&gt; Int32 -&gt; BoolReader s Int32
</span><a href="Codec.Picture.Jpg.Internal.Progressive.html#decodeFirstAc"><span class="hs-identifier hs-var hs-var">decodeFirstAc</span></a></span></span><span> </span><span id="local-6989586621679167568"><span class="annot"><span class="annottext">JpgUnpackerParameter
</span><a href="#local-6989586621679167568"><span class="hs-identifier hs-var">_params</span></a></span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679167567"><span class="annot"><span class="annottext">MutableMacroBlock s Int16
</span><a href="#local-6989586621679167567"><span class="hs-identifier hs-var">_block</span></a></span></span><span> </span><span id="local-6989586621679167566"><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621679167566"><span class="hs-identifier hs-var">eobrun</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621679167566"><span class="hs-identifier hs-var">eobrun</span></a></span><span> </span><span class="annot"><span class="annottext">Int32 -&gt; Int32 -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int32
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int32 -&gt; BoolReader s Int32
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Int32 -&gt; BoolReader s Int32) -&gt; Int32 -&gt; BoolReader s Int32
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621679167566"><span class="hs-identifier hs-var">eobrun</span></a></span><span> </span><span class="annot"><span class="annottext">Int32 -&gt; Int32 -&gt; Int32
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int32
</span><span class="hs-number">1</span></span><span>
</span><span id="line-91"></span><span class="annot"><a href="Codec.Picture.Jpg.Internal.Progressive.html#decodeFirstAc"><span class="hs-identifier hs-var">decodeFirstAc</span></a></span><span> </span><span id="local-6989586621679167564"><span class="annot"><span class="annottext">JpgUnpackerParameter
</span><a href="#local-6989586621679167564"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679167563"><span class="annot"><span class="annottext">MutableMacroBlock s Int16
</span><a href="#local-6989586621679167563"><span class="hs-identifier hs-var">block</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int32
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; BoolReader s Int32
</span><a href="#local-6989586621679167562"><span class="hs-identifier hs-var">unpack</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167561"><span class="hs-identifier hs-var">startIndex</span></a></span><span>
</span><span id="line-92"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679167561"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167561"><span class="hs-identifier hs-var">startIndex</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679167560"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167560"><span class="hs-identifier hs-var">maxIndex</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JpgUnpackerParameter -&gt; (Int, Int)
</span><a href="Codec.Picture.Jpg.Internal.Common.html#coefficientRange"><span class="hs-identifier hs-var hs-var">coefficientRange</span></a></span><span> </span><span class="annot"><span class="annottext">JpgUnpackerParameter
</span><a href="#local-6989586621679167564"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-93"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679167558"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167558"><span class="hs-identifier hs-var">low</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JpgUnpackerParameter -&gt; (Int, Int)
</span><a href="Codec.Picture.Jpg.Internal.Common.html#successiveApprox"><span class="hs-identifier hs-var hs-var">successiveApprox</span></a></span><span> </span><span class="annot"><span class="annottext">JpgUnpackerParameter
</span><a href="#local-6989586621679167564"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-94"></span><span>        </span><span id="local-6989586621679167562"><span class="annot"><span class="annottext">unpack :: Int -&gt; BoolReader s Int32
</span><a href="#local-6989586621679167562"><span class="hs-identifier hs-var hs-var">unpack</span></a></span></span><span> </span><span id="local-6989586621679167557"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167557"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167557"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167560"><span class="hs-identifier hs-var">maxIndex</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int32 -&gt; BoolReader s Int32
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Int32
</span><span class="hs-number">0</span></span><span>
</span><span id="line-95"></span><span>        </span><span class="annot"><a href="#local-6989586621679167562"><span class="hs-identifier hs-var">unpack</span></a></span><span> </span><span id="local-6989586621679167556"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167556"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-96"></span><span>            </span><span id="local-6989586621679167555"><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621679167555"><span class="hs-identifier hs-var">rrrrssss</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HuffmanPackedTree -&gt; BoolReader s (Int, Int)
forall s. HuffmanPackedTree -&gt; BoolReader s (Int, Int)
</span><a href="Codec.Picture.Jpg.Internal.Common.html#decodeRrrrSsss"><span class="hs-identifier hs-var">decodeRrrrSsss</span></a></span><span> </span><span class="annot"><span class="annottext">(HuffmanPackedTree -&gt; BoolReader s (Int, Int))
-&gt; HuffmanPackedTree -&gt; BoolReader s (Int, Int)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">JpgUnpackerParameter -&gt; HuffmanPackedTree
</span><a href="Codec.Picture.Jpg.Internal.Common.html#acHuffmanTree"><span class="hs-identifier hs-var hs-var">acHuffmanTree</span></a></span><span> </span><span class="annot"><span class="annottext">JpgUnpackerParameter
</span><a href="#local-6989586621679167564"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-97"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621679167555"><span class="hs-identifier hs-var">rrrrssss</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-98"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0xF</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; BoolReader s Int32
</span><a href="#local-6989586621679167562"><span class="hs-identifier hs-var">unpack</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; BoolReader s Int32) -&gt; Int -&gt; BoolReader s Int32
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167556"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">16</span></span><span>
</span><span id="line-99"></span><span>                </span><span class="hs-special">(</span><span>  </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int32 -&gt; BoolReader s Int32
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Int32
</span><span class="hs-number">0</span></span><span>
</span><span id="line-100"></span><span>                </span><span class="hs-special">(</span><span>  </span><span id="local-6989586621679167552"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167552"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int32 -&gt; Int32
forall a. (Num a, Bits a) =&gt; a -&gt; a
</span><a href="#local-6989586621679167551"><span class="hs-identifier hs-var">eobrun</span></a></span><span> </span><span class="annot"><span class="annottext">(Int32 -&gt; Int32) -&gt; BoolReader s Int32 -&gt; BoolReader s Int32
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; BoolReader s Int32
forall s. Int -&gt; BoolReader s Int32
</span><a href="Codec.Picture.Jpg.Internal.Common.html#unpackInt"><span class="hs-identifier hs-var">unpackInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167552"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-101"></span><span>                    </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679167551"><span class="annot"><span class="annottext">eobrun :: a -&gt; a
</span><a href="#local-6989586621679167551"><span class="hs-identifier hs-var hs-var">eobrun</span></a></span></span><span> </span><span id="local-6989586621679167549"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679167549"><span class="hs-identifier hs-var">lowBits</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Int -&gt; a
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`unsafeShiftL`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167552"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679167549"><span class="hs-identifier hs-var">lowBits</span></a></span><span>
</span><span id="line-102"></span><span>                </span><span class="hs-special">(</span><span>  </span><span id="local-6989586621679167548"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167548"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679167547"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167547"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-103"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679167546"><span class="annot"><span class="annottext">n' :: Int
</span><a href="#local-6989586621679167546"><span class="hs-identifier hs-var hs-var">n'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167556"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167548"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-104"></span><span>                    </span><span id="local-6989586621679167545"><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621679167545"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int32 -&gt; Int -&gt; Int32
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`unsafeShiftL`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167558"><span class="hs-identifier hs-var">low</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Int32 -&gt; Int32) -&gt; BoolReader s Int32 -&gt; BoolReader s Int32
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; BoolReader s Int32
forall s. Int -&gt; BoolReader s Int32
</span><a href="Codec.Picture.Jpg.Internal.Common.html#decodeInt"><span class="hs-identifier hs-var">decodeInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167547"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-105"></span><span>                    </span><span class="annot"><span class="annottext">ST s () -&gt; StateT BoolState (ST s) ()
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(ST s () -&gt; StateT BoolState (ST s) ())
-&gt; (Int16 -&gt; ST s ()) -&gt; Int16 -&gt; StateT BoolState (ST s) ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MutableMacroBlock s Int16
MVector (PrimState (ST s)) Int16
</span><a href="#local-6989586621679167563"><span class="hs-identifier hs-var">block</span></a></span><span> </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) Int16 -&gt; Int -&gt; Int16 -&gt; ST s ()
forall (m :: * -&gt; *) a.
(PrimMonad m, Storable a) =&gt;
MVector (PrimState m) a -&gt; Int -&gt; a -&gt; m ()
</span><span class="hs-operator hs-var">`MS.unsafeWrite`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167546"><span class="hs-identifier hs-var">n'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Int16 -&gt; StateT BoolState (ST s) ())
-&gt; Int16 -&gt; StateT BoolState (ST s) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int32 -&gt; Int16
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621679167545"><span class="hs-identifier hs-var">val</span></a></span><span>
</span><span id="line-106"></span><span>                    </span><span class="annot"><span class="annottext">Int -&gt; BoolReader s Int32
</span><a href="#local-6989586621679167562"><span class="hs-identifier hs-var">unpack</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; BoolReader s Int32) -&gt; Int -&gt; BoolReader s Int32
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167546"><span class="hs-identifier hs-var">n'</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span class="annot"><a href="Codec.Picture.Jpg.Internal.Progressive.html#decodeRefineAc"><span class="hs-identifier hs-type">decodeRefineAc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679167542"><span class="annot"><a href="#local-6989586621679167542"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621679167541"><span class="annot"><a href="#local-6989586621679167541"><span class="hs-identifier hs-type">s</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Codec.Picture.Jpg.Internal.Common.html#JpgUnpackerParameter"><span class="hs-identifier hs-type">JpgUnpackerParameter</span></a></span><span>
</span><span id="line-109"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679167542"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-110"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Picture.Jpg.Internal.Types.html#MutableMacroBlock"><span class="hs-identifier hs-type">MutableMacroBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679167541"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int16</span></span><span>
</span><span id="line-111"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int32</span></span><span>
</span><span id="line-112"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Picture.BitWriter.html#BoolReader"><span class="hs-identifier hs-type">BoolReader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679167541"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int32</span></span><span>
</span><span id="line-113"></span><span id="decodeRefineAc"><span class="annot"><span class="annottext">decodeRefineAc :: JpgUnpackerParameter
-&gt; a -&gt; MutableMacroBlock s Int16 -&gt; Int32 -&gt; BoolReader s Int32
</span><a href="Codec.Picture.Jpg.Internal.Progressive.html#decodeRefineAc"><span class="hs-identifier hs-var hs-var">decodeRefineAc</span></a></span></span><span> </span><span id="local-6989586621679167540"><span class="annot"><span class="annottext">JpgUnpackerParameter
</span><a href="#local-6989586621679167540"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679167539"><span class="annot"><span class="annottext">MutableMacroBlock s Int16
</span><a href="#local-6989586621679167539"><span class="hs-identifier hs-var">block</span></a></span></span><span> </span><span id="local-6989586621679167538"><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621679167538"><span class="hs-identifier hs-var">eobrun</span></a></span></span><span>
</span><span id="line-114"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621679167538"><span class="hs-identifier hs-var">eobrun</span></a></span><span> </span><span class="annot"><span class="annottext">Int32 -&gt; Int32 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int32
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; BoolReader s Int32
</span><a href="#local-6989586621679167537"><span class="hs-identifier hs-var">unpack</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167536"><span class="hs-identifier hs-var">startIndex</span></a></span><span>
</span><span id="line-115"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; StateT BoolState (ST s) ()
</span><a href="#local-6989586621679167535"><span class="hs-identifier hs-var">performEobRun</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167536"><span class="hs-identifier hs-var">startIndex</span></a></span><span> </span><span class="annot"><span class="annottext">StateT BoolState (ST s) ()
-&gt; BoolReader s Int32 -&gt; BoolReader s Int32
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int32 -&gt; BoolReader s Int32
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621679167538"><span class="hs-identifier hs-var">eobrun</span></a></span><span> </span><span class="annot"><span class="annottext">Int32 -&gt; Int32 -&gt; Int32
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int32
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679167536"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167536"><span class="hs-identifier hs-var">startIndex</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679167534"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167534"><span class="hs-identifier hs-var">maxIndex</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JpgUnpackerParameter -&gt; (Int, Int)
</span><a href="Codec.Picture.Jpg.Internal.Common.html#coefficientRange"><span class="hs-identifier hs-var hs-var">coefficientRange</span></a></span><span> </span><span class="annot"><span class="annottext">JpgUnpackerParameter
</span><a href="#local-6989586621679167540"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-117"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679167533"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167533"><span class="hs-identifier hs-var">low</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JpgUnpackerParameter -&gt; (Int, Int)
</span><a href="Codec.Picture.Jpg.Internal.Common.html#successiveApprox"><span class="hs-identifier hs-var hs-var">successiveApprox</span></a></span><span> </span><span class="annot"><span class="annottext">JpgUnpackerParameter
</span><a href="#local-6989586621679167540"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-118"></span><span>        </span><span id="local-6989586621679167532"><span class="annot"><span class="annottext">plusOne :: Int16
</span><a href="#local-6989586621679167532"><span class="hs-identifier hs-var hs-var">plusOne</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int16
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Int16 -&gt; Int -&gt; Int16
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`unsafeShiftL`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167533"><span class="hs-identifier hs-var">low</span></a></span><span>
</span><span id="line-119"></span><span>        </span><span id="local-6989586621679167531"><span class="annot"><span class="annottext">minusOne :: Int16
</span><a href="#local-6989586621679167531"><span class="hs-identifier hs-var hs-var">minusOne</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int16
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int16 -&gt; Int -&gt; Int16
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`unsafeShiftL`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167533"><span class="hs-identifier hs-var">low</span></a></span><span>
</span><span id="line-120"></span><span>
</span><span id="line-121"></span><span>        </span><span id="local-6989586621679167530"><span class="annot"><span class="annottext">getBitVal :: StateT BoolState (ST s) Int16
</span><a href="#local-6989586621679167530"><span class="hs-identifier hs-var hs-var">getBitVal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-122"></span><span>            </span><span id="local-6989586621679167529"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679167529"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BoolReader s Bool
forall s. BoolReader s Bool
</span><a href="Codec.Picture.BitWriter.html#getNextBitJpg"><span class="hs-identifier hs-var">getNextBitJpg</span></a></span><span>
</span><span id="line-123"></span><span>            </span><span class="annot"><span class="annottext">Int16 -&gt; StateT BoolState (ST s) Int16
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Int16 -&gt; StateT BoolState (ST s) Int16)
-&gt; Int16 -&gt; StateT BoolState (ST s) Int16
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679167529"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int16
</span><a href="#local-6989586621679167532"><span class="hs-identifier hs-var">plusOne</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Int16
</span><a href="#local-6989586621679167531"><span class="hs-identifier hs-var">minusOne</span></a></span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span>        </span><span id="local-6989586621679167535"><span class="annot"><span class="annottext">performEobRun :: Int -&gt; StateT BoolState (ST s) ()
</span><a href="#local-6989586621679167535"><span class="hs-identifier hs-var hs-var">performEobRun</span></a></span></span><span> </span><span id="local-6989586621679167528"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167528"><span class="hs-identifier hs-var">idx</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167528"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167534"><span class="hs-identifier hs-var">maxIndex</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; StateT BoolState (ST s) ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-126"></span><span>        </span><span class="annot"><a href="#local-6989586621679167535"><span class="hs-identifier hs-var">performEobRun</span></a></span><span> </span><span id="local-6989586621679167527"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167527"><span class="hs-identifier hs-var">idx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-127"></span><span>          </span><span id="local-6989586621679167526"><span class="annot"><span class="annottext">Int16
</span><a href="#local-6989586621679167526"><span class="hs-identifier hs-var">coeff</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ST s Int16 -&gt; StateT BoolState (ST s) Int16
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(ST s Int16 -&gt; StateT BoolState (ST s) Int16)
-&gt; ST s Int16 -&gt; StateT BoolState (ST s) Int16
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MutableMacroBlock s Int16
MVector (PrimState (ST s)) Int16
</span><a href="#local-6989586621679167539"><span class="hs-identifier hs-var">block</span></a></span><span> </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) Int16 -&gt; Int -&gt; ST s Int16
forall (m :: * -&gt; *) a.
(PrimMonad m, Storable a) =&gt;
MVector (PrimState m) a -&gt; Int -&gt; m a
</span><span class="hs-operator hs-var">`MS.unsafeRead`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167527"><span class="hs-identifier hs-var">idx</span></a></span><span>
</span><span id="line-128"></span><span>          </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int16
</span><a href="#local-6989586621679167526"><span class="hs-identifier hs-var">coeff</span></a></span><span> </span><span class="annot"><span class="annottext">Int16 -&gt; Int16 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Int16
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-129"></span><span>            </span><span id="local-6989586621679167524"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679167524"><span class="hs-identifier hs-var">bit</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BoolReader s Bool
forall s. BoolReader s Bool
</span><a href="Codec.Picture.BitWriter.html#getNextBitJpg"><span class="hs-identifier hs-var">getNextBitJpg</span></a></span><span>
</span><span id="line-130"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679167524"><span class="hs-identifier hs-var">bit</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int16
</span><a href="#local-6989586621679167526"><span class="hs-identifier hs-var">coeff</span></a></span><span> </span><span class="annot"><span class="annottext">Int16 -&gt; Int16 -&gt; Int16
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">Int16
</span><a href="#local-6989586621679167532"><span class="hs-identifier hs-var">plusOne</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int16 -&gt; Int16 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int16
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-131"></span><span>               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; StateT BoolState (ST s) ()
</span><a href="#local-6989586621679167535"><span class="hs-identifier hs-var">performEobRun</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; StateT BoolState (ST s) ())
-&gt; Int -&gt; StateT BoolState (ST s) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167527"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-132"></span><span>               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; StateT BoolState (ST s) ()
</span><a href="#local-6989586621679167535"><span class="hs-identifier hs-var">performEobRun</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; StateT BoolState (ST s) ())
-&gt; Int -&gt; StateT BoolState (ST s) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167527"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-133"></span><span>               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-134"></span><span>                   </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679167523"><span class="annot"><span class="annottext">newVal :: Int16
</span><a href="#local-6989586621679167523"><span class="hs-identifier hs-var hs-var">newVal</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int16
</span><a href="#local-6989586621679167526"><span class="hs-identifier hs-var">coeff</span></a></span><span> </span><span class="annot"><span class="annottext">Int16 -&gt; Int16 -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int16
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int16
</span><a href="#local-6989586621679167526"><span class="hs-identifier hs-var">coeff</span></a></span><span> </span><span class="annot"><span class="annottext">Int16 -&gt; Int16 -&gt; Int16
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int16
</span><a href="#local-6989586621679167532"><span class="hs-identifier hs-var">plusOne</span></a></span><span>
</span><span id="line-135"></span><span>                              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int16
</span><a href="#local-6989586621679167526"><span class="hs-identifier hs-var">coeff</span></a></span><span> </span><span class="annot"><span class="annottext">Int16 -&gt; Int16 -&gt; Int16
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int16
</span><a href="#local-6989586621679167531"><span class="hs-identifier hs-var">minusOne</span></a></span><span>
</span><span id="line-136"></span><span>                   </span><span class="annot"><span class="annottext">ST s () -&gt; StateT BoolState (ST s) ()
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(ST s () -&gt; StateT BoolState (ST s) ())
-&gt; ST s () -&gt; StateT BoolState (ST s) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MutableMacroBlock s Int16
MVector (PrimState (ST s)) Int16
</span><a href="#local-6989586621679167539"><span class="hs-identifier hs-var">block</span></a></span><span> </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) Int16 -&gt; Int -&gt; Int16 -&gt; ST s ()
forall (m :: * -&gt; *) a.
(PrimMonad m, Storable a) =&gt;
MVector (PrimState m) a -&gt; Int -&gt; a -&gt; m ()
</span><span class="hs-operator hs-var">`MS.unsafeWrite`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167527"><span class="hs-identifier hs-var">idx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int16
</span><a href="#local-6989586621679167523"><span class="hs-identifier hs-var">newVal</span></a></span><span>
</span><span id="line-137"></span><span>                   </span><span class="annot"><span class="annottext">Int -&gt; StateT BoolState (ST s) ()
</span><a href="#local-6989586621679167535"><span class="hs-identifier hs-var">performEobRun</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; StateT BoolState (ST s) ())
-&gt; Int -&gt; StateT BoolState (ST s) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167527"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-138"></span><span>          </span><span class="hs-keyword">else</span><span>
</span><span id="line-139"></span><span>            </span><span class="annot"><span class="annottext">Int -&gt; StateT BoolState (ST s) ()
</span><a href="#local-6989586621679167535"><span class="hs-identifier hs-var">performEobRun</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; StateT BoolState (ST s) ())
-&gt; Int -&gt; StateT BoolState (ST s) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167527"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span>        </span><span id="local-6989586621679167537"><span class="annot"><span class="annottext">unpack :: Int -&gt; BoolReader s Int32
</span><a href="#local-6989586621679167537"><span class="hs-identifier hs-var hs-var">unpack</span></a></span></span><span> </span><span id="local-6989586621679167522"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167522"><span class="hs-identifier hs-var">idx</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167522"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167534"><span class="hs-identifier hs-var">maxIndex</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int32 -&gt; BoolReader s Int32
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Int32
</span><span class="hs-number">0</span></span><span>
</span><span id="line-142"></span><span>        </span><span class="annot"><a href="#local-6989586621679167537"><span class="hs-identifier hs-var">unpack</span></a></span><span> </span><span id="local-6989586621679167521"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167521"><span class="hs-identifier hs-var">idx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-143"></span><span>            </span><span id="local-6989586621679167520"><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621679167520"><span class="hs-identifier hs-var">rrrrssss</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HuffmanPackedTree -&gt; BoolReader s (Int, Int)
forall s. HuffmanPackedTree -&gt; BoolReader s (Int, Int)
</span><a href="Codec.Picture.Jpg.Internal.Common.html#decodeRrrrSsss"><span class="hs-identifier hs-var">decodeRrrrSsss</span></a></span><span> </span><span class="annot"><span class="annottext">(HuffmanPackedTree -&gt; BoolReader s (Int, Int))
-&gt; HuffmanPackedTree -&gt; BoolReader s (Int, Int)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">JpgUnpackerParameter -&gt; HuffmanPackedTree
</span><a href="Codec.Picture.Jpg.Internal.Common.html#acHuffmanTree"><span class="hs-identifier hs-var hs-var">acHuffmanTree</span></a></span><span> </span><span class="annot"><span class="annottext">JpgUnpackerParameter
</span><a href="#local-6989586621679167540"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-144"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621679167520"><span class="hs-identifier hs-var">rrrrssss</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-145"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0xF</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-146"></span><span>                </span><span id="local-6989586621679167519"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167519"><span class="hs-identifier hs-var">idx'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; BoolReader s Int
</span><a href="#local-6989586621679167518"><span class="hs-identifier hs-var">updateCoeffs</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0xF</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167521"><span class="hs-identifier hs-var">idx</span></a></span><span>
</span><span id="line-147"></span><span>                </span><span class="annot"><span class="annottext">Int -&gt; BoolReader s Int32
</span><a href="#local-6989586621679167537"><span class="hs-identifier hs-var">unpack</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; BoolReader s Int32) -&gt; Int -&gt; BoolReader s Int32
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167519"><span class="hs-identifier hs-var">idx'</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-148"></span><span>
</span><span id="line-149"></span><span>              </span><span class="hs-special">(</span><span>  </span><span id="local-6989586621679167517"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167517"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-150"></span><span>                  </span><span id="local-6989586621679167516"><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621679167516"><span class="hs-identifier hs-var">lowBits</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; BoolReader s Int32
forall s. Int -&gt; BoolReader s Int32
</span><a href="Codec.Picture.Jpg.Internal.Common.html#unpackInt"><span class="hs-identifier hs-var">unpackInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167517"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-151"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679167515"><span class="annot"><span class="annottext">newEobRun :: Int32
</span><a href="#local-6989586621679167515"><span class="hs-identifier hs-var hs-var">newEobRun</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int32
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Int32 -&gt; Int -&gt; Int32
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`unsafeShiftL`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167517"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int32 -&gt; Int32 -&gt; Int32
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621679167516"><span class="hs-identifier hs-var">lowBits</span></a></span><span> </span><span class="annot"><span class="annottext">Int32 -&gt; Int32 -&gt; Int32
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int32
</span><span class="hs-number">1</span></span><span>
</span><span id="line-152"></span><span>                  </span><span class="annot"><span class="annottext">Int -&gt; StateT BoolState (ST s) ()
</span><a href="#local-6989586621679167535"><span class="hs-identifier hs-var">performEobRun</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167521"><span class="hs-identifier hs-var">idx</span></a></span><span>
</span><span id="line-153"></span><span>                  </span><span class="annot"><span class="annottext">Int32 -&gt; BoolReader s Int32
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621679167515"><span class="hs-identifier hs-var">newEobRun</span></a></span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span>              </span><span class="hs-special">(</span><span>  </span><span id="local-6989586621679167514"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167514"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-156"></span><span>                  </span><span id="local-6989586621679167513"><span class="annot"><span class="annottext">Int16
</span><a href="#local-6989586621679167513"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT BoolState (ST s) Int16
forall s. StateT BoolState (ST s) Int16
</span><a href="#local-6989586621679167530"><span class="hs-identifier hs-var">getBitVal</span></a></span><span>
</span><span id="line-157"></span><span>                  </span><span id="local-6989586621679167512"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167512"><span class="hs-identifier hs-var">idx'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; BoolReader s Int
</span><a href="#local-6989586621679167518"><span class="hs-identifier hs-var">updateCoeffs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167514"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167521"><span class="hs-identifier hs-var">idx</span></a></span><span>
</span><span id="line-158"></span><span>                  </span><span class="annot"><span class="annottext">Bool -&gt; StateT BoolState (ST s) () -&gt; StateT BoolState (ST s) ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167512"><span class="hs-identifier hs-var">idx'</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167534"><span class="hs-identifier hs-var">maxIndex</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(StateT BoolState (ST s) () -&gt; StateT BoolState (ST s) ())
-&gt; StateT BoolState (ST s) () -&gt; StateT BoolState (ST s) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-159"></span><span>                       </span><span class="annot"><span class="annottext">ST s () -&gt; StateT BoolState (ST s) ()
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(ST s () -&gt; StateT BoolState (ST s) ())
-&gt; ST s () -&gt; StateT BoolState (ST s) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MutableMacroBlock s Int16
MVector (PrimState (ST s)) Int16
</span><a href="#local-6989586621679167539"><span class="hs-identifier hs-var">block</span></a></span><span> </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) Int16 -&gt; Int -&gt; Int16 -&gt; ST s ()
forall (m :: * -&gt; *) a.
(PrimMonad m, Storable a) =&gt;
MVector (PrimState m) a -&gt; Int -&gt; a -&gt; m ()
</span><span class="hs-operator hs-var">`MS.unsafeWrite`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167512"><span class="hs-identifier hs-var">idx'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int16
</span><a href="#local-6989586621679167513"><span class="hs-identifier hs-var">val</span></a></span><span>
</span><span id="line-160"></span><span>                  </span><span class="annot"><span class="annottext">Int -&gt; BoolReader s Int32
</span><a href="#local-6989586621679167537"><span class="hs-identifier hs-var">unpack</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; BoolReader s Int32) -&gt; Int -&gt; BoolReader s Int32
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167512"><span class="hs-identifier hs-var">idx'</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-161"></span><span>
</span><span id="line-162"></span><span>        </span><span class="annot"><a href="#local-6989586621679167518"><span class="hs-identifier hs-type">updateCoeffs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Picture.BitWriter.html#BoolReader"><span class="hs-identifier hs-type">BoolReader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679167541"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-163"></span><span>        </span><span id="local-6989586621679167518"><span class="annot"><span class="annottext">updateCoeffs :: Int -&gt; Int -&gt; BoolReader s Int
</span><a href="#local-6989586621679167518"><span class="hs-identifier hs-var hs-var">updateCoeffs</span></a></span></span><span> </span><span id="local-6989586621679167510"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167510"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679167509"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167509"><span class="hs-identifier hs-var">idx</span></a></span></span><span>
</span><span id="line-164"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167510"><span class="hs-identifier hs-var">r</span></a></span><span>   </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; BoolReader s Int
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; BoolReader s Int) -&gt; Int -&gt; BoolReader s Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167509"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-165"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167509"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167534"><span class="hs-identifier hs-var">maxIndex</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; BoolReader s Int
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167509"><span class="hs-identifier hs-var">idx</span></a></span><span>
</span><span id="line-166"></span><span>        </span><span class="annot"><a href="#local-6989586621679167518"><span class="hs-identifier hs-var">updateCoeffs</span></a></span><span> </span><span id="local-6989586621679167507"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167507"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679167506"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167506"><span class="hs-identifier hs-var">idx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-167"></span><span>          </span><span id="local-6989586621679167505"><span class="annot"><span class="annottext">Int16
</span><a href="#local-6989586621679167505"><span class="hs-identifier hs-var">coeff</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ST s Int16 -&gt; StateT BoolState (ST s) Int16
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(ST s Int16 -&gt; StateT BoolState (ST s) Int16)
-&gt; ST s Int16 -&gt; StateT BoolState (ST s) Int16
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MutableMacroBlock s Int16
MVector (PrimState (ST s)) Int16
</span><a href="#local-6989586621679167539"><span class="hs-identifier hs-var">block</span></a></span><span> </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) Int16 -&gt; Int -&gt; ST s Int16
forall (m :: * -&gt; *) a.
(PrimMonad m, Storable a) =&gt;
MVector (PrimState m) a -&gt; Int -&gt; m a
</span><span class="hs-operator hs-var">`MS.unsafeRead`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167506"><span class="hs-identifier hs-var">idx</span></a></span><span>
</span><span id="line-168"></span><span>          </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int16
</span><a href="#local-6989586621679167505"><span class="hs-identifier hs-var">coeff</span></a></span><span> </span><span class="annot"><span class="annottext">Int16 -&gt; Int16 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Int16
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-169"></span><span>            </span><span id="local-6989586621679167504"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679167504"><span class="hs-identifier hs-var">bit</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BoolReader s Bool
forall s. BoolReader s Bool
</span><a href="Codec.Picture.BitWriter.html#getNextBitJpg"><span class="hs-identifier hs-var">getNextBitJpg</span></a></span><span>
</span><span id="line-170"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; StateT BoolState (ST s) () -&gt; StateT BoolState (ST s) ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679167504"><span class="hs-identifier hs-var">bit</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Int16
</span><a href="#local-6989586621679167505"><span class="hs-identifier hs-var">coeff</span></a></span><span> </span><span class="annot"><span class="annottext">Int16 -&gt; Int16 -&gt; Int16
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">Int16
</span><a href="#local-6989586621679167532"><span class="hs-identifier hs-var">plusOne</span></a></span><span> </span><span class="annot"><span class="annottext">Int16 -&gt; Int16 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int16
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(StateT BoolState (ST s) () -&gt; StateT BoolState (ST s) ())
-&gt; StateT BoolState (ST s) () -&gt; StateT BoolState (ST s) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-171"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679167502"><span class="annot"><span class="annottext">writeCoeff :: Int16
</span><a href="#local-6989586621679167502"><span class="hs-identifier hs-var hs-var">writeCoeff</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int16
</span><a href="#local-6989586621679167505"><span class="hs-identifier hs-var">coeff</span></a></span><span> </span><span class="annot"><span class="annottext">Int16 -&gt; Int16 -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int16
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int16
</span><a href="#local-6989586621679167505"><span class="hs-identifier hs-var">coeff</span></a></span><span> </span><span class="annot"><span class="annottext">Int16 -&gt; Int16 -&gt; Int16
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int16
</span><a href="#local-6989586621679167532"><span class="hs-identifier hs-var">plusOne</span></a></span><span>
</span><span id="line-172"></span><span>                             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int16
</span><a href="#local-6989586621679167505"><span class="hs-identifier hs-var">coeff</span></a></span><span> </span><span class="annot"><span class="annottext">Int16 -&gt; Int16 -&gt; Int16
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int16
</span><a href="#local-6989586621679167531"><span class="hs-identifier hs-var">minusOne</span></a></span><span>
</span><span id="line-173"></span><span>              </span><span class="annot"><span class="annottext">ST s () -&gt; StateT BoolState (ST s) ()
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(ST s () -&gt; StateT BoolState (ST s) ())
-&gt; ST s () -&gt; StateT BoolState (ST s) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MutableMacroBlock s Int16
MVector (PrimState (ST s)) Int16
</span><a href="#local-6989586621679167539"><span class="hs-identifier hs-var">block</span></a></span><span> </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) Int16 -&gt; Int -&gt; Int16 -&gt; ST s ()
forall (m :: * -&gt; *) a.
(PrimMonad m, Storable a) =&gt;
MVector (PrimState m) a -&gt; Int -&gt; a -&gt; m ()
</span><span class="hs-operator hs-var">`MS.unsafeWrite`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167506"><span class="hs-identifier hs-var">idx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int16
</span><a href="#local-6989586621679167502"><span class="hs-identifier hs-var">writeCoeff</span></a></span><span>
</span><span id="line-174"></span><span>            </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; BoolReader s Int
</span><a href="#local-6989586621679167518"><span class="hs-identifier hs-var">updateCoeffs</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167507"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; BoolReader s Int) -&gt; Int -&gt; BoolReader s Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167506"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-175"></span><span>          </span><span class="hs-keyword">else</span><span>
</span><span id="line-176"></span><span>            </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; BoolReader s Int
</span><a href="#local-6989586621679167518"><span class="hs-identifier hs-var">updateCoeffs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167507"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; BoolReader s Int) -&gt; Int -&gt; BoolReader s Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167506"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span class="hs-keyword">type</span><span> </span><span id="Unpacker"><span class="annot"><a href="Codec.Picture.Jpg.Internal.Progressive.html#Unpacker"><span class="hs-identifier hs-var">Unpacker</span></a></span></span><span> </span><span id="local-6989586621679167501"><span class="annot"><a href="#local-6989586621679167501"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-179"></span><span>    </span><span class="annot"><a href="Codec.Picture.Jpg.Internal.Common.html#JpgUnpackerParameter"><span class="hs-identifier hs-type">JpgUnpackerParameter</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MS.STVector</span></span><span> </span><span class="annot"><a href="#local-6989586621679167501"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int16</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Picture.Jpg.Internal.Types.html#MutableMacroBlock"><span class="hs-identifier hs-type">MutableMacroBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679167501"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int16</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int32</span></span><span>
</span><span id="line-180"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Picture.BitWriter.html#BoolReader"><span class="hs-identifier hs-type">BoolReader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679167501"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int32</span></span><span>
</span><span id="line-181"></span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span id="local-6989586621679167682"><span id="local-6989586621679167683"><span class="annot"><a href="Codec.Picture.Jpg.Internal.Progressive.html#prepareUnpacker"><span class="hs-identifier hs-type">prepareUnpacker</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Codec.Picture.Jpg.Internal.Common.html#JpgUnpackerParameter"><span class="hs-identifier hs-type">JpgUnpackerParameter</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679167683"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-184"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679167682"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V.Vector</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V.Vector</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Picture.Jpg.Internal.Common.html#JpgUnpackerParameter"><span class="hs-identifier hs-type">JpgUnpackerParameter</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Codec.Picture.Jpg.Internal.Progressive.html#Unpacker"><span class="hs-identifier hs-type">Unpacker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679167682"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-185"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.STVector</span></span><span> </span><span class="annot"><a href="#local-6989586621679167682"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Codec.Picture.BitWriter.html#BoolState"><span class="hs-identifier hs-type">BoolState</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-186"></span><span id="prepareUnpacker"><span class="annot"><span class="annottext">prepareUnpacker :: [([(JpgUnpackerParameter, a)], ByteString)]
-&gt; ST
     s
     (Vector (Vector (JpgUnpackerParameter, Unpacker s)),
      STVector s BoolState)
</span><a href="Codec.Picture.Jpg.Internal.Progressive.html#prepareUnpacker"><span class="hs-identifier hs-var hs-var">prepareUnpacker</span></a></span></span><span> </span><span id="local-6989586621679167499"><span class="annot"><span class="annottext">[([(JpgUnpackerParameter, a)], ByteString)]
</span><a href="#local-6989586621679167499"><span class="hs-identifier hs-var">lst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-187"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679167498"><span class="annot"><span class="annottext">boolStates :: Vector BoolState
</span><a href="#local-6989586621679167498"><span class="hs-identifier hs-var hs-var">boolStates</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[BoolState] -&gt; Vector BoolState
forall a. [a] -&gt; Vector a
</span><span class="hs-identifier hs-var">V.fromList</span></span><span> </span><span class="annot"><span class="annottext">([BoolState] -&gt; Vector BoolState)
-&gt; [BoolState] -&gt; Vector BoolState
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Vector
    (JpgUnpackerParameter,
     JpgUnpackerParameter
     -&gt; STVector Any Int16
     -&gt; STVector Any Int16
     -&gt; Int32
     -&gt; BoolReader Any Int32),
  BoolState)
 -&gt; BoolState)
-&gt; [(Vector
       (JpgUnpackerParameter,
        JpgUnpackerParameter
        -&gt; STVector Any Int16
        -&gt; STVector Any Int16
        -&gt; Int32
        -&gt; BoolReader Any Int32),
     BoolState)]
-&gt; [BoolState]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Vector
   (JpgUnpackerParameter,
    JpgUnpackerParameter
    -&gt; STVector Any Int16
    -&gt; STVector Any Int16
    -&gt; Int32
    -&gt; BoolReader Any Int32),
 BoolState)
-&gt; BoolState
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">[(Vector
    (JpgUnpackerParameter,
     JpgUnpackerParameter
     -&gt; STVector Any Int16
     -&gt; STVector Any Int16
     -&gt; Int32
     -&gt; BoolReader Any Int32),
  BoolState)]
forall s.
[(Vector
    (JpgUnpackerParameter,
     JpgUnpackerParameter
     -&gt; STVector s Int16
     -&gt; STVector s Int16
     -&gt; Int32
     -&gt; BoolReader s Int32),
  BoolState)]
</span><a href="#local-6989586621679167497"><span class="hs-identifier hs-var">infos</span></a></span><span>
</span><span id="line-188"></span><span>    </span><span id="local-6989586621679167496"><span class="annot"><span class="annottext">STVector s BoolState
</span><a href="#local-6989586621679167496"><span class="hs-identifier hs-var">vec</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Vector BoolState -&gt; ST s (MVector (PrimState (ST s)) BoolState)
forall (m :: * -&gt; *) a.
PrimMonad m =&gt;
Vector a -&gt; m (MVector (PrimState m) a)
</span><span class="hs-identifier hs-var">V.unsafeThaw</span></span><span> </span><span class="annot"><span class="annottext">Vector BoolState
</span><a href="#local-6989586621679167498"><span class="hs-identifier hs-var">boolStates</span></a></span><span>
</span><span id="line-189"></span><span>    </span><span class="annot"><span class="annottext">(Vector (Vector (JpgUnpackerParameter, Unpacker s)),
 STVector s BoolState)
-&gt; ST
     s
     (Vector (Vector (JpgUnpackerParameter, Unpacker s)),
      STVector s BoolState)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Vector (JpgUnpackerParameter, Unpacker s)]
-&gt; Vector (Vector (JpgUnpackerParameter, Unpacker s))
forall a. [a] -&gt; Vector a
</span><span class="hs-identifier hs-var">V.fromList</span></span><span> </span><span class="annot"><span class="annottext">([Vector (JpgUnpackerParameter, Unpacker s)]
 -&gt; Vector (Vector (JpgUnpackerParameter, Unpacker s)))
-&gt; [Vector (JpgUnpackerParameter, Unpacker s)]
-&gt; Vector (Vector (JpgUnpackerParameter, Unpacker s))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Vector (JpgUnpackerParameter, Unpacker s), BoolState)
 -&gt; Vector (JpgUnpackerParameter, Unpacker s))
-&gt; [(Vector (JpgUnpackerParameter, Unpacker s), BoolState)]
-&gt; [Vector (JpgUnpackerParameter, Unpacker s)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Vector (JpgUnpackerParameter, Unpacker s), BoolState)
-&gt; Vector (JpgUnpackerParameter, Unpacker s)
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(Vector (JpgUnpackerParameter, Unpacker s), BoolState)]
forall s.
[(Vector
    (JpgUnpackerParameter,
     JpgUnpackerParameter
     -&gt; STVector s Int16
     -&gt; STVector s Int16
     -&gt; Int32
     -&gt; BoolReader s Int32),
  BoolState)]
</span><a href="#local-6989586621679167497"><span class="hs-identifier hs-var">infos</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">STVector s BoolState
</span><a href="#local-6989586621679167496"><span class="hs-identifier hs-var">vec</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-190"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679167497"><span class="annot"><span class="annottext">infos :: [(Vector
    (JpgUnpackerParameter,
     JpgUnpackerParameter
     -&gt; STVector s Int16
     -&gt; STVector s Int16
     -&gt; Int32
     -&gt; BoolReader s Int32),
  BoolState)]
</span><a href="#local-6989586621679167497"><span class="hs-identifier hs-var hs-var">infos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(([(JpgUnpackerParameter, a)], ByteString)
 -&gt; (Vector
       (JpgUnpackerParameter,
        JpgUnpackerParameter
        -&gt; STVector s Int16
        -&gt; STVector s Int16
        -&gt; Int32
        -&gt; BoolReader s Int32),
     BoolState))
-&gt; [([(JpgUnpackerParameter, a)], ByteString)]
-&gt; [(Vector
       (JpgUnpackerParameter,
        JpgUnpackerParameter
        -&gt; STVector s Int16
        -&gt; STVector s Int16
        -&gt; Int32
        -&gt; BoolReader s Int32),
     BoolState)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">([(JpgUnpackerParameter, a)], ByteString)
-&gt; (Vector
      (JpgUnpackerParameter,
       JpgUnpackerParameter
       -&gt; STVector s Int16
       -&gt; STVector s Int16
       -&gt; Int32
       -&gt; BoolReader s Int32),
    BoolState)
forall b s.
([(JpgUnpackerParameter, b)], ByteString)
-&gt; (Vector
      (JpgUnpackerParameter,
       JpgUnpackerParameter
       -&gt; STVector s Int16
       -&gt; STVector s Int16
       -&gt; Int32
       -&gt; BoolReader s Int32),
    BoolState)
</span><a href="#local-6989586621679167494"><span class="hs-identifier hs-var">prepare</span></a></span><span> </span><span class="annot"><span class="annottext">[([(JpgUnpackerParameter, a)], ByteString)]
</span><a href="#local-6989586621679167499"><span class="hs-identifier hs-var">lst</span></a></span><span>
</span><span id="line-191"></span><span>        </span><span id="local-6989586621679167494"><span class="annot"><span class="annottext">prepare :: ([(JpgUnpackerParameter, b)], ByteString)
-&gt; (Vector
      (JpgUnpackerParameter,
       JpgUnpackerParameter
       -&gt; STVector s Int16
       -&gt; STVector s Int16
       -&gt; Int32
       -&gt; BoolReader s Int32),
    BoolState)
</span><a href="#local-6989586621679167494"><span class="hs-identifier hs-var hs-var">prepare</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char]
-&gt; (Vector
      (JpgUnpackerParameter,
       JpgUnpackerParameter
       -&gt; STVector s Int16
       -&gt; STVector s Int16
       -&gt; Int32
       -&gt; BoolReader s Int32),
    BoolState)
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;progressiveUnpack, no component&quot;</span></span><span>
</span><span id="line-192"></span><span>        </span><span class="annot"><a href="#local-6989586621679167494"><span class="hs-identifier hs-var">prepare</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679167492"><span class="annot"><span class="annottext">whole :: [(JpgUnpackerParameter, b)]
</span><a href="#local-6989586621679167492"><span class="hs-identifier hs-var">whole</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679167491"><span class="annot"><span class="annottext">JpgUnpackerParameter
</span><a href="#local-6989586621679167491"><span class="hs-identifier hs-var">param</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[(JpgUnpackerParameter, b)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">,</span><span> </span><span id="local-6989586621679167490"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679167490"><span class="hs-identifier hs-var">byteString</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-193"></span><span>         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(JpgUnpackerParameter,
  JpgUnpackerParameter
  -&gt; STVector s Int16
  -&gt; STVector s Int16
  -&gt; Int32
  -&gt; BoolReader s Int32)]
-&gt; Vector
     (JpgUnpackerParameter,
      JpgUnpackerParameter
      -&gt; STVector s Int16
      -&gt; STVector s Int16
      -&gt; Int32
      -&gt; BoolReader s Int32)
forall a. [a] -&gt; Vector a
</span><span class="hs-identifier hs-var">V.fromList</span></span><span> </span><span class="annot"><span class="annottext">([(JpgUnpackerParameter,
   JpgUnpackerParameter
   -&gt; STVector s Int16
   -&gt; STVector s Int16
   -&gt; Int32
   -&gt; BoolReader s Int32)]
 -&gt; Vector
      (JpgUnpackerParameter,
       JpgUnpackerParameter
       -&gt; STVector s Int16
       -&gt; STVector s Int16
       -&gt; Int32
       -&gt; BoolReader s Int32))
-&gt; [(JpgUnpackerParameter,
     JpgUnpackerParameter
     -&gt; STVector s Int16
     -&gt; STVector s Int16
     -&gt; Int32
     -&gt; BoolReader s Int32)]
-&gt; Vector
     (JpgUnpackerParameter,
      JpgUnpackerParameter
      -&gt; STVector s Int16
      -&gt; STVector s Int16
      -&gt; Int32
      -&gt; BoolReader s Int32)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((JpgUnpackerParameter, b)
 -&gt; (JpgUnpackerParameter,
     JpgUnpackerParameter
     -&gt; STVector s Int16
     -&gt; STVector s Int16
     -&gt; Int32
     -&gt; BoolReader s Int32))
-&gt; [(JpgUnpackerParameter, b)]
-&gt; [(JpgUnpackerParameter,
     JpgUnpackerParameter
     -&gt; STVector s Int16
     -&gt; STVector s Int16
     -&gt; Int32
     -&gt; BoolReader s Int32)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679167489"><span class="annot"><span class="annottext">JpgUnpackerParameter
</span><a href="#local-6989586621679167489"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">JpgUnpackerParameter
</span><a href="#local-6989586621679167489"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">JpgUnpackerParameter
-&gt; STVector s Int16
-&gt; STVector s Int16
-&gt; Int32
-&gt; BoolReader s Int32
forall s.
JpgUnpackerParameter
-&gt; STVector s Int16
-&gt; STVector s Int16
-&gt; Int32
-&gt; BoolReader s Int32
</span><a href="#local-6989586621679167488"><span class="hs-identifier hs-var">unpacker</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(JpgUnpackerParameter, b)]
</span><a href="#local-6989586621679167492"><span class="hs-identifier hs-var">whole</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BoolState
</span><a href="#local-6989586621679167487"><span class="hs-identifier hs-var">boolReader</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-194"></span><span>           </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679167488"><span class="annot"><span class="annottext">unpacker :: JpgUnpackerParameter
-&gt; STVector s Int16
-&gt; STVector s Int16
-&gt; Int32
-&gt; BoolReader s Int32
</span><a href="#local-6989586621679167488"><span class="hs-identifier hs-var hs-var">unpacker</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int, Int)
-&gt; (Int, Int)
-&gt; JpgUnpackerParameter
-&gt; STVector s Int16
-&gt; STVector s Int16
-&gt; Int32
-&gt; BoolReader s Int32
forall a a a b s.
(Eq a, Eq a, Num a, Num a) =&gt;
(a, a)
-&gt; (a, b)
-&gt; JpgUnpackerParameter
-&gt; STVector s Int16
-&gt; STVector s Int16
-&gt; Int32
-&gt; BoolReader s Int32
</span><a href="#local-6989586621679167486"><span class="hs-identifier hs-var">selection</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">JpgUnpackerParameter -&gt; (Int, Int)
</span><a href="Codec.Picture.Jpg.Internal.Common.html#successiveApprox"><span class="hs-identifier hs-var hs-var">successiveApprox</span></a></span><span> </span><span class="annot"><span class="annottext">JpgUnpackerParameter
</span><a href="#local-6989586621679167491"><span class="hs-identifier hs-var">param</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">JpgUnpackerParameter -&gt; (Int, Int)
</span><a href="Codec.Picture.Jpg.Internal.Common.html#coefficientRange"><span class="hs-identifier hs-var hs-var">coefficientRange</span></a></span><span> </span><span class="annot"><span class="annottext">JpgUnpackerParameter
</span><a href="#local-6989586621679167491"><span class="hs-identifier hs-var">param</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-195"></span><span>                 </span><span id="local-6989586621679167487"><span class="annot"><span class="annottext">boolReader :: BoolState
</span><a href="#local-6989586621679167487"><span class="hs-identifier hs-var hs-var">boolReader</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; BoolState
</span><a href="Codec.Picture.BitWriter.html#initBoolStateJpg"><span class="hs-identifier hs-var">initBoolStateJpg</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; BoolState)
-&gt; ([ByteString] -&gt; ByteString) -&gt; [ByteString] -&gt; BoolState
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteString
</span><span class="hs-identifier hs-var">B.concat</span></span><span> </span><span class="annot"><span class="annottext">([ByteString] -&gt; BoolState) -&gt; [ByteString] -&gt; BoolState
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString]
</span><span class="hs-identifier hs-var">L.toChunks</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679167490"><span class="hs-identifier hs-var">byteString</span></a></span><span>
</span><span id="line-196"></span><span>
</span><span id="line-197"></span><span>                 </span><span id="local-6989586621679167486"><span class="annot"><span class="annottext">selection :: (a, a)
-&gt; (a, b)
-&gt; JpgUnpackerParameter
-&gt; STVector s Int16
-&gt; STVector s Int16
-&gt; Int32
-&gt; BoolReader s Int32
</span><a href="#local-6989586621679167486"><span class="hs-identifier hs-var hs-var">selection</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JpgUnpackerParameter
-&gt; STVector s Int16
-&gt; STVector s Int16
-&gt; Int32
-&gt; BoolReader s Int32
forall s.
JpgUnpackerParameter
-&gt; STVector s Int16
-&gt; STVector s Int16
-&gt; Int32
-&gt; BoolReader s Int32
</span><a href="Codec.Picture.Jpg.Internal.Progressive.html#decodeFirstDC"><span class="hs-identifier hs-var">decodeFirstDC</span></a></span><span>
</span><span id="line-198"></span><span>                 </span><span class="annot"><a href="#local-6989586621679167486"><span class="hs-identifier hs-var">selection</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(a, b)
</span><span class="hs-identifier">_</span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JpgUnpackerParameter
-&gt; STVector s Int16
-&gt; STVector s Int16
-&gt; Int32
-&gt; BoolReader s Int32
forall a s.
JpgUnpackerParameter
-&gt; a -&gt; MutableMacroBlock s Int16 -&gt; Int32 -&gt; BoolReader s Int32
</span><a href="Codec.Picture.Jpg.Internal.Progressive.html#decodeFirstAc"><span class="hs-identifier hs-var">decodeFirstAc</span></a></span><span>
</span><span id="line-199"></span><span>                 </span><span class="annot"><a href="#local-6989586621679167486"><span class="hs-identifier hs-var">selection</span></a></span><span> </span><span class="annot"><span class="annottext">(a, a)
</span><span class="hs-identifier">_</span></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JpgUnpackerParameter
-&gt; STVector s Int16
-&gt; STVector s Int16
-&gt; Int32
-&gt; BoolReader s Int32
forall a s.
JpgUnpackerParameter
-&gt; a -&gt; MutableMacroBlock s Int16 -&gt; Int32 -&gt; BoolReader s Int32
</span><a href="Codec.Picture.Jpg.Internal.Progressive.html#decodeRefineDc"><span class="hs-identifier hs-var">decodeRefineDc</span></a></span><span>
</span><span id="line-200"></span><span>                 </span><span class="annot"><a href="#local-6989586621679167486"><span class="hs-identifier hs-var">selection</span></a></span><span> </span><span class="annot"><span class="annottext">(a, a)
</span><span class="hs-identifier">_</span></span><span>      </span><span class="annot"><span class="annottext">(a, b)
</span><span class="hs-identifier">_</span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JpgUnpackerParameter
-&gt; STVector s Int16
-&gt; STVector s Int16
-&gt; Int32
-&gt; BoolReader s Int32
forall a s.
JpgUnpackerParameter
-&gt; a -&gt; MutableMacroBlock s Int16 -&gt; Int32 -&gt; BoolReader s Int32
</span><a href="Codec.Picture.Jpg.Internal.Progressive.html#decodeRefineAc"><span class="hs-identifier hs-var">decodeRefineAc</span></a></span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span class="hs-keyword">data</span><span> </span><span id="ComponentData"><span class="annot"><a href="Codec.Picture.Jpg.Internal.Progressive.html#ComponentData"><span class="hs-identifier hs-var">ComponentData</span></a></span></span><span> </span><span id="local-6989586621679167646"><span class="annot"><a href="#local-6989586621679167646"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ComponentData"><span class="annot"><a href="Codec.Picture.Jpg.Internal.Progressive.html#ComponentData"><span class="hs-identifier hs-var">ComponentData</span></a></span></span><span>
</span><span id="line-203"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="componentIndices"><span class="annot"><span class="annottext">ComponentData s -&gt; Vector (Vector Int)
</span><a href="Codec.Picture.Jpg.Internal.Progressive.html#componentIndices"><span class="hs-identifier hs-var hs-var">componentIndices</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V.Vector</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">VS.Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-204"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="componentBlocks"><span class="annot"><span class="annottext">ComponentData s -&gt; Vector (MutableMacroBlock s Int16)
</span><a href="Codec.Picture.Jpg.Internal.Progressive.html#componentBlocks"><span class="hs-identifier hs-var hs-var">componentBlocks</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V.Vector</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Picture.Jpg.Internal.Types.html#MutableMacroBlock"><span class="hs-identifier hs-type">MutableMacroBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679167646"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int16</span></span><span class="hs-special">)</span><span>
</span><span id="line-205"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="componentId"><span class="annot"><span class="annottext">ComponentData s -&gt; Int
</span><a href="Codec.Picture.Jpg.Internal.Progressive.html#componentId"><span class="hs-identifier hs-var hs-var">componentId</span></a></span></span><span>         </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-206"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="componentBlockCount"><span class="annot"><span class="annottext">ComponentData s -&gt; Int
</span><a href="Codec.Picture.Jpg.Internal.Progressive.html#componentBlockCount"><span class="hs-identifier hs-var hs-var">componentBlockCount</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-207"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-208"></span><span>
</span><span id="line-209"></span><span class="hs-comment">-- | Iteration from 0 to n in monadic context, without data</span><span>
</span><span id="line-210"></span><span class="hs-comment">-- keeping.</span><span>
</span><span id="line-211"></span><span id="local-6989586621679167650"><span class="annot"><a href="Codec.Picture.Jpg.Internal.Progressive.html#lineMap"><span class="hs-identifier hs-type">lineMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679167650"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679167650"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679167650"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-212"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Codec.Picture.Jpg.Internal.Progressive.html#lineMap"><span class="hs-pragma hs-type">lineMap</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-213"></span><span id="lineMap"><span class="annot"><span class="annottext">lineMap :: Int -&gt; (Int -&gt; m ()) -&gt; m ()
</span><a href="Codec.Picture.Jpg.Internal.Progressive.html#lineMap"><span class="hs-identifier hs-var hs-var">lineMap</span></a></span></span><span> </span><span id="local-6989586621679167476"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167476"><span class="hs-identifier hs-var">count</span></a></span></span><span> </span><span id="local-6989586621679167475"><span class="annot"><span class="annottext">Int -&gt; m ()
</span><a href="#local-6989586621679167475"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; m ()
</span><a href="#local-6989586621679167474"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-214"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679167474"><span class="annot"><span class="annottext">go :: Int -&gt; m ()
</span><a href="#local-6989586621679167474"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679167473"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167473"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167473"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167476"><span class="hs-identifier hs-var">count</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-215"></span><span>        </span><span class="annot"><a href="#local-6989586621679167474"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621679167472"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167472"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; m ()
</span><a href="#local-6989586621679167475"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167472"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">m () -&gt; m () -&gt; m ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; m ()
</span><a href="#local-6989586621679167474"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167472"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span id="local-6989586621679167470"><span id="local-6989586621679167471"><span class="annot"><a href="Codec.Picture.Jpg.Internal.Progressive.html#progressiveUnpack"><span class="hs-identifier hs-type">progressiveUnpack</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-218"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Picture.Jpg.Internal.Types.html#JpgFrameHeader"><span class="hs-identifier hs-type">JpgFrameHeader</span></a></span><span>
</span><span id="line-219"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V.Vector</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Picture.Jpg.Internal.DefaultTable.html#MacroBlock"><span class="hs-identifier hs-type">MacroBlock</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int16</span></span><span class="hs-special">)</span><span>
</span><span id="line-220"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Codec.Picture.Jpg.Internal.Common.html#JpgUnpackerParameter"><span class="hs-identifier hs-type">JpgUnpackerParameter</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679167471"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-221"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679167470"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Picture.Types.html#MutableImage"><span class="hs-identifier hs-type">MutableImage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679167470"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Codec.Picture.Types.html#PixelYCbCr8"><span class="hs-identifier hs-type">PixelYCbCr8</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-222"></span><span id="progressiveUnpack"><span class="annot"><span class="annottext">progressiveUnpack :: (Int, Int)
-&gt; JpgFrameHeader
-&gt; Vector (MacroBlock Int16)
-&gt; [([(JpgUnpackerParameter, a)], ByteString)]
-&gt; ST s (MutableImage s PixelYCbCr8)
</span><a href="Codec.Picture.Jpg.Internal.Progressive.html#progressiveUnpack"><span class="hs-identifier hs-var hs-var">progressiveUnpack</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679167469"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167469"><span class="hs-identifier hs-var">maxiW</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679167468"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167468"><span class="hs-identifier hs-var">maxiH</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679167467"><span class="annot"><span class="annottext">JpgFrameHeader
</span><a href="#local-6989586621679167467"><span class="hs-identifier hs-var">frame</span></a></span></span><span> </span><span id="local-6989586621679167466"><span class="annot"><span class="annottext">Vector (MacroBlock Int16)
</span><a href="#local-6989586621679167466"><span class="hs-identifier hs-var">quants</span></a></span></span><span> </span><span id="local-6989586621679167465"><span class="annot"><span class="annottext">[([(JpgUnpackerParameter, a)], ByteString)]
</span><a href="#local-6989586621679167465"><span class="hs-identifier hs-var">lst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-223"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679167464"><span class="annot"><span class="annottext">Vector (Vector (JpgUnpackerParameter, Unpacker s))
</span><a href="#local-6989586621679167464"><span class="hs-identifier hs-var">unpackers</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679167463"><span class="annot"><span class="annottext">STVector s BoolState
</span><a href="#local-6989586621679167463"><span class="hs-identifier hs-var">readers</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[([(JpgUnpackerParameter, a)], ByteString)]
-&gt; ST
     s
     (Vector (Vector (JpgUnpackerParameter, Unpacker s)),
      STVector s BoolState)
forall a s.
[([(JpgUnpackerParameter, a)], ByteString)]
-&gt; ST
     s
     (Vector (Vector (JpgUnpackerParameter, Unpacker s)),
      STVector s BoolState)
</span><a href="Codec.Picture.Jpg.Internal.Progressive.html#prepareUnpacker"><span class="hs-identifier hs-var">prepareUnpacker</span></a></span><span> </span><span class="annot"><span class="annottext">[([(JpgUnpackerParameter, a)], ByteString)]
</span><a href="#local-6989586621679167465"><span class="hs-identifier hs-var">lst</span></a></span><span>
</span><span id="line-224"></span><span>    </span><span id="local-6989586621679167462"><span class="annot"><span class="annottext">[ComponentData s]
</span><a href="#local-6989586621679167462"><span class="hs-identifier hs-var">allBlocks</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span id="local-6989586621679167461"><span class="annot"><span class="annottext">((Int, JpgComponent) -&gt; ST s (ComponentData s))
-&gt; [(Int, JpgComponent)] -&gt; ST s [ComponentData s]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">(Int, JpgComponent) -&gt; ST s (ComponentData s)
forall s. (Int, JpgComponent) -&gt; ST s (ComponentData s)
</span><a href="#local-6989586621679167459"><span class="hs-identifier hs-var">allocateWorkingBlocks</span></a></span><span> </span><span class="annot"><span class="annottext">([(Int, JpgComponent)] -&gt; ST s [ComponentData s])
-&gt; ([JpgComponent] -&gt; [(Int, JpgComponent)])
-&gt; [JpgComponent]
-&gt; ST s [ComponentData s]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; [JpgComponent] -&gt; [(Int, JpgComponent)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">([JpgComponent] -&gt; ST s [ComponentData s])
-&gt; [JpgComponent] -&gt; ST s [ComponentData s]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">JpgFrameHeader -&gt; [JpgComponent]
</span><a href="Codec.Picture.Jpg.Internal.Types.html#jpgComponents"><span class="hs-identifier hs-var hs-var">jpgComponents</span></a></span><span> </span><span class="annot"><span class="annottext">JpgFrameHeader
</span><a href="#local-6989586621679167467"><span class="hs-identifier hs-var">frame</span></a></span><span>
</span><span id="line-225"></span><span>                    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679167461"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Codec.Picture.Jpg.Internal.Progressive.html#ComponentData"><span class="hs-identifier hs-type">ComponentData</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679167461"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-226"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679167457"><span class="annot"><span class="annottext">scanCount :: Int
</span><a href="#local-6989586621679167457"><span class="hs-identifier hs-var hs-var">scanCount</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[([(JpgUnpackerParameter, a)], ByteString)] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[([(JpgUnpackerParameter, a)], ByteString)]
</span><a href="#local-6989586621679167465"><span class="hs-identifier hs-var">lst</span></a></span><span>
</span><span id="line-227"></span><span>        </span><span id="local-6989586621679167455"><span class="annot"><span class="annottext">restartIntervalValue :: Int
</span><a href="#local-6989586621679167455"><span class="hs-identifier hs-var hs-var">restartIntervalValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[([(JpgUnpackerParameter, a)], ByteString)]
</span><a href="#local-6989586621679167465"><span class="hs-identifier hs-var">lst</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-228"></span><span>                </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679167454"><span class="annot"><span class="annottext">JpgUnpackerParameter
</span><a href="#local-6989586621679167454"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[(JpgUnpackerParameter, a)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[([(JpgUnpackerParameter, a)], ByteString)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">JpgUnpackerParameter -&gt; Int
</span><a href="Codec.Picture.Jpg.Internal.Common.html#restartInterval"><span class="hs-identifier hs-var hs-var">restartInterval</span></a></span><span> </span><span class="annot"><span class="annottext">JpgUnpackerParameter
</span><a href="#local-6989586621679167454"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-229"></span><span>                </span><span class="annot"><span class="annottext">[([(JpgUnpackerParameter, a)], ByteString)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-230"></span><span>    </span><span id="local-6989586621679167452"><span class="annot"><span class="annottext">STVector s Int16
</span><a href="#local-6989586621679167452"><span class="hs-identifier hs-var">dcCoeffs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int16 -&gt; ST s (MVector (PrimState (ST s)) Int16)
forall (m :: * -&gt; *) a.
(PrimMonad m, Storable a) =&gt;
Int -&gt; a -&gt; m (MVector (PrimState m) a)
</span><span class="hs-identifier hs-var">MS.replicate</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167450"><span class="hs-identifier hs-var">imgComponentCount</span></a></span><span> </span><span class="annot"><span class="annottext">Int16
</span><span class="hs-number">0</span></span><span>
</span><span id="line-231"></span><span>    </span><span id="local-6989586621679167449"><span class="annot"><span class="annottext">MVector s Int32
</span><a href="#local-6989586621679167449"><span class="hs-identifier hs-var">eobRuns</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int32 -&gt; ST s (MVector (PrimState (ST s)) Int32)
forall (m :: * -&gt; *) a.
(PrimMonad m, Storable a) =&gt;
Int -&gt; a -&gt; m (MVector (PrimState m) a)
</span><span class="hs-identifier hs-var">MS.replicate</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[([(JpgUnpackerParameter, a)], ByteString)] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[([(JpgUnpackerParameter, a)], ByteString)]
</span><a href="#local-6989586621679167465"><span class="hs-identifier hs-var">lst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int32
</span><span class="hs-number">0</span></span><span>
</span><span id="line-232"></span><span>    </span><span id="local-6989586621679167448"><span class="annot"><span class="annottext">STVector s Int16
</span><a href="#local-6989586621679167448"><span class="hs-identifier hs-var">workBlock</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ST s (STVector s Int16)
forall a s. (Storable a, Num a) =&gt; ST s (MutableMacroBlock s a)
</span><a href="Codec.Picture.Jpg.Internal.Types.html#createEmptyMutableMacroBlock"><span class="hs-identifier hs-var">createEmptyMutableMacroBlock</span></a></span><span>
</span><span id="line-233"></span><span>    </span><span id="local-6989586621679167446"><span class="annot"><span class="annottext">MVector s Int
</span><a href="#local-6989586621679167446"><span class="hs-identifier hs-var">writeIndices</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; ST s (MVector (PrimState (ST s)) Int)
forall (m :: * -&gt; *) a.
(PrimMonad m, Storable a) =&gt;
Int -&gt; a -&gt; m (MVector (PrimState m) a)
</span><span class="hs-identifier hs-var">MS.replicate</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167450"><span class="hs-identifier hs-var">imgComponentCount</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-234"></span><span>    </span><span id="local-6989586621679167445"><span class="annot"><span class="annottext">MVector s Int
</span><a href="#local-6989586621679167445"><span class="hs-identifier hs-var">restartIntervals</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; ST s (MVector (PrimState (ST s)) Int)
forall (m :: * -&gt; *) a.
(PrimMonad m, Storable a) =&gt;
Int -&gt; a -&gt; m (MVector (PrimState m) a)
</span><span class="hs-identifier hs-var">MS.replicate</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167457"><span class="hs-identifier hs-var">scanCount</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167455"><span class="hs-identifier hs-var">restartIntervalValue</span></a></span><span>
</span><span id="line-235"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679167444"><span class="annot"><span class="annottext">elementCount :: Int
</span><a href="#local-6989586621679167444"><span class="hs-identifier hs-var hs-var">elementCount</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167443"><span class="hs-identifier hs-var">imgWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167442"><span class="hs-identifier hs-var">imgHeight</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167450"><span class="hs-identifier hs-var">imgComponentCount</span></a></span><span>
</span><span id="line-236"></span><span>    </span><span id="local-6989586621679167441"><span class="annot"><span class="annottext">MutableImage s PixelYCbCr8
</span><a href="#local-6989586621679167441"><span class="hs-identifier hs-var">img</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; Int
-&gt; STVector s (PixelBaseComponent PixelYCbCr8)
-&gt; MutableImage s PixelYCbCr8
forall s a.
Int -&gt; Int -&gt; STVector s (PixelBaseComponent a) -&gt; MutableImage s a
</span><a href="Codec.Picture.Types.html#MutableImage"><span class="hs-identifier hs-var">MutableImage</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167443"><span class="hs-identifier hs-var">imgWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167442"><span class="hs-identifier hs-var">imgHeight</span></a></span><span> </span><span class="annot"><span class="annottext">(MVector s Word8 -&gt; MutableImage s PixelYCbCr8)
-&gt; ST s (MVector s Word8) -&gt; ST s (MutableImage s PixelYCbCr8)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Word8 -&gt; ST s (MVector (PrimState (ST s)) Word8)
forall (m :: * -&gt; *) a.
(PrimMonad m, Storable a) =&gt;
Int -&gt; a -&gt; m (MVector (PrimState m) a)
</span><span class="hs-identifier hs-var">MS.replicate</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167444"><span class="hs-identifier hs-var">elementCount</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">128</span></span><span>
</span><span id="line-237"></span><span>
</span><span id="line-238"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679167439"><span class="annot"><span class="annottext">processRestartInterval :: ST s ()
</span><a href="#local-6989586621679167439"><span class="hs-identifier hs-var hs-var">processRestartInterval</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-239"></span><span>          </span><span class="annot"><span class="annottext">[Int] -&gt; (Int -&gt; ST s ()) -&gt; ST s ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167457"><span class="hs-identifier hs-var">scanCount</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">((Int -&gt; ST s ()) -&gt; ST s ()) -&gt; (Int -&gt; ST s ()) -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679167438"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167438"><span class="hs-identifier hs-var">ix</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-240"></span><span>            </span><span id="local-6989586621679167437"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167437"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MVector s Int
MVector (PrimState (ST s)) Int
</span><a href="#local-6989586621679167445"><span class="hs-identifier hs-var">restartIntervals</span></a></span><span> </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) Int -&gt; Int -&gt; ST s Int
forall (m :: * -&gt; *) a.
(PrimMonad m, Storable a) =&gt;
MVector (PrimState m) a -&gt; Int -&gt; m a
</span><span class="hs-operator hs-var">`MS.read`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167438"><span class="hs-identifier hs-var">ix</span></a></span><span>
</span><span id="line-241"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167437"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-242"></span><span>              </span><span class="hs-comment">-- reset DC prediction</span><span>
</span><span id="line-243"></span><span>              </span><span class="annot"><span class="annottext">Bool -&gt; ST s () -&gt; ST s ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167438"><span class="hs-identifier hs-var">ix</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) Int16 -&gt; Int16 -&gt; ST s ()
forall (m :: * -&gt; *) a.
(PrimMonad m, Storable a) =&gt;
MVector (PrimState m) a -&gt; a -&gt; m ()
</span><span class="hs-identifier hs-var">MS.set</span></span><span> </span><span class="annot"><span class="annottext">STVector s Int16
MVector (PrimState (ST s)) Int16
</span><a href="#local-6989586621679167452"><span class="hs-identifier hs-var">dcCoeffs</span></a></span><span> </span><span class="annot"><span class="annottext">Int16
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-244"></span><span>              </span><span id="local-6989586621679167434"><span class="annot"><span class="annottext">BoolState
</span><a href="#local-6989586621679167434"><span class="hs-identifier hs-var">reader</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">STVector s BoolState
MVector (PrimState (ST s)) BoolState
</span><a href="#local-6989586621679167463"><span class="hs-identifier hs-var">readers</span></a></span><span> </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) BoolState -&gt; Int -&gt; ST s BoolState
forall (m :: * -&gt; *) a.
PrimMonad m =&gt;
MVector (PrimState m) a -&gt; Int -&gt; m a
</span><span class="hs-operator hs-var">`M.read`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167438"><span class="hs-identifier hs-var">ix</span></a></span><span>
</span><span id="line-245"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int32
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679167432"><span class="annot"><span class="annottext">BoolState
</span><a href="#local-6989586621679167432"><span class="hs-identifier hs-var">updated</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BoolState -&gt; BoolReader s Int32 -&gt; ST s (Int32, BoolState)
forall s a. BoolState -&gt; BoolReader s a -&gt; ST s (a, BoolState)
</span><a href="Codec.Picture.BitWriter.html#runBoolReaderWith"><span class="hs-identifier hs-var">runBoolReaderWith</span></a></span><span> </span><span class="annot"><span class="annottext">BoolState
</span><a href="#local-6989586621679167434"><span class="hs-identifier hs-var">reader</span></a></span><span> </span><span class="annot"><span class="annottext">(BoolReader s Int32 -&gt; ST s (Int32, BoolState))
-&gt; BoolReader s Int32 -&gt; ST s (Int32, BoolState)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-246"></span><span>                  </span><span class="annot"><span class="annottext">BoolReader s ()
forall s. BoolReader s ()
</span><a href="Codec.Picture.BitWriter.html#byteAlignJpg"><span class="hs-identifier hs-var">byteAlignJpg</span></a></span><span> </span><span class="annot"><span class="annottext">BoolReader s () -&gt; BoolReader s Int32 -&gt; BoolReader s Int32
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">BoolReader s Int32
forall s. BoolReader s Int32
</span><a href="Codec.Picture.Jpg.Internal.Common.html#decodeRestartInterval"><span class="hs-identifier hs-var">decodeRestartInterval</span></a></span><span>
</span><span id="line-247"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">STVector s BoolState
MVector (PrimState (ST s)) BoolState
</span><a href="#local-6989586621679167463"><span class="hs-identifier hs-var">readers</span></a></span><span> </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) BoolState -&gt; Int -&gt; BoolState -&gt; ST s ()
forall (m :: * -&gt; *) a.
PrimMonad m =&gt;
MVector (PrimState m) a -&gt; Int -&gt; a -&gt; m ()
</span><span class="hs-operator hs-var">`M.write`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167438"><span class="hs-identifier hs-var">ix</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BoolState
</span><a href="#local-6989586621679167432"><span class="hs-identifier hs-var">updated</span></a></span><span> </span><span>
</span><span id="line-248"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MVector s Int32
MVector (PrimState (ST s)) Int32
</span><a href="#local-6989586621679167449"><span class="hs-identifier hs-var">eobRuns</span></a></span><span> </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) Int32 -&gt; Int -&gt; Int32 -&gt; ST s ()
forall (m :: * -&gt; *) a.
(PrimMonad m, Storable a) =&gt;
MVector (PrimState m) a -&gt; Int -&gt; a -&gt; m ()
</span><span class="hs-operator hs-var">`MS.unsafeWrite`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167438"><span class="hs-identifier hs-var">ix</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int32
</span><span class="hs-number">0</span></span><span>
</span><span id="line-249"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MVector s Int
MVector (PrimState (ST s)) Int
</span><a href="#local-6989586621679167445"><span class="hs-identifier hs-var">restartIntervals</span></a></span><span> </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) Int -&gt; Int -&gt; Int -&gt; ST s ()
forall (m :: * -&gt; *) a.
(PrimMonad m, Storable a) =&gt;
MVector (PrimState m) a -&gt; Int -&gt; a -&gt; m ()
</span><span class="hs-operator hs-var">`MS.unsafeWrite`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167438"><span class="hs-identifier hs-var">ix</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; ST s ()) -&gt; Int -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167455"><span class="hs-identifier hs-var">restartIntervalValue</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-250"></span><span>            </span><span class="hs-keyword">else</span><span>
</span><span id="line-251"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MVector s Int
MVector (PrimState (ST s)) Int
</span><a href="#local-6989586621679167445"><span class="hs-identifier hs-var">restartIntervals</span></a></span><span> </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) Int -&gt; Int -&gt; Int -&gt; ST s ()
forall (m :: * -&gt; *) a.
(PrimMonad m, Storable a) =&gt;
MVector (PrimState m) a -&gt; Int -&gt; a -&gt; m ()
</span><span class="hs-operator hs-var">`MS.unsafeWrite`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167438"><span class="hs-identifier hs-var">ix</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; ST s ()) -&gt; Int -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167437"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-252"></span><span>
</span><span id="line-253"></span><span>
</span><span id="line-254"></span><span>    </span><span class="annot"><span class="annottext">Int -&gt; (Int -&gt; ST s ()) -&gt; ST s ()
forall (m :: * -&gt; *). Monad m =&gt; Int -&gt; (Int -&gt; m ()) -&gt; m ()
</span><a href="Codec.Picture.Jpg.Internal.Progressive.html#lineMap"><span class="hs-identifier hs-var">lineMap</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167427"><span class="hs-identifier hs-var">imageMcuHeight</span></a></span><span> </span><span class="annot"><span class="annottext">((Int -&gt; ST s ()) -&gt; ST s ()) -&gt; (Int -&gt; ST s ()) -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679167426"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167426"><span class="hs-identifier hs-var">mmY</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-255"></span><span>      </span><span class="hs-comment">-- Reset all blocks to 0</span><span>
</span><span id="line-256"></span><span>      </span><span class="annot"><span class="annottext">[ComponentData s] -&gt; (ComponentData s -&gt; ST s ()) -&gt; ST s ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="annot"><span class="annottext">[ComponentData s]
</span><a href="#local-6989586621679167462"><span class="hs-identifier hs-var">allBlocks</span></a></span><span> </span><span class="annot"><span class="annottext">((ComponentData s -&gt; ST s ()) -&gt; ST s ())
-&gt; (ComponentData s -&gt; ST s ()) -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(STVector s Int16 -&gt; ST s ())
-&gt; Vector (STVector s Int16) -&gt; ST s ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; Vector a -&gt; m ()
</span><span class="hs-identifier hs-var">V.mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) Int16 -&gt; Int16 -&gt; ST s ()
forall (m :: * -&gt; *) a.
(PrimMonad m, Storable a) =&gt;
MVector (PrimState m) a -&gt; a -&gt; m ()
</span><span class="hs-operator hs-var">`MS.set`</span></span><span> </span><span class="annot"><span class="annottext">Int16
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Vector (STVector s Int16) -&gt; ST s ())
-&gt; (ComponentData s -&gt; Vector (STVector s Int16))
-&gt; ComponentData s
-&gt; ST s ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span>  </span><span class="annot"><span class="annottext">ComponentData s -&gt; Vector (STVector s Int16)
forall s. ComponentData s -&gt; Vector (MutableMacroBlock s Int16)
</span><a href="Codec.Picture.Jpg.Internal.Progressive.html#componentBlocks"><span class="hs-identifier hs-var hs-var">componentBlocks</span></a></span><span>
</span><span id="line-257"></span><span>      </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) Int -&gt; Int -&gt; ST s ()
forall (m :: * -&gt; *) a.
(PrimMonad m, Storable a) =&gt;
MVector (PrimState m) a -&gt; a -&gt; m ()
</span><span class="hs-identifier hs-var">MS.set</span></span><span> </span><span class="annot"><span class="annottext">MVector s Int
MVector (PrimState (ST s)) Int
</span><a href="#local-6989586621679167446"><span class="hs-identifier hs-var">writeIndices</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-258"></span><span>
</span><span id="line-259"></span><span>      </span><span class="annot"><span class="annottext">Int -&gt; (Int -&gt; ST s ()) -&gt; ST s ()
forall (m :: * -&gt; *). Monad m =&gt; Int -&gt; (Int -&gt; m ()) -&gt; m ()
</span><a href="Codec.Picture.Jpg.Internal.Progressive.html#lineMap"><span class="hs-identifier hs-var">lineMap</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167424"><span class="hs-identifier hs-var">imageMcuWidth</span></a></span><span> </span><span class="annot"><span class="annottext">((Int -&gt; ST s ()) -&gt; ST s ()) -&gt; (Int -&gt; ST s ()) -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679167423"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167423"><span class="hs-identifier hs-var">_mmx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-260"></span><span>        </span><span class="annot"><span class="annottext">ST s ()
</span><a href="#local-6989586621679167439"><span class="hs-identifier hs-var">processRestartInterval</span></a></span><span> </span><span>
</span><span id="line-261"></span><span>        </span><span class="annot"><span class="annottext">Vector (Vector (JpgUnpackerParameter, Unpacker s))
-&gt; (Vector (JpgUnpackerParameter, Unpacker s) -&gt; ST s ())
-&gt; ST s ()
forall (m :: * -&gt; *) a b. Monad m =&gt; Vector a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">V.forM_</span></span><span> </span><span class="annot"><span class="annottext">Vector (Vector (JpgUnpackerParameter, Unpacker s))
</span><a href="#local-6989586621679167464"><span class="hs-identifier hs-var">unpackers</span></a></span><span> </span><span class="annot"><span class="annottext">((Vector (JpgUnpackerParameter, Unpacker s) -&gt; ST s ()) -&gt; ST s ())
-&gt; (Vector (JpgUnpackerParameter, Unpacker s) -&gt; ST s ())
-&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((JpgUnpackerParameter, Unpacker s) -&gt; ST s ())
-&gt; Vector (JpgUnpackerParameter, Unpacker s) -&gt; ST s ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; Vector a -&gt; m ()
</span><span class="hs-identifier hs-var">V.mapM_</span></span><span> </span><span class="annot"><span class="annottext">(((JpgUnpackerParameter, Unpacker s) -&gt; ST s ())
 -&gt; Vector (JpgUnpackerParameter, Unpacker s) -&gt; ST s ())
-&gt; ((JpgUnpackerParameter, Unpacker s) -&gt; ST s ())
-&gt; Vector (JpgUnpackerParameter, Unpacker s)
-&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679167421"><span class="annot"><span class="annottext">JpgUnpackerParameter
</span><a href="#local-6989586621679167421"><span class="hs-identifier hs-var">unpackParam</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679167420"><span class="annot"><span class="annottext">Unpacker s
</span><a href="#local-6989586621679167420"><span class="hs-identifier hs-var">unpacker</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-262"></span><span>            </span><span id="local-6989586621679167419"><span class="annot"><span class="annottext">BoolState
</span><a href="#local-6989586621679167419"><span class="hs-identifier hs-var">boolState</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">STVector s BoolState
MVector (PrimState (ST s)) BoolState
</span><a href="#local-6989586621679167463"><span class="hs-identifier hs-var">readers</span></a></span><span> </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) BoolState -&gt; Int -&gt; ST s BoolState
forall (m :: * -&gt; *) a.
PrimMonad m =&gt;
MVector (PrimState m) a -&gt; Int -&gt; m a
</span><span class="hs-operator hs-var">`M.read`</span></span><span> </span><span class="annot"><span class="annottext">JpgUnpackerParameter -&gt; Int
</span><a href="Codec.Picture.Jpg.Internal.Common.html#readerIndex"><span class="hs-identifier hs-var hs-var">readerIndex</span></a></span><span> </span><span class="annot"><span class="annottext">JpgUnpackerParameter
</span><a href="#local-6989586621679167421"><span class="hs-identifier hs-var">unpackParam</span></a></span><span>
</span><span id="line-263"></span><span>            </span><span id="local-6989586621679167417"><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621679167417"><span class="hs-identifier hs-var">eobrun</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MVector s Int32
MVector (PrimState (ST s)) Int32
</span><a href="#local-6989586621679167449"><span class="hs-identifier hs-var">eobRuns</span></a></span><span> </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) Int32 -&gt; Int -&gt; ST s Int32
forall (m :: * -&gt; *) a.
(PrimMonad m, Storable a) =&gt;
MVector (PrimState m) a -&gt; Int -&gt; m a
</span><span class="hs-operator hs-var">`MS.read`</span></span><span> </span><span class="annot"><span class="annottext">JpgUnpackerParameter -&gt; Int
</span><a href="Codec.Picture.Jpg.Internal.Common.html#readerIndex"><span class="hs-identifier hs-var hs-var">readerIndex</span></a></span><span> </span><span class="annot"><span class="annottext">JpgUnpackerParameter
</span><a href="#local-6989586621679167421"><span class="hs-identifier hs-var">unpackParam</span></a></span><span>
</span><span id="line-264"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679167416"><span class="annot"><span class="annottext">componentNumber :: Int
</span><a href="#local-6989586621679167416"><span class="hs-identifier hs-var hs-var">componentNumber</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JpgUnpackerParameter -&gt; Int
</span><a href="Codec.Picture.Jpg.Internal.Common.html#componentIndex"><span class="hs-identifier hs-var hs-var">componentIndex</span></a></span><span> </span><span class="annot"><span class="annottext">JpgUnpackerParameter
</span><a href="#local-6989586621679167421"><span class="hs-identifier hs-var">unpackParam</span></a></span><span>
</span><span id="line-265"></span><span>            </span><span id="local-6989586621679167415"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167415"><span class="hs-identifier hs-var">writeIndex</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MVector s Int
MVector (PrimState (ST s)) Int
</span><a href="#local-6989586621679167446"><span class="hs-identifier hs-var">writeIndices</span></a></span><span> </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) Int -&gt; Int -&gt; ST s Int
forall (m :: * -&gt; *) a.
(PrimMonad m, Storable a) =&gt;
MVector (PrimState m) a -&gt; Int -&gt; m a
</span><span class="hs-operator hs-var">`MS.read`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167416"><span class="hs-identifier hs-var">componentNumber</span></a></span><span>
</span><span id="line-266"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679167414"><span class="annot"><span class="annottext">componentData :: ComponentData s
</span><a href="#local-6989586621679167414"><span class="hs-identifier hs-var hs-var">componentData</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ComponentData s]
</span><a href="#local-6989586621679167462"><span class="hs-identifier hs-var">allBlocks</span></a></span><span> </span><span class="annot"><span class="annottext">[ComponentData s] -&gt; Int -&gt; ComponentData s
forall a. [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167416"><span class="hs-identifier hs-var">componentNumber</span></a></span><span>
</span><span id="line-267"></span><span>                </span><span class="hs-comment">-- We get back the correct block indices for the number of component</span><span>
</span><span id="line-268"></span><span>                </span><span class="hs-comment">-- in the current scope (precalculated)</span><span>
</span><span id="line-269"></span><span>                </span><span id="local-6989586621679167412"><span class="annot"><span class="annottext">indexVector :: Vector Int
</span><a href="#local-6989586621679167412"><span class="hs-identifier hs-var hs-var">indexVector</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-270"></span><span>                    </span><span class="annot"><span class="annottext">ComponentData s -&gt; Vector (Vector Int)
forall s. ComponentData s -&gt; Vector (Vector Int)
</span><a href="Codec.Picture.Jpg.Internal.Progressive.html#componentIndices"><span class="hs-identifier hs-var hs-var">componentIndices</span></a></span><span> </span><span class="annot"><span class="annottext">ComponentData s
</span><a href="#local-6989586621679167414"><span class="hs-identifier hs-var">componentData</span></a></span><span> </span><span class="annot"><span class="annottext">Vector (Vector Int) -&gt; Int -&gt; Vector Int
forall a. Vector a -&gt; Int -&gt; a
</span><span class="hs-glyph hs-var">!</span></span><span> </span><span class="annot"><span class="annottext">JpgUnpackerParameter -&gt; Int
</span><a href="Codec.Picture.Jpg.Internal.Common.html#indiceVector"><span class="hs-identifier hs-var hs-var">indiceVector</span></a></span><span> </span><span class="annot"><span class="annottext">JpgUnpackerParameter
</span><a href="#local-6989586621679167421"><span class="hs-identifier hs-var">unpackParam</span></a></span><span>
</span><span id="line-271"></span><span>                </span><span id="local-6989586621679167410"><span class="annot"><span class="annottext">maxIndexLength :: Int
</span><a href="#local-6989586621679167410"><span class="hs-identifier hs-var hs-var">maxIndexLength</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector Int -&gt; Int
forall a. Storable a =&gt; Vector a -&gt; Int
</span><span class="hs-identifier hs-var">VS.length</span></span><span> </span><span class="annot"><span class="annottext">Vector Int
</span><a href="#local-6989586621679167412"><span class="hs-identifier hs-var">indexVector</span></a></span><span>
</span><span id="line-272"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; ST s () -&gt; ST s ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167415"><span class="hs-identifier hs-var">writeIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">JpgUnpackerParameter -&gt; Int
</span><a href="Codec.Picture.Jpg.Internal.Common.html#blockIndex"><span class="hs-identifier hs-var hs-var">blockIndex</span></a></span><span> </span><span class="annot"><span class="annottext">JpgUnpackerParameter
</span><a href="#local-6989586621679167421"><span class="hs-identifier hs-var">unpackParam</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167410"><span class="hs-identifier hs-var">maxIndexLength</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ST s () -&gt; ST s ()) -&gt; ST s () -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-273"></span><span>               </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679167407"><span class="annot"><span class="annottext">realIndex :: Int
</span><a href="#local-6989586621679167407"><span class="hs-identifier hs-var hs-var">realIndex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector Int
</span><a href="#local-6989586621679167412"><span class="hs-identifier hs-var">indexVector</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Int -&gt; Int -&gt; Int
forall a. Storable a =&gt; Vector a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">VS.!</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167415"><span class="hs-identifier hs-var">writeIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">JpgUnpackerParameter -&gt; Int
</span><a href="Codec.Picture.Jpg.Internal.Common.html#blockIndex"><span class="hs-identifier hs-var hs-var">blockIndex</span></a></span><span> </span><span class="annot"><span class="annottext">JpgUnpackerParameter
</span><a href="#local-6989586621679167421"><span class="hs-identifier hs-var">unpackParam</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-274"></span><span>                   </span><span id="local-6989586621679167405"><span class="annot"><span class="annottext">writeBlock :: STVector s Int16
</span><a href="#local-6989586621679167405"><span class="hs-identifier hs-var hs-var">writeBlock</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ComponentData s -&gt; Vector (STVector s Int16)
forall s. ComponentData s -&gt; Vector (MutableMacroBlock s Int16)
</span><a href="Codec.Picture.Jpg.Internal.Progressive.html#componentBlocks"><span class="hs-identifier hs-var hs-var">componentBlocks</span></a></span><span> </span><span class="annot"><span class="annottext">ComponentData s
</span><a href="#local-6989586621679167414"><span class="hs-identifier hs-var">componentData</span></a></span><span> </span><span class="annot"><span class="annottext">Vector (STVector s Int16) -&gt; Int -&gt; STVector s Int16
forall a. Vector a -&gt; Int -&gt; a
</span><span class="hs-glyph hs-var">!</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167407"><span class="hs-identifier hs-var">realIndex</span></a></span><span>
</span><span id="line-275"></span><span>               </span><span class="hs-special">(</span><span id="local-6989586621679167404"><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621679167404"><span class="hs-identifier hs-var">eobrun'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679167403"><span class="annot"><span class="annottext">BoolState
</span><a href="#local-6989586621679167403"><span class="hs-identifier hs-var">state</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-276"></span><span>                   </span><span class="annot"><span class="annottext">BoolState -&gt; BoolReader s Int32 -&gt; ST s (Int32, BoolState)
forall s a. BoolState -&gt; BoolReader s a -&gt; ST s (a, BoolState)
</span><a href="Codec.Picture.BitWriter.html#runBoolReaderWith"><span class="hs-identifier hs-var">runBoolReaderWith</span></a></span><span> </span><span class="annot"><span class="annottext">BoolState
</span><a href="#local-6989586621679167419"><span class="hs-identifier hs-var">boolState</span></a></span><span> </span><span class="annot"><span class="annottext">(BoolReader s Int32 -&gt; ST s (Int32, BoolState))
-&gt; BoolReader s Int32 -&gt; ST s (Int32, BoolState)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-277"></span><span>                       </span><span class="annot"><span class="annottext">Unpacker s
</span><a href="#local-6989586621679167420"><span class="hs-identifier hs-var">unpacker</span></a></span><span> </span><span class="annot"><span class="annottext">JpgUnpackerParameter
</span><a href="#local-6989586621679167421"><span class="hs-identifier hs-var">unpackParam</span></a></span><span> </span><span class="annot"><span class="annottext">STVector s Int16
</span><a href="#local-6989586621679167452"><span class="hs-identifier hs-var">dcCoeffs</span></a></span><span> </span><span class="annot"><span class="annottext">STVector s Int16
</span><a href="#local-6989586621679167405"><span class="hs-identifier hs-var">writeBlock</span></a></span><span> </span><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621679167417"><span class="hs-identifier hs-var">eobrun</span></a></span><span>
</span><span id="line-278"></span><span>
</span><span id="line-279"></span><span>               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">STVector s BoolState
MVector (PrimState (ST s)) BoolState
</span><a href="#local-6989586621679167463"><span class="hs-identifier hs-var">readers</span></a></span><span> </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) BoolState -&gt; Int -&gt; BoolState -&gt; ST s ()
forall (m :: * -&gt; *) a.
PrimMonad m =&gt;
MVector (PrimState m) a -&gt; Int -&gt; a -&gt; m ()
</span><span class="hs-operator hs-var">`M.write`</span></span><span> </span><span class="annot"><span class="annottext">JpgUnpackerParameter -&gt; Int
</span><a href="Codec.Picture.Jpg.Internal.Common.html#readerIndex"><span class="hs-identifier hs-var hs-var">readerIndex</span></a></span><span> </span><span class="annot"><span class="annottext">JpgUnpackerParameter
</span><a href="#local-6989586621679167421"><span class="hs-identifier hs-var">unpackParam</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BoolState
</span><a href="#local-6989586621679167403"><span class="hs-identifier hs-var">state</span></a></span><span>
</span><span id="line-280"></span><span>               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MVector s Int32
MVector (PrimState (ST s)) Int32
</span><a href="#local-6989586621679167449"><span class="hs-identifier hs-var">eobRuns</span></a></span><span> </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) Int32 -&gt; Int -&gt; Int32 -&gt; ST s ()
forall (m :: * -&gt; *) a.
(PrimMonad m, Storable a) =&gt;
MVector (PrimState m) a -&gt; Int -&gt; a -&gt; m ()
</span><span class="hs-operator hs-var">`MS.write`</span></span><span> </span><span class="annot"><span class="annottext">JpgUnpackerParameter -&gt; Int
</span><a href="Codec.Picture.Jpg.Internal.Common.html#readerIndex"><span class="hs-identifier hs-var hs-var">readerIndex</span></a></span><span> </span><span class="annot"><span class="annottext">JpgUnpackerParameter
</span><a href="#local-6989586621679167421"><span class="hs-identifier hs-var">unpackParam</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621679167404"><span class="hs-identifier hs-var">eobrun'</span></a></span><span>
</span><span id="line-281"></span><span>
</span><span id="line-282"></span><span>        </span><span class="hs-comment">-- Update the write indices</span><span>
</span><span id="line-283"></span><span>        </span><span class="annot"><span class="annottext">[ComponentData s] -&gt; (ComponentData s -&gt; ST s ()) -&gt; ST s ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="annot"><span class="annottext">[ComponentData s]
</span><a href="#local-6989586621679167462"><span class="hs-identifier hs-var">allBlocks</span></a></span><span> </span><span class="annot"><span class="annottext">((ComponentData s -&gt; ST s ()) -&gt; ST s ())
-&gt; (ComponentData s -&gt; ST s ()) -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679167401"><span class="annot"><span class="annottext">ComponentData s
</span><a href="#local-6989586621679167401"><span class="hs-identifier hs-var">comp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-284"></span><span>          </span><span id="local-6989586621679167400"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167400"><span class="hs-identifier hs-var">writeIndex</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MVector s Int
MVector (PrimState (ST s)) Int
</span><a href="#local-6989586621679167446"><span class="hs-identifier hs-var">writeIndices</span></a></span><span> </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) Int -&gt; Int -&gt; ST s Int
forall (m :: * -&gt; *) a.
(PrimMonad m, Storable a) =&gt;
MVector (PrimState m) a -&gt; Int -&gt; m a
</span><span class="hs-operator hs-var">`MS.read`</span></span><span> </span><span class="annot"><span class="annottext">ComponentData s -&gt; Int
forall s. ComponentData s -&gt; Int
</span><a href="Codec.Picture.Jpg.Internal.Progressive.html#componentId"><span class="hs-identifier hs-var hs-var">componentId</span></a></span><span> </span><span class="annot"><span class="annottext">ComponentData s
</span><a href="#local-6989586621679167401"><span class="hs-identifier hs-var">comp</span></a></span><span>
</span><span id="line-285"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679167399"><span class="annot"><span class="annottext">newIndex :: Int
</span><a href="#local-6989586621679167399"><span class="hs-identifier hs-var hs-var">newIndex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167400"><span class="hs-identifier hs-var">writeIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">ComponentData s -&gt; Int
forall s. ComponentData s -&gt; Int
</span><a href="Codec.Picture.Jpg.Internal.Progressive.html#componentBlockCount"><span class="hs-identifier hs-var hs-var">componentBlockCount</span></a></span><span> </span><span class="annot"><span class="annottext">ComponentData s
</span><a href="#local-6989586621679167401"><span class="hs-identifier hs-var">comp</span></a></span><span>
</span><span id="line-286"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MVector s Int
MVector (PrimState (ST s)) Int
</span><a href="#local-6989586621679167446"><span class="hs-identifier hs-var">writeIndices</span></a></span><span> </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) Int -&gt; Int -&gt; Int -&gt; ST s ()
forall (m :: * -&gt; *) a.
(PrimMonad m, Storable a) =&gt;
MVector (PrimState m) a -&gt; Int -&gt; a -&gt; m ()
</span><span class="hs-operator hs-var">`MS.write`</span></span><span> </span><span class="annot"><span class="annottext">ComponentData s -&gt; Int
forall s. ComponentData s -&gt; Int
</span><a href="Codec.Picture.Jpg.Internal.Progressive.html#componentId"><span class="hs-identifier hs-var hs-var">componentId</span></a></span><span> </span><span class="annot"><span class="annottext">ComponentData s
</span><a href="#local-6989586621679167401"><span class="hs-identifier hs-var">comp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167399"><span class="hs-identifier hs-var">newIndex</span></a></span><span>
</span><span id="line-287"></span><span>
</span><span id="line-288"></span><span>      </span><span class="annot"><span class="annottext">[ComponentData s] -&gt; (ComponentData s -&gt; ST s ()) -&gt; ST s ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="annot"><span class="annottext">[ComponentData s]
</span><a href="#local-6989586621679167462"><span class="hs-identifier hs-var">allBlocks</span></a></span><span> </span><span class="annot"><span class="annottext">((ComponentData s -&gt; ST s ()) -&gt; ST s ())
-&gt; (ComponentData s -&gt; ST s ()) -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679167398"><span class="annot"><span class="annottext">ComponentData s
</span><a href="#local-6989586621679167398"><span class="hs-identifier hs-var">compData</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-289"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679167397"><span class="annot"><span class="annottext">compBlocks :: Vector (STVector s Int16)
</span><a href="#local-6989586621679167397"><span class="hs-identifier hs-var hs-var">compBlocks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ComponentData s -&gt; Vector (STVector s Int16)
forall s. ComponentData s -&gt; Vector (MutableMacroBlock s Int16)
</span><a href="Codec.Picture.Jpg.Internal.Progressive.html#componentBlocks"><span class="hs-identifier hs-var hs-var">componentBlocks</span></a></span><span> </span><span class="annot"><span class="annottext">ComponentData s
</span><a href="#local-6989586621679167398"><span class="hs-identifier hs-var">compData</span></a></span><span>
</span><span id="line-290"></span><span>            </span><span id="local-6989586621679167396"><span class="annot"><span class="annottext">cId :: Int
</span><a href="#local-6989586621679167396"><span class="hs-identifier hs-var hs-var">cId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ComponentData s -&gt; Int
forall s. ComponentData s -&gt; Int
</span><a href="Codec.Picture.Jpg.Internal.Progressive.html#componentId"><span class="hs-identifier hs-var hs-var">componentId</span></a></span><span> </span><span class="annot"><span class="annottext">ComponentData s
</span><a href="#local-6989586621679167398"><span class="hs-identifier hs-var">compData</span></a></span><span>
</span><span id="line-291"></span><span>            </span><span id="local-6989586621679167395"><span class="annot"><span class="annottext">comp :: JpgComponent
</span><a href="#local-6989586621679167395"><span class="hs-identifier hs-var hs-var">comp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JpgFrameHeader -&gt; [JpgComponent]
</span><a href="Codec.Picture.Jpg.Internal.Types.html#jpgComponents"><span class="hs-identifier hs-var hs-var">jpgComponents</span></a></span><span> </span><span class="annot"><span class="annottext">JpgFrameHeader
</span><a href="#local-6989586621679167467"><span class="hs-identifier hs-var">frame</span></a></span><span> </span><span class="annot"><span class="annottext">[JpgComponent] -&gt; Int -&gt; JpgComponent
forall a. [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167396"><span class="hs-identifier hs-var">cId</span></a></span><span>
</span><span id="line-292"></span><span>            </span><span id="local-6989586621679167394"><span class="annot"><span class="annottext">quantId :: Int
</span><a href="#local-6989586621679167394"><span class="hs-identifier hs-var hs-var">quantId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-293"></span><span>                </span><span class="annot"><span class="annottext">Word8 -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(Word8 -&gt; Int) -&gt; Word8 -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">JpgComponent -&gt; Word8
</span><a href="Codec.Picture.Jpg.Internal.Types.html#quantizationTableDest"><span class="hs-identifier hs-var hs-var">quantizationTableDest</span></a></span><span> </span><span class="annot"><span class="annottext">JpgComponent
</span><a href="#local-6989586621679167395"><span class="hs-identifier hs-var">comp</span></a></span><span>
</span><span id="line-294"></span><span>            </span><span id="local-6989586621679167392"><span class="annot"><span class="annottext">table :: MacroBlock Int16
</span><a href="#local-6989586621679167392"><span class="hs-identifier hs-var hs-var">table</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector (MacroBlock Int16)
</span><a href="#local-6989586621679167466"><span class="hs-identifier hs-var">quants</span></a></span><span> </span><span class="annot"><span class="annottext">Vector (MacroBlock Int16) -&gt; Int -&gt; MacroBlock Int16
forall a. Vector a -&gt; Int -&gt; a
</span><span class="hs-glyph hs-var">!</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">min</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167394"><span class="hs-identifier hs-var">quantId</span></a></span><span>
</span><span id="line-295"></span><span>            </span><span id="local-6989586621679167390"><span class="annot"><span class="annottext">compW :: Int
</span><a href="#local-6989586621679167390"><span class="hs-identifier hs-var hs-var">compW</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(Word8 -&gt; Int) -&gt; Word8 -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">JpgComponent -&gt; Word8
</span><a href="Codec.Picture.Jpg.Internal.Types.html#horizontalSamplingFactor"><span class="hs-identifier hs-var hs-var">horizontalSamplingFactor</span></a></span><span> </span><span class="annot"><span class="annottext">JpgComponent
</span><a href="#local-6989586621679167395"><span class="hs-identifier hs-var">comp</span></a></span><span>
</span><span id="line-296"></span><span>            </span><span id="local-6989586621679167389"><span class="annot"><span class="annottext">compH :: Int
</span><a href="#local-6989586621679167389"><span class="hs-identifier hs-var hs-var">compH</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(Word8 -&gt; Int) -&gt; Word8 -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">JpgComponent -&gt; Word8
</span><a href="Codec.Picture.Jpg.Internal.Types.html#verticalSamplingFactor"><span class="hs-identifier hs-var hs-var">verticalSamplingFactor</span></a></span><span> </span><span class="annot"><span class="annottext">JpgComponent
</span><a href="#local-6989586621679167395"><span class="hs-identifier hs-var">comp</span></a></span><span>
</span><span id="line-297"></span><span>            </span><span id="local-6989586621679167388"><span class="annot"><span class="annottext">cw8 :: Int
</span><a href="#local-6989586621679167388"><span class="hs-identifier hs-var hs-var">cw8</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167469"><span class="hs-identifier hs-var">maxiW</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">JpgComponent -&gt; Word8
</span><a href="Codec.Picture.Jpg.Internal.Types.html#horizontalSamplingFactor"><span class="hs-identifier hs-var hs-var">horizontalSamplingFactor</span></a></span><span> </span><span class="annot"><span class="annottext">JpgComponent
</span><a href="#local-6989586621679167395"><span class="hs-identifier hs-var">comp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-298"></span><span>            </span><span id="local-6989586621679167387"><span class="annot"><span class="annottext">ch8 :: Int
</span><a href="#local-6989586621679167387"><span class="hs-identifier hs-var hs-var">ch8</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167468"><span class="hs-identifier hs-var">maxiH</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">JpgComponent -&gt; Word8
</span><a href="Codec.Picture.Jpg.Internal.Types.html#verticalSamplingFactor"><span class="hs-identifier hs-var hs-var">verticalSamplingFactor</span></a></span><span> </span><span class="annot"><span class="annottext">JpgComponent
</span><a href="#local-6989586621679167395"><span class="hs-identifier hs-var">comp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-299"></span><span>
</span><span id="line-300"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; (Int -&gt; Int -&gt; ST s ()) -&gt; ST s ()
forall (m :: * -&gt; *).
Monad m =&gt;
Int -&gt; Int -&gt; (Int -&gt; Int -&gt; m ()) -&gt; m ()
</span><a href="Codec.Picture.Jpg.Internal.Common.html#rasterMap"><span class="hs-identifier hs-var">rasterMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167424"><span class="hs-identifier hs-var">imageMcuWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167390"><span class="hs-identifier hs-var">compW</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167389"><span class="hs-identifier hs-var">compH</span></a></span><span> </span><span class="annot"><span class="annottext">((Int -&gt; Int -&gt; ST s ()) -&gt; ST s ())
-&gt; (Int -&gt; Int -&gt; ST s ()) -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679167385"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167385"><span class="hs-identifier hs-var">rx</span></a></span></span><span> </span><span id="local-6989586621679167384"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167384"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-301"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679167383"><span class="annot"><span class="annottext">ry :: Int
</span><a href="#local-6989586621679167383"><span class="hs-identifier hs-var hs-var">ry</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167426"><span class="hs-identifier hs-var">mmY</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167468"><span class="hs-identifier hs-var">maxiH</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167384"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-302"></span><span>                </span><span id="local-6989586621679167382"><span class="annot"><span class="annottext">block :: STVector s Int16
</span><a href="#local-6989586621679167382"><span class="hs-identifier hs-var hs-var">block</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector (STVector s Int16)
</span><a href="#local-6989586621679167397"><span class="hs-identifier hs-var">compBlocks</span></a></span><span> </span><span class="annot"><span class="annottext">Vector (STVector s Int16) -&gt; Int -&gt; STVector s Int16
forall a. Vector a -&gt; Int -&gt; a
</span><span class="hs-glyph hs-var">!</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167384"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167424"><span class="hs-identifier hs-var">imageMcuWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167390"><span class="hs-identifier hs-var">compW</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167385"><span class="hs-identifier hs-var">rx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-303"></span><span>            </span><span id="local-6989586621679167381"><span class="annot"><span class="annottext">STVector s Int16
</span><a href="#local-6989586621679167381"><span class="hs-identifier hs-var">transformed</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MacroBlock Int16
-&gt; STVector s Int16 -&gt; STVector s Int16 -&gt; ST s (STVector s Int16)
forall s.
MacroBlock Int16
-&gt; MutableMacroBlock s Int16
-&gt; MutableMacroBlock s Int16
-&gt; ST s (MutableMacroBlock s Int16)
</span><a href="Codec.Picture.Jpg.Internal.Common.html#decodeMacroBlock"><span class="hs-identifier hs-var">decodeMacroBlock</span></a></span><span> </span><span class="annot"><span class="annottext">MacroBlock Int16
</span><a href="#local-6989586621679167392"><span class="hs-identifier hs-var">table</span></a></span><span> </span><span class="annot"><span class="annottext">STVector s Int16
</span><a href="#local-6989586621679167448"><span class="hs-identifier hs-var">workBlock</span></a></span><span> </span><span class="annot"><span class="annottext">STVector s Int16
</span><a href="#local-6989586621679167382"><span class="hs-identifier hs-var">block</span></a></span><span>
</span><span id="line-304"></span><span>            </span><span class="annot"><span class="annottext">Int
-&gt; Int
-&gt; Int
-&gt; Int
-&gt; Int
-&gt; Int
-&gt; MutableImage s PixelYCbCr8
-&gt; STVector s Int16
-&gt; ST s ()
forall s.
Int
-&gt; Int
-&gt; Int
-&gt; Int
-&gt; Int
-&gt; Int
-&gt; MutableImage s PixelYCbCr8
-&gt; MutableMacroBlock s Int16
-&gt; ST s ()
</span><a href="Codec.Picture.Jpg.Internal.Common.html#unpackMacroBlock"><span class="hs-identifier hs-var">unpackMacroBlock</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167450"><span class="hs-identifier hs-var">imgComponentCount</span></a></span><span>
</span><span id="line-305"></span><span>                    </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167388"><span class="hs-identifier hs-var">cw8</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167387"><span class="hs-identifier hs-var">ch8</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167396"><span class="hs-identifier hs-var">cId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167385"><span class="hs-identifier hs-var">rx</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167388"><span class="hs-identifier hs-var">cw8</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167383"><span class="hs-identifier hs-var">ry</span></a></span><span>
</span><span id="line-306"></span><span>                    </span><span class="annot"><span class="annottext">MutableImage s PixelYCbCr8
</span><a href="#local-6989586621679167441"><span class="hs-identifier hs-var">img</span></a></span><span> </span><span class="annot"><span class="annottext">STVector s Int16
</span><a href="#local-6989586621679167381"><span class="hs-identifier hs-var">transformed</span></a></span><span>
</span><span id="line-307"></span><span>
</span><span id="line-308"></span><span>    </span><span class="annot"><span class="annottext">MutableImage s PixelYCbCr8 -&gt; ST s (MutableImage s PixelYCbCr8)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">MutableImage s PixelYCbCr8
</span><a href="#local-6989586621679167441"><span class="hs-identifier hs-var">img</span></a></span><span>
</span><span id="line-309"></span><span>
</span><span id="line-310"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679167450"><span class="annot"><span class="annottext">imgComponentCount :: Int
</span><a href="#local-6989586621679167450"><span class="hs-identifier hs-var hs-var">imgComponentCount</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[JpgComponent] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">([JpgComponent] -&gt; Int) -&gt; [JpgComponent] -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">JpgFrameHeader -&gt; [JpgComponent]
</span><a href="Codec.Picture.Jpg.Internal.Types.html#jpgComponents"><span class="hs-identifier hs-var hs-var">jpgComponents</span></a></span><span> </span><span class="annot"><span class="annottext">JpgFrameHeader
</span><a href="#local-6989586621679167467"><span class="hs-identifier hs-var">frame</span></a></span><span>
</span><span id="line-311"></span><span>
</span><span id="line-312"></span><span>        </span><span id="local-6989586621679167443"><span class="annot"><span class="annottext">imgWidth :: Int
</span><a href="#local-6989586621679167443"><span class="hs-identifier hs-var hs-var">imgWidth</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(Word16 -&gt; Int) -&gt; Word16 -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">JpgFrameHeader -&gt; Word16
</span><a href="Codec.Picture.Jpg.Internal.Types.html#jpgWidth"><span class="hs-identifier hs-var hs-var">jpgWidth</span></a></span><span> </span><span class="annot"><span class="annottext">JpgFrameHeader
</span><a href="#local-6989586621679167467"><span class="hs-identifier hs-var">frame</span></a></span><span>
</span><span id="line-313"></span><span>        </span><span id="local-6989586621679167442"><span class="annot"><span class="annottext">imgHeight :: Int
</span><a href="#local-6989586621679167442"><span class="hs-identifier hs-var hs-var">imgHeight</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(Word16 -&gt; Int) -&gt; Word16 -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">JpgFrameHeader -&gt; Word16
</span><a href="Codec.Picture.Jpg.Internal.Types.html#jpgHeight"><span class="hs-identifier hs-var hs-var">jpgHeight</span></a></span><span> </span><span class="annot"><span class="annottext">JpgFrameHeader
</span><a href="#local-6989586621679167467"><span class="hs-identifier hs-var">frame</span></a></span><span>
</span><span id="line-314"></span><span>
</span><span id="line-315"></span><span>        </span><span id="local-6989586621679167376"><span class="annot"><span class="annottext">imageBlockWidth :: Int
</span><a href="#local-6989586621679167376"><span class="hs-identifier hs-var hs-var">imageBlockWidth</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="Codec.Picture.Jpg.Internal.Common.html#toBlockSize"><span class="hs-identifier hs-var">toBlockSize</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167443"><span class="hs-identifier hs-var">imgWidth</span></a></span><span>
</span><span id="line-316"></span><span>        </span><span id="local-6989586621679167375"><span class="annot"><span class="annottext">imageBlockHeight :: Int
</span><a href="#local-6989586621679167375"><span class="hs-identifier hs-var hs-var">imageBlockHeight</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="Codec.Picture.Jpg.Internal.Common.html#toBlockSize"><span class="hs-identifier hs-var">toBlockSize</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167442"><span class="hs-identifier hs-var">imgHeight</span></a></span><span>
</span><span id="line-317"></span><span>
</span><span id="line-318"></span><span>        </span><span id="local-6989586621679167424"><span class="annot"><span class="annottext">imageMcuWidth :: Int
</span><a href="#local-6989586621679167424"><span class="hs-identifier hs-var hs-var">imageMcuWidth</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167376"><span class="hs-identifier hs-var">imageBlockWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167469"><span class="hs-identifier hs-var">maxiW</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`div`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167469"><span class="hs-identifier hs-var">maxiW</span></a></span><span>
</span><span id="line-319"></span><span>        </span><span id="local-6989586621679167427"><span class="annot"><span class="annottext">imageMcuHeight :: Int
</span><a href="#local-6989586621679167427"><span class="hs-identifier hs-var hs-var">imageMcuHeight</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167375"><span class="hs-identifier hs-var">imageBlockHeight</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167468"><span class="hs-identifier hs-var">maxiH</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`div`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167468"><span class="hs-identifier hs-var">maxiH</span></a></span><span>
</span><span id="line-320"></span><span>
</span><span id="line-321"></span><span>        </span><span id="local-6989586621679167459"><span class="annot"><span class="annottext">allocateWorkingBlocks :: (Int, JpgComponent) -&gt; ST s (ComponentData s)
</span><a href="#local-6989586621679167459"><span class="hs-identifier hs-var hs-var">allocateWorkingBlocks</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679167373"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167373"><span class="hs-identifier hs-var">ix</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679167372"><span class="annot"><span class="annottext">JpgComponent
</span><a href="#local-6989586621679167372"><span class="hs-identifier hs-var">comp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-322"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679167371"><span class="annot"><span class="annottext">blockCount :: Int
</span><a href="#local-6989586621679167371"><span class="hs-identifier hs-var hs-var">blockCount</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167370"><span class="hs-identifier hs-var">hSample</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167369"><span class="hs-identifier hs-var">vSample</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167424"><span class="hs-identifier hs-var">imageMcuWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span>
</span><span id="line-323"></span><span>            </span><span id="local-6989586621679167368"><span class="annot"><span class="annottext">Vector (MutableMacroBlock s Int16)
</span><a href="#local-6989586621679167368"><span class="hs-identifier hs-var">blocks</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; ST s (MutableMacroBlock s Int16)
-&gt; ST s (Vector (MutableMacroBlock s Int16))
forall (m :: * -&gt; *) a. Monad m =&gt; Int -&gt; m a -&gt; m (Vector a)
</span><span class="hs-identifier hs-var">V.replicateM</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167371"><span class="hs-identifier hs-var">blockCount</span></a></span><span> </span><span class="annot"><span class="annottext">ST s (MutableMacroBlock s Int16)
forall a s. (Storable a, Num a) =&gt; ST s (MutableMacroBlock s a)
</span><a href="Codec.Picture.Jpg.Internal.Types.html#createEmptyMutableMacroBlock"><span class="hs-identifier hs-var">createEmptyMutableMacroBlock</span></a></span><span>
</span><span id="line-324"></span><span>            </span><span class="annot"><span class="annottext">ComponentData s -&gt; ST s (ComponentData s)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ComponentData :: forall s.
Vector (Vector Int)
-&gt; Vector (MutableMacroBlock s Int16)
-&gt; Int
-&gt; Int
-&gt; ComponentData s
</span><a href="Codec.Picture.Jpg.Internal.Progressive.html#ComponentData"><span class="hs-identifier hs-type">ComponentData</span></a></span><span> </span><span>
</span><span id="line-325"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">componentBlocks :: Vector (MutableMacroBlock s Int16)
</span><a href="Codec.Picture.Jpg.Internal.Progressive.html#componentBlocks"><span class="hs-identifier hs-var">componentBlocks</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector (MutableMacroBlock s Int16)
</span><a href="#local-6989586621679167368"><span class="hs-identifier hs-var">blocks</span></a></span><span>
</span><span id="line-326"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">componentIndices :: Vector (Vector Int)
</span><a href="Codec.Picture.Jpg.Internal.Progressive.html#componentIndices"><span class="hs-identifier hs-var">componentIndices</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JpgComponent -&gt; Int -&gt; Int -&gt; Vector (Vector Int)
</span><a href="Codec.Picture.Jpg.Internal.Progressive.html#createMcuLineIndices"><span class="hs-identifier hs-var">createMcuLineIndices</span></a></span><span> </span><span class="annot"><span class="annottext">JpgComponent
</span><a href="#local-6989586621679167372"><span class="hs-identifier hs-var">comp</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167443"><span class="hs-identifier hs-var">imgWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167424"><span class="hs-identifier hs-var">imageMcuWidth</span></a></span><span>
</span><span id="line-327"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">componentBlockCount :: Int
</span><a href="Codec.Picture.Jpg.Internal.Progressive.html#componentBlockCount"><span class="hs-identifier hs-var">componentBlockCount</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167370"><span class="hs-identifier hs-var">hSample</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167369"><span class="hs-identifier hs-var">vSample</span></a></span><span>
</span><span id="line-328"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">componentId :: Int
</span><a href="Codec.Picture.Jpg.Internal.Progressive.html#componentId"><span class="hs-identifier hs-var">componentId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679167373"><span class="hs-identifier hs-var">ix</span></a></span><span>
</span><span id="line-329"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-330"></span><span>            </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679167370"><span class="annot"><span class="annottext">hSample :: Int
</span><a href="#local-6989586621679167370"><span class="hs-identifier hs-var hs-var">hSample</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(Word8 -&gt; Int) -&gt; Word8 -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">JpgComponent -&gt; Word8
</span><a href="Codec.Picture.Jpg.Internal.Types.html#horizontalSamplingFactor"><span class="hs-identifier hs-var hs-var">horizontalSamplingFactor</span></a></span><span> </span><span class="annot"><span class="annottext">JpgComponent
</span><a href="#local-6989586621679167372"><span class="hs-identifier hs-var">comp</span></a></span><span>
</span><span id="line-331"></span><span>                  </span><span id="local-6989586621679167369"><span class="annot"><span class="annottext">vSample :: Int
</span><a href="#local-6989586621679167369"><span class="hs-identifier hs-var hs-var">vSample</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(Word8 -&gt; Int) -&gt; Word8 -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">JpgComponent -&gt; Word8
</span><a href="Codec.Picture.Jpg.Internal.Types.html#verticalSamplingFactor"><span class="hs-identifier hs-var hs-var">verticalSamplingFactor</span></a></span><span> </span><span class="annot"><span class="annottext">JpgComponent
</span><a href="#local-6989586621679167372"><span class="hs-identifier hs-var">comp</span></a></span><span>
</span><span id="line-332"></span><span>
</span><span id="line-333"></span></pre></body></html>