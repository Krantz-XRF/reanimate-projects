<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE BangPatterns #-}</span><span>
</span><span id="line-2"></span><span class="hs-comment">-- | Numerical computations used by the cubic bezier functions.  Also</span><span>
</span><span id="line-3"></span><span class="hs-comment">-- contains functions that aren't used anymore, but might be useful on</span><span>
</span><span id="line-4"></span><span class="hs-comment">-- its own.</span><span>
</span><span id="line-5"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Geom2D.CubicBezier.Numeric</span><span>
</span><span id="line-6"></span><span>       </span><span class="hs-special">(</span><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#quadraticRoot"><span class="hs-identifier">quadraticRoot</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#cubicRoot"><span class="hs-identifier">cubicRoot</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#cubicRootNorm"><span class="hs-identifier">cubicRootNorm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#solveLinear2x2"><span class="hs-identifier">solveLinear2x2</span></a></span><span class="hs-special">,</span><span> </span><span>
</span><span id="line-7"></span><span>        </span><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#goldSearch"><span class="hs-identifier">goldSearch</span></a></span><span class="hs-special">,</span><span> </span><span>
</span><span id="line-8"></span><span>        </span><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#makeSparse"><span class="hs-identifier">makeSparse</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#SparseMatrix"><span class="hs-identifier">SparseMatrix</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#sparseMulT"><span class="hs-identifier">sparseMulT</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#sparseMul"><span class="hs-identifier">sparseMul</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-9"></span><span>        </span><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#addMatrix"><span class="hs-identifier">addMatrix</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#addVec"><span class="hs-identifier">addVec</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#lsqMatrix"><span class="hs-identifier">lsqMatrix</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#lsqSolveDist"><span class="hs-identifier">lsqSolveDist</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-10"></span><span>        </span><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#decompLDL"><span class="hs-identifier">decompLDL</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#lsqSolve"><span class="hs-identifier">lsqSolve</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-11"></span><span>        </span><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#solveTriDiagonal"><span class="hs-identifier">solveTriDiagonal</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#solveCyclicTriD"><span class="hs-identifier">solveCyclicTriD</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span>       </span><span class="hs-keyword">where</span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector.Unboxed</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">V</span></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector.Unboxed.Mutable</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">MV</span></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Matrix.Unboxed</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Matrix.Class</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">G</span></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Matrix.Unboxed.Mutable</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">MM</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.ST</span></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>
</span><span id="line-20"></span><span>
</span><span id="line-21"></span><span id="local-6989586621679235891"><span id="local-6989586621679235892"><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#sign"><span class="hs-identifier hs-type">sign</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679235892"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679235892"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679235891"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679235892"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679235891"><span class="hs-identifier hs-type">t</span></a></span></span></span><span>
</span><span id="line-22"></span><span id="sign"><span class="annot"><span class="annottext">sign :: a -&gt; t
</span><a href="Geom2D.CubicBezier.Numeric.html#sign"><span class="hs-identifier hs-var hs-var">sign</span></a></span></span><span> </span><span id="local-6989586621679235757"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235757"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235757"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">t
</span><span class="hs-number">1</span></span><span>
</span><span id="line-23"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">t
</span><span class="hs-number">1</span></span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span class="hs-comment">-- | @quadraticRoot a b c@ find the real roots of the quadratic equation</span><span>
</span><span id="line-26"></span><span class="hs-comment">-- @a x^2 + b x + c = 0@.  It will return one, two or zero roots.</span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#quadraticRoot"><span class="hs-identifier hs-type">quadraticRoot</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">]</span><span>
</span><span id="line-29"></span><span id="quadraticRoot"><span class="annot"><span class="annottext">quadraticRoot :: Double -&gt; Double -&gt; Double -&gt; [Double]
</span><a href="Geom2D.CubicBezier.Numeric.html#quadraticRoot"><span class="hs-identifier hs-var hs-var">quadraticRoot</span></a></span></span><span> </span><span id="local-6989586621679235755"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235755"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679235754"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235754"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621679235753"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235753"><span class="hs-identifier hs-var">c</span></a></span></span><span>
</span><span id="line-30"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235755"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235754"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-31"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235755"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235753"><span class="hs-identifier hs-var">c</span></a></span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235754"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-32"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Double]
</span><a href="#local-6989586621679235750"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-33"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-34"></span><span>    </span><span id="local-6989586621679235749"><span class="annot"><span class="annottext">d :: Double
</span><a href="#local-6989586621679235749"><span class="hs-identifier hs-var hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235754"><span class="hs-identifier hs-var">b</span></a></span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235754"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">4</span></span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235755"><span class="hs-identifier hs-var">a</span></a></span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235753"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-35"></span><span>    </span><span id="local-6989586621679235747"><span class="annot"><span class="annottext">q :: Double
</span><a href="#local-6989586621679235747"><span class="hs-identifier hs-var hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235754"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
forall a t. (Ord a, Num a, Num t) =&gt; a -&gt; t
</span><a href="Geom2D.CubicBezier.Numeric.html#sign"><span class="hs-identifier hs-var">sign</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235754"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">sqrt</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235749"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">2</span></span><span>
</span><span id="line-36"></span><span>    </span><span id="local-6989586621679235744"><span class="annot"><span class="annottext">x1 :: Double
</span><a href="#local-6989586621679235744"><span class="hs-identifier hs-var hs-var">x1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235747"><span class="hs-identifier hs-var">q</span></a></span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235755"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-37"></span><span>    </span><span id="local-6989586621679235743"><span class="annot"><span class="annottext">x2 :: Double
</span><a href="#local-6989586621679235743"><span class="hs-identifier hs-var hs-var">x2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235753"><span class="hs-identifier hs-var">c</span></a></span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235747"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-38"></span><span>    </span><span id="local-6989586621679235750"><span class="annot"><span class="annottext">result :: [Double]
</span><a href="#local-6989586621679235750"><span class="hs-identifier hs-var hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235749"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-39"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235749"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235744"><span class="hs-identifier hs-var">x1</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-40"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235744"><span class="hs-identifier hs-var">x1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235743"><span class="hs-identifier hs-var">x2</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#cubicRoot"><span class="hs-identifier hs-type">cubicRoot</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">]</span><span>
</span><span id="line-43"></span><span id="cubicRoot"><span class="annot"><span class="annottext">cubicRoot :: Double -&gt; Double -&gt; Double -&gt; Double -&gt; [Double]
</span><a href="Geom2D.CubicBezier.Numeric.html#cubicRoot"><span class="hs-identifier hs-var hs-var">cubicRoot</span></a></span></span><span> </span><span id="local-6989586621679235742"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235742"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679235741"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235741"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621679235740"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235740"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679235739"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235739"><span class="hs-identifier hs-var">d</span></a></span></span><span>
</span><span id="line-44"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235742"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double -&gt; [Double]
</span><a href="Geom2D.CubicBezier.Numeric.html#quadraticRoot"><span class="hs-identifier hs-var">quadraticRoot</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235741"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235740"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235739"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-45"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double -&gt; [Double]
</span><a href="Geom2D.CubicBezier.Numeric.html#cubicRootNorm"><span class="hs-identifier hs-var">cubicRootNorm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235741"><span class="hs-identifier hs-var">b</span></a></span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235742"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235740"><span class="hs-identifier hs-var">c</span></a></span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235742"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235739"><span class="hs-identifier hs-var">d</span></a></span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235742"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span class="hs-comment">-- | Find real roots from the normalized cubic equation.</span><span>
</span><span id="line-48"></span><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#cubicRootNorm"><span class="hs-identifier hs-type">cubicRootNorm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">]</span><span>
</span><span id="line-49"></span><span id="cubicRootNorm"><span class="annot"><span class="annottext">cubicRootNorm :: Double -&gt; Double -&gt; Double -&gt; [Double]
</span><a href="Geom2D.CubicBezier.Numeric.html#cubicRootNorm"><span class="hs-identifier hs-var hs-var">cubicRootNorm</span></a></span></span><span> </span><span id="local-6989586621679235738"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235738"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679235737"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235737"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621679235736"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235736"><span class="hs-identifier hs-var">c</span></a></span></span><span>
</span><span id="line-50"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235735"><span class="hs-identifier hs-var">r2</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235734"><span class="hs-identifier hs-var">q3</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235733"><span class="hs-identifier hs-var">m2sqrtQ</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">cos</span></span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235731"><span class="hs-identifier hs-var">t</span></a></span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">3</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235738"><span class="hs-identifier hs-var">a</span></a></span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">3</span></span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span>               </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235733"><span class="hs-identifier hs-var">m2sqrtQ</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">cos</span></span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235731"><span class="hs-identifier hs-var">t</span></a></span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">2</span></span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">Double
forall a. Floating a =&gt; a
</span><span class="hs-identifier hs-var">pi</span></span><span class="hs-special">)</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">3</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235738"><span class="hs-identifier hs-var">a</span></a></span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">3</span></span><span class="hs-special">,</span><span>
</span><span id="line-52"></span><span>               </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235733"><span class="hs-identifier hs-var">m2sqrtQ</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">cos</span></span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235731"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">2</span></span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">Double
forall a. Floating a =&gt; a
</span><span class="hs-identifier hs-var">pi</span></span><span class="hs-special">)</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">3</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235738"><span class="hs-identifier hs-var">a</span></a></span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">3</span></span><span class="hs-special">]</span><span>
</span><span id="line-53"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235729"><span class="hs-identifier hs-var">d</span></a></span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235728"><span class="hs-identifier hs-var">e</span></a></span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235738"><span class="hs-identifier hs-var">a</span></a></span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">3</span></span><span class="hs-special">]</span><span>
</span><span id="line-54"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679235727"><span class="annot"><span class="annottext">q :: Double
</span><a href="#local-6989586621679235727"><span class="hs-identifier hs-var hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235738"><span class="hs-identifier hs-var">a</span></a></span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235738"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">3</span></span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235737"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">9</span></span><span>
</span><span id="line-55"></span><span>        </span><span id="local-6989586621679235734"><span class="annot"><span class="annottext">q3 :: Double
</span><a href="#local-6989586621679235734"><span class="hs-identifier hs-var hs-var">q3</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235727"><span class="hs-identifier hs-var">q</span></a></span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235727"><span class="hs-identifier hs-var">q</span></a></span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235727"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-56"></span><span>        </span><span id="local-6989586621679235726"><span class="annot"><span class="annottext">r :: Double
</span><a href="#local-6989586621679235726"><span class="hs-identifier hs-var hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">2</span></span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235738"><span class="hs-identifier hs-var">a</span></a></span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235738"><span class="hs-identifier hs-var">a</span></a></span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235738"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">9</span></span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235738"><span class="hs-identifier hs-var">a</span></a></span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235737"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">27</span></span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235736"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">54</span></span><span>
</span><span id="line-57"></span><span>        </span><span id="local-6989586621679235731"><span class="annot"><span class="annottext">t :: Double
</span><a href="#local-6989586621679235731"><span class="hs-identifier hs-var hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">acos</span></span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235726"><span class="hs-identifier hs-var">r</span></a></span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">sqrt</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235734"><span class="hs-identifier hs-var">q3</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span>        </span><span id="local-6989586621679235733"><span class="annot"><span class="annottext">m2sqrtQ :: Double
</span><a href="#local-6989586621679235733"><span class="hs-identifier hs-var hs-var">m2sqrtQ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">2</span></span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">sqrt</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235727"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-59"></span><span>        </span><span id="local-6989586621679235735"><span class="annot"><span class="annottext">r2 :: Double
</span><a href="#local-6989586621679235735"><span class="hs-identifier hs-var hs-var">r2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235726"><span class="hs-identifier hs-var">r</span></a></span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235726"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-60"></span><span>        </span><span id="local-6989586621679235729"><span class="annot"><span class="annottext">d :: Double
</span><a href="#local-6989586621679235729"><span class="hs-identifier hs-var hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
forall a t. (Ord a, Num a, Num t) =&gt; a -&gt; t
</span><a href="Geom2D.CubicBezier.Numeric.html#sign"><span class="hs-identifier hs-var">sign</span></a></span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235726"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Num a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">abs</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235726"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">sqrt</span></span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235735"><span class="hs-identifier hs-var">r2</span></a></span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235734"><span class="hs-identifier hs-var">q3</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">**</span></span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">3</span></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span>        </span><span id="local-6989586621679235728"><span class="annot"><span class="annottext">e :: Double
</span><a href="#local-6989586621679235728"><span class="hs-identifier hs-var hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235729"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span>
</span><span id="line-62"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235727"><span class="hs-identifier hs-var">q</span></a></span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679235729"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-63"></span><span>        </span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span class="hs-comment">-- | @solveLinear2x2 a b c d e f@ solves the linear equation with two variables (x and y) and two systems:</span><span>
</span><span id="line-66"></span><span class="hs-comment">-- </span><span>
</span><span id="line-67"></span><span class="hs-comment">-- &gt;a x + b y + c = 0</span><span>
</span><span id="line-68"></span><span class="hs-comment">-- &gt;d x + e y + f = 0</span><span>
</span><span id="line-69"></span><span class="hs-comment">-- </span><span>
</span><span id="line-70"></span><span class="hs-comment">-- Returns @Nothing@ if no solution is found.</span><span>
</span><span id="line-71"></span><span id="local-6989586621679235722"><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#solveLinear2x2"><span class="hs-identifier hs-type">solveLinear2x2</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679235722"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679235722"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679235722"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679235722"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679235722"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679235722"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679235722"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679235722"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679235722"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679235722"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-72"></span><span id="solveLinear2x2"><span class="annot"><span class="annottext">solveLinear2x2 :: a -&gt; a -&gt; a -&gt; a -&gt; a -&gt; a -&gt; Maybe (a, a)
</span><a href="Geom2D.CubicBezier.Numeric.html#solveLinear2x2"><span class="hs-identifier hs-var hs-var">solveLinear2x2</span></a></span></span><span> </span><span id="local-6989586621679235721"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235721"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679235720"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235720"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621679235719"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235719"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679235718"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235718"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621679235717"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235717"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621679235716"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235716"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-73"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235715"><span class="hs-identifier hs-var">det</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (a, a)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-74"></span><span>              </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(a, a) -&gt; Maybe (a, a)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235719"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235717"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235720"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235716"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235715"><span class="hs-identifier hs-var">det</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235721"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235716"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235719"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235718"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235715"><span class="hs-identifier hs-var">det</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679235715"><span class="annot"><span class="annottext">det :: a
</span><a href="#local-6989586621679235715"><span class="hs-identifier hs-var hs-var">det</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235718"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235720"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235721"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235717"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-76"></span><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#solveLinear2x2"><span class="hs-pragma hs-type">solveLinear2x2</span></a></span><span> </span><span class="hs-pragma">::</span><span> </span><span class="annot"><span class="hs-pragma hs-type">Double</span></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><span class="hs-pragma hs-type">Double</span></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><span class="hs-pragma hs-type">Double</span></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><span class="hs-pragma hs-type">Double</span></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><span class="hs-pragma hs-type">Double</span></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><span class="hs-pragma hs-type">Double</span></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><span class="hs-pragma hs-type">Maybe</span></span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-type">Double</span></span><span class="hs-pragma">,</span><span> </span><span class="annot"><span class="hs-pragma hs-type">Double</span></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span id="local-6989586621679235714"><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#phi"><span class="hs-identifier hs-type">phi</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Floating</span></span><span> </span><span class="annot"><a href="#local-6989586621679235714"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679235714"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-79"></span><span id="phi"><span class="annot"><span class="annottext">phi :: a
</span><a href="Geom2D.CubicBezier.Numeric.html#phi"><span class="hs-identifier hs-var hs-var">phi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">sqrt</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">5</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">2</span></span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span id="local-6989586621679235712"><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#goldSearch"><span class="hs-identifier hs-type">goldSearch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679235712"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Floating</span></span><span> </span><span class="annot"><a href="#local-6989586621679235712"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679235712"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679235712"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679235712"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-83"></span><span id="goldSearch"><span class="annot"><span class="annottext">goldSearch :: (a -&gt; a) -&gt; Int -&gt; a
</span><a href="Geom2D.CubicBezier.Numeric.html#goldSearch"><span class="hs-identifier hs-var hs-var">goldSearch</span></a></span></span><span> </span><span id="local-6989586621679235711"><span class="annot"><span class="annottext">a -&gt; a
</span><a href="#local-6989586621679235711"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679235710"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235710"><span class="hs-identifier hs-var">maxiter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-84"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; a -&gt; a -&gt; a -&gt; a -&gt; a -&gt; a -&gt; a -&gt; a -&gt; Int -&gt; a
forall a.
(Ord a, Floating a) =&gt;
(a -&gt; a) -&gt; a -&gt; a -&gt; a -&gt; a -&gt; a -&gt; a -&gt; a -&gt; a -&gt; Int -&gt; a
</span><a href="Geom2D.CubicBezier.Numeric.html#goldSearch%27"><span class="hs-identifier hs-var">goldSearch'</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a
</span><a href="#local-6989586621679235711"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235708"><span class="hs-identifier hs-var">x1</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235707"><span class="hs-identifier hs-var">x2</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; a
</span><a href="#local-6989586621679235711"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span>
</span><span id="line-85"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; a
</span><a href="#local-6989586621679235711"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235708"><span class="hs-identifier hs-var">x1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; a
</span><a href="#local-6989586621679235711"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235707"><span class="hs-identifier hs-var">x2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; a
</span><a href="#local-6989586621679235711"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235710"><span class="hs-identifier hs-var">maxiter</span></a></span><span>
</span><span id="line-86"></span><span>    </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679235708"><span class="annot"><span class="annottext">x1 :: a
</span><a href="#local-6989586621679235708"><span class="hs-identifier hs-var hs-var">x1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">a
forall a. Floating a =&gt; a
</span><a href="Geom2D.CubicBezier.Numeric.html#phi"><span class="hs-identifier hs-var">phi</span></a></span><span>
</span><span id="line-87"></span><span>          </span><span id="local-6989586621679235707"><span class="annot"><span class="annottext">x2 :: a
</span><a href="#local-6989586621679235707"><span class="hs-identifier hs-var hs-var">x2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
forall a. Floating a =&gt; a
</span><a href="Geom2D.CubicBezier.Numeric.html#phi"><span class="hs-identifier hs-var">phi</span></a></span><span>
</span><span id="line-88"></span><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#goldSearch"><span class="hs-pragma hs-type">goldSearch</span></a></span><span> </span><span class="hs-pragma">::</span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-type">Double</span></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><span class="hs-pragma hs-type">Double</span></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><span class="hs-pragma hs-type">Int</span></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><span class="hs-pragma hs-type">Double</span></span><span> </span><span class="hs-pragma">#-}</span><span>          </span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span id="local-6989586621679235886"><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#goldSearch%27"><span class="hs-identifier hs-type">goldSearch'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679235886"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Floating</span></span><span> </span><span class="annot"><a href="#local-6989586621679235886"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-91"></span><span>               </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679235886"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679235886"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679235886"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679235886"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679235886"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-92"></span><span>               </span><span class="annot"><a href="#local-6989586621679235886"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679235886"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679235886"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679235886"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679235886"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679235886"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-93"></span><span id="goldSearch%27"><span class="annot"><span class="annottext">goldSearch' :: (a -&gt; a) -&gt; a -&gt; a -&gt; a -&gt; a -&gt; a -&gt; a -&gt; a -&gt; a -&gt; Int -&gt; a
</span><a href="Geom2D.CubicBezier.Numeric.html#goldSearch%27"><span class="hs-identifier hs-var hs-var">goldSearch'</span></a></span></span><span> </span><span id="local-6989586621679235706"><span class="annot"><span class="annottext">a -&gt; a
</span><a href="#local-6989586621679235706"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679235705"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235705"><span class="hs-identifier hs-var">x0</span></a></span></span><span> </span><span id="local-6989586621679235704"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235704"><span class="hs-identifier hs-var">x1</span></a></span></span><span> </span><span id="local-6989586621679235703"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235703"><span class="hs-identifier hs-var">x2</span></a></span></span><span> </span><span id="local-6989586621679235702"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235702"><span class="hs-identifier hs-var">x3</span></a></span></span><span> </span><span id="local-6989586621679235701"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235701"><span class="hs-identifier hs-var">y0</span></a></span></span><span> </span><span id="local-6989586621679235700"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235700"><span class="hs-identifier hs-var">y1</span></a></span></span><span> </span><span id="local-6989586621679235699"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235699"><span class="hs-identifier hs-var">y2</span></a></span></span><span> </span><span id="local-6989586621679235698"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235698"><span class="hs-identifier hs-var">y3</span></a></span></span><span> </span><span id="local-6989586621679235697"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235697"><span class="hs-identifier hs-var">maxiter</span></a></span></span><span>
</span><span id="line-94"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235697"><span class="hs-identifier hs-var">maxiter</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a, a) -&gt; a
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((a, a) -&gt; a) -&gt; (a, a) -&gt; a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(a, a)] -&gt; (a, a)
forall (t :: * -&gt; *) a. (Foldable t, Ord a) =&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">maximum</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235701"><span class="hs-identifier hs-var">y0</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235705"><span class="hs-identifier hs-var">x0</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235700"><span class="hs-identifier hs-var">y1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235704"><span class="hs-identifier hs-var">x1</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-95"></span><span>                                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235699"><span class="hs-identifier hs-var">y2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235703"><span class="hs-identifier hs-var">x2</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235698"><span class="hs-identifier hs-var">y3</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235702"><span class="hs-identifier hs-var">x3</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-96"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235700"><span class="hs-identifier hs-var">y1</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235699"><span class="hs-identifier hs-var">y2</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-97"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679235695"><span class="annot"><span class="annottext">x25 :: a
</span><a href="#local-6989586621679235695"><span class="hs-identifier hs-var hs-var">x25</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235704"><span class="hs-identifier hs-var">x1</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">a
forall a. Floating a =&gt; a
</span><a href="Geom2D.CubicBezier.Numeric.html#phi"><span class="hs-identifier hs-var">phi</span></a></span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235702"><span class="hs-identifier hs-var">x3</span></a></span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235704"><span class="hs-identifier hs-var">x1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span>        </span><span id="local-6989586621679235694"><span class="annot"><span class="annottext">y25 :: a
</span><a href="#local-6989586621679235694"><span class="hs-identifier hs-var hs-var">y25</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; a
</span><a href="#local-6989586621679235706"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235695"><span class="hs-identifier hs-var">x25</span></a></span><span>
</span><span id="line-99"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; a -&gt; a -&gt; a -&gt; a -&gt; a -&gt; a -&gt; a -&gt; a -&gt; Int -&gt; a
forall a.
(Ord a, Floating a) =&gt;
(a -&gt; a) -&gt; a -&gt; a -&gt; a -&gt; a -&gt; a -&gt; a -&gt; a -&gt; a -&gt; Int -&gt; a
</span><a href="Geom2D.CubicBezier.Numeric.html#goldSearch%27"><span class="hs-identifier hs-var">goldSearch'</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a
</span><a href="#local-6989586621679235706"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235704"><span class="hs-identifier hs-var">x1</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235703"><span class="hs-identifier hs-var">x2</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235695"><span class="hs-identifier hs-var">x25</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235702"><span class="hs-identifier hs-var">x3</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235700"><span class="hs-identifier hs-var">y1</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235699"><span class="hs-identifier hs-var">y2</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235694"><span class="hs-identifier hs-var">y25</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235698"><span class="hs-identifier hs-var">y3</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235697"><span class="hs-identifier hs-var">maxiter</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-101"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679235693"><span class="annot"><span class="annottext">x05 :: a
</span><a href="#local-6989586621679235693"><span class="hs-identifier hs-var hs-var">x05</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235703"><span class="hs-identifier hs-var">x2</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">a
forall a. Floating a =&gt; a
</span><a href="Geom2D.CubicBezier.Numeric.html#phi"><span class="hs-identifier hs-var">phi</span></a></span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235705"><span class="hs-identifier hs-var">x0</span></a></span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235703"><span class="hs-identifier hs-var">x2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span>        </span><span id="local-6989586621679235692"><span class="annot"><span class="annottext">y05 :: a
</span><a href="#local-6989586621679235692"><span class="hs-identifier hs-var hs-var">y05</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; a
</span><a href="#local-6989586621679235706"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235693"><span class="hs-identifier hs-var">x05</span></a></span><span>
</span><span id="line-103"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; a -&gt; a -&gt; a -&gt; a -&gt; a -&gt; a -&gt; a -&gt; a -&gt; Int -&gt; a
forall a.
(Ord a, Floating a) =&gt;
(a -&gt; a) -&gt; a -&gt; a -&gt; a -&gt; a -&gt; a -&gt; a -&gt; a -&gt; a -&gt; Int -&gt; a
</span><a href="Geom2D.CubicBezier.Numeric.html#goldSearch%27"><span class="hs-identifier hs-var">goldSearch'</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a
</span><a href="#local-6989586621679235706"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235705"><span class="hs-identifier hs-var">x0</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235693"><span class="hs-identifier hs-var">x05</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235704"><span class="hs-identifier hs-var">x1</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235703"><span class="hs-identifier hs-var">x2</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235701"><span class="hs-identifier hs-var">y0</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235692"><span class="hs-identifier hs-var">y05</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235700"><span class="hs-identifier hs-var">y1</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235699"><span class="hs-identifier hs-var">y2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235697"><span class="hs-identifier hs-var">maxiter</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span class="hs-keyword">data</span><span> </span><span id="SparseMatrix"><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#SparseMatrix"><span class="hs-identifier hs-var">SparseMatrix</span></a></span></span><span> </span><span id="local-6989586621679235873"><span class="annot"><a href="#local-6989586621679235873"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-107"></span><span>  </span><span id="SparseMatrix"><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#SparseMatrix"><span class="hs-identifier hs-var">SparseMatrix</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V.Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V.Vector</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">M.Matrix</span></span><span> </span><span class="annot"><a href="#local-6989586621679235873"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span>                      </span><span>
</span><span id="line-110"></span><span id="local-6989586621679235690"><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#makeSparse"><span class="hs-identifier hs-type">makeSparse</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Unbox</span></span><span> </span><span class="annot"><a href="#local-6989586621679235690"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V.Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-111"></span><span>              </span><span class="hs-comment">-- ^ The column index of the first element of each row.</span><span>
</span><span id="line-112"></span><span>              </span><span class="hs-comment">-- Should be ascending in order.</span><span>
</span><span id="line-113"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Matrix</span></span><span> </span><span class="annot"><a href="#local-6989586621679235690"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-114"></span><span>              </span><span class="hs-comment">-- ^ The adjacent coefficients in each row</span><span>
</span><span id="line-115"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#SparseMatrix"><span class="hs-identifier hs-type">SparseMatrix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679235690"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-116"></span><span>              </span><span class="hs-comment">-- ^ A sparse matrix.</span></span><span>
</span><span id="line-117"></span><span id="makeSparse"><span class="annot"><span class="annottext">makeSparse :: Vector Int -&gt; Matrix a -&gt; SparseMatrix a
</span><a href="Geom2D.CubicBezier.Numeric.html#makeSparse"><span class="hs-identifier hs-var hs-var">makeSparse</span></a></span></span><span> </span><span id="local-6989586621679235689"><span class="annot"><span class="annottext">Vector Int
</span><a href="#local-6989586621679235689"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621679235688"><span class="annot"><span class="annottext">Matrix a
</span><a href="#local-6989586621679235688"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector Int -&gt; Vector (Int, Int) -&gt; Matrix a -&gt; SparseMatrix a
forall a.
Vector Int -&gt; Vector (Int, Int) -&gt; Matrix a -&gt; SparseMatrix a
</span><a href="Geom2D.CubicBezier.Numeric.html#SparseMatrix"><span class="hs-identifier hs-var">SparseMatrix</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Int
</span><a href="#local-6989586621679235689"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector Int -&gt; Int -&gt; Int -&gt; Vector (Int, Int)
</span><a href="Geom2D.CubicBezier.Numeric.html#sparseRanges"><span class="hs-identifier hs-var">sparseRanges</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Int
</span><a href="#local-6989586621679235689"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235686"><span class="hs-identifier hs-var">vars</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235685"><span class="hs-identifier hs-var">width</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Matrix a
</span><a href="#local-6989586621679235688"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-118"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-119"></span><span>    </span><span id="local-6989586621679235685"><span class="annot"><span class="annottext">width :: Int
</span><a href="#local-6989586621679235685"><span class="hs-identifier hs-var hs-var">width</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Matrix a -&gt; Int
forall a. Context a =&gt; Matrix a -&gt; Int
</span><span class="hs-identifier hs-var">cols</span></span><span> </span><span class="annot"><span class="annottext">Matrix a
</span><a href="#local-6989586621679235688"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-120"></span><span>    </span><span id="local-6989586621679235686"><span class="annot"><span class="annottext">vars :: Int
</span><a href="#local-6989586621679235686"><span class="hs-identifier hs-var hs-var">vars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector Int -&gt; Int
forall a. Unbox a =&gt; Vector a -&gt; a
</span><span class="hs-identifier hs-var">V.last</span></span><span> </span><span class="annot"><span class="annottext">Vector Int
</span><a href="#local-6989586621679235689"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235685"><span class="hs-identifier hs-var">width</span></a></span><span>
</span><span id="line-121"></span><span>
</span><span id="line-122"></span><span class="hs-comment">-- give the range of (possibly) nonzero coefficients for each column.</span><span>
</span><span id="line-123"></span><span class="hs-comment">-- The column indices are those of the dense matrix of which the</span><span>
</span><span id="line-124"></span><span class="hs-comment">-- sparse is a representation.</span><span>
</span><span id="line-125"></span><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#sparseRanges"><span class="hs-identifier hs-type">sparseRanges</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V.Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V.Vector</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-126"></span><span id="sparseRanges"><span class="annot"><span class="annottext">sparseRanges :: Vector Int -&gt; Int -&gt; Int -&gt; Vector (Int, Int)
</span><a href="Geom2D.CubicBezier.Numeric.html#sparseRanges"><span class="hs-identifier hs-var hs-var">sparseRanges</span></a></span></span><span> </span><span id="local-6989586621679235682"><span class="annot"><span class="annottext">Vector Int
</span><a href="#local-6989586621679235682"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621679235681"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235681"><span class="hs-identifier hs-var">vars</span></a></span></span><span> </span><span id="local-6989586621679235680"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235680"><span class="hs-identifier hs-var">width</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector (Int, Int)
</span><a href="#local-6989586621679235679"><span class="hs-identifier hs-var">ranges</span></a></span><span> </span><span>
</span><span id="line-127"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-128"></span><span>    </span><span id="local-6989586621679235678"><span class="annot"><span class="annottext">height :: Int
</span><a href="#local-6989586621679235678"><span class="hs-identifier hs-var hs-var">height</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector Int -&gt; Int
forall a. Unbox a =&gt; Vector a -&gt; Int
</span><span class="hs-identifier hs-var">V.length</span></span><span> </span><span class="annot"><span class="annottext">Vector Int
</span><a href="#local-6989586621679235682"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-129"></span><span>    </span><span id="local-6989586621679235679"><span class="annot"><span class="annottext">ranges :: Vector (Int, Int)
</span><a href="#local-6989586621679235679"><span class="hs-identifier hs-var hs-var">ranges</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Int, Int) -&gt; Int -&gt; (Int, Int))
-&gt; (Int, Int) -&gt; Vector Int -&gt; Vector (Int, Int)
forall a b.
(Unbox a, Unbox b) =&gt;
(a -&gt; b -&gt; a) -&gt; a -&gt; Vector b -&gt; Vector a
</span><span class="hs-identifier hs-var">V.scanl'</span></span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; Int -&gt; (Int, Int)
</span><a href="#local-6989586621679235675"><span class="hs-identifier hs-var">nextRange</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int, Int) -&gt; Int -&gt; (Int, Int)
</span><a href="#local-6989586621679235675"><span class="hs-identifier hs-var">nextRange</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Vector Int -&gt; Vector (Int, Int))
-&gt; Vector Int -&gt; Vector (Int, Int)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-130"></span><span>             </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Vector Int
forall a. (Unbox a, Num a) =&gt; a -&gt; Int -&gt; Vector a
</span><span class="hs-identifier hs-var">V.enumFromN</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235681"><span class="hs-identifier hs-var">vars</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span>    </span><span id="local-6989586621679235675"><span class="annot"><span class="annottext">nextRange :: (Int, Int) -&gt; Int -&gt; (Int, Int)
</span><a href="#local-6989586621679235675"><span class="hs-identifier hs-var hs-var">nextRange</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679235673"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235673"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679235672"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235672"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679235671"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235671"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
</span><a href="#local-6989586621679235670"><span class="hs-identifier hs-var">nextStart</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235673"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235671"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
</span><a href="#local-6989586621679235669"><span class="hs-identifier hs-var">nextEnd</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235672"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235671"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span>    </span><span id="local-6989586621679235670"><span class="annot"><span class="annottext">nextStart :: Int -&gt; Int -&gt; Int
</span><a href="#local-6989586621679235670"><span class="hs-identifier hs-var hs-var">nextStart</span></a></span></span><span> </span><span id="local-6989586621679235668"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235668"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679235667"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235667"><span class="hs-identifier hs-var">i</span></a></span></span><span>
</span><span id="line-133"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235668"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235678"><span class="hs-identifier hs-var">height</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235678"><span class="hs-identifier hs-var">height</span></a></span><span>
</span><span id="line-134"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Vector Int
</span><a href="#local-6989586621679235682"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Int -&gt; Int -&gt; Int
forall a. Unbox a =&gt; Vector a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`V.unsafeIndex`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235668"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235680"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235667"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-135"></span><span>          </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
</span><a href="#local-6989586621679235670"><span class="hs-identifier hs-var">nextStart</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235668"><span class="hs-identifier hs-var">s</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235667"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-136"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235668"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-137"></span><span>    </span><span id="local-6989586621679235669"><span class="annot"><span class="annottext">nextEnd :: Int -&gt; Int -&gt; Int
</span><a href="#local-6989586621679235669"><span class="hs-identifier hs-var hs-var">nextEnd</span></a></span></span><span> </span><span id="local-6989586621679235664"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235664"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621679235663"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235663"><span class="hs-identifier hs-var">i</span></a></span></span><span>
</span><span id="line-138"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235664"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235678"><span class="hs-identifier hs-var">height</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235678"><span class="hs-identifier hs-var">height</span></a></span><span>
</span><span id="line-139"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Vector Int
</span><a href="#local-6989586621679235682"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Int -&gt; Int -&gt; Int
forall a. Unbox a =&gt; Vector a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`V.unsafeIndex`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235664"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235663"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235664"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-140"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
</span><a href="#local-6989586621679235669"><span class="hs-identifier hs-var">nextEnd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235664"><span class="hs-identifier hs-var">e</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235663"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-141"></span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span class="hs-comment">-- | Given a rectangular matrix M, calculate the symmetric square</span><span>
</span><span id="line-144"></span><span class="hs-comment">-- matrix M&#7488;M which can be used to find a least squares solution to</span><span>
</span><span id="line-145"></span><span class="hs-comment">-- the overconstrained system.</span><span>
</span><span id="line-146"></span><span id="local-6989586621679235793"><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#lsqMatrix"><span class="hs-identifier hs-type">lsqMatrix</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679235793"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Unbox</span></span><span> </span><span class="annot"><a href="#local-6989586621679235793"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-147"></span><span>             </span><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#SparseMatrix"><span class="hs-identifier hs-type">SparseMatrix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679235793"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-148"></span><span>             </span><span class="hs-comment">-- ^ The input system.</span><span>
</span><span id="line-149"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Matrix</span></span><span> </span><span class="annot"><a href="#local-6989586621679235793"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-150"></span><span>             </span><span class="hs-comment">-- ^ The resulting symmetric matrix as a sparse matrix.</span><span>
</span><span id="line-151"></span><span>             </span><span class="hs-comment">-- The first element of each row is the element on the</span><span>
</span><span id="line-152"></span><span>             </span><span class="hs-comment">-- diagonal.</span></span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span id="lsqMatrix"><span class="annot"><span class="annottext">lsqMatrix :: SparseMatrix a -&gt; Matrix a
</span><a href="Geom2D.CubicBezier.Numeric.html#lsqMatrix"><span class="hs-identifier hs-var hs-var">lsqMatrix</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#SparseMatrix"><span class="hs-identifier hs-type">SparseMatrix</span></a></span><span> </span><span id="local-6989586621679235661"><span class="annot"><span class="annottext">Vector Int
</span><a href="#local-6989586621679235661"><span class="hs-identifier hs-var">rowStart</span></a></span></span><span> </span><span id="local-6989586621679235660"><span class="annot"><span class="annottext">Vector (Int, Int)
</span><a href="#local-6989586621679235660"><span class="hs-identifier hs-var">ranges</span></a></span></span><span> </span><span id="local-6989586621679235659"><span class="annot"><span class="annottext">Matrix a
</span><a href="#local-6989586621679235659"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-155"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Vector Int -&gt; Int
forall a. Unbox a =&gt; Vector a -&gt; Int
</span><span class="hs-identifier hs-var">V.length</span></span><span> </span><span class="annot"><span class="annottext">Vector Int
</span><a href="#local-6989586621679235661"><span class="hs-identifier hs-var">rowStart</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235657"><span class="hs-identifier hs-var">height</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-156"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; Matrix a
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;lsqMatrix: lengths don't match.&quot;</span></span><span>
</span><span id="line-157"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; ((Int, Int) -&gt; a) -&gt; Matrix a
forall a. Context a =&gt; (Int, Int) -&gt; ((Int, Int) -&gt; a) -&gt; Matrix a
</span><span class="hs-identifier hs-var">M.generate</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235654"><span class="hs-identifier hs-var">vars</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235653"><span class="hs-identifier hs-var">width</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; a
</span><a href="#local-6989586621679235652"><span class="hs-identifier hs-var">coeff</span></a></span><span>
</span><span id="line-158"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-159"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679235657"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235657"><span class="hs-identifier hs-var">height</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679235653"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235653"><span class="hs-identifier hs-var">width</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Matrix a -&gt; (Int, Int)
forall a. Context a =&gt; Matrix a -&gt; (Int, Int)
</span><span class="hs-identifier hs-var">dim</span></span><span> </span><span class="annot"><span class="annottext">Matrix a
</span><a href="#local-6989586621679235659"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-160"></span><span>    </span><span id="local-6989586621679235654"><span class="annot"><span class="annottext">vars :: Int
</span><a href="#local-6989586621679235654"><span class="hs-identifier hs-var hs-var">vars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector Int -&gt; Int
forall a. Unbox a =&gt; Vector a -&gt; a
</span><span class="hs-identifier hs-var">V.last</span></span><span> </span><span class="annot"><span class="annottext">Vector Int
</span><a href="#local-6989586621679235661"><span class="hs-identifier hs-var">rowStart</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235653"><span class="hs-identifier hs-var">width</span></a></span><span>
</span><span id="line-161"></span><span>    </span><span id="local-6989586621679235650"><span class="annot"><span class="annottext">overlap :: (a, b) -&gt; (a, b) -&gt; (a, b)
</span><a href="#local-6989586621679235650"><span class="hs-identifier hs-var hs-var">overlap</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679235649"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235649"><span class="hs-identifier hs-var">s1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679235648"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679235648"><span class="hs-identifier hs-var">e1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679235647"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235647"><span class="hs-identifier hs-var">s2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679235646"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679235646"><span class="hs-identifier hs-var">e2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-162"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">max</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235649"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235647"><span class="hs-identifier hs-var">s2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b -&gt; b -&gt; b
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">min</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679235648"><span class="hs-identifier hs-var">e1</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679235646"><span class="hs-identifier hs-var">e2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-163"></span><span>    </span><span id="local-6989586621679235643"><span class="annot"><span class="annottext">realIndex :: (Int, Int) -&gt; (Int, Int)
</span><a href="#local-6989586621679235643"><span class="hs-identifier hs-var hs-var">realIndex</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679235642"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235642"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679235641"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235641"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-164"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235642"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235641"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Vector Int
</span><a href="#local-6989586621679235661"><span class="hs-identifier hs-var">rowStart</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Int -&gt; Int -&gt; Int
forall a. Unbox a =&gt; Vector a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`V.unsafeIndex`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235642"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-165"></span><span>    </span><span id="local-6989586621679235652"><span class="annot"><span class="annottext">coeff :: (Int, Int) -&gt; a
</span><a href="#local-6989586621679235652"><span class="hs-identifier hs-var hs-var">coeff</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679235640"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235640"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679235639"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235639"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span>
</span><span id="line-166"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679235638"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235638"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679235637"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235637"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235640"><span class="hs-identifier hs-var">r</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235639"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235654"><span class="hs-identifier hs-var">vars</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-168"></span><span>                 </span><span class="annot"><span class="annottext">(Int, Int) -&gt; (Int, Int) -&gt; (Int, Int)
forall a b. (Ord a, Ord b) =&gt; (a, b) -&gt; (a, b) -&gt; (a, b)
</span><a href="#local-6989586621679235650"><span class="hs-identifier hs-var">overlap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector (Int, Int)
</span><a href="#local-6989586621679235660"><span class="hs-identifier hs-var">ranges</span></a></span><span> </span><span class="annot"><span class="annottext">Vector (Int, Int) -&gt; Int -&gt; (Int, Int)
forall a. Unbox a =&gt; Vector a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`V.unsafeIndex`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235640"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector (Int, Int)
</span><a href="#local-6989586621679235660"><span class="hs-identifier hs-var">ranges</span></a></span><span> </span><span class="annot"><span class="annottext">Vector (Int, Int) -&gt; Int -&gt; (Int, Int)
forall a. Unbox a =&gt; Vector a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`V.unsafeIndex`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235640"><span class="hs-identifier hs-var">r</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235639"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-169"></span><span>      </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(a -&gt; Int -&gt; a) -&gt; a -&gt; Vector Int -&gt; a
forall b a. Unbox b =&gt; (a -&gt; b -&gt; a) -&gt; a -&gt; Vector b -&gt; a
</span><span class="hs-identifier hs-var">V.foldl'</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679235635"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235635"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621679235634"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235634"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235635"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Matrix a
</span><a href="#local-6989586621679235659"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix a -&gt; (Int, Int) -&gt; a
forall a. Context a =&gt; Matrix a -&gt; (Int, Int) -&gt; a
</span><span class="hs-operator hs-var">`M.unsafeIndex`</span></span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; (Int, Int)
</span><a href="#local-6989586621679235643"><span class="hs-identifier hs-var">realIndex</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235634"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235640"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span>
</span><span id="line-170"></span><span>                             </span><span class="annot"><span class="annottext">Matrix a
</span><a href="#local-6989586621679235659"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix a -&gt; (Int, Int) -&gt; a
forall a. Context a =&gt; Matrix a -&gt; (Int, Int) -&gt; a
</span><span class="hs-operator hs-var">`M.unsafeIndex`</span></span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; (Int, Int)
</span><a href="#local-6989586621679235643"><span class="hs-identifier hs-var">realIndex</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235634"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235640"><span class="hs-identifier hs-var">r</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235639"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">(Vector Int -&gt; a) -&gt; Vector Int -&gt; a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-171"></span><span>         </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Vector Int
forall a. (Unbox a, Num a) =&gt; a -&gt; Int -&gt; Vector a
</span><span class="hs-identifier hs-var">V.enumFromN</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235638"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235637"><span class="hs-identifier hs-var">e</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235638"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-172"></span><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#lsqMatrix"><span class="hs-pragma hs-type">lsqMatrix</span></a></span><span> </span><span class="hs-pragma">::</span><span> </span><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#SparseMatrix"><span class="hs-pragma hs-type">SparseMatrix</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">Double</span></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><span class="hs-pragma hs-type">M.Matrix</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">Double</span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-173"></span><span>
</span><span id="line-174"></span><span id="local-6989586621679235790"><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#addMatrix"><span class="hs-identifier hs-type">addMatrix</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679235790"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Unbox</span></span><span> </span><span class="annot"><a href="#local-6989586621679235790"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Matrix</span></span><span> </span><span class="annot"><a href="#local-6989586621679235790"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Matrix</span></span><span> </span><span class="annot"><a href="#local-6989586621679235790"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Matrix</span></span><span> </span><span class="annot"><a href="#local-6989586621679235790"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-175"></span><span id="addMatrix"><span class="annot"><span class="annottext">addMatrix :: Matrix a -&gt; Matrix a -&gt; Matrix a
</span><a href="Geom2D.CubicBezier.Numeric.html#addMatrix"><span class="hs-identifier hs-var hs-var">addMatrix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; a -&gt; a) -&gt; Matrix a -&gt; Matrix a -&gt; Matrix a
forall a b c.
(Context a, Context b, Context c) =&gt;
(a -&gt; b -&gt; c) -&gt; Matrix a -&gt; Matrix b -&gt; Matrix c
</span><span class="hs-identifier hs-var">M.zipWith</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(+)</span></span><span>
</span><span id="line-176"></span><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#addMatrix"><span class="hs-pragma hs-type">addMatrix</span></a></span><span> </span><span class="hs-pragma">::</span><span> </span><span class="annot"><span class="hs-pragma hs-type">M.Matrix</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">Double</span></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><span class="hs-pragma hs-type">M.Matrix</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">Double</span></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><span class="hs-pragma hs-type">M.Matrix</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">Double</span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span id="local-6989586621679235791"><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#addVec"><span class="hs-identifier hs-type">addVec</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679235791"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Unbox</span></span><span> </span><span class="annot"><a href="#local-6989586621679235791"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V.Vector</span></span><span> </span><span class="annot"><a href="#local-6989586621679235791"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V.Vector</span></span><span> </span><span class="annot"><a href="#local-6989586621679235791"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V.Vector</span></span><span> </span><span class="annot"><a href="#local-6989586621679235791"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-179"></span><span id="addVec"><span class="annot"><span class="annottext">addVec :: Vector a -&gt; Vector a -&gt; Vector a
</span><a href="Geom2D.CubicBezier.Numeric.html#addVec"><span class="hs-identifier hs-var hs-var">addVec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; a -&gt; a) -&gt; Vector a -&gt; Vector a -&gt; Vector a
forall a b c.
(Unbox a, Unbox b, Unbox c) =&gt;
(a -&gt; b -&gt; c) -&gt; Vector a -&gt; Vector b -&gt; Vector c
</span><span class="hs-identifier hs-var">V.zipWith</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(+)</span></span><span>
</span><span id="line-180"></span><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#addVec"><span class="hs-pragma hs-type">addVec</span></a></span><span> </span><span class="hs-pragma">::</span><span> </span><span class="annot"><span class="hs-pragma hs-type">V.Vector</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">Double</span></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><span class="hs-pragma hs-type">V.Vector</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">Double</span></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><span class="hs-pragma hs-type">V.Vector</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">Double</span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-181"></span><span>
</span><span id="line-182"></span><span class="hs-comment">-- | Multiply the vector by the transpose of the sparse matrix.</span><span>
</span><span id="line-183"></span><span id="local-6989586621679235795"><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#sparseMulT"><span class="hs-identifier hs-type">sparseMulT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679235795"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Unbox</span></span><span> </span><span class="annot"><a href="#local-6989586621679235795"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-184"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">V.Vector</span></span><span> </span><span class="annot"><a href="#local-6989586621679235795"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-185"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#SparseMatrix"><span class="hs-identifier hs-type">SparseMatrix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679235795"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-186"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V.Vector</span></span><span> </span><span class="annot"><a href="#local-6989586621679235795"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-187"></span><span id="sparseMulT"><span class="annot"><span class="annottext">sparseMulT :: Vector a -&gt; SparseMatrix a -&gt; Vector a
</span><a href="Geom2D.CubicBezier.Numeric.html#sparseMulT"><span class="hs-identifier hs-var hs-var">sparseMulT</span></a></span></span><span> </span><span id="local-6989586621679235630"><span class="annot"><span class="annottext">Vector a
</span><a href="#local-6989586621679235630"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#SparseMatrix"><span class="hs-identifier hs-type">SparseMatrix</span></a></span><span> </span><span id="local-6989586621679235629"><span class="annot"><span class="annottext">Vector Int
</span><a href="#local-6989586621679235629"><span class="hs-identifier hs-var">rowStart</span></a></span></span><span> </span><span id="local-6989586621679235628"><span class="annot"><span class="annottext">Vector (Int, Int)
</span><a href="#local-6989586621679235628"><span class="hs-identifier hs-var">ranges</span></a></span></span><span> </span><span id="local-6989586621679235627"><span class="annot"><span class="annottext">Matrix a
</span><a href="#local-6989586621679235627"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-188"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Vector a -&gt; Int
forall a. Unbox a =&gt; Vector a -&gt; Int
</span><span class="hs-identifier hs-var">V.length</span></span><span> </span><span class="annot"><span class="annottext">Vector a
</span><a href="#local-6989586621679235630"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235626"><span class="hs-identifier hs-var">height</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-189"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; Vector a
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;sparseMulT: lengths don't match.&quot;</span></span><span>
</span><span id="line-190"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; (Int -&gt; a) -&gt; Vector a
forall a. Unbox a =&gt; Int -&gt; (Int -&gt; a) -&gt; Vector a
</span><span class="hs-identifier hs-var">V.generate</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235624"><span class="hs-identifier hs-var">vars</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; a
</span><a href="#local-6989586621679235623"><span class="hs-identifier hs-var">coeff</span></a></span><span>
</span><span id="line-191"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679235626"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235626"><span class="hs-identifier hs-var">height</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679235622"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235622"><span class="hs-identifier hs-var">width</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Matrix a -&gt; (Int, Int)
forall a. Context a =&gt; Matrix a -&gt; (Int, Int)
</span><span class="hs-identifier hs-var">dim</span></span><span> </span><span class="annot"><span class="annottext">Matrix a
</span><a href="#local-6989586621679235627"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-192"></span><span>        </span><span id="local-6989586621679235624"><span class="annot"><span class="annottext">vars :: Int
</span><a href="#local-6989586621679235624"><span class="hs-identifier hs-var hs-var">vars</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Vector Int -&gt; Bool
forall a. Unbox a =&gt; Vector a -&gt; Bool
</span><span class="hs-identifier hs-var">V.null</span></span><span> </span><span class="annot"><span class="annottext">Vector Int
</span><a href="#local-6989586621679235629"><span class="hs-identifier hs-var">rowStart</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-193"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector Int -&gt; Int
forall a. Unbox a =&gt; Vector a -&gt; a
</span><span class="hs-identifier hs-var">V.unsafeLast</span></span><span> </span><span class="annot"><span class="annottext">Vector Int
</span><a href="#local-6989586621679235629"><span class="hs-identifier hs-var">rowStart</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235622"><span class="hs-identifier hs-var">width</span></a></span><span>
</span><span id="line-194"></span><span>        </span><span id="local-6989586621679235619"><span class="annot"><span class="annottext">realIndex :: (Int, Int) -&gt; (Int, Int)
</span><a href="#local-6989586621679235619"><span class="hs-identifier hs-var hs-var">realIndex</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679235618"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235618"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679235617"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235617"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-195"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235618"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235617"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Vector Int
</span><a href="#local-6989586621679235629"><span class="hs-identifier hs-var">rowStart</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Int -&gt; Int -&gt; Int
forall a. Unbox a =&gt; Vector a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`V.unsafeIndex`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235618"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-196"></span><span>        </span><span id="local-6989586621679235623"><span class="annot"><span class="annottext">coeff :: Int -&gt; a
</span><a href="#local-6989586621679235623"><span class="hs-identifier hs-var hs-var">coeff</span></a></span></span><span> </span><span id="local-6989586621679235616"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235616"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-197"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679235615"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235615"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679235614"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235614"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector (Int, Int)
</span><a href="#local-6989586621679235628"><span class="hs-identifier hs-var">ranges</span></a></span><span> </span><span class="annot"><span class="annottext">Vector (Int, Int) -&gt; Int -&gt; (Int, Int)
forall a. Unbox a =&gt; Vector a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`V.unsafeIndex`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235616"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-198"></span><span>          </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(a -&gt; Int -&gt; a) -&gt; a -&gt; Vector Int -&gt; a
forall b a. Unbox b =&gt; (a -&gt; b -&gt; a) -&gt; a -&gt; Vector b -&gt; a
</span><span class="hs-identifier hs-var">V.foldl'</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679235613"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235613"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621679235612"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235612"><span class="hs-identifier hs-var">j</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-199"></span><span>                        </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235613"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Matrix a
</span><a href="#local-6989586621679235627"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix a -&gt; (Int, Int) -&gt; a
forall a. Context a =&gt; Matrix a -&gt; (Int, Int) -&gt; a
</span><span class="hs-operator hs-var">`M.unsafeIndex`</span></span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; (Int, Int)
</span><a href="#local-6989586621679235619"><span class="hs-identifier hs-var">realIndex</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235612"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235616"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span>
</span><span id="line-200"></span><span>                        </span><span class="annot"><span class="annottext">Vector a
</span><a href="#local-6989586621679235630"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Vector a -&gt; Int -&gt; a
forall a. Unbox a =&gt; Vector a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`V.unsafeIndex`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235612"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">(Vector Int -&gt; a) -&gt; Vector Int -&gt; a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-201"></span><span>             </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Vector Int
forall a. (Unbox a, Num a) =&gt; a -&gt; Int -&gt; Vector a
</span><span class="hs-identifier hs-var">V.enumFromN</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235615"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235614"><span class="hs-identifier hs-var">e</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235615"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-202"></span><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#sparseMulT"><span class="hs-pragma hs-type">sparseMulT</span></a></span><span> </span><span class="hs-pragma">::</span><span> </span><span class="annot"><span class="hs-pragma hs-type">V.Vector</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">Double</span></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#SparseMatrix"><span class="hs-pragma hs-type">SparseMatrix</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">Double</span></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><span class="hs-pragma hs-type">V.Vector</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">Double</span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-203"></span><span>
</span><span id="line-204"></span><span class="hs-comment">-- | Sparse matrix * vector multiplication.</span><span>
</span><span id="line-205"></span><span id="local-6989586621679235611"><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#sparseMul"><span class="hs-identifier hs-type">sparseMul</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679235611"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Unbox</span></span><span> </span><span class="annot"><a href="#local-6989586621679235611"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-206"></span><span>              </span><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#SparseMatrix"><span class="hs-identifier hs-type">SparseMatrix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679235611"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-207"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V.Vector</span></span><span> </span><span class="annot"><a href="#local-6989586621679235611"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-208"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V.Vector</span></span><span> </span><span class="annot"><a href="#local-6989586621679235611"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-209"></span><span id="sparseMul"><span class="annot"><span class="annottext">sparseMul :: SparseMatrix a -&gt; Vector a -&gt; Vector a
</span><a href="Geom2D.CubicBezier.Numeric.html#sparseMul"><span class="hs-identifier hs-var hs-var">sparseMul</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#SparseMatrix"><span class="hs-identifier hs-type">SparseMatrix</span></a></span><span> </span><span id="local-6989586621679235610"><span class="annot"><span class="annottext">Vector Int
</span><a href="#local-6989586621679235610"><span class="hs-identifier hs-var">rowStart</span></a></span></span><span> </span><span id="local-6989586621679235609"><span class="annot"><span class="annottext">Vector (Int, Int)
</span><a href="#local-6989586621679235609"><span class="hs-identifier hs-var">_ranges</span></a></span></span><span> </span><span id="local-6989586621679235608"><span class="annot"><span class="annottext">Matrix a
</span><a href="#local-6989586621679235608"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679235607"><span class="annot"><span class="annottext">Vector a
</span><a href="#local-6989586621679235607"><span class="hs-identifier hs-var">v</span></a></span></span><span>
</span><span id="line-210"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Vector a -&gt; Int
forall a. Unbox a =&gt; Vector a -&gt; Int
</span><span class="hs-identifier hs-var">V.length</span></span><span> </span><span class="annot"><span class="annottext">Vector a
</span><a href="#local-6989586621679235607"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235606"><span class="hs-identifier hs-var">vars</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-211"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; Vector a
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;sparseMulT: lengths don't match.&quot;</span></span><span>
</span><span id="line-212"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; (Int -&gt; a) -&gt; Vector a
forall a. Unbox a =&gt; Int -&gt; (Int -&gt; a) -&gt; Vector a
</span><span class="hs-identifier hs-var">V.generate</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235605"><span class="hs-identifier hs-var">height</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; a
</span><a href="#local-6989586621679235604"><span class="hs-identifier hs-var">coeff</span></a></span><span>
</span><span id="line-213"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679235605"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235605"><span class="hs-identifier hs-var">height</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679235603"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235603"><span class="hs-identifier hs-var">width</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Matrix a -&gt; (Int, Int)
forall a. Context a =&gt; Matrix a -&gt; (Int, Int)
</span><span class="hs-identifier hs-var">dim</span></span><span> </span><span class="annot"><span class="annottext">Matrix a
</span><a href="#local-6989586621679235608"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-214"></span><span>        </span><span id="local-6989586621679235606"><span class="annot"><span class="annottext">vars :: Int
</span><a href="#local-6989586621679235606"><span class="hs-identifier hs-var hs-var">vars</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Vector Int -&gt; Bool
forall a. Unbox a =&gt; Vector a -&gt; Bool
</span><span class="hs-identifier hs-var">V.null</span></span><span> </span><span class="annot"><span class="annottext">Vector Int
</span><a href="#local-6989586621679235610"><span class="hs-identifier hs-var">rowStart</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-215"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector Int -&gt; Int
forall a. Unbox a =&gt; Vector a -&gt; a
</span><span class="hs-identifier hs-var">V.unsafeLast</span></span><span> </span><span class="annot"><span class="annottext">Vector Int
</span><a href="#local-6989586621679235610"><span class="hs-identifier hs-var">rowStart</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235603"><span class="hs-identifier hs-var">width</span></a></span><span>
</span><span id="line-216"></span><span>        </span><span id="local-6989586621679235604"><span class="annot"><span class="annottext">coeff :: Int -&gt; a
</span><a href="#local-6989586621679235604"><span class="hs-identifier hs-var hs-var">coeff</span></a></span></span><span> </span><span id="local-6989586621679235602"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235602"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector a -&gt; a
forall a. (Unbox a, Num a) =&gt; Vector a -&gt; a
</span><span class="hs-identifier hs-var">V.sum</span></span><span> </span><span class="annot"><span class="annottext">(Vector a -&gt; a) -&gt; Vector a -&gt; a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; a -&gt; a) -&gt; Vector a -&gt; Vector a -&gt; Vector a
forall a b c.
(Unbox a, Unbox b, Unbox c) =&gt;
(a -&gt; b -&gt; c) -&gt; Vector a -&gt; Vector b -&gt; Vector c
</span><span class="hs-identifier hs-var">V.zipWith</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(*)</span></span><span>
</span><span id="line-217"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Vector a -&gt; Vector a
forall a. Unbox a =&gt; Int -&gt; Int -&gt; Vector a -&gt; Vector a
</span><span class="hs-identifier hs-var">V.unsafeSlice</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector Int
</span><a href="#local-6989586621679235610"><span class="hs-identifier hs-var">rowStart</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Int -&gt; Int -&gt; Int
forall a. Unbox a =&gt; Vector a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">V.!</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235602"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235603"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Vector a
</span><a href="#local-6989586621679235607"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-218"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Matrix a -&gt; Int -&gt; Vector a
forall (m :: (* -&gt; *) -&gt; * -&gt; *) (v :: * -&gt; *) a.
Matrix m v a =&gt;
m v a -&gt; Int -&gt; v a
</span><span class="hs-identifier hs-var">G.unsafeTakeRow</span></span><span> </span><span class="annot"><span class="annottext">Matrix a
</span><a href="#local-6989586621679235608"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235602"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-219"></span><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#sparseMul"><span class="hs-pragma hs-type">sparseMul</span></a></span><span> </span><span class="hs-pragma">::</span><span> </span><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#SparseMatrix"><span class="hs-pragma hs-type">SparseMatrix</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">Double</span></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><span class="hs-pragma hs-type">V.Vector</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">Double</span></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><span class="hs-pragma hs-type">V.Vector</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">Double</span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-220"></span><span>
</span><span id="line-221"></span><span class="hs-comment">-- | LDL* decomposition of the sparse hermitian matrix.  The</span><span>
</span><span id="line-222"></span><span class="hs-comment">-- first element of each row is the diagonal component of the D</span><span>
</span><span id="line-223"></span><span class="hs-comment">-- matrix.  The following elements are the elements next to the</span><span>
</span><span id="line-224"></span><span class="hs-comment">-- diagonal in the L* matrix (the diagonal components in L* are 1).</span><span>
</span><span id="line-225"></span><span class="hs-comment">-- For efficiency it mutates the matrix inplace.</span><span>
</span><span id="line-226"></span><span id="local-6989586621679235794"><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#decompLDL"><span class="hs-identifier hs-type">decompLDL</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679235794"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Unbox</span></span><span> </span><span class="annot"><a href="#local-6989586621679235794"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Matrix</span></span><span> </span><span class="annot"><a href="#local-6989586621679235794"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Matrix</span></span><span> </span><span class="annot"><a href="#local-6989586621679235794"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-227"></span><span id="decompLDL"><span class="annot"><span class="annottext">decompLDL :: Matrix a -&gt; Matrix a
</span><a href="Geom2D.CubicBezier.Numeric.html#decompLDL"><span class="hs-identifier hs-var hs-var">decompLDL</span></a></span></span><span> </span><span id="local-6989586621679235597"><span class="annot"><span class="annottext">Matrix a
</span><a href="#local-6989586621679235597"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall s. ST s (Matrix a)) -&gt; Matrix a
forall a. (forall s. ST s a) -&gt; a
</span><span class="hs-identifier hs-var">runST</span></span><span> </span><span class="annot"><span class="annottext">((forall s. ST s (Matrix a)) -&gt; Matrix a)
-&gt; (forall s. ST s (Matrix a)) -&gt; Matrix a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-228"></span><span>  </span><span id="local-6989586621679235595"><span class="annot"><span class="annottext">MMatrix s a
</span><a href="#local-6989586621679235595"><span class="hs-identifier hs-var">m2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Matrix a -&gt; ST s (MMatrix (PrimState (ST s)) a)
forall a (s :: * -&gt; *).
(Context a, PrimMonad s) =&gt;
Matrix a -&gt; s (MMatrix (PrimState s) a)
</span><span class="hs-identifier hs-var">M.thaw</span></span><span> </span><span class="annot"><span class="annottext">Matrix a
</span><a href="#local-6989586621679235597"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-229"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679235593"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235593"><span class="hs-identifier hs-var">vars</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679235592"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235592"><span class="hs-identifier hs-var">width</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Matrix a -&gt; (Int, Int)
forall a. Context a =&gt; Matrix a -&gt; (Int, Int)
</span><span class="hs-identifier hs-var">dim</span></span><span> </span><span class="annot"><span class="annottext">Matrix a
</span><a href="#local-6989586621679235597"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-230"></span><span>  </span><span class="annot"><span class="annottext">Vector Int -&gt; (Int -&gt; ST s ()) -&gt; ST s ()
forall (m :: * -&gt; *) a b.
(Monad m, Unbox a) =&gt;
Vector a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">V.forM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Vector Int
forall a. (Unbox a, Num a) =&gt; a -&gt; Int -&gt; Vector a
</span><span class="hs-identifier hs-var">V.enumFromN</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Vector Int) -&gt; Int -&gt; Vector Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235593"><span class="hs-identifier hs-var">vars</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Int -&gt; ST s ()) -&gt; ST s ()) -&gt; (Int -&gt; ST s ()) -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-231"></span><span>    </span><span class="hs-glyph">\</span><span id="local-6989586621679235590"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235590"><span class="hs-identifier hs-var">startr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-232"></span><span>      </span><span id="local-6989586621679235589"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235589"><span class="hs-identifier hs-var">pivot</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MMatrix (PrimState (ST s)) a -&gt; (Int, Int) -&gt; ST s a
forall a (s :: * -&gt; *).
(Context a, PrimMonad s) =&gt;
MMatrix (PrimState s) a -&gt; (Int, Int) -&gt; s a
</span><span class="hs-identifier hs-var">MM.unsafeRead</span></span><span> </span><span class="annot"><span class="annottext">MMatrix s a
MMatrix (PrimState (ST s)) a
</span><a href="#local-6989586621679235595"><span class="hs-identifier hs-var">m2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235590"><span class="hs-identifier hs-var">startr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-233"></span><span>      </span><span class="annot"><span class="annottext">Vector Int -&gt; (Int -&gt; ST s ()) -&gt; ST s ()
forall (m :: * -&gt; *) a b.
(Monad m, Unbox a) =&gt;
Vector a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">V.forM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Vector Int
forall a. (Unbox a, Num a) =&gt; a -&gt; Int -&gt; Vector a
</span><span class="hs-identifier hs-var">V.enumFromN</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Vector Int) -&gt; Int -&gt; Vector Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235592"><span class="hs-identifier hs-var">width</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Int -&gt; ST s ()) -&gt; ST s ()) -&gt; (Int -&gt; ST s ()) -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-234"></span><span>        </span><span class="hs-glyph">\</span><span id="local-6989586621679235587"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235587"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-235"></span><span>          </span><span id="local-6989586621679235586"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235586"><span class="hs-identifier hs-var">el</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MMatrix (PrimState (ST s)) a -&gt; (Int, Int) -&gt; ST s a
forall a (s :: * -&gt; *).
(Context a, PrimMonad s) =&gt;
MMatrix (PrimState s) a -&gt; (Int, Int) -&gt; s a
</span><span class="hs-identifier hs-var">MM.unsafeRead</span></span><span> </span><span class="annot"><span class="annottext">MMatrix s a
MMatrix (PrimState (ST s)) a
</span><a href="#local-6989586621679235595"><span class="hs-identifier hs-var">m2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235590"><span class="hs-identifier hs-var">startr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235587"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-236"></span><span>          </span><span class="annot"><span class="annottext">MMatrix (PrimState (ST s)) a -&gt; (Int, Int) -&gt; a -&gt; ST s ()
forall a (s :: * -&gt; *).
(Context a, PrimMonad s) =&gt;
MMatrix (PrimState s) a -&gt; (Int, Int) -&gt; a -&gt; s ()
</span><span class="hs-identifier hs-var">MM.unsafeWrite</span></span><span> </span><span class="annot"><span class="annottext">MMatrix s a
MMatrix (PrimState (ST s)) a
</span><a href="#local-6989586621679235595"><span class="hs-identifier hs-var">m2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235590"><span class="hs-identifier hs-var">startr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235587"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235586"><span class="hs-identifier hs-var">el</span></a></span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235589"><span class="hs-identifier hs-var">pivot</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-237"></span><span>      </span><span class="annot"><span class="annottext">Vector Int -&gt; (Int -&gt; ST s ()) -&gt; ST s ()
forall (m :: * -&gt; *) a b.
(Monad m, Unbox a) =&gt;
Vector a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">V.forM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Vector Int
forall a. (Unbox a, Num a) =&gt; a -&gt; Int -&gt; Vector a
</span><span class="hs-identifier hs-var">V.enumFromN</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Vector Int) -&gt; Int -&gt; Vector Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">min</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235592"><span class="hs-identifier hs-var">width</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int) -&gt; Int -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235593"><span class="hs-identifier hs-var">vars</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235590"><span class="hs-identifier hs-var">startr</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Int -&gt; ST s ()) -&gt; ST s ()) -&gt; (Int -&gt; ST s ()) -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-238"></span><span>        </span><span class="hs-glyph">\</span><span id="local-6989586621679235584"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235584"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-239"></span><span>         </span><span id="local-6989586621679235583"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235583"><span class="hs-identifier hs-var">r0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MMatrix (PrimState (ST s)) a -&gt; (Int, Int) -&gt; ST s a
forall a (s :: * -&gt; *).
(Context a, PrimMonad s) =&gt;
MMatrix (PrimState s) a -&gt; (Int, Int) -&gt; s a
</span><span class="hs-identifier hs-var">MM.unsafeRead</span></span><span> </span><span class="annot"><span class="annottext">MMatrix s a
MMatrix (PrimState (ST s)) a
</span><a href="#local-6989586621679235595"><span class="hs-identifier hs-var">m2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235590"><span class="hs-identifier hs-var">startr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235584"><span class="hs-identifier hs-var">r</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-240"></span><span>         </span><span class="annot"><span class="annottext">Vector Int -&gt; (Int -&gt; ST s ()) -&gt; ST s ()
forall (m :: * -&gt; *) a b.
(Monad m, Unbox a) =&gt;
Vector a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">V.forM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Vector Int
forall a. (Unbox a, Num a) =&gt; a -&gt; Int -&gt; Vector a
</span><span class="hs-identifier hs-var">V.enumFromN</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235592"><span class="hs-identifier hs-var">width</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235584"><span class="hs-identifier hs-var">r</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Int -&gt; ST s ()) -&gt; ST s ()) -&gt; (Int -&gt; ST s ()) -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-241"></span><span>              </span><span class="hs-glyph">\</span><span id="local-6989586621679235582"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235582"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679235581"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235581"><span class="hs-identifier hs-var">r1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MMatrix (PrimState (ST s)) a -&gt; (Int, Int) -&gt; ST s a
forall a (s :: * -&gt; *).
(Context a, PrimMonad s) =&gt;
MMatrix (PrimState s) a -&gt; (Int, Int) -&gt; s a
</span><span class="hs-identifier hs-var">MM.unsafeRead</span></span><span> </span><span class="annot"><span class="annottext">MMatrix s a
MMatrix (PrimState (ST s)) a
</span><a href="#local-6989586621679235595"><span class="hs-identifier hs-var">m2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235590"><span class="hs-identifier hs-var">startr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235584"><span class="hs-identifier hs-var">r</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235582"><span class="hs-identifier hs-var">c</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-242"></span><span>                       </span><span id="local-6989586621679235580"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235580"><span class="hs-identifier hs-var">el</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MMatrix (PrimState (ST s)) a -&gt; (Int, Int) -&gt; ST s a
forall a (s :: * -&gt; *).
(Context a, PrimMonad s) =&gt;
MMatrix (PrimState s) a -&gt; (Int, Int) -&gt; s a
</span><span class="hs-identifier hs-var">MM.unsafeRead</span></span><span> </span><span class="annot"><span class="annottext">MMatrix s a
MMatrix (PrimState (ST s)) a
</span><a href="#local-6989586621679235595"><span class="hs-identifier hs-var">m2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235584"><span class="hs-identifier hs-var">r</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235590"><span class="hs-identifier hs-var">startr</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235582"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-243"></span><span>                       </span><span class="annot"><span class="annottext">MMatrix (PrimState (ST s)) a -&gt; (Int, Int) -&gt; a -&gt; ST s ()
forall a (s :: * -&gt; *).
(Context a, PrimMonad s) =&gt;
MMatrix (PrimState s) a -&gt; (Int, Int) -&gt; a -&gt; s ()
</span><span class="hs-identifier hs-var">MM.unsafeWrite</span></span><span> </span><span class="annot"><span class="annottext">MMatrix s a
MMatrix (PrimState (ST s)) a
</span><a href="#local-6989586621679235595"><span class="hs-identifier hs-var">m2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235584"><span class="hs-identifier hs-var">r</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235590"><span class="hs-identifier hs-var">startr</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235582"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-244"></span><span>                         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235580"><span class="hs-identifier hs-var">el</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235583"><span class="hs-identifier hs-var">r0</span></a></span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235581"><span class="hs-identifier hs-var">r1</span></a></span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235589"><span class="hs-identifier hs-var">pivot</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-245"></span><span>  </span><span class="annot"><span class="annottext">MMatrix (PrimState (ST s)) a -&gt; ST s (Matrix a)
forall a (s :: * -&gt; *).
(Context a, PrimMonad s) =&gt;
MMatrix (PrimState s) a -&gt; s (Matrix a)
</span><span class="hs-identifier hs-var">M.unsafeFreeze</span></span><span> </span><span class="annot"><span class="annottext">MMatrix s a
MMatrix (PrimState (ST s)) a
</span><a href="#local-6989586621679235595"><span class="hs-identifier hs-var">m2</span></a></span><span>
</span><span id="line-246"></span><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#decompLDL"><span class="hs-pragma hs-type">decompLDL</span></a></span><span> </span><span class="hs-pragma">::</span><span> </span><span class="annot"><span class="hs-pragma hs-type">Matrix</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">Double</span></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><span class="hs-pragma hs-type">Matrix</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">Double</span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-247"></span><span>
</span><span id="line-248"></span><span id="local-6989586621679235796"><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#solveLDL"><span class="hs-identifier hs-type">solveLDL</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679235796"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Unbox</span></span><span> </span><span class="annot"><a href="#local-6989586621679235796"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-249"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">M.Matrix</span></span><span> </span><span class="annot"><a href="#local-6989586621679235796"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V.Vector</span></span><span> </span><span class="annot"><a href="#local-6989586621679235796"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V.Vector</span></span><span> </span><span class="annot"><a href="#local-6989586621679235796"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-250"></span><span id="solveLDL"><span class="annot"><span class="annottext">solveLDL :: Matrix a -&gt; Vector a -&gt; Vector a
</span><a href="Geom2D.CubicBezier.Numeric.html#solveLDL"><span class="hs-identifier hs-var hs-var">solveLDL</span></a></span></span><span> </span><span id="local-6989586621679235577"><span class="annot"><span class="annottext">Matrix a
</span><a href="#local-6989586621679235577"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621679235576"><span class="annot"><span class="annottext">Vector a
</span><a href="#local-6989586621679235576"><span class="hs-identifier hs-var">v</span></a></span></span><span>
</span><span id="line-251"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Matrix a -&gt; Int
forall a. Context a =&gt; Matrix a -&gt; Int
</span><span class="hs-identifier hs-var">rows</span></span><span> </span><span class="annot"><span class="annottext">Matrix a
</span><a href="#local-6989586621679235577"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Vector a -&gt; Int
forall a. Unbox a =&gt; Vector a -&gt; Int
</span><span class="hs-identifier hs-var">V.length</span></span><span> </span><span class="annot"><span class="annottext">Vector a
</span><a href="#local-6989586621679235576"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Vector a
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;solveLDL: lengths don't match&quot;</span></span><span>
</span><span id="line-252"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall s. ST s (Vector a)) -&gt; Vector a
forall a. (forall s. ST s a) -&gt; a
</span><span class="hs-identifier hs-var">runST</span></span><span> </span><span class="annot"><span class="annottext">((forall s. ST s (Vector a)) -&gt; Vector a)
-&gt; (forall s. ST s (Vector a)) -&gt; Vector a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-253"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679235574"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235574"><span class="hs-identifier hs-var">vars</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679235573"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235573"><span class="hs-identifier hs-var">width</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Matrix a -&gt; (Int, Int)
forall a. Context a =&gt; Matrix a -&gt; (Int, Int)
</span><span class="hs-identifier hs-var">M.dim</span></span><span> </span><span class="annot"><span class="annottext">Matrix a
</span><a href="#local-6989586621679235577"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-254"></span><span>      </span><span id="local-6989586621679235572"><span class="annot"><span class="annottext">MVector s a
</span><a href="#local-6989586621679235572"><span class="hs-identifier hs-var">sol1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ST s (MVector (PrimState (ST s)) a)
forall (m :: * -&gt; *) a.
(PrimMonad m, Unbox a) =&gt;
Int -&gt; m (MVector (PrimState m) a)
</span><span class="hs-identifier hs-var">MV.new</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235574"><span class="hs-identifier hs-var">vars</span></a></span><span>
</span><span id="line-255"></span><span>      </span><span class="hs-comment">-- forward substitution on the first (width) rows</span><span>
</span><span id="line-256"></span><span>      </span><span class="annot"><span class="annottext">Vector Int -&gt; (Int -&gt; ST s ()) -&gt; ST s ()
forall (m :: * -&gt; *) a b.
(Monad m, Unbox a) =&gt;
Vector a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">V.forM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Vector Int
forall a. (Unbox a, Num a) =&gt; a -&gt; Int -&gt; Vector a
</span><span class="hs-identifier hs-var">V.enumFromN</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Vector Int) -&gt; Int -&gt; Vector Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">min</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235574"><span class="hs-identifier hs-var">vars</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235573"><span class="hs-identifier hs-var">width</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Int -&gt; ST s ()) -&gt; ST s ()) -&gt; (Int -&gt; ST s ()) -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-257"></span><span>        </span><span class="hs-glyph">\</span><span id="local-6989586621679235570"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235570"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-258"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679235569"><span class="annot"><span class="annottext">vi :: a
</span><a href="#local-6989586621679235569"><span class="hs-identifier hs-var hs-var">vi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector a
</span><a href="#local-6989586621679235576"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Vector a -&gt; Int -&gt; a
forall a. Unbox a =&gt; Vector a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`V.unsafeIndex`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235570"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-259"></span><span>          </span><span id="local-6989586621679235568"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235568"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Vector a -&gt; a) -&gt; ST s (Vector a) -&gt; ST s a
forall (m :: * -&gt; *) a1 r. Monad m =&gt; (a1 -&gt; r) -&gt; m a1 -&gt; m r
</span><span class="hs-identifier hs-var">liftM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a -&gt; a -&gt; a) -&gt; a -&gt; Vector a -&gt; a
forall b a. Unbox b =&gt; (a -&gt; b -&gt; a) -&gt; a -&gt; Vector b -&gt; a
</span><span class="hs-identifier hs-var">V.foldl'</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235569"><span class="hs-identifier hs-var">vi</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ST s (Vector a) -&gt; ST s a) -&gt; ST s (Vector a) -&gt; ST s a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-260"></span><span>               </span><span class="annot"><span class="annottext">Vector Int -&gt; (Int -&gt; ST s a) -&gt; ST s (Vector a)
forall (m :: * -&gt; *) a b.
(Monad m, Unbox a, Unbox b) =&gt;
Vector a -&gt; (a -&gt; m b) -&gt; m (Vector b)
</span><span class="hs-identifier hs-var">V.forM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Vector Int
forall a. (Unbox a, Num a) =&gt; a -&gt; Int -&gt; Vector a
</span><span class="hs-identifier hs-var">V.enumFromN</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235570"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Int -&gt; ST s a) -&gt; ST s (Vector a))
-&gt; (Int -&gt; ST s a) -&gt; ST s (Vector a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-261"></span><span>               </span><span class="hs-glyph">\</span><span id="local-6989586621679235565"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235565"><span class="hs-identifier hs-var">j</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; ST s a -&gt; ST s a
forall (m :: * -&gt; *) a1 r. Monad m =&gt; (a1 -&gt; r) -&gt; m a1 -&gt; m r
</span><span class="hs-identifier hs-var">liftM</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Matrix a
</span><a href="#local-6989586621679235577"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix a -&gt; (Int, Int) -&gt; a
forall a. Context a =&gt; Matrix a -&gt; (Int, Int) -&gt; a
</span><span class="hs-operator hs-var">`M.unsafeIndex`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235565"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235570"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235565"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="hs-special">)</span><span>
</span><span id="line-262"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) a -&gt; Int -&gt; ST s a
forall (m :: * -&gt; *) a.
(PrimMonad m, Unbox a) =&gt;
MVector (PrimState m) a -&gt; Int -&gt; m a
</span><span class="hs-identifier hs-var">MV.unsafeRead</span></span><span> </span><span class="annot"><span class="annottext">MVector s a
MVector (PrimState (ST s)) a
</span><a href="#local-6989586621679235572"><span class="hs-identifier hs-var">sol1</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235565"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-263"></span><span>          </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) a -&gt; Int -&gt; a -&gt; ST s ()
forall (m :: * -&gt; *) a.
(PrimMonad m, Unbox a) =&gt;
MVector (PrimState m) a -&gt; Int -&gt; a -&gt; m ()
</span><span class="hs-identifier hs-var">MV.unsafeWrite</span></span><span> </span><span class="annot"><span class="annottext">MVector s a
MVector (PrimState (ST s)) a
</span><a href="#local-6989586621679235572"><span class="hs-identifier hs-var">sol1</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235570"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235568"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-264"></span><span>          </span><span>
</span><span id="line-265"></span><span>      </span><span class="hs-comment">-- forward substitution on the next (height-width) rows</span><span>
</span><span id="line-266"></span><span>      </span><span class="annot"><span class="annottext">Vector Int -&gt; (Int -&gt; ST s ()) -&gt; ST s ()
forall (m :: * -&gt; *) a b.
(Monad m, Unbox a) =&gt;
Vector a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">V.forM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Vector Int
forall a. (Unbox a, Num a) =&gt; a -&gt; Int -&gt; Vector a
</span><span class="hs-identifier hs-var">V.enumFromN</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235573"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Vector Int) -&gt; Int -&gt; Vector Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235574"><span class="hs-identifier hs-var">vars</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235573"><span class="hs-identifier hs-var">width</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Int -&gt; ST s ()) -&gt; ST s ()) -&gt; (Int -&gt; ST s ()) -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-267"></span><span>        </span><span class="hs-glyph">\</span><span id="local-6989586621679235562"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235562"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-268"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679235561"><span class="annot"><span class="annottext">vi :: a
</span><a href="#local-6989586621679235561"><span class="hs-identifier hs-var hs-var">vi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector a
</span><a href="#local-6989586621679235576"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Vector a -&gt; Int -&gt; a
forall a. Unbox a =&gt; Vector a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`V.unsafeIndex`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235562"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-269"></span><span>          </span><span id="local-6989586621679235560"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235560"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Vector a -&gt; a) -&gt; ST s (Vector a) -&gt; ST s a
forall (m :: * -&gt; *) a1 r. Monad m =&gt; (a1 -&gt; r) -&gt; m a1 -&gt; m r
</span><span class="hs-identifier hs-var">liftM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a -&gt; a -&gt; a) -&gt; a -&gt; Vector a -&gt; a
forall b a. Unbox b =&gt; (a -&gt; b -&gt; a) -&gt; a -&gt; Vector b -&gt; a
</span><span class="hs-identifier hs-var">V.foldl'</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235561"><span class="hs-identifier hs-var">vi</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ST s (Vector a) -&gt; ST s a) -&gt; ST s (Vector a) -&gt; ST s a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-270"></span><span>               </span><span class="annot"><span class="annottext">Vector Int -&gt; (Int -&gt; ST s a) -&gt; ST s (Vector a)
forall (m :: * -&gt; *) a b.
(Monad m, Unbox a, Unbox b) =&gt;
Vector a -&gt; (a -&gt; m b) -&gt; m (Vector b)
</span><span class="hs-identifier hs-var">V.forM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Vector Int
forall a. (Unbox a, Num a) =&gt; a -&gt; Int -&gt; Vector a
</span><span class="hs-identifier hs-var">V.enumFromN</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235573"><span class="hs-identifier hs-var">width</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Int -&gt; ST s a) -&gt; ST s (Vector a))
-&gt; (Int -&gt; ST s a) -&gt; ST s (Vector a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-271"></span><span>               </span><span class="hs-glyph">\</span><span id="local-6989586621679235559"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235559"><span class="hs-identifier hs-var">j</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; ST s a -&gt; ST s a
forall (m :: * -&gt; *) a1 r. Monad m =&gt; (a1 -&gt; r) -&gt; m a1 -&gt; m r
</span><span class="hs-identifier hs-var">liftM</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Matrix a
</span><a href="#local-6989586621679235577"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix a -&gt; (Int, Int) -&gt; a
forall a. Context a =&gt; Matrix a -&gt; (Int, Int) -&gt; a
</span><span class="hs-operator hs-var">`M.unsafeIndex`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235562"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235559"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235559"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="hs-special">)</span><span>
</span><span id="line-272"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) a -&gt; Int -&gt; ST s a
forall (m :: * -&gt; *) a.
(PrimMonad m, Unbox a) =&gt;
MVector (PrimState m) a -&gt; Int -&gt; m a
</span><span class="hs-identifier hs-var">MV.unsafeRead</span></span><span> </span><span class="annot"><span class="annottext">MVector s a
MVector (PrimState (ST s)) a
</span><a href="#local-6989586621679235572"><span class="hs-identifier hs-var">sol1</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; ST s a) -&gt; Int -&gt; ST s a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235562"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235559"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-273"></span><span>          </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) a -&gt; Int -&gt; a -&gt; ST s ()
forall (m :: * -&gt; *) a.
(PrimMonad m, Unbox a) =&gt;
MVector (PrimState m) a -&gt; Int -&gt; a -&gt; m ()
</span><span class="hs-identifier hs-var">MV.unsafeWrite</span></span><span> </span><span class="annot"><span class="annottext">MVector s a
MVector (PrimState (ST s)) a
</span><a href="#local-6989586621679235572"><span class="hs-identifier hs-var">sol1</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235562"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235560"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-274"></span><span>          </span><span>
</span><span id="line-275"></span><span>      </span><span class="hs-comment">-- backward substitution on the last (width) rows</span><span>
</span><span id="line-276"></span><span>      </span><span class="annot"><span class="annottext">Vector Int -&gt; (Int -&gt; ST s ()) -&gt; ST s ()
forall (m :: * -&gt; *) a b.
(Monad m, Unbox a) =&gt;
Vector a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">V.forM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Vector Int
forall a. (Unbox a, Num a) =&gt; a -&gt; Int -&gt; Vector a
</span><span class="hs-identifier hs-var">V.enumFromN</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Vector Int) -&gt; Int -&gt; Vector Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">min</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235574"><span class="hs-identifier hs-var">vars</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235573"><span class="hs-identifier hs-var">width</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Int -&gt; ST s ()) -&gt; ST s ()) -&gt; (Int -&gt; ST s ()) -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-277"></span><span>        </span><span class="hs-glyph">\</span><span id="local-6989586621679235558"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235558"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-278"></span><span>          </span><span id="local-6989586621679235557"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235557"><span class="hs-identifier hs-var">solI</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) a -&gt; Int -&gt; ST s a
forall (m :: * -&gt; *) a.
(PrimMonad m, Unbox a) =&gt;
MVector (PrimState m) a -&gt; Int -&gt; m a
</span><span class="hs-identifier hs-var">MV.unsafeRead</span></span><span> </span><span class="annot"><span class="annottext">MVector s a
MVector (PrimState (ST s)) a
</span><a href="#local-6989586621679235572"><span class="hs-identifier hs-var">sol1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235574"><span class="hs-identifier hs-var">vars</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235558"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-279"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679235556"><span class="annot"><span class="annottext">d :: a
</span><a href="#local-6989586621679235556"><span class="hs-identifier hs-var hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Matrix a
</span><a href="#local-6989586621679235577"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix a -&gt; (Int, Int) -&gt; a
forall a. Context a =&gt; Matrix a -&gt; (Int, Int) -&gt; a
</span><span class="hs-operator hs-var">`M.unsafeIndex`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235574"><span class="hs-identifier hs-var">vars</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235558"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-280"></span><span>          </span><span id="local-6989586621679235555"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235555"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Vector a -&gt; a) -&gt; ST s (Vector a) -&gt; ST s a
forall (m :: * -&gt; *) a1 r. Monad m =&gt; (a1 -&gt; r) -&gt; m a1 -&gt; m r
</span><span class="hs-identifier hs-var">liftM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a -&gt; a -&gt; a) -&gt; a -&gt; Vector a -&gt; a
forall b a. Unbox b =&gt; (a -&gt; b -&gt; a) -&gt; a -&gt; Vector b -&gt; a
</span><span class="hs-identifier hs-var">V.foldl'</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235557"><span class="hs-identifier hs-var">solI</span></a></span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235556"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ST s (Vector a) -&gt; ST s a) -&gt; ST s (Vector a) -&gt; ST s a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-281"></span><span>               </span><span class="annot"><span class="annottext">Vector Int -&gt; (Int -&gt; ST s a) -&gt; ST s (Vector a)
forall (m :: * -&gt; *) a b.
(Monad m, Unbox a, Unbox b) =&gt;
Vector a -&gt; (a -&gt; m b) -&gt; m (Vector b)
</span><span class="hs-identifier hs-var">V.forM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Vector Int
forall a. (Unbox a, Num a) =&gt; a -&gt; Int -&gt; Vector a
</span><span class="hs-identifier hs-var">V.enumFromN</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235558"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Int -&gt; ST s a) -&gt; ST s (Vector a))
-&gt; (Int -&gt; ST s a) -&gt; ST s (Vector a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-282"></span><span>               </span><span class="hs-glyph">\</span><span id="local-6989586621679235554"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235554"><span class="hs-identifier hs-var">j</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; ST s a -&gt; ST s a
forall (m :: * -&gt; *) a1 r. Monad m =&gt; (a1 -&gt; r) -&gt; m a1 -&gt; m r
</span><span class="hs-identifier hs-var">liftM</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Matrix a
</span><a href="#local-6989586621679235577"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix a -&gt; (Int, Int) -&gt; a
forall a. Context a =&gt; Matrix a -&gt; (Int, Int) -&gt; a
</span><span class="hs-operator hs-var">`M.unsafeIndex`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235574"><span class="hs-identifier hs-var">vars</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235558"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235554"><span class="hs-identifier hs-var">j</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="hs-special">)</span><span>
</span><span id="line-283"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) a -&gt; Int -&gt; ST s a
forall (m :: * -&gt; *) a.
(PrimMonad m, Unbox a) =&gt;
MVector (PrimState m) a -&gt; Int -&gt; m a
</span><span class="hs-identifier hs-var">MV.unsafeRead</span></span><span> </span><span class="annot"><span class="annottext">MVector s a
MVector (PrimState (ST s)) a
</span><a href="#local-6989586621679235572"><span class="hs-identifier hs-var">sol1</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; ST s a) -&gt; Int -&gt; ST s a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235574"><span class="hs-identifier hs-var">vars</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235558"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235554"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-284"></span><span>          </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) a -&gt; Int -&gt; a -&gt; ST s ()
forall (m :: * -&gt; *) a.
(PrimMonad m, Unbox a) =&gt;
MVector (PrimState m) a -&gt; Int -&gt; a -&gt; m ()
</span><span class="hs-identifier hs-var">MV.unsafeWrite</span></span><span> </span><span class="annot"><span class="annottext">MVector s a
MVector (PrimState (ST s)) a
</span><a href="#local-6989586621679235572"><span class="hs-identifier hs-var">sol1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235574"><span class="hs-identifier hs-var">vars</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235558"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235555"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-285"></span><span>          </span><span>
</span><span id="line-286"></span><span>      </span><span class="hs-comment">-- backward substitution on the prevous (vars-width) rows</span><span>
</span><span id="line-287"></span><span>      </span><span class="annot"><span class="annottext">Vector Int -&gt; (Int -&gt; ST s ()) -&gt; ST s ()
forall (m :: * -&gt; *) a b.
(Monad m, Unbox a) =&gt;
Vector a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">V.forM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Vector Int
forall a. (Unbox a, Num a) =&gt; a -&gt; Int -&gt; Vector a
</span><span class="hs-identifier hs-var">V.enumFromN</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235573"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Vector Int) -&gt; Int -&gt; Vector Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235574"><span class="hs-identifier hs-var">vars</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235573"><span class="hs-identifier hs-var">width</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Int -&gt; ST s ()) -&gt; ST s ()) -&gt; (Int -&gt; ST s ()) -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-288"></span><span>        </span><span class="hs-glyph">\</span><span id="local-6989586621679235553"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235553"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-289"></span><span>          </span><span id="local-6989586621679235552"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235552"><span class="hs-identifier hs-var">solI</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) a -&gt; Int -&gt; ST s a
forall (m :: * -&gt; *) a.
(PrimMonad m, Unbox a) =&gt;
MVector (PrimState m) a -&gt; Int -&gt; m a
</span><span class="hs-identifier hs-var">MV.unsafeRead</span></span><span> </span><span class="annot"><span class="annottext">MVector s a
MVector (PrimState (ST s)) a
</span><a href="#local-6989586621679235572"><span class="hs-identifier hs-var">sol1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235574"><span class="hs-identifier hs-var">vars</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235553"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-290"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679235551"><span class="annot"><span class="annottext">d :: a
</span><a href="#local-6989586621679235551"><span class="hs-identifier hs-var hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Matrix a
</span><a href="#local-6989586621679235577"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix a -&gt; (Int, Int) -&gt; a
forall a. Context a =&gt; Matrix a -&gt; (Int, Int) -&gt; a
</span><span class="hs-operator hs-var">`M.unsafeIndex`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235574"><span class="hs-identifier hs-var">vars</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235553"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-291"></span><span>          </span><span id="local-6989586621679235550"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235550"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Vector a -&gt; a) -&gt; ST s (Vector a) -&gt; ST s a
forall (m :: * -&gt; *) a1 r. Monad m =&gt; (a1 -&gt; r) -&gt; m a1 -&gt; m r
</span><span class="hs-identifier hs-var">liftM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a -&gt; a -&gt; a) -&gt; a -&gt; Vector a -&gt; a
forall b a. Unbox b =&gt; (a -&gt; b -&gt; a) -&gt; a -&gt; Vector b -&gt; a
</span><span class="hs-identifier hs-var">V.foldl'</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235552"><span class="hs-identifier hs-var">solI</span></a></span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235551"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ST s (Vector a) -&gt; ST s a) -&gt; ST s (Vector a) -&gt; ST s a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-292"></span><span>               </span><span class="annot"><span class="annottext">Vector Int -&gt; (Int -&gt; ST s a) -&gt; ST s (Vector a)
forall (m :: * -&gt; *) a b.
(Monad m, Unbox a, Unbox b) =&gt;
Vector a -&gt; (a -&gt; m b) -&gt; m (Vector b)
</span><span class="hs-identifier hs-var">V.forM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Vector Int
forall a. (Unbox a, Num a) =&gt; a -&gt; Int -&gt; Vector a
</span><span class="hs-identifier hs-var">V.enumFromN</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235573"><span class="hs-identifier hs-var">width</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Int -&gt; ST s a) -&gt; ST s (Vector a))
-&gt; (Int -&gt; ST s a) -&gt; ST s (Vector a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-293"></span><span>               </span><span class="hs-glyph">\</span><span id="local-6989586621679235549"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235549"><span class="hs-identifier hs-var">j</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; ST s a -&gt; ST s a
forall (m :: * -&gt; *) a1 r. Monad m =&gt; (a1 -&gt; r) -&gt; m a1 -&gt; m r
</span><span class="hs-identifier hs-var">liftM</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Matrix a
</span><a href="#local-6989586621679235577"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix a -&gt; (Int, Int) -&gt; a
forall a. Context a =&gt; Matrix a -&gt; (Int, Int) -&gt; a
</span><span class="hs-operator hs-var">`M.unsafeIndex`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235574"><span class="hs-identifier hs-var">vars</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235553"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235549"><span class="hs-identifier hs-var">j</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="hs-special">)</span><span>
</span><span id="line-294"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) a -&gt; Int -&gt; ST s a
forall (m :: * -&gt; *) a.
(PrimMonad m, Unbox a) =&gt;
MVector (PrimState m) a -&gt; Int -&gt; m a
</span><span class="hs-identifier hs-var">MV.unsafeRead</span></span><span> </span><span class="annot"><span class="annottext">MVector s a
MVector (PrimState (ST s)) a
</span><a href="#local-6989586621679235572"><span class="hs-identifier hs-var">sol1</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; ST s a) -&gt; Int -&gt; ST s a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235574"><span class="hs-identifier hs-var">vars</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235553"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235549"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-295"></span><span>          </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) a -&gt; Int -&gt; a -&gt; ST s ()
forall (m :: * -&gt; *) a.
(PrimMonad m, Unbox a) =&gt;
MVector (PrimState m) a -&gt; Int -&gt; a -&gt; m ()
</span><span class="hs-identifier hs-var">MV.unsafeWrite</span></span><span> </span><span class="annot"><span class="annottext">MVector s a
MVector (PrimState (ST s)) a
</span><a href="#local-6989586621679235572"><span class="hs-identifier hs-var">sol1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235574"><span class="hs-identifier hs-var">vars</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679235553"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235550"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-296"></span><span>          </span><span>
</span><span id="line-297"></span><span>      </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) a -&gt; ST s (Vector a)
forall a (m :: * -&gt; *).
(Unbox a, PrimMonad m) =&gt;
MVector (PrimState m) a -&gt; m (Vector a)
</span><span class="hs-identifier hs-var">V.unsafeFreeze</span></span><span> </span><span class="annot"><span class="annottext">MVector s a
MVector (PrimState (ST s)) a
</span><a href="#local-6989586621679235572"><span class="hs-identifier hs-var">sol1</span></a></span><span>
</span><span id="line-298"></span><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#solveLDL"><span class="hs-pragma hs-type">solveLDL</span></a></span><span> </span><span class="hs-pragma">::</span><span> </span><span class="annot"><span class="hs-pragma hs-type">M.Matrix</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">Double</span></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><span class="hs-pragma hs-type">V.Vector</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">Double</span></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><span class="hs-pragma hs-type">V.Vector</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">Double</span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-299"></span><span>    </span><span>
</span><span id="line-300"></span><span class="hs-comment">-- | @lsqSolve rowStart M y@ Find a least squares solution x to the</span><span>
</span><span id="line-301"></span><span class="hs-comment">-- system xM = y.</span><span>
</span><span id="line-302"></span><span id="local-6989586621679235547"><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#lsqSolve"><span class="hs-identifier hs-type">lsqSolve</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679235547"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Unbox</span></span><span> </span><span class="annot"><a href="#local-6989586621679235547"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-303"></span><span>            </span><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#SparseMatrix"><span class="hs-identifier hs-type">SparseMatrix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679235547"><span class="hs-identifier hs-type">a</span></a></span><span>    </span><span class="hs-comment">-- ^ sparse matrix</span><span>
</span><span id="line-304"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V.Vector</span></span><span> </span><span class="annot"><a href="#local-6989586621679235547"><span class="hs-identifier hs-type">a</span></a></span><span>        </span><span class="hs-comment">-- ^ Right hand side vector.</span><span>
</span><span id="line-305"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V.Vector</span></span><span> </span><span class="annot"><a href="#local-6989586621679235547"><span class="hs-identifier hs-type">a</span></a></span><span>        </span><span class="hs-comment">-- ^ Solution vector</span></span><span>
</span><span id="line-306"></span><span id="lsqSolve"><span class="annot"><span class="annottext">lsqSolve :: SparseMatrix a -&gt; Vector a -&gt; Vector a
</span><a href="Geom2D.CubicBezier.Numeric.html#lsqSolve"><span class="hs-identifier hs-var hs-var">lsqSolve</span></a></span></span><span> </span><span id="local-6989586621679235546"><span class="annot"><span class="annottext">m :: SparseMatrix a
</span><a href="#local-6989586621679235546"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#SparseMatrix"><span class="hs-identifier hs-type">SparseMatrix</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Vector (Int, Int)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679235545"><span class="annot"><span class="annottext">Matrix a
</span><a href="#local-6989586621679235545"><span class="hs-identifier hs-var">m'</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679235544"><span class="annot"><span class="annottext">Vector a
</span><a href="#local-6989586621679235544"><span class="hs-identifier hs-var">v</span></a></span></span><span>
</span><span id="line-307"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Matrix a -&gt; Int
forall a. Context a =&gt; Matrix a -&gt; Int
</span><span class="hs-identifier hs-var">rows</span></span><span> </span><span class="annot"><span class="annottext">Matrix a
</span><a href="#local-6989586621679235545"><span class="hs-identifier hs-var">m'</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Vector a -&gt; Int
forall a. Unbox a =&gt; Vector a -&gt; Int
</span><span class="hs-identifier hs-var">V.length</span></span><span> </span><span class="annot"><span class="annottext">Vector a
</span><a href="#local-6989586621679235544"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Vector a
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;lsqSolve: lengths don't match&quot;</span></span><span>
</span><span id="line-308"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Matrix a -&gt; Vector a -&gt; Vector a
forall a.
(Fractional a, Unbox a) =&gt;
Matrix a -&gt; Vector a -&gt; Vector a
</span><a href="Geom2D.CubicBezier.Numeric.html#solveLDL"><span class="hs-identifier hs-var">solveLDL</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix a
</span><a href="#local-6989586621679235543"><span class="hs-identifier hs-var">m2</span></a></span><span> </span><span class="annot"><span class="annottext">Vector a
</span><a href="#local-6989586621679235542"><span class="hs-identifier hs-var">v2</span></a></span><span>
</span><span id="line-309"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-310"></span><span>    </span><span id="local-6989586621679235542"><span class="annot"><span class="annottext">v2 :: Vector a
</span><a href="#local-6989586621679235542"><span class="hs-identifier hs-var hs-var">v2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector a -&gt; SparseMatrix a -&gt; Vector a
forall a.
(Num a, Unbox a) =&gt;
Vector a -&gt; SparseMatrix a -&gt; Vector a
</span><a href="Geom2D.CubicBezier.Numeric.html#sparseMulT"><span class="hs-identifier hs-var">sparseMulT</span></a></span><span> </span><span class="annot"><span class="annottext">Vector a
</span><a href="#local-6989586621679235544"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">SparseMatrix a
</span><a href="#local-6989586621679235546"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-311"></span><span>    </span><span id="local-6989586621679235543"><span class="annot"><span class="annottext">m2 :: Matrix a
</span><a href="#local-6989586621679235543"><span class="hs-identifier hs-var hs-var">m2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Matrix a -&gt; Matrix a
forall a. (Fractional a, Unbox a) =&gt; Matrix a -&gt; Matrix a
</span><a href="Geom2D.CubicBezier.Numeric.html#decompLDL"><span class="hs-identifier hs-var">decompLDL</span></a></span><span> </span><span class="annot"><span class="annottext">(Matrix a -&gt; Matrix a) -&gt; Matrix a -&gt; Matrix a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SparseMatrix a -&gt; Matrix a
forall a. (Num a, Unbox a) =&gt; SparseMatrix a -&gt; Matrix a
</span><a href="Geom2D.CubicBezier.Numeric.html#lsqMatrix"><span class="hs-identifier hs-var">lsqMatrix</span></a></span><span> </span><span class="annot"><span class="annottext">SparseMatrix a
</span><a href="#local-6989586621679235546"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-312"></span><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#lsqSolve"><span class="hs-pragma hs-type">lsqSolve</span></a></span><span> </span><span class="hs-pragma">::</span><span> </span><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#SparseMatrix"><span class="hs-pragma hs-type">SparseMatrix</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">Double</span></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><span class="hs-pragma hs-type">V.Vector</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">Double</span></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><span class="hs-pragma hs-type">V.Vector</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">Double</span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-313"></span><span>
</span><span id="line-314"></span><span class="hs-comment">-- | @lsqSolveDist rowStart M y@ Find a least squares solution of the distance between the points.</span><span>
</span><span id="line-315"></span><span id="local-6989586621679235541"><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#lsqSolveDist"><span class="hs-identifier hs-type">lsqSolveDist</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679235541"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Unbox</span></span><span> </span><span class="annot"><a href="#local-6989586621679235541"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-316"></span><span>                </span><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#SparseMatrix"><span class="hs-identifier hs-type">SparseMatrix</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679235541"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679235541"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ sparse matrix</span><span>
</span><span id="line-317"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V.Vector</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679235541"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679235541"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>     </span><span class="hs-comment">-- ^ Right hand side vector.</span><span>
</span><span id="line-318"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V.Vector</span></span><span> </span><span class="annot"><a href="#local-6989586621679235541"><span class="hs-identifier hs-type">a</span></a></span><span>          </span><span class="hs-comment">-- ^ Solution vector</span></span><span>
</span><span id="line-319"></span><span id="lsqSolveDist"><span class="annot"><span class="annottext">lsqSolveDist :: SparseMatrix (a, a) -&gt; Vector (a, a) -&gt; Vector a
</span><a href="Geom2D.CubicBezier.Numeric.html#lsqSolveDist"><span class="hs-identifier hs-var hs-var">lsqSolveDist</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#SparseMatrix"><span class="hs-identifier hs-type">SparseMatrix</span></a></span><span> </span><span id="local-6989586621679235540"><span class="annot"><span class="annottext">Vector Int
</span><a href="#local-6989586621679235540"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679235539"><span class="annot"><span class="annottext">Vector (Int, Int)
</span><a href="#local-6989586621679235539"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679235538"><span class="annot"><span class="annottext">Matrix (a, a)
</span><a href="#local-6989586621679235538"><span class="hs-identifier hs-var">m'</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679235537"><span class="annot"><span class="annottext">Vector (a, a)
</span><a href="#local-6989586621679235537"><span class="hs-identifier hs-var">v</span></a></span></span><span>
</span><span id="line-320"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Matrix (a, a) -&gt; Int
forall a. Context a =&gt; Matrix a -&gt; Int
</span><span class="hs-identifier hs-var">rows</span></span><span> </span><span class="annot"><span class="annottext">Matrix (a, a)
</span><a href="#local-6989586621679235538"><span class="hs-identifier hs-var">m'</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Vector (a, a) -&gt; Int
forall a. Unbox a =&gt; Vector a -&gt; Int
</span><span class="hs-identifier hs-var">V.length</span></span><span> </span><span class="annot"><span class="annottext">Vector (a, a)
</span><a href="#local-6989586621679235537"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Vector a
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;lsqSolve: lengths don't match&quot;</span></span><span>
</span><span id="line-321"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Matrix a -&gt; Vector a -&gt; Vector a
forall a.
(Fractional a, Unbox a) =&gt;
Matrix a -&gt; Vector a -&gt; Vector a
</span><a href="Geom2D.CubicBezier.Numeric.html#solveLDL"><span class="hs-identifier hs-var">solveLDL</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix a
</span><a href="#local-6989586621679235536"><span class="hs-identifier hs-var">m3</span></a></span><span> </span><span class="annot"><span class="annottext">Vector a
</span><a href="#local-6989586621679235535"><span class="hs-identifier hs-var">v3</span></a></span><span>
</span><span id="line-322"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-323"></span><span>    </span><span id="local-6989586621679235535"><span class="annot"><span class="annottext">v3 :: Vector a
</span><a href="#local-6989586621679235535"><span class="hs-identifier hs-var hs-var">v3</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector a -&gt; SparseMatrix a -&gt; Vector a
forall a.
(Num a, Unbox a) =&gt;
Vector a -&gt; SparseMatrix a -&gt; Vector a
</span><a href="Geom2D.CubicBezier.Numeric.html#sparseMulT"><span class="hs-identifier hs-var">sparseMulT</span></a></span><span> </span><span class="annot"><span class="annottext">Vector a
</span><a href="#local-6989586621679235534"><span class="hs-identifier hs-var">v1</span></a></span><span> </span><span class="annot"><span class="annottext">SparseMatrix a
</span><a href="#local-6989586621679235533"><span class="hs-identifier hs-var">m1</span></a></span><span> </span><span class="annot"><span class="annottext">Vector a -&gt; Vector a -&gt; Vector a
forall a. (Num a, Unbox a) =&gt; Vector a -&gt; Vector a -&gt; Vector a
</span><a href="Geom2D.CubicBezier.Numeric.html#addVec"><span class="hs-operator hs-var">`addVec`</span></a></span><span> </span><span class="annot"><span class="annottext">Vector a -&gt; SparseMatrix a -&gt; Vector a
forall a.
(Num a, Unbox a) =&gt;
Vector a -&gt; SparseMatrix a -&gt; Vector a
</span><a href="Geom2D.CubicBezier.Numeric.html#sparseMulT"><span class="hs-identifier hs-var">sparseMulT</span></a></span><span> </span><span class="annot"><span class="annottext">Vector a
</span><a href="#local-6989586621679235532"><span class="hs-identifier hs-var">v2</span></a></span><span> </span><span class="annot"><span class="annottext">SparseMatrix a
</span><a href="#local-6989586621679235531"><span class="hs-identifier hs-var">m2</span></a></span><span>
</span><span id="line-324"></span><span>    </span><span id="local-6989586621679235536"><span class="annot"><span class="annottext">m3 :: Matrix a
</span><a href="#local-6989586621679235536"><span class="hs-identifier hs-var hs-var">m3</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Matrix a -&gt; Matrix a
forall a. (Fractional a, Unbox a) =&gt; Matrix a -&gt; Matrix a
</span><a href="Geom2D.CubicBezier.Numeric.html#decompLDL"><span class="hs-identifier hs-var">decompLDL</span></a></span><span> </span><span class="annot"><span class="annottext">(Matrix a -&gt; Matrix a) -&gt; Matrix a -&gt; Matrix a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SparseMatrix a -&gt; Matrix a
forall a. (Num a, Unbox a) =&gt; SparseMatrix a -&gt; Matrix a
</span><a href="Geom2D.CubicBezier.Numeric.html#lsqMatrix"><span class="hs-identifier hs-var">lsqMatrix</span></a></span><span> </span><span class="annot"><span class="annottext">SparseMatrix a
</span><a href="#local-6989586621679235533"><span class="hs-identifier hs-var">m1</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix a -&gt; Matrix a -&gt; Matrix a
forall a. (Num a, Unbox a) =&gt; Matrix a -&gt; Matrix a -&gt; Matrix a
</span><a href="Geom2D.CubicBezier.Numeric.html#addMatrix"><span class="hs-operator hs-var">`addMatrix`</span></a></span><span> </span><span class="annot"><span class="annottext">SparseMatrix a -&gt; Matrix a
forall a. (Num a, Unbox a) =&gt; SparseMatrix a -&gt; Matrix a
</span><a href="Geom2D.CubicBezier.Numeric.html#lsqMatrix"><span class="hs-identifier hs-var">lsqMatrix</span></a></span><span> </span><span class="annot"><span class="annottext">SparseMatrix a
</span><a href="#local-6989586621679235531"><span class="hs-identifier hs-var">m2</span></a></span><span>
</span><span id="line-325"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679235534"><span class="annot"><span class="annottext">Vector a
</span><a href="#local-6989586621679235534"><span class="hs-identifier hs-var">v1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679235532"><span class="annot"><span class="annottext">Vector a
</span><a href="#local-6989586621679235532"><span class="hs-identifier hs-var">v2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector (a, a) -&gt; (Vector a, Vector a)
forall a b.
(Unbox a, Unbox b) =&gt;
Vector (a, b) -&gt; (Vector a, Vector b)
</span><span class="hs-identifier hs-var">V.unzip</span></span><span> </span><span class="annot"><span class="annottext">Vector (a, a)
</span><a href="#local-6989586621679235537"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-326"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679235529"><span class="annot"><span class="annottext">Matrix a
</span><a href="#local-6989586621679235529"><span class="hs-identifier hs-var">m1'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679235528"><span class="annot"><span class="annottext">Matrix a
</span><a href="#local-6989586621679235528"><span class="hs-identifier hs-var">m2'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Matrix (a, a) -&gt; (Matrix a, Matrix a)
forall a b.
(Context a, Context b, Context (a, b)) =&gt;
Matrix (a, b) -&gt; (Matrix a, Matrix b)
</span><span class="hs-identifier hs-var">M.unzip</span></span><span> </span><span class="annot"><span class="annottext">Matrix (a, a)
</span><a href="#local-6989586621679235538"><span class="hs-identifier hs-var">m'</span></a></span><span>
</span><span id="line-327"></span><span>    </span><span id="local-6989586621679235533"><span class="annot"><span class="annottext">m1 :: SparseMatrix a
</span><a href="#local-6989586621679235533"><span class="hs-identifier hs-var hs-var">m1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector Int -&gt; Vector (Int, Int) -&gt; Matrix a -&gt; SparseMatrix a
forall a.
Vector Int -&gt; Vector (Int, Int) -&gt; Matrix a -&gt; SparseMatrix a
</span><a href="Geom2D.CubicBezier.Numeric.html#SparseMatrix"><span class="hs-identifier hs-var">SparseMatrix</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Int
</span><a href="#local-6989586621679235540"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Vector (Int, Int)
</span><a href="#local-6989586621679235539"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix a
</span><a href="#local-6989586621679235529"><span class="hs-identifier hs-var">m1'</span></a></span><span>
</span><span id="line-328"></span><span>    </span><span id="local-6989586621679235531"><span class="annot"><span class="annottext">m2 :: SparseMatrix a
</span><a href="#local-6989586621679235531"><span class="hs-identifier hs-var hs-var">m2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector Int -&gt; Vector (Int, Int) -&gt; Matrix a -&gt; SparseMatrix a
forall a.
Vector Int -&gt; Vector (Int, Int) -&gt; Matrix a -&gt; SparseMatrix a
</span><a href="Geom2D.CubicBezier.Numeric.html#SparseMatrix"><span class="hs-identifier hs-var">SparseMatrix</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Int
</span><a href="#local-6989586621679235540"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Vector (Int, Int)
</span><a href="#local-6989586621679235539"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix a
</span><a href="#local-6989586621679235528"><span class="hs-identifier hs-var">m2'</span></a></span><span>
</span><span id="line-329"></span><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#lsqSolveDist"><span class="hs-pragma hs-type">lsqSolveDist</span></a></span><span> </span><span class="hs-pragma">::</span><span> </span><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#SparseMatrix"><span class="hs-pragma hs-type">SparseMatrix</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-type">Double</span></span><span class="hs-pragma">,</span><span> </span><span class="annot"><span class="hs-pragma hs-type">Double</span></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><span class="hs-pragma hs-type">V.Vector</span></span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-type">Double</span></span><span class="hs-pragma">,</span><span> </span><span class="annot"><span class="hs-pragma hs-type">Double</span></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><span class="hs-pragma hs-type">V.Vector</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">Double</span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-330"></span><span>
</span><span id="line-331"></span><span class="hs-comment">-- | solve a tridiagonal system.  see metafont the program: &#182; 283</span><span>
</span><span id="line-332"></span><span id="local-6989586621679235526"><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#solveTriDiagonal"><span class="hs-identifier hs-type">solveTriDiagonal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Unbox</span></span><span> </span><span class="annot"><a href="#local-6989586621679235526"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679235526"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-333"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679235526"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679235526"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679235526"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V.Vector</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679235526"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679235526"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679235526"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679235526"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V.Vector</span></span><span> </span><span class="annot"><a href="#local-6989586621679235526"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-334"></span><span id="solveTriDiagonal"><span class="annot"><span class="annottext">solveTriDiagonal :: (a, a, a) -&gt; Vector (a, a, a, a) -&gt; Vector a
</span><a href="Geom2D.CubicBezier.Numeric.html#solveTriDiagonal"><span class="hs-identifier hs-var hs-var">solveTriDiagonal</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621679235525"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235525"><span class="hs-identifier hs-var">b0</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679235524"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235524"><span class="hs-identifier hs-var">c0</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679235523"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235523"><span class="hs-identifier hs-var">d0</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679235522"><span class="annot"><span class="annottext">Vector (a, a, a, a)
</span><a href="#local-6989586621679235522"><span class="hs-identifier hs-var">rows</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector a
</span><a href="#local-6989586621679235521"><span class="hs-identifier hs-var">solutions</span></a></span><span>
</span><span id="line-335"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-336"></span><span>    </span><span id="local-6989586621679235520"><span class="annot"><span class="annottext">twovars :: Vector (a, a)
</span><a href="#local-6989586621679235520"><span class="hs-identifier hs-var hs-var">twovars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((a, a) -&gt; (a, a, a, a) -&gt; (a, a))
-&gt; (a, a) -&gt; Vector (a, a, a, a) -&gt; Vector (a, a)
forall a b.
(Unbox a, Unbox b) =&gt;
(a -&gt; b -&gt; a) -&gt; a -&gt; Vector b -&gt; Vector a
</span><span class="hs-identifier hs-var">V.scanl</span></span><span> </span><span class="annot"><span class="annottext">(a, a) -&gt; (a, a, a, a) -&gt; (a, a)
forall b. Fractional b =&gt; (b, b) -&gt; (b, b, b, b) -&gt; (b, b)
</span><a href="#local-6989586621679235518"><span class="hs-identifier hs-var">nextrow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235524"><span class="hs-identifier hs-var">c0</span></a></span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235525"><span class="hs-identifier hs-var">b0</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235523"><span class="hs-identifier hs-var">d0</span></a></span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235525"><span class="hs-identifier hs-var">b0</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Vector (a, a, a, a)
</span><a href="#local-6989586621679235522"><span class="hs-identifier hs-var">rows</span></a></span><span>
</span><span id="line-337"></span><span>    </span><span id="local-6989586621679235521"><span class="annot"><span class="annottext">solutions :: Vector a
</span><a href="#local-6989586621679235521"><span class="hs-identifier hs-var hs-var">solutions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((a, a) -&gt; a -&gt; a) -&gt; a -&gt; Vector (a, a) -&gt; Vector a
forall a b.
(Unbox a, Unbox b) =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; Vector a -&gt; Vector b
</span><span class="hs-identifier hs-var">V.scanr</span></span><span> </span><span class="annot"><span class="annottext">(a, a) -&gt; a -&gt; a
forall a. Num a =&gt; (a, a) -&gt; a -&gt; a
</span><a href="#local-6989586621679235516"><span class="hs-identifier hs-var">nextsol</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235515"><span class="hs-identifier hs-var">vn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector (a, a) -&gt; Vector (a, a)
forall a. Unbox a =&gt; Vector a -&gt; Vector a
</span><span class="hs-identifier hs-var">V.unsafeInit</span></span><span> </span><span class="annot"><span class="annottext">Vector (a, a)
</span><a href="#local-6989586621679235520"><span class="hs-identifier hs-var">twovars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-338"></span><span>    </span><span id="local-6989586621679235515"><span class="annot"><span class="annottext">vn :: a
</span><a href="#local-6989586621679235515"><span class="hs-identifier hs-var hs-var">vn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a, a) -&gt; a
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((a, a) -&gt; a) -&gt; (a, a) -&gt; a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Vector (a, a) -&gt; (a, a)
forall a. Unbox a =&gt; Vector a -&gt; a
</span><span class="hs-identifier hs-var">V.unsafeLast</span></span><span> </span><span class="annot"><span class="annottext">Vector (a, a)
</span><a href="#local-6989586621679235520"><span class="hs-identifier hs-var">twovars</span></a></span><span>
</span><span id="line-339"></span><span>    </span><span id="local-6989586621679235516"><span class="annot"><span class="annottext">nextsol :: (a, a) -&gt; a -&gt; a
</span><a href="#local-6989586621679235516"><span class="hs-identifier hs-var hs-var">nextsol</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679235513"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235513"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679235512"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235512"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679235511"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235511"><span class="hs-identifier hs-var">ti</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235512"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235513"><span class="hs-identifier hs-var">u</span></a></span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235511"><span class="hs-identifier hs-var">ti</span></a></span><span>
</span><span id="line-340"></span><span>    </span><span id="local-6989586621679235518"><span class="annot"><span class="annottext">nextrow :: (b, b) -&gt; (b, b, b, b) -&gt; (b, b)
</span><a href="#local-6989586621679235518"><span class="hs-identifier hs-var hs-var">nextrow</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679235510"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679235510"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679235509"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679235509"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679235508"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679235508"><span class="hs-identifier hs-var">ai</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679235507"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679235507"><span class="hs-identifier hs-var">bi</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679235506"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679235506"><span class="hs-identifier hs-var">ci</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679235505"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679235505"><span class="hs-identifier hs-var">di</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-341"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679235506"><span class="hs-identifier hs-var">ci</span></a></span><span class="annot"><span class="annottext">b -&gt; b -&gt; b
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span class="hs-special">(</span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679235507"><span class="hs-identifier hs-var">bi</span></a></span><span> </span><span class="annot"><span class="annottext">b -&gt; b -&gt; b
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679235510"><span class="hs-identifier hs-var">u</span></a></span><span class="annot"><span class="annottext">b -&gt; b -&gt; b
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679235508"><span class="hs-identifier hs-var">ai</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679235505"><span class="hs-identifier hs-var">di</span></a></span><span> </span><span class="annot"><span class="annottext">b -&gt; b -&gt; b
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679235509"><span class="hs-identifier hs-var">v</span></a></span><span class="annot"><span class="annottext">b -&gt; b -&gt; b
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679235508"><span class="hs-identifier hs-var">ai</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">b -&gt; b -&gt; b
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span class="hs-special">(</span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679235507"><span class="hs-identifier hs-var">bi</span></a></span><span> </span><span class="annot"><span class="annottext">b -&gt; b -&gt; b
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679235510"><span class="hs-identifier hs-var">u</span></a></span><span class="annot"><span class="annottext">b -&gt; b -&gt; b
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679235508"><span class="hs-identifier hs-var">ai</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-342"></span><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#solveTriDiagonal"><span class="hs-pragma hs-type">solveTriDiagonal</span></a></span><span> </span><span class="hs-pragma">::</span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-type">Double</span></span><span class="hs-pragma">,</span><span> </span><span class="annot"><span class="hs-pragma hs-type">Double</span></span><span class="hs-pragma">,</span><span> </span><span class="annot"><span class="hs-pragma hs-type">Double</span></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><span class="hs-pragma hs-type">V.Vector</span></span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-type">Double</span></span><span class="hs-pragma">,</span><span> </span><span class="annot"><span class="hs-pragma hs-type">Double</span></span><span class="hs-pragma">,</span><span> </span><span class="annot"><span class="hs-pragma hs-type">Double</span></span><span class="hs-pragma">,</span><span> </span><span class="annot"><span class="hs-pragma hs-type">Double</span></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><span class="hs-pragma hs-type">V.Vector</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">Double</span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-343"></span><span>
</span><span id="line-344"></span><span class="hs-comment">-- | solve a cyclic tridiagonal system.  see metafont the program: &#182; 286</span><span>
</span><span id="line-345"></span><span id="local-6989586621679235504"><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#solveCyclicTriD"><span class="hs-identifier hs-type">solveCyclicTriD</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Unbox</span></span><span> </span><span class="annot"><a href="#local-6989586621679235504"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679235504"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V.Vector</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679235504"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679235504"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679235504"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679235504"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V.Vector</span></span><span> </span><span class="annot"><a href="#local-6989586621679235504"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-346"></span><span id="solveCyclicTriD"><span class="annot"><span class="annottext">solveCyclicTriD :: Vector (a, a, a, a) -&gt; Vector a
</span><a href="Geom2D.CubicBezier.Numeric.html#solveCyclicTriD"><span class="hs-identifier hs-var hs-var">solveCyclicTriD</span></a></span></span><span> </span><span id="local-6989586621679235503"><span class="annot"><span class="annottext">Vector (a, a, a, a)
</span><a href="#local-6989586621679235503"><span class="hs-identifier hs-var">rows</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector a
</span><a href="#local-6989586621679235502"><span class="hs-identifier hs-var">solutions</span></a></span><span>
</span><span id="line-347"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-348"></span><span>    </span><span id="local-6989586621679235501"><span class="annot"><span class="annottext">threevars :: Vector (a, a, a)
</span><a href="#local-6989586621679235501"><span class="hs-identifier hs-var hs-var">threevars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector (a, a, a) -&gt; Vector (a, a, a)
forall a. Unbox a =&gt; Vector a -&gt; Vector a
</span><span class="hs-identifier hs-var">V.tail</span></span><span> </span><span class="annot"><span class="annottext">(Vector (a, a, a) -&gt; Vector (a, a, a))
-&gt; Vector (a, a, a) -&gt; Vector (a, a, a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((a, a, a) -&gt; (a, a, a, a) -&gt; (a, a, a))
-&gt; (a, a, a) -&gt; Vector (a, a, a, a) -&gt; Vector (a, a, a)
forall a b.
(Unbox a, Unbox b) =&gt;
(a -&gt; b -&gt; a) -&gt; a -&gt; Vector b -&gt; Vector a
</span><span class="hs-identifier hs-var">V.scanl</span></span><span> </span><span class="annot"><span class="annottext">(a, a, a) -&gt; (a, a, a, a) -&gt; (a, a, a)
forall c. Fractional c =&gt; (c, c, c) -&gt; (c, c, c, c) -&gt; (c, c, c)
</span><a href="#local-6989586621679235499"><span class="hs-identifier hs-var">nextrow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Vector (a, a, a, a)
</span><a href="#local-6989586621679235503"><span class="hs-identifier hs-var">rows</span></a></span><span>
</span><span id="line-349"></span><span>    </span><span id="local-6989586621679235499"><span class="annot"><span class="annottext">nextrow :: (c, c, c) -&gt; (c, c, c, c) -&gt; (c, c, c)
</span><a href="#local-6989586621679235499"><span class="hs-identifier hs-var hs-var">nextrow</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621679235498"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679235498"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679235497"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679235497"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679235496"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679235496"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621679235495"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679235495"><span class="hs-identifier hs-var">ai</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679235494"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679235494"><span class="hs-identifier hs-var">bi</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679235493"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679235493"><span class="hs-identifier hs-var">ci</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679235492"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679235492"><span class="hs-identifier hs-var">di</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-350"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679235493"><span class="hs-identifier hs-var">ci</span></a></span><span class="annot"><span class="annottext">c -&gt; c -&gt; c
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span class="hs-special">(</span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679235494"><span class="hs-identifier hs-var">bi</span></a></span><span> </span><span class="annot"><span class="annottext">c -&gt; c -&gt; c
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679235495"><span class="hs-identifier hs-var">ai</span></a></span><span class="annot"><span class="annottext">c -&gt; c -&gt; c
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679235498"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679235492"><span class="hs-identifier hs-var">di</span></a></span><span> </span><span class="annot"><span class="annottext">c -&gt; c -&gt; c
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679235495"><span class="hs-identifier hs-var">ai</span></a></span><span class="annot"><span class="annottext">c -&gt; c -&gt; c
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679235497"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">c -&gt; c -&gt; c
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span class="hs-special">(</span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679235494"><span class="hs-identifier hs-var">bi</span></a></span><span> </span><span class="annot"><span class="annottext">c -&gt; c -&gt; c
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679235495"><span class="hs-identifier hs-var">ai</span></a></span><span class="annot"><span class="annottext">c -&gt; c -&gt; c
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679235498"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679235495"><span class="hs-identifier hs-var">ai</span></a></span><span class="annot"><span class="annottext">c -&gt; c -&gt; c
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679235496"><span class="hs-identifier hs-var">w</span></a></span><span class="annot"><span class="annottext">c -&gt; c -&gt; c
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span class="hs-special">(</span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679235494"><span class="hs-identifier hs-var">bi</span></a></span><span> </span><span class="annot"><span class="annottext">c -&gt; c -&gt; c
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679235495"><span class="hs-identifier hs-var">ai</span></a></span><span class="annot"><span class="annottext">c -&gt; c -&gt; c
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679235498"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-351"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679235491"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235491"><span class="hs-identifier hs-var">totvn</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679235490"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235490"><span class="hs-identifier hs-var">totwn</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((a, a, a) -&gt; (a, a) -&gt; (a, a))
-&gt; (a, a) -&gt; Vector (a, a, a) -&gt; (a, a)
forall a b. Unbox a =&gt; (a -&gt; b -&gt; b) -&gt; b -&gt; Vector a -&gt; b
</span><span class="hs-identifier hs-var">V.foldr</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679235488"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235488"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679235487"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235487"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679235486"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235486"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679235485"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235485"><span class="hs-identifier hs-var">v'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679235484"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235484"><span class="hs-identifier hs-var">w'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-352"></span><span>                               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235487"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235488"><span class="hs-identifier hs-var">u</span></a></span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235485"><span class="hs-identifier hs-var">v'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235486"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235488"><span class="hs-identifier hs-var">u</span></a></span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235484"><span class="hs-identifier hs-var">w'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-353"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector (a, a, a) -&gt; Vector (a, a, a)
forall a. Unbox a =&gt; Vector a -&gt; Vector a
</span><span class="hs-identifier hs-var">V.init</span></span><span> </span><span class="annot"><span class="annottext">Vector (a, a, a)
</span><a href="#local-6989586621679235501"><span class="hs-identifier hs-var">threevars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-354"></span><span>    </span><span id="local-6989586621679235482"><span class="annot"><span class="annottext">t0 :: a
</span><a href="#local-6989586621679235482"><span class="hs-identifier hs-var hs-var">t0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235481"><span class="hs-identifier hs-var">vn</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235480"><span class="hs-identifier hs-var">un</span></a></span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235491"><span class="hs-identifier hs-var">totvn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235479"><span class="hs-identifier hs-var">wn</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235480"><span class="hs-identifier hs-var">un</span></a></span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235490"><span class="hs-identifier hs-var">totwn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-355"></span><span>    </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621679235480"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235480"><span class="hs-identifier hs-var">un</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679235481"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235481"><span class="hs-identifier hs-var">vn</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679235479"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235479"><span class="hs-identifier hs-var">wn</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector (a, a, a) -&gt; (a, a, a)
forall a. Unbox a =&gt; Vector a -&gt; a
</span><span class="hs-identifier hs-var">V.last</span></span><span> </span><span class="annot"><span class="annottext">Vector (a, a, a)
</span><a href="#local-6989586621679235501"><span class="hs-identifier hs-var">threevars</span></a></span><span>
</span><span id="line-356"></span><span>    </span><span id="local-6989586621679235502"><span class="annot"><span class="annottext">solutions :: Vector a
</span><a href="#local-6989586621679235502"><span class="hs-identifier hs-var hs-var">solutions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; (a, a, a) -&gt; a) -&gt; a -&gt; Vector (a, a, a) -&gt; Vector a
forall a b.
(Unbox a, Unbox b) =&gt;
(a -&gt; b -&gt; a) -&gt; a -&gt; Vector b -&gt; Vector a
</span><span class="hs-identifier hs-var">V.scanl</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; (a, a, a) -&gt; a
</span><a href="#local-6989586621679235478"><span class="hs-identifier hs-var">nextsol</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235482"><span class="hs-identifier hs-var">t0</span></a></span><span> </span><span class="annot"><span class="annottext">(Vector (a, a, a) -&gt; Vector a) -&gt; Vector (a, a, a) -&gt; Vector a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(a, a, a) -&gt; Vector (a, a, a) -&gt; Vector (a, a, a)
forall a. Unbox a =&gt; a -&gt; Vector a -&gt; Vector a
</span><span class="hs-identifier hs-var">V.cons</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235480"><span class="hs-identifier hs-var">un</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235481"><span class="hs-identifier hs-var">vn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235479"><span class="hs-identifier hs-var">wn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Vector (a, a, a) -&gt; Vector (a, a, a))
-&gt; Vector (a, a, a) -&gt; Vector (a, a, a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-357"></span><span>                </span><span class="annot"><span class="annottext">Vector (a, a, a) -&gt; Vector (a, a, a)
forall a. Unbox a =&gt; Vector a -&gt; Vector a
</span><span class="hs-identifier hs-var">V.init</span></span><span> </span><span class="annot"><span class="annottext">(Vector (a, a, a) -&gt; Vector (a, a, a))
-&gt; Vector (a, a, a) -&gt; Vector (a, a, a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Vector (a, a, a) -&gt; Vector (a, a, a)
forall a. Unbox a =&gt; Vector a -&gt; Vector a
</span><span class="hs-identifier hs-var">V.init</span></span><span> </span><span class="annot"><span class="annottext">(Vector (a, a, a) -&gt; Vector (a, a, a))
-&gt; Vector (a, a, a) -&gt; Vector (a, a, a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Vector (a, a, a)
</span><a href="#local-6989586621679235501"><span class="hs-identifier hs-var">threevars</span></a></span><span>
</span><span id="line-358"></span><span>    </span><span id="local-6989586621679235478"><span class="annot"><span class="annottext">nextsol :: a -&gt; (a, a, a) -&gt; a
</span><a href="#local-6989586621679235478"><span class="hs-identifier hs-var hs-var">nextsol</span></a></span></span><span> </span><span id="local-6989586621679235476"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235476"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621679235475"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235475"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679235474"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235474"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679235473"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235473"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235474"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235473"><span class="hs-identifier hs-var">w</span></a></span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235482"><span class="hs-identifier hs-var">t0</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235476"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679235475"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-359"></span><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="annot"><a href="Geom2D.CubicBezier.Numeric.html#solveCyclicTriD"><span class="hs-pragma hs-type">solveCyclicTriD</span></a></span><span> </span><span class="hs-pragma">::</span><span> </span><span class="annot"><span class="hs-pragma hs-type">V.Vector</span></span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-type">Double</span></span><span class="hs-pragma">,</span><span> </span><span class="annot"><span class="hs-pragma hs-type">Double</span></span><span class="hs-pragma">,</span><span> </span><span class="annot"><span class="hs-pragma hs-type">Double</span></span><span class="hs-pragma">,</span><span> </span><span class="annot"><span class="hs-pragma hs-type">Double</span></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><span class="hs-pragma hs-type">V.Vector</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">Double</span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-360"></span></pre></body></html>