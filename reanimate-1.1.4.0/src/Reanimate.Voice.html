<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE ApplicativeDo     #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards   #-}</span><span>
</span><span id="line-4"></span><span class="hs-comment">{-|
  Reanimate can automatically synchronize animations to your voice if you have
  a transcript and an audio recording. This works with the help of Gentle
  (&lt;https://lowerquality.com/gentle/&gt;). Accuracy is not perfect but it is pretty
  close, and it is by far the easiest way of adding narration to an animation.
-}</span><span>
</span><span id="line-10"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Reanimate.Voice</span><span>
</span><span id="line-11"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Reanimate.Voice.html#Transcript"><span class="hs-identifier">Transcript</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Reanimate.Voice.html#TWord"><span class="hs-identifier">TWord</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Reanimate.Voice.html#Phone"><span class="hs-identifier">Phone</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Reanimate.Voice.html#findWord"><span class="hs-identifier">findWord</span></a></span><span>                </span><span class="hs-comment">-- :: Transcript -&gt; [Text] -&gt; Text -&gt; TWord</span><span>
</span><span id="line-15"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Reanimate.Voice.html#findWords"><span class="hs-identifier">findWords</span></a></span><span>               </span><span class="hs-comment">-- :: Transcript -&gt; [Text] -&gt; Text -&gt; [TWord]</span><span>
</span><span id="line-16"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Reanimate.Voice.html#loadTranscript"><span class="hs-identifier">loadTranscript</span></a></span><span>          </span><span class="hs-comment">-- :: FilePath -&gt; Transcript</span><span>
</span><span id="line-17"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Reanimate.Voice.html#fakeTranscript"><span class="hs-identifier">fakeTranscript</span></a></span><span>          </span><span class="hs-comment">-- :: Text -&gt; Transcript</span><span>
</span><span id="line-18"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Reanimate.Voice.html#splitTranscript"><span class="hs-identifier">splitTranscript</span></a></span><span>         </span><span class="hs-comment">-- :: Transcript -&gt; SVG -&gt; [(SVG, TWord)]</span><span>
</span><span id="line-19"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Reanimate.Voice.html#annotateWithTranscript"><span class="hs-identifier">annotateWithTranscript</span></a></span><span>  </span><span class="hs-comment">-- :: Transcript -&gt; Scene s ()</span><span>
</span><span id="line-20"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">where</span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>       </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">forM_</span></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Aeson</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Char</span></span><span>           </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">isAlphaNum</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">isSpace</span></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span>           </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">sortOn</span></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Map</span></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span>            </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">listToMaybe</span></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span>           </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Text</span></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span>           </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.IO</span></span><span>        </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Reanimate.Animation.html"><span class="hs-identifier">Reanimate.Animation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Reanimate.Animation.html#SVG"><span class="hs-identifier">SVG</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Reanimate.Animation.html#staticFrame"><span class="hs-identifier">staticFrame</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Reanimate.Constants.html"><span class="hs-identifier">Reanimate.Constants</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Reanimate.Constants.html#defaultStrokeWidth"><span class="hs-identifier">defaultStrokeWidth</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Reanimate.Constants.html#screenHeight"><span class="hs-identifier">screenHeight</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Reanimate.Constants.html#screenWidth"><span class="hs-identifier">screenWidth</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Reanimate.LaTeX.html"><span class="hs-identifier">Reanimate.LaTeX</span></a></span><span>     </span><span class="hs-special">(</span><span class="annot"><a href="Reanimate.LaTeX.html#latex"><span class="hs-identifier">latex</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Reanimate.LaTeX.html#latexChunks"><span class="hs-identifier">latexChunks</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Reanimate.Misc.html"><span class="hs-identifier">Reanimate.Misc</span></a></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Reanimate.Misc.html#withTempFile"><span class="hs-identifier">withTempFile</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Reanimate.Scene.html"><span class="hs-identifier">Reanimate.Scene</span></a></span><span>     </span><span class="hs-special">(</span><span class="annot"><a href="Reanimate.Scene.Core.html#Scene"><span class="hs-identifier">Scene</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Reanimate.Scene.Sprite.html#play"><span class="hs-identifier">play</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Reanimate.Scene.Core.html#waitUntil"><span class="hs-identifier">waitUntil</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Reanimate.Svg.html"><span class="hs-identifier">Reanimate.Svg</span></a></span><span>       </span><span class="hs-special">(</span><span class="annot"><a href="Reanimate.Svg.Constructors.html#mkGroup"><span class="hs-identifier">mkGroup</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Reanimate.Svg.Constructors.html#scale"><span class="hs-identifier">scale</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Reanimate.Svg.Constructors.html#translate"><span class="hs-identifier">translate</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Reanimate.Svg.Constructors.html#withStrokeColor"><span class="hs-identifier">withStrokeColor</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Reanimate.Svg.Constructors.html#withStrokeWidth"><span class="hs-identifier">withStrokeWidth</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">System.Directory</span></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">doesFileExist</span></span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">System.Exit</span></span><span>         </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ExitCode</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ExitFailure</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ExitSuccess</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">System.FilePath</span></span><span>     </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">replaceExtension</span></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">System.IO.Unsafe</span></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">unsafePerformIO</span></span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">System.Process</span></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">rawSystem</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">showCommandForUser</span></span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span class="hs-comment">-- | Aligned transcript. Contains the transcript text as well as</span><span>
</span><span id="line-46"></span><span class="hs-comment">--   timing data for each word.</span><span>
</span><span id="line-47"></span><span class="hs-keyword">data</span><span> </span><span id="Transcript"><span class="annot"><a href="Reanimate.Voice.html#Transcript"><span class="hs-identifier hs-var">Transcript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Transcript"><span class="annot"><a href="Reanimate.Voice.html#Transcript"><span class="hs-identifier hs-var">Transcript</span></a></span></span><span>
</span><span id="line-48"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="transcriptText"><span class="annot"><span class="annottext">Transcript -&gt; Text
</span><a href="Reanimate.Voice.html#transcriptText"><span class="hs-identifier hs-var hs-var">transcriptText</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-49"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="transcriptKeys"><span class="annot"><span class="annottext">Transcript -&gt; Map Text Int
</span><a href="Reanimate.Voice.html#transcriptKeys"><span class="hs-identifier hs-var hs-var">transcriptKeys</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-50"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="transcriptWords"><span class="annot"><span class="annottext">Transcript -&gt; [TWord]
</span><a href="Reanimate.Voice.html#transcriptWords"><span class="hs-identifier hs-var hs-var">transcriptWords</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Reanimate.Voice.html#TWord"><span class="hs-identifier hs-type">TWord</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-51"></span><span>  </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679549736"><span id="local-6989586621679549738"><span id="local-6989586621679549740"><span class="annot"><span class="annottext">Int -&gt; Transcript -&gt; ShowS
[Transcript] -&gt; ShowS
Transcript -&gt; String
(Int -&gt; Transcript -&gt; ShowS)
-&gt; (Transcript -&gt; String)
-&gt; ([Transcript] -&gt; ShowS)
-&gt; Show Transcript
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [Transcript] -&gt; ShowS
$cshowList :: [Transcript] -&gt; ShowS
show :: Transcript -&gt; String
$cshow :: Transcript -&gt; String
showsPrec :: Int -&gt; Transcript -&gt; ShowS
$cshowsPrec :: Int -&gt; Transcript -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679549732"><span class="annot"><span class="hs-identifier hs-type">FromJSON</span></span><span> </span><span class="annot"><a href="Reanimate.Voice.html#Transcript"><span class="hs-identifier hs-type">Transcript</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-54"></span><span>  </span><span id="local-6989586621679549730"><span class="annot"><span class="annottext">parseJSON :: Value -&gt; Parser Transcript
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">parseJSON</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Object -&gt; Parser Transcript) -&gt; Value -&gt; Parser Transcript
forall a. String -&gt; (Object -&gt; Parser a) -&gt; Value -&gt; Parser a
</span><span class="hs-identifier hs-var">withObject</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;transcript&quot;</span></span><span> </span><span class="annot"><span class="annottext">((Object -&gt; Parser Transcript) -&gt; Value -&gt; Parser Transcript)
-&gt; (Object -&gt; Parser Transcript) -&gt; Value -&gt; Parser Transcript
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679549727"><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679549727"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-55"></span><span>    </span><span class="annot"><span class="annottext">Text -&gt; Map Text Int -&gt; [TWord] -&gt; Transcript
</span><a href="Reanimate.Voice.html#Transcript"><span class="hs-identifier hs-var">Transcript</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Map Text Int -&gt; [TWord] -&gt; Transcript)
-&gt; Parser Text -&gt; Parser (Map Text Int -&gt; [TWord] -&gt; Transcript)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679549727"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">Object -&gt; Text -&gt; Parser Text
forall a. FromJSON a =&gt; Object -&gt; Text -&gt; Parser a
</span><span class="hs-operator hs-var">.:</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;transcript&quot;</span></span><span> </span><span class="annot"><span class="annottext">Parser (Map Text Int -&gt; [TWord] -&gt; Transcript)
-&gt; Parser (Map Text Int) -&gt; Parser ([TWord] -&gt; Transcript)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Map Text Int -&gt; Parser (Map Text Int)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Map Text Int
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span> </span><span class="annot"><span class="annottext">Parser ([TWord] -&gt; Transcript)
-&gt; Parser [TWord] -&gt; Parser Transcript
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679549727"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">Object -&gt; Text -&gt; Parser [TWord]
forall a. FromJSON a =&gt; Object -&gt; Text -&gt; Parser a
</span><span class="hs-operator hs-var">.:</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;words&quot;</span></span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span class="hs-comment">-- | Spoken word. Includes information about when it was spoken,</span><span>
</span><span id="line-58"></span><span class="hs-comment">--   its duration, and its phonemes.</span><span>
</span><span id="line-59"></span><span class="hs-keyword">data</span><span> </span><span id="TWord"><span class="annot"><a href="Reanimate.Voice.html#TWord"><span class="hs-identifier hs-var">TWord</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="TWord"><span class="annot"><a href="Reanimate.Voice.html#TWord"><span class="hs-identifier hs-var">TWord</span></a></span></span><span>
</span><span id="line-60"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="wordAligned"><span class="annot"><span class="annottext">TWord -&gt; Text
</span><a href="Reanimate.Voice.html#wordAligned"><span class="hs-identifier hs-var hs-var">wordAligned</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-61"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="wordCase"><span class="annot"><span class="annottext">TWord -&gt; Text
</span><a href="Reanimate.Voice.html#wordCase"><span class="hs-identifier hs-var hs-var">wordCase</span></a></span></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-62"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="wordStart"><span class="annot"><span class="annottext">TWord -&gt; Double
</span><a href="Reanimate.Voice.html#wordStart"><span class="hs-identifier hs-var hs-var">wordStart</span></a></span></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-comment">-- ^ Start of pronunciation in seconds</span><span>
</span><span id="line-63"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="wordStartOffset"><span class="annot"><span class="annottext">TWord -&gt; Int
</span><a href="Reanimate.Voice.html#wordStartOffset"><span class="hs-identifier hs-var hs-var">wordStartOffset</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>    </span><span class="hs-comment">-- ^ Character index of word in transcript</span><span>
</span><span id="line-64"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="wordEnd"><span class="annot"><span class="annottext">TWord -&gt; Double
</span><a href="Reanimate.Voice.html#wordEnd"><span class="hs-identifier hs-var hs-var">wordEnd</span></a></span></span><span>         </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-comment">-- ^ End of pronunciation in seconds</span><span>
</span><span id="line-65"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="wordEndOffset"><span class="annot"><span class="annottext">TWord -&gt; Int
</span><a href="Reanimate.Voice.html#wordEndOffset"><span class="hs-identifier hs-var hs-var">wordEndOffset</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>    </span><span class="hs-comment">-- ^ Last character index of word in transcript</span><span>
</span><span id="line-66"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="wordPhones"><span class="annot"><span class="annottext">TWord -&gt; [Phone]
</span><a href="Reanimate.Voice.html#wordPhones"><span class="hs-identifier hs-var hs-var">wordPhones</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Reanimate.Voice.html#Phone"><span class="hs-identifier hs-type">Phone</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-67"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="wordReference"><span class="annot"><span class="annottext">TWord -&gt; Text
</span><a href="Reanimate.Voice.html#wordReference"><span class="hs-identifier hs-var hs-var">wordReference</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>   </span><span class="hs-comment">-- ^ The word being pronounced.</span><span>
</span><span id="line-68"></span><span>  </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679549709"><span id="local-6989586621679549711"><span id="local-6989586621679549713"><span class="annot"><span class="annottext">Int -&gt; TWord -&gt; ShowS
[TWord] -&gt; ShowS
TWord -&gt; String
(Int -&gt; TWord -&gt; ShowS)
-&gt; (TWord -&gt; String) -&gt; ([TWord] -&gt; ShowS) -&gt; Show TWord
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [TWord] -&gt; ShowS
$cshowList :: [TWord] -&gt; ShowS
show :: TWord -&gt; String
$cshow :: TWord -&gt; String
showsPrec :: Int -&gt; TWord -&gt; ShowS
$cshowsPrec :: Int -&gt; TWord -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679549706"><span class="annot"><span class="hs-identifier hs-type">FromJSON</span></span><span> </span><span class="annot"><a href="Reanimate.Voice.html#TWord"><span class="hs-identifier hs-type">TWord</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-71"></span><span>  </span><span id="local-6989586621679549705"><span class="annot"><span class="annottext">parseJSON :: Value -&gt; Parser TWord
</span><a href="#local-6989586621679549705"><span class="hs-identifier hs-var hs-var hs-var hs-var">parseJSON</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; (Object -&gt; Parser TWord) -&gt; Value -&gt; Parser TWord
forall a. String -&gt; (Object -&gt; Parser a) -&gt; Value -&gt; Parser a
</span><span class="hs-identifier hs-var">withObject</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;word&quot;</span></span><span> </span><span class="annot"><span class="annottext">((Object -&gt; Parser TWord) -&gt; Value -&gt; Parser TWord)
-&gt; (Object -&gt; Parser TWord) -&gt; Value -&gt; Parser TWord
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679549704"><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679549704"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-72"></span><span>    </span><span class="annot"><span class="annottext">Text
-&gt; Text
-&gt; Double
-&gt; Int
-&gt; Double
-&gt; Int
-&gt; [Phone]
-&gt; Text
-&gt; TWord
</span><a href="Reanimate.Voice.html#TWord"><span class="hs-identifier hs-var">TWord</span></a></span><span>
</span><span id="line-73"></span><span>      </span><span class="annot"><span class="annottext">(Text
 -&gt; Text
 -&gt; Double
 -&gt; Int
 -&gt; Double
 -&gt; Int
 -&gt; [Phone]
 -&gt; Text
 -&gt; TWord)
-&gt; Parser Text
-&gt; Parser
     (Text
      -&gt; Double -&gt; Int -&gt; Double -&gt; Int -&gt; [Phone] -&gt; Text -&gt; TWord)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679549704"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-74"></span><span>      </span><span class="annot"><span class="annottext">Object -&gt; Text -&gt; Parser (Maybe Text)
forall a. FromJSON a =&gt; Object -&gt; Text -&gt; Parser (Maybe a)
</span><span class="hs-operator hs-var">.:?</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;alignedWord&quot;</span></span><span>
</span><span id="line-75"></span><span>      </span><span class="annot"><span class="annottext">Parser (Maybe Text) -&gt; Text -&gt; Parser Text
forall a. Parser (Maybe a) -&gt; a -&gt; Parser a
</span><span class="hs-operator hs-var">.!=</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier hs-var">T.empty</span></span><span>
</span><span id="line-76"></span><span>      </span><span class="annot"><span class="annottext">Parser
  (Text
   -&gt; Double -&gt; Int -&gt; Double -&gt; Int -&gt; [Phone] -&gt; Text -&gt; TWord)
-&gt; Parser Text
-&gt; Parser
     (Double -&gt; Int -&gt; Double -&gt; Int -&gt; [Phone] -&gt; Text -&gt; TWord)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679549704"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-77"></span><span>      </span><span class="annot"><span class="annottext">Object -&gt; Text -&gt; Parser Text
forall a. FromJSON a =&gt; Object -&gt; Text -&gt; Parser a
</span><span class="hs-operator hs-var">.:</span></span><span>  </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;case&quot;</span></span><span>
</span><span id="line-78"></span><span>      </span><span class="annot"><span class="annottext">Parser (Double -&gt; Int -&gt; Double -&gt; Int -&gt; [Phone] -&gt; Text -&gt; TWord)
-&gt; Parser Double
-&gt; Parser (Int -&gt; Double -&gt; Int -&gt; [Phone] -&gt; Text -&gt; TWord)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679549704"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-79"></span><span>      </span><span class="annot"><span class="annottext">Object -&gt; Text -&gt; Parser (Maybe Double)
forall a. FromJSON a =&gt; Object -&gt; Text -&gt; Parser (Maybe a)
</span><span class="hs-operator hs-var">.:?</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;start&quot;</span></span><span>
</span><span id="line-80"></span><span>      </span><span class="annot"><span class="annottext">Parser (Maybe Double) -&gt; Double -&gt; Parser Double
forall a. Parser (Maybe a) -&gt; a -&gt; Parser a
</span><span class="hs-operator hs-var">.!=</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span>
</span><span id="line-81"></span><span>      </span><span class="annot"><span class="annottext">Parser (Int -&gt; Double -&gt; Int -&gt; [Phone] -&gt; Text -&gt; TWord)
-&gt; Parser Int -&gt; Parser (Double -&gt; Int -&gt; [Phone] -&gt; Text -&gt; TWord)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679549704"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-82"></span><span>      </span><span class="annot"><span class="annottext">Object -&gt; Text -&gt; Parser Int
forall a. FromJSON a =&gt; Object -&gt; Text -&gt; Parser a
</span><span class="hs-operator hs-var">.:</span></span><span>  </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;startOffset&quot;</span></span><span>
</span><span id="line-83"></span><span>      </span><span class="annot"><span class="annottext">Parser (Double -&gt; Int -&gt; [Phone] -&gt; Text -&gt; TWord)
-&gt; Parser Double -&gt; Parser (Int -&gt; [Phone] -&gt; Text -&gt; TWord)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679549704"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-84"></span><span>      </span><span class="annot"><span class="annottext">Object -&gt; Text -&gt; Parser (Maybe Double)
forall a. FromJSON a =&gt; Object -&gt; Text -&gt; Parser (Maybe a)
</span><span class="hs-operator hs-var">.:?</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;end&quot;</span></span><span>
</span><span id="line-85"></span><span>      </span><span class="annot"><span class="annottext">Parser (Maybe Double) -&gt; Double -&gt; Parser Double
forall a. Parser (Maybe a) -&gt; a -&gt; Parser a
</span><span class="hs-operator hs-var">.!=</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span>
</span><span id="line-86"></span><span>      </span><span class="annot"><span class="annottext">Parser (Int -&gt; [Phone] -&gt; Text -&gt; TWord)
-&gt; Parser Int -&gt; Parser ([Phone] -&gt; Text -&gt; TWord)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679549704"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-87"></span><span>      </span><span class="annot"><span class="annottext">Object -&gt; Text -&gt; Parser Int
forall a. FromJSON a =&gt; Object -&gt; Text -&gt; Parser a
</span><span class="hs-operator hs-var">.:</span></span><span>  </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;endOffset&quot;</span></span><span>
</span><span id="line-88"></span><span>      </span><span class="annot"><span class="annottext">Parser ([Phone] -&gt; Text -&gt; TWord)
-&gt; Parser [Phone] -&gt; Parser (Text -&gt; TWord)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679549704"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-89"></span><span>      </span><span class="annot"><span class="annottext">Object -&gt; Text -&gt; Parser (Maybe [Phone])
forall a. FromJSON a =&gt; Object -&gt; Text -&gt; Parser (Maybe a)
</span><span class="hs-operator hs-var">.:?</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;phones&quot;</span></span><span>
</span><span id="line-90"></span><span>      </span><span class="annot"><span class="annottext">Parser (Maybe [Phone]) -&gt; [Phone] -&gt; Parser [Phone]
forall a. Parser (Maybe a) -&gt; a -&gt; Parser a
</span><span class="hs-operator hs-var">.!=</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-91"></span><span>      </span><span class="annot"><span class="annottext">Parser (Text -&gt; TWord) -&gt; Parser Text -&gt; Parser TWord
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679549704"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-92"></span><span>      </span><span class="annot"><span class="annottext">Object -&gt; Text -&gt; Parser Text
forall a. FromJSON a =&gt; Object -&gt; Text -&gt; Parser a
</span><span class="hs-operator hs-var">.:</span></span><span>  </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;word&quot;</span></span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span class="hs-comment">-- | Phoneme type</span><span>
</span><span id="line-95"></span><span class="hs-keyword">data</span><span> </span><span id="Phone"><span class="annot"><a href="Reanimate.Voice.html#Phone"><span class="hs-identifier hs-var">Phone</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Phone"><span class="annot"><a href="Reanimate.Voice.html#Phone"><span class="hs-identifier hs-var">Phone</span></a></span></span><span>
</span><span id="line-96"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="phoneDuration"><span class="annot"><span class="annottext">Phone -&gt; Double
</span><a href="Reanimate.Voice.html#phoneDuration"><span class="hs-identifier hs-var hs-var">phoneDuration</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-97"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="phoneType"><span class="annot"><span class="annottext">Phone -&gt; Text
</span><a href="Reanimate.Voice.html#phoneType"><span class="hs-identifier hs-var hs-var">phoneType</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-98"></span><span>  </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679549692"><span id="local-6989586621679549694"><span id="local-6989586621679549696"><span class="annot"><span class="annottext">Int -&gt; Phone -&gt; ShowS
[Phone] -&gt; ShowS
Phone -&gt; String
(Int -&gt; Phone -&gt; ShowS)
-&gt; (Phone -&gt; String) -&gt; ([Phone] -&gt; ShowS) -&gt; Show Phone
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [Phone] -&gt; ShowS
$cshowList :: [Phone] -&gt; ShowS
show :: Phone -&gt; String
$cshow :: Phone -&gt; String
showsPrec :: Int -&gt; Phone -&gt; ShowS
$cshowsPrec :: Int -&gt; Phone -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679549689"><span class="annot"><span class="hs-identifier hs-type">FromJSON</span></span><span> </span><span class="annot"><a href="Reanimate.Voice.html#Phone"><span class="hs-identifier hs-type">Phone</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-101"></span><span>  </span><span id="local-6989586621679549688"><span class="annot"><span class="annottext">parseJSON :: Value -&gt; Parser Phone
</span><a href="#local-6989586621679549688"><span class="hs-identifier hs-var hs-var hs-var hs-var">parseJSON</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-102"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; (Object -&gt; Parser Phone) -&gt; Value -&gt; Parser Phone
forall a. String -&gt; (Object -&gt; Parser a) -&gt; Value -&gt; Parser a
</span><span class="hs-identifier hs-var">withObject</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;phone&quot;</span></span><span> </span><span class="annot"><span class="annottext">((Object -&gt; Parser Phone) -&gt; Value -&gt; Parser Phone)
-&gt; (Object -&gt; Parser Phone) -&gt; Value -&gt; Parser Phone
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679549687"><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679549687"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Text -&gt; Phone
</span><a href="Reanimate.Voice.html#Phone"><span class="hs-identifier hs-var">Phone</span></a></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Text -&gt; Phone)
-&gt; Parser Double -&gt; Parser (Text -&gt; Phone)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679549687"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">Object -&gt; Text -&gt; Parser Double
forall a. FromJSON a =&gt; Object -&gt; Text -&gt; Parser a
</span><span class="hs-operator hs-var">.:</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;duration&quot;</span></span><span> </span><span class="annot"><span class="annottext">Parser (Text -&gt; Phone) -&gt; Parser Text -&gt; Parser Phone
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679549687"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">Object -&gt; Text -&gt; Parser Text
forall a. FromJSON a =&gt; Object -&gt; Text -&gt; Parser a
</span><span class="hs-operator hs-var">.:</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;phone&quot;</span></span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span class="hs-comment">-- | Locate the first word that occurs after all the given keys.</span><span>
</span><span id="line-105"></span><span class="hs-comment">--   An error is thrown if no such word exists. An error is thrown</span><span>
</span><span id="line-106"></span><span class="hs-comment">--   if the keys do not exist in the transcript.</span><span>
</span><span id="line-107"></span><span class="annot"><a href="Reanimate.Voice.html#findWord"><span class="hs-identifier hs-type">findWord</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Reanimate.Voice.html#Transcript"><span class="hs-identifier hs-type">Transcript</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Reanimate.Voice.html#TWord"><span class="hs-identifier hs-type">TWord</span></a></span><span>
</span><span id="line-108"></span><span id="findWord"><span class="annot"><span class="annottext">findWord :: Transcript -&gt; [Text] -&gt; Text -&gt; TWord
</span><a href="Reanimate.Voice.html#findWord"><span class="hs-identifier hs-var hs-var">findWord</span></a></span></span><span> </span><span id="local-6989586621679549686"><span class="annot"><span class="annottext">Transcript
</span><a href="#local-6989586621679549686"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679549685"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679549685"><span class="hs-identifier hs-var">keys</span></a></span></span><span> </span><span id="local-6989586621679549684"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549684"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[TWord] -&gt; Maybe TWord
forall a. [a] -&gt; Maybe a
</span><span class="hs-identifier hs-var">listToMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Transcript -&gt; [Text] -&gt; Text -&gt; [TWord]
</span><a href="Reanimate.Voice.html#findWords"><span class="hs-identifier hs-var">findWords</span></a></span><span> </span><span class="annot"><span class="annottext">Transcript
</span><a href="#local-6989586621679549686"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679549685"><span class="hs-identifier hs-var">keys</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549684"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-109"></span><span>  </span><span class="annot"><span class="annottext">Maybe TWord
</span><span class="hs-identifier hs-var">Nothing</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; TWord
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; TWord) -&gt; String -&gt; TWord
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Word not in transcript: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">([Text], Text) -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679549685"><span class="hs-identifier hs-var">keys</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549684"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-110"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679549681"><span class="annot"><span class="annottext">TWord
</span><a href="#local-6989586621679549681"><span class="hs-identifier hs-var">tword</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TWord
</span><a href="#local-6989586621679549681"><span class="hs-identifier hs-var">tword</span></a></span><span>
</span><span id="line-111"></span><span>
</span><span id="line-112"></span><span class="hs-comment">-- | Locate all words that occur after all the given keys.</span><span>
</span><span id="line-113"></span><span class="hs-comment">--   May return an empty list. An error is thrown</span><span>
</span><span id="line-114"></span><span class="hs-comment">--   if the keys do not exist in the transcript.</span><span>
</span><span id="line-115"></span><span class="annot"><a href="Reanimate.Voice.html#findWords"><span class="hs-identifier hs-type">findWords</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Reanimate.Voice.html#Transcript"><span class="hs-identifier hs-type">Transcript</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Reanimate.Voice.html#TWord"><span class="hs-identifier hs-type">TWord</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-116"></span><span id="findWords"><span class="annot"><span class="annottext">findWords :: Transcript -&gt; [Text] -&gt; Text -&gt; [TWord]
</span><a href="Reanimate.Voice.html#findWords"><span class="hs-identifier hs-var hs-var">findWords</span></a></span></span><span> </span><span id="local-6989586621679549680"><span class="annot"><span class="annottext">Transcript
</span><a href="#local-6989586621679549680"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621679549679"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549679"><span class="hs-identifier hs-var">wd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-117"></span><span>  </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TWord
</span><a href="#local-6989586621679549678"><span class="hs-identifier hs-var">tword</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679549678"><span class="annot"><span class="annottext">TWord
</span><a href="#local-6989586621679549678"><span class="hs-identifier hs-var">tword</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Transcript -&gt; [TWord]
</span><a href="Reanimate.Voice.html#transcriptWords"><span class="hs-identifier hs-var hs-var">transcriptWords</span></a></span><span> </span><span class="annot"><span class="annottext">Transcript
</span><a href="#local-6989586621679549680"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TWord -&gt; Text
</span><a href="Reanimate.Voice.html#wordReference"><span class="hs-identifier hs-var hs-var">wordReference</span></a></span><span> </span><span class="annot"><span class="annottext">TWord
</span><a href="#local-6989586621679549678"><span class="hs-identifier hs-var">tword</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549679"><span class="hs-identifier hs-var">wd</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-118"></span><span class="annot"><a href="Reanimate.Voice.html#findWords"><span class="hs-identifier hs-var">findWords</span></a></span><span> </span><span id="local-6989586621679549677"><span class="annot"><span class="annottext">Transcript
</span><a href="#local-6989586621679549677"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679549676"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549676"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679549675"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679549675"><span class="hs-identifier hs-var">keys</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679549674"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549674"><span class="hs-identifier hs-var">wd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-119"></span><span>  </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TWord
</span><a href="#local-6989586621679549673"><span class="hs-identifier hs-var">tword</span></a></span><span>
</span><span id="line-120"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679549673"><span class="annot"><span class="annottext">TWord
</span><a href="#local-6989586621679549673"><span class="hs-identifier hs-var">tword</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Transcript -&gt; [Text] -&gt; Text -&gt; [TWord]
</span><a href="Reanimate.Voice.html#findWords"><span class="hs-identifier hs-var">findWords</span></a></span><span> </span><span class="annot"><span class="annottext">Transcript
</span><a href="#local-6989586621679549677"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679549675"><span class="hs-identifier hs-var">keys</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549674"><span class="hs-identifier hs-var">wd</span></a></span><span>
</span><span id="line-121"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TWord -&gt; Int
</span><a href="Reanimate.Voice.html#wordStartOffset"><span class="hs-identifier hs-var hs-var">wordStartOffset</span></a></span><span> </span><span class="annot"><span class="annottext">TWord
</span><a href="#local-6989586621679549673"><span class="hs-identifier hs-var">tword</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Text -&gt; Map Text Int -&gt; Int
forall k a. Ord k =&gt; a -&gt; k -&gt; Map k a -&gt; a
</span><span class="hs-identifier hs-var">Map.findWithDefault</span></span><span> </span><span class="annot"><span class="annottext">Int
forall a. a
</span><a href="#local-6989586621679549671"><span class="hs-identifier hs-var">badKey</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549676"><span class="hs-identifier hs-var">key</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Transcript -&gt; Map Text Int
</span><a href="Reanimate.Voice.html#transcriptKeys"><span class="hs-identifier hs-var hs-var">transcriptKeys</span></a></span><span> </span><span class="annot"><span class="annottext">Transcript
</span><a href="#local-6989586621679549677"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span>  </span><span class="hs-special">]</span><span>
</span><span id="line-123"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679549671"><span class="annot"><span class="annottext">badKey :: a
</span><a href="#local-6989586621679549671"><span class="hs-identifier hs-var hs-var">badKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; a
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; a) -&gt; String -&gt; a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Missing transcript key: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549676"><span class="hs-identifier hs-var">key</span></a></span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span class="hs-comment">-- | Loading a transcript does three things depending on which files are available</span><span>
</span><span id="line-126"></span><span class="hs-comment">--   with the same basename as the input argument:</span><span>
</span><span id="line-127"></span><span class="hs-comment">--   1. If a JSON file is available, it is parsed and returned.</span><span>
</span><span id="line-128"></span><span class="hs-comment">--   2. If an audio file is available, reanimate tries to align it by calling out to</span><span>
</span><span id="line-129"></span><span class="hs-comment">--      Gentle on localhost:8765/. If Gentle is not running, an error will be thrown.</span><span>
</span><span id="line-130"></span><span class="hs-comment">--   3. If only the text transcript is available, a fake transcript is returned,</span><span>
</span><span id="line-131"></span><span class="hs-comment">--      with timings roughly at 120 words per minute.</span><span>
</span><span id="line-132"></span><span class="annot"><a href="Reanimate.Voice.html#loadTranscript"><span class="hs-identifier hs-type">loadTranscript</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Reanimate.Voice.html#Transcript"><span class="hs-identifier hs-type">Transcript</span></a></span><span>
</span><span id="line-133"></span><span id="loadTranscript"><span class="annot"><span class="annottext">loadTranscript :: String -&gt; Transcript
</span><a href="Reanimate.Voice.html#loadTranscript"><span class="hs-identifier hs-var hs-var">loadTranscript</span></a></span></span><span> </span><span id="local-6989586621679549669"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679549669"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO Transcript -&gt; Transcript
forall a. IO a -&gt; a
</span><span class="hs-identifier hs-var">unsafePerformIO</span></span><span> </span><span class="annot"><span class="annottext">(IO Transcript -&gt; Transcript) -&gt; IO Transcript -&gt; Transcript
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-134"></span><span>  </span><span id="local-6989586621679549668"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549668"><span class="hs-identifier hs-var">rawTranscript</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO Text
</span><span class="hs-identifier hs-var">T.readFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679549669"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-135"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679549666"><span class="annot"><span class="annottext">keys :: Map Text Int
</span><a href="#local-6989586621679549666"><span class="hs-identifier hs-var hs-var">keys</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Map Text Int
</span><a href="Reanimate.Voice.html#parseTranscriptKeys"><span class="hs-identifier hs-var">parseTranscriptKeys</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549668"><span class="hs-identifier hs-var">rawTranscript</span></a></span><span>
</span><span id="line-136"></span><span>      </span><span id="local-6989586621679549664"><span class="annot"><span class="annottext">trimTranscript :: Text
</span><a href="#local-6989586621679549664"><span class="hs-identifier hs-var hs-var">trimTranscript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Text Int -&gt; Text -&gt; Text
</span><a href="Reanimate.Voice.html#cutoutKeys"><span class="hs-identifier hs-var">cutoutKeys</span></a></span><span> </span><span class="annot"><span class="annottext">Map Text Int
</span><a href="#local-6989586621679549666"><span class="hs-identifier hs-var">keys</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549668"><span class="hs-identifier hs-var">rawTranscript</span></a></span><span>
</span><span id="line-137"></span><span>  </span><span id="local-6989586621679549662"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679549662"><span class="hs-identifier hs-var">hasJSON</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO Bool
</span><span class="hs-identifier hs-var">doesFileExist</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679549661"><span class="hs-identifier hs-var">jsonPath</span></a></span><span>
</span><span id="line-138"></span><span>  </span><span id="local-6989586621679549660"><span class="annot"><span class="annottext">Transcript
</span><a href="#local-6989586621679549660"><span class="hs-identifier hs-var">transcript</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679549662"><span class="hs-identifier hs-var">hasJSON</span></a></span><span>
</span><span id="line-139"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-140"></span><span>      </span><span id="local-6989586621679549659"><span class="annot"><span class="annottext">Maybe Transcript
</span><a href="#local-6989586621679549659"><span class="hs-identifier hs-var">mbT</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO (Maybe Transcript)
forall a. FromJSON a =&gt; String -&gt; IO (Maybe a)
</span><span class="hs-identifier hs-var">decodeFileStrict</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679549661"><span class="hs-identifier hs-var">jsonPath</span></a></span><span>
</span><span id="line-141"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Transcript
</span><a href="#local-6989586621679549659"><span class="hs-identifier hs-var">mbT</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-142"></span><span>        </span><span class="annot"><span class="annottext">Maybe Transcript
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO Transcript
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;bad json&quot;</span></span><span>
</span><span id="line-143"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679549657"><span class="annot"><span class="annottext">Transcript
</span><a href="#local-6989586621679549657"><span class="hs-identifier hs-var">t</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Transcript -&gt; IO Transcript
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Transcript
</span><a href="#local-6989586621679549657"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-144"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-145"></span><span>      </span><span id="local-6989586621679549656"><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621679549656"><span class="hs-identifier hs-var">hasAudio</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; IO (Maybe String)
</span><a href="Reanimate.Voice.html#findWithExtension"><span class="hs-identifier hs-var">findWithExtension</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679549669"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679549654"><span class="hs-identifier hs-var">audioExtensions</span></a></span><span>
</span><span id="line-146"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621679549656"><span class="hs-identifier hs-var">hasAudio</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-147"></span><span>        </span><span class="annot"><span class="annottext">Maybe String
</span><span class="hs-identifier hs-var">Nothing</span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Transcript -&gt; IO Transcript
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Transcript -&gt; IO Transcript) -&gt; Transcript -&gt; IO Transcript
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Transcript
</span><a href="Reanimate.Voice.html#fakeTranscript%27"><span class="hs-identifier hs-var">fakeTranscript'</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549664"><span class="hs-identifier hs-var">trimTranscript</span></a></span><span>
</span><span id="line-148"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679549652"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679549652"><span class="hs-identifier hs-var">audioPath</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; (String -&gt; IO Transcript) -&gt; IO Transcript
forall a. String -&gt; (String -&gt; IO a) -&gt; IO a
</span><a href="Reanimate.Misc.html#withTempFile"><span class="hs-identifier hs-var">withTempFile</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;txt&quot;</span></span><span> </span><span class="annot"><span class="annottext">((String -&gt; IO Transcript) -&gt; IO Transcript)
-&gt; (String -&gt; IO Transcript) -&gt; IO Transcript
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679549651"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679549651"><span class="hs-identifier hs-var">txtPath</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-149"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.writeFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679549651"><span class="hs-identifier hs-var">txtPath</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549664"><span class="hs-identifier hs-var">trimTranscript</span></a></span><span>
</span><span id="line-150"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; String -&gt; IO ()
</span><a href="Reanimate.Voice.html#runGentleForcedAligner"><span class="hs-identifier hs-var">runGentleForcedAligner</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679549652"><span class="hs-identifier hs-var">audioPath</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679549651"><span class="hs-identifier hs-var">txtPath</span></a></span><span>
</span><span id="line-151"></span><span>          </span><span id="local-6989586621679549648"><span class="annot"><span class="annottext">Maybe Transcript
</span><a href="#local-6989586621679549648"><span class="hs-identifier hs-var">mbT</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO (Maybe Transcript)
forall a. FromJSON a =&gt; String -&gt; IO (Maybe a)
</span><span class="hs-identifier hs-var">decodeFileStrict</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679549661"><span class="hs-identifier hs-var">jsonPath</span></a></span><span>
</span><span id="line-152"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Transcript
</span><a href="#local-6989586621679549648"><span class="hs-identifier hs-var">mbT</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-153"></span><span>            </span><span class="annot"><span class="annottext">Maybe Transcript
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO Transcript
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;bad json&quot;</span></span><span>
</span><span id="line-154"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679549647"><span class="annot"><span class="annottext">Transcript
</span><a href="#local-6989586621679549647"><span class="hs-identifier hs-var">t</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Transcript -&gt; IO Transcript
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Transcript
</span><a href="#local-6989586621679549647"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-155"></span><span>  </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="annot"><span class="annottext">Transcript
</span><a href="#local-6989586621679549660"><span class="hs-identifier hs-var">transcript</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">transcriptKeys :: Map Text Int
</span><a href="Reanimate.Voice.html#transcriptKeys"><span class="hs-identifier hs-var">transcriptKeys</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Text Int -&gt; Map Text Int
</span><a href="Reanimate.Voice.html#finalizeKeys"><span class="hs-identifier hs-var">finalizeKeys</span></a></span><span> </span><span class="annot"><span class="annottext">Map Text Int
</span><a href="#local-6989586621679549666"><span class="hs-identifier hs-var">keys</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-156"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-157"></span><span>  </span><span id="local-6989586621679549661"><span class="annot"><span class="annottext">jsonPath :: String
</span><a href="#local-6989586621679549661"><span class="hs-identifier hs-var hs-var">jsonPath</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><span class="hs-identifier hs-var">replaceExtension</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679549669"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;json&quot;</span></span><span>
</span><span id="line-158"></span><span>  </span><span id="local-6989586621679549654"><span class="annot"><span class="annottext">audioExtensions :: [String]
</span><a href="#local-6989586621679549654"><span class="hs-identifier hs-var hs-var">audioExtensions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mp3&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;m4a&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;flac&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span class="annot"><a href="Reanimate.Voice.html#parseTranscriptKeys"><span class="hs-identifier hs-type">parseTranscriptKeys</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-161"></span><span id="parseTranscriptKeys"><span class="annot"><span class="annottext">parseTranscriptKeys :: Text -&gt; Map Text Int
</span><a href="Reanimate.Voice.html#parseTranscriptKeys"><span class="hs-identifier hs-var hs-var">parseTranscriptKeys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Text Int -&gt; Int -&gt; Text -&gt; Map Text Int
</span><a href="#local-6989586621679549645"><span class="hs-identifier hs-var">worker</span></a></span><span> </span><span class="annot"><span class="annottext">Map Text Int
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-162"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-163"></span><span>  </span><span id="local-6989586621679549645"><span class="annot"><span class="annottext">worker :: Map Text Int -&gt; Int -&gt; Text -&gt; Map Text Int
</span><a href="#local-6989586621679549645"><span class="hs-identifier hs-var hs-var">worker</span></a></span></span><span> </span><span id="local-6989586621679549644"><span class="annot"><span class="annottext">Map Text Int
</span><a href="#local-6989586621679549644"><span class="hs-identifier hs-var">keys</span></a></span></span><span> </span><span id="local-6989586621679549643"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679549643"><span class="hs-identifier hs-var">offset</span></a></span></span><span> </span><span id="local-6989586621679549642"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549642"><span class="hs-identifier hs-var">txt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe (Char, Text)
</span><span class="hs-identifier hs-var">T.uncons</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549642"><span class="hs-identifier hs-var">txt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-164"></span><span>    </span><span class="annot"><span class="annottext">Maybe (Char, Text)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map Text Int
</span><a href="#local-6989586621679549644"><span class="hs-identifier hs-var">keys</span></a></span><span>
</span><span id="line-165"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'['</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679549640"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549640"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-166"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679549639"><span class="annot"><span class="annottext">key :: Text
</span><a href="#local-6989586621679549639"><span class="hs-identifier hs-var hs-var">key</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; Text -&gt; Text
</span><span class="hs-identifier hs-var">T.takeWhile</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">']'</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549640"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-167"></span><span>          </span><span id="local-6989586621679549636"><span class="annot"><span class="annottext">newOffset :: Int
</span><a href="#local-6989586621679549636"><span class="hs-identifier hs-var hs-var">newOffset</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Int
</span><span class="hs-identifier hs-var">T.length</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549639"><span class="hs-identifier hs-var">key</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span>
</span><span id="line-168"></span><span>      </span><span class="hs-keyword">in</span><span>  </span><span class="annot"><span class="annottext">Map Text Int -&gt; Int -&gt; Text -&gt; Map Text Int
</span><a href="#local-6989586621679549645"><span class="hs-identifier hs-var">worker</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Int -&gt; Map Text Int -&gt; Map Text Int
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insert</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549639"><span class="hs-identifier hs-var">key</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679549643"><span class="hs-identifier hs-var">offset</span></a></span><span> </span><span class="annot"><span class="annottext">Map Text Int
</span><a href="#local-6989586621679549644"><span class="hs-identifier hs-var">keys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-169"></span><span>                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679549643"><span class="hs-identifier hs-var">offset</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679549636"><span class="hs-identifier hs-var">newOffset</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span>                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Text -&gt; Text
</span><span class="hs-identifier hs-var">T.drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679549636"><span class="hs-identifier hs-var">newOffset</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549642"><span class="hs-identifier hs-var">txt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-171"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679549631"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549631"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map Text Int -&gt; Int -&gt; Text -&gt; Map Text Int
</span><a href="#local-6989586621679549645"><span class="hs-identifier hs-var">worker</span></a></span><span> </span><span class="annot"><span class="annottext">Map Text Int
</span><a href="#local-6989586621679549644"><span class="hs-identifier hs-var">keys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679549643"><span class="hs-identifier hs-var">offset</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549631"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span class="annot"><a href="Reanimate.Voice.html#finalizeKeys"><span class="hs-identifier hs-type">finalizeKeys</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-174"></span><span id="finalizeKeys"><span class="annot"><span class="annottext">finalizeKeys :: Map Text Int -&gt; Map Text Int
</span><a href="Reanimate.Voice.html#finalizeKeys"><span class="hs-identifier hs-var hs-var">finalizeKeys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Text, Int)] -&gt; Map Text Int
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="annot"><span class="annottext">([(Text, Int)] -&gt; Map Text Int)
-&gt; (Map Text Int -&gt; [(Text, Int)]) -&gt; Map Text Int -&gt; Map Text Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [(Text, Int)] -&gt; [(Text, Int)]
</span><a href="#local-6989586621679549628"><span class="hs-identifier hs-var">worker</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">([(Text, Int)] -&gt; [(Text, Int)])
-&gt; (Map Text Int -&gt; [(Text, Int)]) -&gt; Map Text Int -&gt; [(Text, Int)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((Text, Int) -&gt; Int) -&gt; [(Text, Int)] -&gt; [(Text, Int)]
forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sortOn</span></span><span> </span><span class="annot"><span class="annottext">(Text, Int) -&gt; Int
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">([(Text, Int)] -&gt; [(Text, Int)])
-&gt; (Map Text Int -&gt; [(Text, Int)]) -&gt; Map Text Int -&gt; [(Text, Int)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Map Text Int -&gt; [(Text, Int)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span>
</span><span id="line-175"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-176"></span><span>  </span><span id="local-6989586621679549628"><span class="annot"><span class="annottext">worker :: Int -&gt; [(Text, Int)] -&gt; [(Text, Int)]
</span><a href="#local-6989586621679549628"><span class="hs-identifier hs-var hs-var">worker</span></a></span></span><span> </span><span id="local-6989586621679549626"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679549626"><span class="hs-identifier hs-var">_offset</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-177"></span><span>  </span><span class="annot"><a href="#local-6989586621679549628"><span class="hs-identifier hs-var">worker</span></a></span><span> </span><span id="local-6989586621679549625"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679549625"><span class="hs-identifier hs-var">offset</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679549624"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549624"><span class="hs-identifier hs-var">key</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679549623"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679549623"><span class="hs-identifier hs-var">at</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679549622"><span class="annot"><span class="annottext">[(Text, Int)]
</span><a href="#local-6989586621679549622"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-178"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549624"><span class="hs-identifier hs-var">key</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679549623"><span class="hs-identifier hs-var">at</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679549625"><span class="hs-identifier hs-var">offset</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Text, Int) -&gt; [(Text, Int)] -&gt; [(Text, Int)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [(Text, Int)] -&gt; [(Text, Int)]
</span><a href="#local-6989586621679549628"><span class="hs-identifier hs-var">worker</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679549625"><span class="hs-identifier hs-var">offset</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Int
</span><span class="hs-identifier hs-var">T.length</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549624"><span class="hs-identifier hs-var">key</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Text, Int)]
</span><a href="#local-6989586621679549622"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-179"></span><span>
</span><span id="line-180"></span><span class="annot"><a href="Reanimate.Voice.html#cutoutKeys"><span class="hs-identifier hs-type">cutoutKeys</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-181"></span><span id="cutoutKeys"><span class="annot"><span class="annottext">cutoutKeys :: Map Text Int -&gt; Text -&gt; Text
</span><a href="Reanimate.Voice.html#cutoutKeys"><span class="hs-identifier hs-var hs-var">cutoutKeys</span></a></span></span><span> </span><span id="local-6989586621679549621"><span class="annot"><span class="annottext">Map Text Int
</span><a href="#local-6989586621679549621"><span class="hs-identifier hs-var">keys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.concat</span></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; Text) -&gt; (Text -&gt; [Text]) -&gt; Text -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [(Text, Int)] -&gt; Text -&gt; [Text]
</span><a href="#local-6989586621679549619"><span class="hs-identifier hs-var">worker</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Text, Int) -&gt; Int) -&gt; [(Text, Int)] -&gt; [(Text, Int)]
forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sortOn</span></span><span> </span><span class="annot"><span class="annottext">(Text, Int) -&gt; Int
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Text Int -&gt; [(Text, Int)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">Map Text Int
</span><a href="#local-6989586621679549621"><span class="hs-identifier hs-var">keys</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-182"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-183"></span><span>  </span><span id="local-6989586621679549619"><span class="annot"><span class="annottext">worker :: Int -&gt; [(Text, Int)] -&gt; Text -&gt; [Text]
</span><a href="#local-6989586621679549619"><span class="hs-identifier hs-var hs-var">worker</span></a></span></span><span> </span><span id="local-6989586621679549618"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679549618"><span class="hs-identifier hs-var">_offset</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621679549617"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549617"><span class="hs-identifier hs-var">txt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549617"><span class="hs-identifier hs-var">txt</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-184"></span><span>  </span><span class="annot"><a href="#local-6989586621679549619"><span class="hs-identifier hs-var">worker</span></a></span><span> </span><span id="local-6989586621679549616"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679549616"><span class="hs-identifier hs-var">offset</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679549615"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549615"><span class="hs-identifier hs-var">key</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679549614"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679549614"><span class="hs-identifier hs-var">at</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679549613"><span class="annot"><span class="annottext">[(Text, Int)]
</span><a href="#local-6989586621679549613"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679549612"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549612"><span class="hs-identifier hs-var">txt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-185"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679549611"><span class="annot"><span class="annottext">keyLen :: Int
</span><a href="#local-6989586621679549611"><span class="hs-identifier hs-var hs-var">keyLen</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Int
</span><span class="hs-identifier hs-var">T.length</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549615"><span class="hs-identifier hs-var">key</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span>
</span><span id="line-186"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679549610"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549610"><span class="hs-identifier hs-var">before</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679549609"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549609"><span class="hs-identifier hs-var">after</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Text -&gt; (Text, Text)
</span><span class="hs-identifier hs-var">T.splitAt</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679549614"><span class="hs-identifier hs-var">at</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679549616"><span class="hs-identifier hs-var">offset</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549612"><span class="hs-identifier hs-var">txt</span></a></span><span>
</span><span id="line-187"></span><span>    </span><span class="hs-keyword">in</span><span>  </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549610"><span class="hs-identifier hs-var">before</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; [Text]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [(Text, Int)] -&gt; Text -&gt; [Text]
</span><a href="#local-6989586621679549619"><span class="hs-identifier hs-var">worker</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679549614"><span class="hs-identifier hs-var">at</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679549611"><span class="hs-identifier hs-var">keyLen</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Text, Int)]
</span><a href="#local-6989586621679549613"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Text -&gt; Text
</span><span class="hs-identifier hs-var">T.drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679549611"><span class="hs-identifier hs-var">keyLen</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549609"><span class="hs-identifier hs-var">after</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span class="annot"><a href="Reanimate.Voice.html#findWithExtension"><span class="hs-identifier hs-type">findWithExtension</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span class="hs-special">)</span><span>
</span><span id="line-190"></span><span id="findWithExtension"><span class="annot"><span class="annottext">findWithExtension :: String -&gt; [String] -&gt; IO (Maybe String)
</span><a href="Reanimate.Voice.html#findWithExtension"><span class="hs-identifier hs-var hs-var">findWithExtension</span></a></span></span><span> </span><span id="local-6989586621679549607"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679549607"><span class="hs-identifier hs-var">_path</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe String -&gt; IO (Maybe String)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-191"></span><span class="annot"><a href="Reanimate.Voice.html#findWithExtension"><span class="hs-identifier hs-var">findWithExtension</span></a></span><span> </span><span id="local-6989586621679549606"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679549606"><span class="hs-identifier hs-var">path</span></a></span></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679549605"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679549605"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679549604"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679549604"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-192"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679549603"><span class="annot"><span class="annottext">newPath :: String
</span><a href="#local-6989586621679549603"><span class="hs-identifier hs-var hs-var">newPath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><span class="hs-identifier hs-var">replaceExtension</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679549606"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679549605"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-193"></span><span>  </span><span id="local-6989586621679549602"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679549602"><span class="hs-identifier hs-var">hasFile</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO Bool
</span><span class="hs-identifier hs-var">doesFileExist</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679549603"><span class="hs-identifier hs-var">newPath</span></a></span><span>
</span><span id="line-194"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679549602"><span class="hs-identifier hs-var">hasFile</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe String -&gt; IO (Maybe String)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Maybe String
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679549603"><span class="hs-identifier hs-var">newPath</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; IO (Maybe String)
</span><a href="Reanimate.Voice.html#findWithExtension"><span class="hs-identifier hs-var">findWithExtension</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679549606"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679549604"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-195"></span><span>
</span><span id="line-196"></span><span class="annot"><a href="Reanimate.Voice.html#runGentleForcedAligner"><span class="hs-identifier hs-type">runGentleForcedAligner</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-197"></span><span id="runGentleForcedAligner"><span class="annot"><span class="annottext">runGentleForcedAligner :: String -&gt; String -&gt; IO ()
</span><a href="Reanimate.Voice.html#runGentleForcedAligner"><span class="hs-identifier hs-var hs-var">runGentleForcedAligner</span></a></span></span><span> </span><span id="local-6989586621679549601"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679549601"><span class="hs-identifier hs-var">audioFile</span></a></span></span><span> </span><span id="local-6989586621679549600"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679549600"><span class="hs-identifier hs-var">transcriptFile</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-198"></span><span>  </span><span id="local-6989586621679549599"><span class="annot"><span class="annottext">ExitCode
</span><a href="#local-6989586621679549599"><span class="hs-identifier hs-var">ret</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; IO ExitCode
</span><span class="hs-identifier hs-var">rawSystem</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679549598"><span class="hs-identifier hs-var">prog</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679549597"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-199"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ExitCode
</span><a href="#local-6989586621679549599"><span class="hs-identifier hs-var">ret</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-200"></span><span>    </span><span class="annot"><span class="annottext">ExitCode
</span><span class="hs-identifier hs-var">ExitSuccess</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-201"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">ExitFailure</span></span><span> </span><span id="local-6989586621679549596"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679549596"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-202"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; IO ()
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span>
</span><span id="line-203"></span><span>        </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; String -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>  </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Gentle forced aligner failed with: &quot;</span></span><span>
</span><span id="line-204"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679549596"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-205"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\nIs it running locally on port 8765?&quot;</span></span><span>
</span><span id="line-206"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\nCommand: &quot;</span></span><span>
</span><span id="line-207"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; String
</span><span class="hs-identifier hs-var">showCommandForUser</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679549598"><span class="hs-identifier hs-var">prog</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679549597"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-208"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-209"></span><span>  </span><span id="local-6989586621679549598"><span class="annot"><span class="annottext">prog :: String
</span><a href="#local-6989586621679549598"><span class="hs-identifier hs-var hs-var">prog</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;curl&quot;</span></span><span>
</span><span id="line-210"></span><span>  </span><span id="local-6989586621679549597"><span class="annot"><span class="annottext">args :: [String]
</span><a href="#local-6989586621679549597"><span class="hs-identifier hs-var hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-211"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;--silent&quot;</span></span><span>
</span><span id="line-212"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;--form&quot;</span></span><span>
</span><span id="line-213"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;audio=@&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679549601"><span class="hs-identifier hs-var">audioFile</span></a></span><span>
</span><span id="line-214"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;--form&quot;</span></span><span>
</span><span id="line-215"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;transcript=@&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679549600"><span class="hs-identifier hs-var">transcriptFile</span></a></span><span>
</span><span id="line-216"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;--output&quot;</span></span><span>
</span><span id="line-217"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><span class="hs-identifier hs-var">replaceExtension</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679549601"><span class="hs-identifier hs-var">audioFile</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;json&quot;</span></span><span>
</span><span id="line-218"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;http://localhost:8765/transcriptions?async=false&quot;</span></span><span>
</span><span id="line-219"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-220"></span><span>
</span><span id="line-221"></span><span class="hs-keyword">data</span><span> </span><span id="Token"><span class="annot"><a href="Reanimate.Voice.html#Token"><span class="hs-identifier hs-var">Token</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="TokenWord"><span class="annot"><a href="Reanimate.Voice.html#TokenWord"><span class="hs-identifier hs-var">TokenWord</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="TokenComma"><span class="annot"><a href="Reanimate.Voice.html#TokenComma"><span class="hs-identifier hs-var">TokenComma</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="TokenPeriod"><span class="annot"><a href="Reanimate.Voice.html#TokenPeriod"><span class="hs-identifier hs-var">TokenPeriod</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="TokenParagraph"><span class="annot"><a href="Reanimate.Voice.html#TokenParagraph"><span class="hs-identifier hs-var">TokenParagraph</span></a></span></span><span>
</span><span id="line-222"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679549586"><span id="local-6989586621679549588"><span id="local-6989586621679549590"><span class="annot"><span class="annottext">Int -&gt; Token -&gt; ShowS
[Token] -&gt; ShowS
Token -&gt; String
(Int -&gt; Token -&gt; ShowS)
-&gt; (Token -&gt; String) -&gt; ([Token] -&gt; ShowS) -&gt; Show Token
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [Token] -&gt; ShowS
$cshowList :: [Token] -&gt; ShowS
show :: Token -&gt; String
$cshow :: Token -&gt; String
showsPrec :: Int -&gt; Token -&gt; ShowS
$cshowsPrec :: Int -&gt; Token -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-223"></span><span>
</span><span id="line-224"></span><span class="annot"><a href="Reanimate.Voice.html#lexText"><span class="hs-identifier hs-type">lexText</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Reanimate.Voice.html#Token"><span class="hs-identifier hs-type">Token</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-225"></span><span id="lexText"><span class="annot"><span class="annottext">lexText :: Text -&gt; [Token]
</span><a href="Reanimate.Voice.html#lexText"><span class="hs-identifier hs-var hs-var">lexText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Text -&gt; [Token]
</span><a href="#local-6989586621679549584"><span class="hs-identifier hs-var">worker</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-226"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-227"></span><span>  </span><span id="local-6989586621679549584"><span class="annot"><span class="annottext">worker :: Int -&gt; Text -&gt; [Token]
</span><a href="#local-6989586621679549584"><span class="hs-identifier hs-var hs-var">worker</span></a></span></span><span> </span><span id="local-6989586621679549583"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679549583"><span class="hs-identifier hs-var">offset</span></a></span></span><span> </span><span id="local-6989586621679549582"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549582"><span class="hs-identifier hs-var">txt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe (Char, Text)
</span><span class="hs-identifier hs-var">T.uncons</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549582"><span class="hs-identifier hs-var">txt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-228"></span><span>    </span><span class="annot"><span class="annottext">Maybe (Char, Text)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-229"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679549581"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679549581"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679549580"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549580"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-230"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><span class="hs-identifier hs-var">isSpace</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679549581"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-231"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679549579"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549579"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679549578"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549578"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; Text -&gt; (Text, Text)
</span><span class="hs-identifier hs-var">T.span</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\n'</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549582"><span class="hs-identifier hs-var">txt</span></a></span><span>
</span><span id="line-232"></span><span>         </span><span class="hs-keyword">in</span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Int
</span><span class="hs-identifier hs-var">T.length</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549579"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span>
</span><span id="line-233"></span><span>               </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Token
</span><a href="Reanimate.Voice.html#TokenParagraph"><span class="hs-identifier hs-var">TokenParagraph</span></a></span><span> </span><span class="annot"><span class="annottext">Token -&gt; [Token] -&gt; [Token]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Text -&gt; [Token]
</span><a href="#local-6989586621679549584"><span class="hs-identifier hs-var">worker</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679549583"><span class="hs-identifier hs-var">offset</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Int
</span><span class="hs-identifier hs-var">T.length</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549579"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549578"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-234"></span><span>               </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Text -&gt; [Token]
</span><a href="#local-6989586621679549584"><span class="hs-identifier hs-var">worker</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679549583"><span class="hs-identifier hs-var">offset</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549580"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-235"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679549581"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'.'</span></span><span>
</span><span id="line-236"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Token
</span><a href="Reanimate.Voice.html#TokenPeriod"><span class="hs-identifier hs-var">TokenPeriod</span></a></span><span> </span><span class="annot"><span class="annottext">Token -&gt; [Token] -&gt; [Token]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Text -&gt; [Token]
</span><a href="#local-6989586621679549584"><span class="hs-identifier hs-var">worker</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679549583"><span class="hs-identifier hs-var">offset</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549580"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-237"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679549581"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">','</span></span><span>
</span><span id="line-238"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Token
</span><a href="Reanimate.Voice.html#TokenComma"><span class="hs-identifier hs-var">TokenComma</span></a></span><span> </span><span class="annot"><span class="annottext">Token -&gt; [Token] -&gt; [Token]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Text -&gt; [Token]
</span><a href="#local-6989586621679549584"><span class="hs-identifier hs-var">worker</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679549583"><span class="hs-identifier hs-var">offset</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549580"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-239"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><a href="#local-6989586621679549576"><span class="hs-identifier hs-var">isWord</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679549581"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-240"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679549575"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549575"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679549574"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549574"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; Text -&gt; (Text, Text)
</span><span class="hs-identifier hs-var">T.span</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><a href="#local-6989586621679549576"><span class="hs-identifier hs-var">isWord</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549582"><span class="hs-identifier hs-var">txt</span></a></span><span>
</span><span id="line-241"></span><span>             </span><span id="local-6989586621679549573"><span class="annot"><span class="annottext">newOffset :: Int
</span><a href="#local-6989586621679549573"><span class="hs-identifier hs-var hs-var">newOffset</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679549583"><span class="hs-identifier hs-var">offset</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Int
</span><span class="hs-identifier hs-var">T.length</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549575"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-242"></span><span>         </span><span class="hs-keyword">in</span><span>  </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Text -&gt; Token
</span><a href="Reanimate.Voice.html#TokenWord"><span class="hs-identifier hs-var">TokenWord</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679549583"><span class="hs-identifier hs-var">offset</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679549573"><span class="hs-identifier hs-var">newOffset</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549575"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Token -&gt; [Token] -&gt; [Token]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Text -&gt; [Token]
</span><a href="#local-6989586621679549584"><span class="hs-identifier hs-var">worker</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679549573"><span class="hs-identifier hs-var">newOffset</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549574"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-243"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-244"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Text -&gt; [Token]
</span><a href="#local-6989586621679549584"><span class="hs-identifier hs-var">worker</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679549583"><span class="hs-identifier hs-var">offset</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549580"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-245"></span><span>  </span><span id="local-6989586621679549576"><span class="annot"><span class="annottext">isWord :: Char -&gt; Bool
</span><a href="#local-6989586621679549576"><span class="hs-identifier hs-var hs-var">isWord</span></a></span></span><span> </span><span id="local-6989586621679549572"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679549572"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><span class="hs-identifier hs-var">isAlphaNum</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679549572"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679549572"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; String -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\''</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'-'</span></span><span class="hs-special">]</span><span>
</span><span id="line-246"></span><span>
</span><span id="line-247"></span><span class="hs-comment">-- | Fake transcript timings at roughly 120 words per minute.</span><span>
</span><span id="line-248"></span><span class="annot"><a href="Reanimate.Voice.html#fakeTranscript"><span class="hs-identifier hs-type">fakeTranscript</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Reanimate.Voice.html#Transcript"><span class="hs-identifier hs-type">Transcript</span></a></span><span>
</span><span id="line-249"></span><span id="fakeTranscript"><span class="annot"><span class="annottext">fakeTranscript :: Text -&gt; Transcript
</span><a href="Reanimate.Voice.html#fakeTranscript"><span class="hs-identifier hs-var hs-var">fakeTranscript</span></a></span></span><span> </span><span id="local-6989586621679549569"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549569"><span class="hs-identifier hs-var">rawTranscript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-250"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679549568"><span class="annot"><span class="annottext">keys :: Map Text Int
</span><a href="#local-6989586621679549568"><span class="hs-identifier hs-var hs-var">keys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Map Text Int
</span><a href="Reanimate.Voice.html#parseTranscriptKeys"><span class="hs-identifier hs-var">parseTranscriptKeys</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549569"><span class="hs-identifier hs-var">rawTranscript</span></a></span><span>
</span><span id="line-251"></span><span>      </span><span id="local-6989586621679549567"><span class="annot"><span class="annottext">t :: Transcript
</span><a href="#local-6989586621679549567"><span class="hs-identifier hs-var hs-var">t</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Transcript
</span><a href="Reanimate.Voice.html#fakeTranscript%27"><span class="hs-identifier hs-var">fakeTranscript'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Text Int -&gt; Text -&gt; Text
</span><a href="Reanimate.Voice.html#cutoutKeys"><span class="hs-identifier hs-var">cutoutKeys</span></a></span><span> </span><span class="annot"><span class="annottext">Map Text Int
</span><a href="#local-6989586621679549568"><span class="hs-identifier hs-var">keys</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549569"><span class="hs-identifier hs-var">rawTranscript</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-252"></span><span>  </span><span class="hs-keyword">in</span><span>  </span><span class="annot"><span class="annottext">Transcript
</span><a href="#local-6989586621679549567"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">transcriptKeys :: Map Text Int
</span><a href="Reanimate.Voice.html#transcriptKeys"><span class="hs-identifier hs-var">transcriptKeys</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Text Int -&gt; Map Text Int
</span><a href="Reanimate.Voice.html#finalizeKeys"><span class="hs-identifier hs-var">finalizeKeys</span></a></span><span> </span><span class="annot"><span class="annottext">Map Text Int
</span><a href="#local-6989586621679549568"><span class="hs-identifier hs-var">keys</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-253"></span><span>
</span><span id="line-254"></span><span class="annot"><a href="Reanimate.Voice.html#fakeTranscript%27"><span class="hs-identifier hs-type">fakeTranscript'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Reanimate.Voice.html#Transcript"><span class="hs-identifier hs-type">Transcript</span></a></span><span>
</span><span id="line-255"></span><span id="fakeTranscript%27"><span class="annot"><span class="annottext">fakeTranscript' :: Text -&gt; Transcript
</span><a href="Reanimate.Voice.html#fakeTranscript%27"><span class="hs-identifier hs-var hs-var">fakeTranscript'</span></a></span></span><span> </span><span id="local-6989586621679549566"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549566"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Transcript :: Text -&gt; Map Text Int -&gt; [TWord] -&gt; Transcript
</span><a href="Reanimate.Voice.html#Transcript"><span class="hs-identifier hs-type">Transcript</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">transcriptText :: Text
</span><a href="Reanimate.Voice.html#transcriptText"><span class="hs-identifier hs-var">transcriptText</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549566"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-256"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">transcriptKeys :: Map Text Int
</span><a href="Reanimate.Voice.html#transcriptKeys"><span class="hs-identifier hs-var">transcriptKeys</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Text Int
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span>
</span><span id="line-257"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">transcriptWords :: [TWord]
</span><a href="Reanimate.Voice.html#transcriptWords"><span class="hs-identifier hs-var">transcriptWords</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; [Token] -&gt; [TWord]
</span><a href="#local-6989586621679549565"><span class="hs-identifier hs-var">worker</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; [Token]
</span><a href="Reanimate.Voice.html#lexText"><span class="hs-identifier hs-var">lexText</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549566"><span class="hs-identifier hs-var">input</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-258"></span><span>                                   </span><span class="hs-special">}</span><span>
</span><span id="line-259"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-260"></span><span>  </span><span id="local-6989586621679549565"><span class="annot"><span class="annottext">worker :: Double -&gt; [Token] -&gt; [TWord]
</span><a href="#local-6989586621679549565"><span class="hs-identifier hs-var hs-var">worker</span></a></span></span><span> </span><span id="local-6989586621679549564"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679549564"><span class="hs-identifier hs-var">_now</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-261"></span><span>  </span><span class="annot"><a href="#local-6989586621679549565"><span class="hs-identifier hs-var">worker</span></a></span><span> </span><span id="local-6989586621679549563"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679549563"><span class="hs-identifier hs-var">now</span></a></span></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679549562"><span class="annot"><span class="annottext">Token
</span><a href="#local-6989586621679549562"><span class="hs-identifier hs-var">token</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679549561"><span class="annot"><span class="annottext">[Token]
</span><a href="#local-6989586621679549561"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Token
</span><a href="#local-6989586621679549562"><span class="hs-identifier hs-var">token</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-262"></span><span>    </span><span class="annot"><a href="Reanimate.Voice.html#TokenWord"><span class="hs-identifier hs-type">TokenWord</span></a></span><span> </span><span id="local-6989586621679549560"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679549560"><span class="hs-identifier hs-var">start</span></a></span></span><span> </span><span id="local-6989586621679549559"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679549559"><span class="hs-identifier hs-var">end</span></a></span></span><span> </span><span id="local-6989586621679549558"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549558"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-263"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679549557"><span class="annot"><span class="annottext">dur :: Double
</span><a href="#local-6989586621679549557"><span class="hs-identifier hs-var hs-var">dur</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Real a, Fractional b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">realToFrac</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679549559"><span class="hs-identifier hs-var">end</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679549560"><span class="hs-identifier hs-var">start</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.1</span></span><span>
</span><span id="line-264"></span><span>      </span><span class="hs-keyword">in</span><span>  </span><span class="annot"><span class="annottext">TWord :: Text
-&gt; Text
-&gt; Double
-&gt; Int
-&gt; Double
-&gt; Int
-&gt; [Phone]
-&gt; Text
-&gt; TWord
</span><a href="Reanimate.Voice.html#TWord"><span class="hs-identifier hs-type">TWord</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">wordAligned :: Text
</span><a href="Reanimate.Voice.html#wordAligned"><span class="hs-identifier hs-var">wordAligned</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">T.toLower</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549558"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-265"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wordCase :: Text
</span><a href="Reanimate.Voice.html#wordCase"><span class="hs-identifier hs-var">wordCase</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;success&quot;</span></span><span>
</span><span id="line-266"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wordStart :: Double
</span><a href="Reanimate.Voice.html#wordStart"><span class="hs-identifier hs-var">wordStart</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679549563"><span class="hs-identifier hs-var">now</span></a></span><span>
</span><span id="line-267"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wordStartOffset :: Int
</span><a href="Reanimate.Voice.html#wordStartOffset"><span class="hs-identifier hs-var">wordStartOffset</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679549560"><span class="hs-identifier hs-var">start</span></a></span><span>
</span><span id="line-268"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wordEnd :: Double
</span><a href="Reanimate.Voice.html#wordEnd"><span class="hs-identifier hs-var">wordEnd</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679549563"><span class="hs-identifier hs-var">now</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679549557"><span class="hs-identifier hs-var">dur</span></a></span><span>
</span><span id="line-269"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wordEndOffset :: Int
</span><a href="Reanimate.Voice.html#wordEndOffset"><span class="hs-identifier hs-var">wordEndOffset</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679549559"><span class="hs-identifier hs-var">end</span></a></span><span>
</span><span id="line-270"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wordPhones :: [Phone]
</span><a href="Reanimate.Voice.html#wordPhones"><span class="hs-identifier hs-var">wordPhones</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-271"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wordReference :: Text
</span><a href="Reanimate.Voice.html#wordReference"><span class="hs-identifier hs-var">wordReference</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549558"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-272"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-273"></span><span>            </span><span class="annot"><span class="annottext">TWord -&gt; [TWord] -&gt; [TWord]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; [Token] -&gt; [TWord]
</span><a href="#local-6989586621679549565"><span class="hs-identifier hs-var">worker</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679549563"><span class="hs-identifier hs-var">now</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679549557"><span class="hs-identifier hs-var">dur</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Token]
</span><a href="#local-6989586621679549561"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-274"></span><span>    </span><span class="annot"><span class="annottext">Token
</span><a href="Reanimate.Voice.html#TokenComma"><span class="hs-identifier hs-var">TokenComma</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Double -&gt; [Token] -&gt; [TWord]
</span><a href="#local-6989586621679549565"><span class="hs-identifier hs-var">worker</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679549563"><span class="hs-identifier hs-var">now</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679549554"><span class="hs-identifier hs-var">commaPause</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Token]
</span><a href="#local-6989586621679549561"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-275"></span><span>    </span><span class="annot"><span class="annottext">Token
</span><a href="Reanimate.Voice.html#TokenPeriod"><span class="hs-identifier hs-var">TokenPeriod</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Double -&gt; [Token] -&gt; [TWord]
</span><a href="#local-6989586621679549565"><span class="hs-identifier hs-var">worker</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679549563"><span class="hs-identifier hs-var">now</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679549553"><span class="hs-identifier hs-var">periodPause</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Token]
</span><a href="#local-6989586621679549561"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-276"></span><span>    </span><span class="annot"><span class="annottext">Token
</span><a href="Reanimate.Voice.html#TokenParagraph"><span class="hs-identifier hs-var">TokenParagraph</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Double -&gt; [Token] -&gt; [TWord]
</span><a href="#local-6989586621679549565"><span class="hs-identifier hs-var">worker</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679549563"><span class="hs-identifier hs-var">now</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679549552"><span class="hs-identifier hs-var">paragraphPause</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Token]
</span><a href="#local-6989586621679549561"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-277"></span><span>  </span><span id="local-6989586621679549552"><span class="annot"><span class="annottext">paragraphPause :: Double
</span><a href="#local-6989586621679549552"><span class="hs-identifier hs-var hs-var">paragraphPause</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.5</span></span><span>
</span><span id="line-278"></span><span>  </span><span id="local-6989586621679549554"><span class="annot"><span class="annottext">commaPause :: Double
</span><a href="#local-6989586621679549554"><span class="hs-identifier hs-var hs-var">commaPause</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.1</span></span><span>
</span><span id="line-279"></span><span>  </span><span id="local-6989586621679549553"><span class="annot"><span class="annottext">periodPause :: Double
</span><a href="#local-6989586621679549553"><span class="hs-identifier hs-var hs-var">periodPause</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.2</span></span><span>
</span><span id="line-280"></span><span>
</span><span id="line-281"></span><span class="hs-comment">-- | Convert the transcript text to an SVG image using LaTeX and associate</span><span>
</span><span id="line-282"></span><span class="hs-comment">--   each word image with its timing information.</span><span>
</span><span id="line-283"></span><span class="annot"><a href="Reanimate.Voice.html#splitTranscript"><span class="hs-identifier hs-type">splitTranscript</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Reanimate.Voice.html#Transcript"><span class="hs-identifier hs-type">Transcript</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Reanimate.Animation.html#SVG"><span class="hs-identifier hs-type">SVG</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Reanimate.Voice.html#TWord"><span class="hs-identifier hs-type">TWord</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-284"></span><span id="splitTranscript"><span class="annot"><span class="annottext">splitTranscript :: Transcript -&gt; [(SVG, TWord)]
</span><a href="Reanimate.Voice.html#splitTranscript"><span class="hs-identifier hs-var hs-var">splitTranscript</span></a></span></span><span> </span><span class="annot"><a href="Reanimate.Voice.html#Transcript"><span class="hs-identifier hs-type">Transcript</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679549549"><span id="local-6989586621679549550"><span id="local-6989586621679549551"><span class="annot"><span class="annottext">[TWord]
Text
Map Text Int
transcriptWords :: [TWord]
transcriptKeys :: Map Text Int
transcriptText :: Text
transcriptWords :: Transcript -&gt; [TWord]
transcriptKeys :: Transcript -&gt; Map Text Int
transcriptText :: Transcript -&gt; Text
</span><a href="#local-6989586621679549549"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-285"></span><span>  </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SVG
</span><a href="#local-6989586621679549548"><span class="hs-identifier hs-var">svg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TWord
</span><a href="#local-6989586621679549547"><span class="hs-identifier hs-var">tword</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-286"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679549547"><span class="annot"><span class="annottext">tword :: TWord
</span><a href="#local-6989586621679549547"><span class="hs-identifier hs-var">tword</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Reanimate.Voice.html#TWord"><span class="hs-identifier hs-type">TWord</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679549539"><span id="local-6989586621679549540"><span id="local-6989586621679549541"><span id="local-6989586621679549542"><span id="local-6989586621679549543"><span id="local-6989586621679549544"><span id="local-6989586621679549545"><span id="local-6989586621679549546"><span class="annot"><span class="annottext">Double
Int
[Phone]
Text
wordReference :: Text
wordPhones :: [Phone]
wordEndOffset :: Int
wordEnd :: Double
wordStartOffset :: Int
wordStart :: Double
wordCase :: Text
wordAligned :: Text
wordReference :: TWord -&gt; Text
wordPhones :: TWord -&gt; [Phone]
wordEndOffset :: TWord -&gt; Int
wordEnd :: TWord -&gt; Double
wordStartOffset :: TWord -&gt; Int
wordStart :: TWord -&gt; Double
wordCase :: TWord -&gt; Text
wordAligned :: TWord -&gt; Text
</span><a href="#local-6989586621679549539"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TWord]
</span><a href="#local-6989586621679549549"><span class="hs-identifier hs-var">transcriptWords</span></a></span><span>
</span><span id="line-287"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679549538"><span class="annot"><span class="annottext">wordLength :: Int
</span><a href="#local-6989586621679549538"><span class="hs-identifier hs-var hs-var">wordLength</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679549541"><span class="hs-identifier hs-var">wordEndOffset</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679549543"><span class="hs-identifier hs-var">wordStartOffset</span></a></span><span>
</span><span id="line-288"></span><span>        </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SVG
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679549548"><span class="annot"><span class="annottext">SVG
</span><a href="#local-6989586621679549548"><span class="hs-identifier hs-var">svg</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SVG
</span><span class="hs-identifier">_</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; [SVG]
forall (t :: * -&gt; *). Traversable t =&gt; t Text -&gt; t SVG
</span><a href="Reanimate.LaTeX.html#latexChunks"><span class="hs-identifier hs-var">latexChunks</span></a></span><span>
</span><span id="line-289"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Text -&gt; Text
</span><span class="hs-identifier hs-var">T.take</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679549543"><span class="hs-identifier hs-var">wordStartOffset</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549551"><span class="hs-identifier hs-var">transcriptText</span></a></span><span>
</span><span id="line-290"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Text -&gt; Text
</span><span class="hs-identifier hs-var">T.take</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679549538"><span class="hs-identifier hs-var">wordLength</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Text -&gt; Text
</span><span class="hs-identifier hs-var">T.drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679549543"><span class="hs-identifier hs-var">wordStartOffset</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549551"><span class="hs-identifier hs-var">transcriptText</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-291"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Text -&gt; Text
</span><span class="hs-identifier hs-var">T.drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679549541"><span class="hs-identifier hs-var">wordEndOffset</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679549551"><span class="hs-identifier hs-var">transcriptText</span></a></span><span>
</span><span id="line-292"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-293"></span><span>  </span><span class="hs-special">]</span><span>
</span><span id="line-294"></span><span>
</span><span id="line-295"></span><span class="hs-comment">-- | Helper function for rendering a transcript.</span><span>
</span><span id="line-296"></span><span id="local-6989586621679549536"><span class="annot"><a href="Reanimate.Voice.html#annotateWithTranscript"><span class="hs-identifier hs-type">annotateWithTranscript</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Reanimate.Voice.html#Transcript"><span class="hs-identifier hs-type">Transcript</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Reanimate.Scene.Core.html#Scene"><span class="hs-identifier hs-type">Scene</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679549536"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-297"></span><span id="annotateWithTranscript"><span class="annot"><span class="annottext">annotateWithTranscript :: Transcript -&gt; Scene s ()
</span><a href="Reanimate.Voice.html#annotateWithTranscript"><span class="hs-identifier hs-var hs-var">annotateWithTranscript</span></a></span></span><span> </span><span id="local-6989586621679549535"><span class="annot"><span class="annottext">Transcript
</span><a href="#local-6989586621679549535"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TWord] -&gt; (TWord -&gt; Scene s ()) -&gt; Scene s ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Transcript -&gt; [TWord]
</span><a href="Reanimate.Voice.html#transcriptWords"><span class="hs-identifier hs-var hs-var">transcriptWords</span></a></span><span> </span><span class="annot"><span class="annottext">Transcript
</span><a href="#local-6989586621679549535"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((TWord -&gt; Scene s ()) -&gt; Scene s ())
-&gt; (TWord -&gt; Scene s ()) -&gt; Scene s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679549534"><span class="annot"><span class="annottext">TWord
</span><a href="#local-6989586621679549534"><span class="hs-identifier hs-var">tword</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-298"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679549533"><span class="annot"><span class="annottext">svg :: SVG
</span><a href="#local-6989586621679549533"><span class="hs-identifier hs-var hs-var">svg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; SVG -&gt; SVG
</span><a href="Reanimate.Svg.Constructors.html#scale"><span class="hs-identifier hs-var">scale</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(SVG -&gt; SVG) -&gt; SVG -&gt; SVG
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; SVG
</span><a href="Reanimate.LaTeX.html#latex"><span class="hs-identifier hs-var">latex</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TWord -&gt; Text
</span><a href="Reanimate.Voice.html#wordReference"><span class="hs-identifier hs-var hs-var">wordReference</span></a></span><span> </span><span class="annot"><span class="annottext">TWord
</span><a href="#local-6989586621679549534"><span class="hs-identifier hs-var">tword</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-299"></span><span>  </span><span class="annot"><span class="annottext">Double -&gt; Scene s ()
forall s. Double -&gt; Scene s ()
</span><a href="Reanimate.Scene.Core.html#waitUntil"><span class="hs-identifier hs-var">waitUntil</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TWord -&gt; Double
</span><a href="Reanimate.Voice.html#wordStart"><span class="hs-identifier hs-var hs-var">wordStart</span></a></span><span> </span><span class="annot"><span class="annottext">TWord
</span><a href="#local-6989586621679549534"><span class="hs-identifier hs-var">tword</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-300"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679549532"><span class="annot"><span class="annottext">dur :: Double
</span><a href="#local-6989586621679549532"><span class="hs-identifier hs-var hs-var">dur</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TWord -&gt; Double
</span><a href="Reanimate.Voice.html#wordEnd"><span class="hs-identifier hs-var hs-var">wordEnd</span></a></span><span> </span><span class="annot"><span class="annottext">TWord
</span><a href="#local-6989586621679549534"><span class="hs-identifier hs-var">tword</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">TWord -&gt; Double
</span><a href="Reanimate.Voice.html#wordStart"><span class="hs-identifier hs-var hs-var">wordStart</span></a></span><span> </span><span class="annot"><span class="annottext">TWord
</span><a href="#local-6989586621679549534"><span class="hs-identifier hs-var">tword</span></a></span><span>
</span><span id="line-301"></span><span>  </span><span class="annot"><span class="annottext">Animation -&gt; Scene s ()
forall s. Animation -&gt; Scene s ()
</span><a href="Reanimate.Scene.Sprite.html#play"><span class="hs-identifier hs-var">play</span></a></span><span> </span><span class="annot"><span class="annottext">(Animation -&gt; Scene s ()) -&gt; Animation -&gt; Scene s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; SVG -&gt; Animation
</span><a href="Reanimate.Animation.html#staticFrame"><span class="hs-identifier hs-var">staticFrame</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679549532"><span class="hs-identifier hs-var">dur</span></a></span><span> </span><span class="annot"><span class="annottext">(SVG -&gt; Animation) -&gt; SVG -&gt; Animation
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SVG -&gt; SVG
</span><a href="#local-6989586621679549531"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">(SVG -&gt; SVG) -&gt; SVG -&gt; SVG
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SVG -&gt; SVG
</span><a href="#local-6989586621679549530"><span class="hs-identifier hs-var">outline</span></a></span><span> </span><span class="annot"><span class="annottext">SVG
</span><a href="#local-6989586621679549533"><span class="hs-identifier hs-var">svg</span></a></span><span>
</span><span id="line-302"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-303"></span><span>  </span><span id="local-6989586621679549531"><span class="annot"><span class="annottext">position :: SVG -&gt; SVG
</span><a href="#local-6989586621679549531"><span class="hs-identifier hs-var hs-var">position</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; SVG -&gt; SVG
</span><a href="Reanimate.Svg.Constructors.html#translate"><span class="hs-identifier hs-var">translate</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Double
forall a. Fractional a =&gt; a
</span><a href="Reanimate.Constants.html#screenWidth"><span class="hs-identifier hs-var">screenWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Double
forall a. Fractional a =&gt; a
</span><a href="Reanimate.Constants.html#screenHeight"><span class="hs-identifier hs-var">screenHeight</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-304"></span><span>  </span><span id="local-6989586621679549530"><span class="annot"><span class="annottext">outline :: SVG -&gt; SVG
</span><a href="#local-6989586621679549530"><span class="hs-identifier hs-var hs-var">outline</span></a></span></span><span> </span><span id="local-6989586621679549528"><span class="annot"><span class="annottext">SVG
</span><a href="#local-6989586621679549528"><span class="hs-identifier hs-var">txt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SVG] -&gt; SVG
</span><a href="Reanimate.Svg.Constructors.html#mkGroup"><span class="hs-identifier hs-var">mkGroup</span></a></span><span>
</span><span id="line-305"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double -&gt; SVG -&gt; SVG
</span><a href="Reanimate.Svg.Constructors.html#withStrokeWidth"><span class="hs-identifier hs-var">withStrokeWidth</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="Reanimate.Constants.html#defaultStrokeWidth"><span class="hs-identifier hs-var">defaultStrokeWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">10</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SVG -&gt; SVG) -&gt; SVG -&gt; SVG
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; SVG -&gt; SVG
</span><a href="Reanimate.Svg.Constructors.html#withStrokeColor"><span class="hs-identifier hs-var">withStrokeColor</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;white&quot;</span></span><span> </span><span class="annot"><span class="annottext">SVG
</span><a href="#local-6989586621679549528"><span class="hs-identifier hs-var">txt</span></a></span><span>
</span><span id="line-306"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; SVG -&gt; SVG
</span><a href="Reanimate.Svg.Constructors.html#withStrokeWidth"><span class="hs-identifier hs-var">withStrokeWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">SVG
</span><a href="#local-6989586621679549528"><span class="hs-identifier hs-var">txt</span></a></span><span>
</span><span id="line-307"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-308"></span></pre></body></html>